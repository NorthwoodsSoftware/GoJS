/**
 * @license GoJS
 * GoJS v3.1.5 JavaScript Library for Interactive Diagrams, https://gojs.net
 * GoJS and Northwoods Software are registered trademarks of Northwoods Software Corporation, https://nwoods.com.
 * Copyright 1998-2026 by Northwoods Software Corporation.  All Rights Reserved.
 * THIS SOFTWARE IS LICENSED.  THE LICENSE AGREEMENT IS AT: https://gojs.net/3.1.5/license.html.
 * DO NOT MODIFY THIS FILE.  DO NOT DISTRIBUTE A MODIFIED COPY OF THE CONTENTS OF THIS FILE.
 */
(function() {const root=typeof globalThis=="object"&&globalThis||typeof global=="object"&&global.global===global&&global||typeof self=="object"&&self.self===self&&self||{};root.requestAnimationFrame===void 0&&(root.setImmediate===void 0?root.requestAnimationFrame=w=>root.setTimeout(w,0):root.requestAnimationFrame=root.setImmediate);class U{static fr=root.navigator!==void 0&&root.navigator.platform!==void 0&&root.navigator.platform.match(/(iPhone|iPod|iPad|Mac)/i)!==null;static CP(t,e,i){let s=-1;return function(){const n=this,o=arguments;s!==-1&&U.yc(s),s=U.un(()=>{s=-1,i||t.apply(n,o)},e),i&&!s&&t.apply(n,o)}}static un(t,e){return root.setTimeout(t,e)}static yc(t){root.clearTimeout(t)}static Ni(t){return root.document.createElement(t)}static o(t){throw new Error(t)}static L(t,e){let i="The object is frozen, so its properties cannot be set: "+t.toString();e!==void 0&&(i+="  to value: "+e),U.o(i)}static se(t,e,i,s){}static s(t,e,i,s){}static CU(t,e,i){}static wc(t,e,i){if(t===null||typeof t!="object"){let s=U.TL(e);i!==void 0&&(s+="."+i),U.si(t,"object",s)}}static S(t,e,i){U.s(t,"function",e,i)}static LU(t,e,i){}static si(t,e,i,s){}static J(t,e,i,s){let n=U.TL(i);s!==void 0&&(n+="."+s),U.o(n+" is not in the range "+e+": "+t)}static Xi(t){}static ur(t,e){}static ne(t){root.console&&root.console.log(t)}static $(t){return t!==null&&typeof t=="object"}static st(t){return typeof t=="function"}static LP=[];static nt(){const t=U.LP.pop();return t===void 0?[]:t}static Z(t){t.length=0,U.LP.push(t)}static AU=Object.freeze([]);static TL(t){return t===null?"*":typeof t=="string"?t:U.st(t)?t.name:""}static Kn(t){return U.st(t)?t.className?t.className:t.name:U.$(t)&&t.constructor?U.Kn(t.constructor):typeof t}static $a(t,e){return e==null||e===""?null:U.$(t)&&e in t||t[e]?t[e]:null}static toString(t){let e=t;return U.$(t)&&(t.text?e=t.text:t.name?e=t.name:t.key!==void 0?e=t.key:t.id!==void 0?e=t.id:t.constructor===Object&&(t.Text?e=t.Text:t.Name?e=t.Name:t.Key!==void 0?e=t.Key:t.Id!==void 0?e=t.Id:t.ID!==void 0&&(e=t.ID))),e===void 0?"undefined":e===null?"null":e.toString()}static qw(t,e){if(t.hasOwnProperty(e))return!0;let i=Object.getPrototypeOf(t);for(;i&&i!==Function;){if(i.hasOwnProperty(e))return!0;const s=i.TU;if(s&&s[e])return!0;i=Object.getPrototypeOf(i)}return!1}static XF(t){const e=[];let i=0;for(i=0;i<256;i++)e[i]=i;let s=0,n=0;for(i=0;i<256;i++)s=(s+e[i]+119)%256,n=e[i],e[i]=e[s],e[s]=n;i=0,s=0;let o="";for(let r=0;r<t.length;r++)i=(i+1)%256,s=(s+e[i])%256,n=e[i],e[i]=e[s],e[s]=n,o+=String.fromCharCode(t.charCodeAt(r)^e[(e[i]+e[s])%256]);return o}static GF(t){const e="0123456789abcdef",i=[];for(let r=0;r<256;r++)i[e.charAt(r>>4)+e.charAt(r&15)]=String.fromCharCode(r);t.length%2&&(t="0"+t);const s=[];let n=0;for(let r=0;r<t.length;r+=2)s[n++]=i[t.substring(r,r+2)];const o=s.join("");return o===""?"0":o}static We(t){return U.XF(U.GF(t))}static color1="@COLOR1";static color2="@COLOR2";static jw="32ab5ff3b26f42dc0ed90f21422913b5"}U.vfo="29e647fdb6";class StringBuilder{AP;constructor(){this.AP=[]}toString(){return this.AP.join("")}add(t){t!==""&&this.AP.push(t)}}class PropertyCollection{}class EmptyIterator{g;constructor(){this.g=[]}[Symbol.iterator](){return this.g.values()}key;value;get iterator(){return this}reset(){}next(){return!1}hasNext(){return!1}first(){return null}any(){return!1}all(){return!0}each(){return this}map(t){return this}filter(){return this}get count(){return 0}Ml(){}toString(){return"EmptyIterator"}static instance=new EmptyIterator}class SingletonIterator{constructor(t){this.key=-1,this.value=t}[Symbol.iterator](){return[this.value].values()}key;value;get iterator(){return this}reset(){this.key=-1}next(){return this.key===-1?(this.key=0,!0):!1}hasNext(){return this.next()}first(){return this.key=0,this.value}any(t){return this.key=-1,t(this.value)}all(t){return this.key=-1,t(this.value)}each(t){return this.key=-1,t(this.value),this}map(t){return new SingletonIterator(t(this.value))}filter(t){return t(this.value)?new SingletonIterator(this.value):EmptyIterator.instance}get count(){return 1}Ml(){this.value=null}toString(){return"SingletonIterator("+this.value+")"}}class ListIterator{qt;zs;Gt;Tt;constructor(t){this.qt=t,this.zs=null,t.dr=null,this.Gt=t.rt,this.Tt=-1}[Symbol.iterator](){return this.zs===null?this.qt.r.values():this.qt.r.filter(this.zs).values()}key;value;get iterator(){return this}get predicate(){return this.zs}set predicate(t){this.zs=t}reset(){const t=this.qt;t.dr=null,this.Gt=t.rt,this.Tt=-1}next(){const t=this.qt;if(t.rt!==this.Gt){if(this.key<0)return!1;U.Xi(t)}const e=t.r,i=e.length;let s=++this.Tt;const n=this.zs;if(n!==null)for(;s<i;){const o=e[s];if(n(o))return this.Tt=s,this.key=s,this.value=o,!0;s++}else{if(s<i)return this.key=s,this.value=e[s],!0;this.Ml()}return!1}hasNext(){return this.next()}first(){const t=this.qt;this.Gt=t.rt,this.Tt=0;const e=t.r,i=e.length,s=this.zs;if(s!==null){let n=0;for(;n<i;){const o=e[n];if(s(o))return this.Tt=n,this.key=n,this.value=o,o;n++}return null}else if(i>0){const n=e[0];return this.key=0,this.value=n,n}else return null}any(t){const e=this.qt;e.dr=null;const i=e.rt;this.Tt=-1;const s=e.r,n=s.length,o=this.zs;for(let r=0;r<n;r++){const l=s[r];if(!(o!==null&&!o(l))){if(t(l))return!0;e.rt!==i&&U.Xi(e)}}return!1}all(t){const e=this.qt;e.dr=null;const i=e.rt;this.Tt=-1;const s=e.r,n=s.length,o=this.zs;for(let r=0;r<n;r++){const l=s[r];if(!(o!==null&&!o(l))){if(!t(l))return!1;e.rt!==i&&U.Xi(e)}}return!0}each(t){const e=this.qt;e.dr=null;const i=e.rt;this.Tt=-1;const s=e.r,n=s.length,o=this.zs;for(let r=0;r<n;r++){const l=s[r];o!==null&&!o(l)||(t(l),e.rt!==i&&U.Xi(e))}return this}map(t){const e=this.qt;e.dr=null;const i=e.rt;this.Tt=-1;const s=[],n=e.r,o=n.length,r=this.zs;for(let a=0;a<o;a++){const h=n[a];r!==null&&!r(h)||(s.push(t(h)),e.rt!==i&&U.Xi(e))}const l=new List;return l.r=s,l.Gi(),l.iterator}filter(t){const e=this.qt;e.dr=null;const i=e.rt;this.Tt=-1;const s=[],n=e.r,o=n.length,r=this.zs;for(let a=0;a<o;a++){const h=n[a];r!==null&&!r(h)||(t(h)&&s.push(h),e.rt!==i&&U.Xi(e))}const l=new List;return l.r=s,l.Gi(),l.iterator}get count(){const t=this.zs;if(t!==null){let e=0;const i=this.qt.r,s=i.length;for(let n=0;n<s;n++)t(i[n])&&e++;return e}else return this.qt.r.length}Ml(){this.key=-1,this.value=null,this.Gt=-1,this.zs=null,this.qt.dr=this}toString(){return"ListIterator@"+this.Tt+"/"+this.qt.count}}class ListIteratorBackwards{qt;Gt;Tt;constructor(t){this.qt=t,t.gr=null,this.Gt=t.rt,this.Tt=t.r.length}[Symbol.iterator](){return this.qt.r.reverse().values()}key;value;get iterator(){return this}reset(){const t=this.qt;t.gr=null,this.Gt=t.rt,this.Tt=t.r.length}next(){const t=this.qt;if(t.rt!==this.Gt){if(this.key<0)return!1;U.Xi(t)}const e=--this.Tt;return e>=0?(this.key=e,this.value=t.r[e],!0):(this.Ml(),!1)}hasNext(){return this.next()}first(){const t=this.qt;this.Gt=t.rt;const e=t.r,i=e.length-1;if(this.Tt=i,i>=0){const s=e[i];return this.key=i,this.value=s,s}else return null}any(t){const e=this.qt;e.gr=null;const i=e.rt,s=e.r,n=s.length;this.Tt=n;for(let o=n-1;o>=0;o--){const r=s[o];if(t(r))return!0;e.rt!==i&&U.Xi(e)}return!1}all(t){const e=this.qt;e.gr=null;const i=e.rt,s=e.r,n=s.length;this.Tt=n;for(let o=n-1;o>=0;o--){const r=s[o];if(!t(r))return!1;e.rt!==i&&U.Xi(e)}return!0}each(t){const e=this.qt;e.gr=null;const i=e.rt,s=e.r,n=s.length;this.Tt=n;for(let o=n-1;o>=0;o--){const r=s[o];t(r),e.rt!==i&&U.Xi(e)}return this}map(t){const e=this.qt;e.gr=null;const i=e.rt,s=[],n=e.r,o=n.length;this.Tt=o;for(let l=o-1;l>=0;l--){const a=n[l];s.push(t(a)),e.rt!==i&&U.Xi(e)}const r=new List;return r.r=s,r.Gi(),r.iterator}filter(t){const e=this.qt;e.gr=null;const i=e.rt,s=[],n=e.r,o=n.length;this.Tt=o;for(let l=o-1;l>=0;l--){const a=n[l];t(a)&&s.push(a),e.rt!==i&&U.Xi(e)}const r=new List;return r.r=s,r.Gi(),r.iterator}get count(){return this.qt.r.length}Ml(){this.key=-1,this.value=null,this.Gt=-1,this.qt.gr=this}toString(){return"ListIteratorBackwards("+this.Tt+"/"+this.qt.count+")"}}class List{u;r;rt;dr;gr;constructor(t){GSet.Je(this),this.u=!1,this.r=[],this.rt=0,this.dr=null,this.gr=null,t!==void 0&&this.addAll(t)}[Symbol.iterator](){return this.r.values()}Gi(){let t=this.rt;t++,t>999999999&&(t=0),this.rt=t}k(){return this.u=!0,this}ce(){return this.u=!1,this}toString(){return"List()#"+GSet.xs(this)}add(t){return this.u&&U.L(this,t),this.r.push(t),this.Gi(),this}push(t){this.add(t)}addAll(t){if(t===null)return this;this.u&&U.L(this);const e=this.r;if(t.first){const i=t.iterator;for(;i.next();)e.push(i.value)}else for(const i of t)e.push(i);return this.Gi(),this}clear(){this.u&&U.L(this),this.r.length=0,this.Gi()}contains(t){return this.has(t)}has(t){return t===null?!1:this.r.indexOf(t)!==-1}indexOf(t){return t===null?-1:this.r.indexOf(t)}elt(t){const e=this.r;return(t<0||t>=e.length)&&U.J(t,"0 <= i < length",List,"elt:i"),e[t]}get(t){return this.elt(t)}setElt(t,e){const i=this.r;(t<0||t>=i.length)&&U.J(t,"0 <= i < length",List,"setElt:i"),this.u&&U.L(this,t),i[t]=e}set(t,e){this.setElt(t,e)}first(){const t=this.r;return t.length===0?null:t[0]}last(){const t=this.r,e=t.length;return e>0?t[e-1]:null}pop(){this.u&&U.L(this);const t=this.r;if(t.length>0){const e=t.pop();return e===void 0?null:e}return null}any(t){const e=this.r,i=this.rt,s=e.length;for(let n=0;n<s;n++){if(t(e[n]))return!0;this.rt!==i&&U.Xi(this)}return!1}all(t){const e=this.r,i=this.rt,s=e.length;for(let n=0;n<s;n++){if(!t(e[n]))return!1;this.rt!==i&&U.Xi(this)}return!0}each(t){const e=this.r,i=this.rt,s=e.length;for(let n=0;n<s;n++)t(e[n]),this.rt!==i&&U.Xi(this);return this}map(t){const e=new List,i=[],s=this.r,n=this.rt,o=s.length;for(let r=0;r<o;r++)i.push(t(s[r])),this.rt!==n&&U.Xi(this);return e.r=i,e.Gi(),e}filter(t){const e=new List,i=[],s=this.r,n=this.rt,o=s.length;for(let r=0;r<o;r++){const l=s[r];t(l)&&i.push(l),this.rt!==n&&U.Xi(this)}return e.r=i,e.Gi(),e}insertAt(t,e){t<0&&U.J(t,">= 0",List,"insertAt:i"),this.u&&U.L(this,t);const i=this.r;t>=i.length?i.push(e):i.splice(t,0,e),this.Gi()}remove(t){return this.delete(t)}delete(t){if(t===null)return!1;this.u&&U.L(this,t);const e=this.r,i=e.indexOf(t);return i===-1?!1:(i===e.length-1?e.pop():e.splice(i,1),this.Gi(),!0)}removeAt(t){const e=this.r;(t<0||t>=e.length)&&U.J(t,"0 <= i < length",List,"removeAt:i"),this.u&&U.L(this,t),t===e.length-1?e.pop():e.splice(t,1),this.Gi()}removeRange(t,e){const i=this.r,s=i.length;if(t<0)t=0;else if(t>=s)return this;if(e<0)return this;if(e>=s&&(e=s-1),t>e)return this;this.u&&U.L(this);let n=t,o=e+1;for(;o<s;)i[n++]=i[o++];return i.length=s-(e-t+1),this.Gi(),this}copy(){const t=new List,e=this.r;return e.length>0&&(t.r=Array.prototype.slice.call(e)),t}toArray(){const t=this.r,e=this.count,i=new Array(e);for(let s=0;s<e;s++)i[s]=t[s];return i}get DL(){return this.r}toSet(){const t=new GSet,e=this.r,i=this.count;for(let s=0;s<i;s++)t.add(e[s]);return t}sort(t){return this.u&&U.L(this),this.r.sort(t),this.Gi(),this}sortRange(t,e,i){const s=this.r,n=s.length;e===void 0&&(e=0),i===void 0&&(i=n),this.u&&U.L(this);const o=i-e;if(o<=1)return this;if((e<0||e>=n-1)&&U.J(e,"0 <= from < length",List,"sortRange:from"),o===2){const r=s[e],l=s[e+1];return t(r,l)>0&&(s[e]=l,s[e+1]=r,this.Gi()),this}if(e===0)if(i>=n)s.sort(t);else{const r=s.slice(0,i);r.sort(t);for(let l=0;l<i;l++)s[l]=r[l]}else if(i>=n){const r=s.slice(e);r.sort(t);for(let l=e;l<n;l++)s[l]=r[l-e]}else{const r=s.slice(e,i);r.sort(t);for(let l=e;l<i;l++)s[l]=r[l-e]}return this.Gi(),this}reverse(){return this.u&&U.L(this),this.r.reverse(),this.Gi(),this}get count(){return this.r.length}get size(){return this.r.length}get length(){return this.r.length}get iterator(){if(this.r.length<=0)return EmptyIterator.instance;const t=this.dr;return t!==null?(t.reset(),t):new ListIterator(this)}get iteratorBackwards(){if(this.r.length<=0)return EmptyIterator.instance;const t=this.gr;return t!==null?(t.reset(),t):new ListIteratorBackwards(this)}}class SetIterator{To;oe;constructor(t){this.To=t,this.oe=t.g.values()}[Symbol.iterator](){return this.To.g.values()}key;value;get iterator(){return this}reset(){const t=this.To;this.oe=t.g.values()}next(){const t=this.oe.next();return this.value=t.value,this.key=t.value,!t.done}hasNext(){return this.next()}first(){return this.To.g.size===0?null:(this.oe=this.To.g.values(),this.oe.next().value)}any(t){return this.To.any(t)}all(t){return this.To.all(t)}each(t){return this.To.each(t),this}map(t){const e=new List;return this.To.g.forEach(i=>e.add(t(i))),e.iterator}filter(t){const e=new List;return this.To.g.forEach(i=>{t(i)&&e.add(i)}),e.iterator}get count(){return this.To.count}Ml(){this.key=null,this.value=null,this.oe=null}toString(){return"SetIterator"}}class GSet{u;g;constructor(t){this.u=!1,this.g=new Set,t!==void 0&&this.addAll(t)}[Symbol.iterator](){return this.g.values()}values(){return this.g.values()}k(){return this.u=!0,this}ce(){return this.u=!1,this}toString(){return"Set()#"+GSet.xs(this)}add(t){return t===null?this:(this.g.add(t),this)}addAll(t){if(t===null)return this;if(this.u&&U.L(this),t.first){const e=t.iterator;for(;e.next();)this.g.add(e.value)}else for(const e of t)this.g.add(e);return this}has(t){return this.g.has(t)}contains(t){return this.has(t)}containsAll(t){if(t===null)return!0;if(t.first){const e=t.iterator;for(;e.next();)if(!this.has(e.value))return!1}else for(const e of t)if(!this.has(e))return!1;return!0}containsAny(t){if(t===null)return!0;if(t.first){const e=t.iterator;for(;e.next();)if(this.has(e.value))return!0}else for(const e of t)if(this.has(e))return!0;return!1}first(){return this.g.size===0?null:this.g.values().next().value}any(t){for(const e of this.g)if(t(e))return!0;return!1}all(t){for(const e of this.g)if(!t(e))return!1;return!0}each(t){for(const e of this.g)t(e);return this}map(t){const e=new GSet;for(const i of this.g)e.add(t(i));return e}filter(t){const e=new GSet;for(const i of this.g)t(i)&&e.add(i);return e}delete(t){return this.u&&U.L(this),this.g.delete(t)}remove(t){return this.delete(t)}removeAll(t){if(t===null)return this;if(this.u&&U.L(this),t.first){const e=t.iterator;for(;e.next();)this.delete(e.value)}else for(const e of t)this.delete(e);return this}retainAll(t){if(t===null)return this;if(this.count===0)return this;this.u&&U.L(this);const e=new GSet;e.addAll(t);const i=[];if(t.first){const s=t.iterator;for(;s.next();){const n=s.value;e.has(n)||i.push(n)}}else for(const s of t)e.has(s)||i.push(s);return this.removeAll(i),this}clear(){this.u&&U.L(this),this.g.clear()}copy(){const t=new GSet;return this.g.forEach(e=>t.add(e)),t}toArray(){return Array.from(this.g)}toList(){const t=new List;return this.g.forEach(e=>t.add(e)),t}get count(){return this.g.size}get size(){return this.g.size}get iterator(){return this.g.size<=0?EmptyIterator.instance:new SetIterator(this)}entries(){return this.g.entries()}keys(){return this.g.keys()}forEach(t,e){return this.g.forEach(t,e)}static Ww=1;static Je(t){t.__gohashid=GSet.Ww++}static xs(t){return t.__gohashid}}class MapKeySetIterator{j;oe;constructor(t){this.j=t,this.oe=t.g.keys()}[Symbol.iterator](){return this.j.g.keys()}key;value;get iterator(){return this}reset(){const t=this.j;this.oe=t.g.keys()}next(){const t=this.oe.next();return this.value=t.value,this.key=t.value,!t.done}hasNext(){return this.next()}first(){return this.j.g.size===0?null:(this.oe=this.j.g.keys(),this.oe.next().value)}any(t){for(const e of this.j.g)if(t(e[0]))return!0;return!1}all(t){for(const e of this.j.g)if(!t(e[0]))return!1;return!0}each(t){for(const e of this.j.g)t(e[0]);return this}map(t){const e=this.j,i=new List;for(const s of e.g)i.add(t(s[0]));return i.iterator}filter(t){const e=this.j,i=new List;for(const s of e.g){const n=s[0];t(n)&&i.add(n)}return i.iterator}get count(){return this.j.size}Ml(){this.key=null,this.value=null,this.oe=null}toString(){return"MapKeySetIterator"}}class MapKeySet extends GSet{j;constructor(t){super(),GSet.Je(this),this.u=!0,this.j=t}[Symbol.iterator](){return this.g.keys()}values(){return this.g.keys()}k(){return this}ce(){return this}toString(){return"MapKeySet("+this.j.toString()+")"}add(t){U.o("This Set is read-only: "+this.toString())}has(t){return this.j.has(t)}contains(t){return this.has(t)}delete(t){U.o("This Set is read-only: "+this.toString())}remove(t){return this.delete(t)}clear(){U.o("This Set is read-only: "+this.toString())}first(){return this.j.g.size===0?null:this.j.g.keys().next().value}any(t){for(const e of this.j.g)if(t(e[0]))return!0;return!1}all(t){for(const e of this.j.g)if(!t(e[0]))return!1;return!0}each(t){for(const e of this.j.g)t(e[0]);return this}map(t){const e=new GSet;for(const i of this.j.g)e.add(t(i[0]));return e}filter(t){const e=new GSet;for(const i of this.j.g){const s=i[0];t(s)&&e.add(s)}return e}copy(){return new MapKeySet(this.j)}toSet(){const t=new GSet,e=this.j.g;for(const i of e)t.add(i[0]);return t}toArray(){const t=this.j.g,e=new Array(t.size);let i=0;for(const s of t)e[i]=s[0],i++;return e}toList(){const t=new List,e=this.j.g;for(const i of e)t.add(i[0]);return t}get count(){return this.j.size}get size(){return this.j.size}get iterator(){return this.j.size<=0?EmptyIterator.instance:new MapKeySetIterator(this.j)}}class MapValueSetIterator{j;oe;constructor(t){this.j=t,this.oe=t.g.values()}[Symbol.iterator](){return this.j.g.values()}key;value;get iterator(){return this}reset(){const t=this.j;this.oe=t.g.values()}next(){const t=this.oe.next();return this.value=t.value,this.key=t.value,!t.done}hasNext(){return this.next()}first(){return this.j.g.size===0?null:(this.oe=this.j.g.values(),this.oe.next().value)}any(t){for(const e of this.j.g)if(t(e[1]))return!0;return!1}all(t){for(const e of this.j.g)if(!t(e[1]))return!1;return!0}each(t){for(const e of this.j.g)t(e[1]);return this}map(t){const e=this.j,i=new List;for(const s of e.g)i.add(t(s[1]));return i.iterator}filter(t){const e=this.j,i=new List;for(const s of e.g){const n=s[1];t(n)&&i.add(n)}return i.iterator}get count(){return this.j.size}Ml(){this.key=null,this.value=null,this.oe=null}toString(){return"MapValueSetIterator"}}class KeyValuePair{constructor(t,e){this.key=t,this.value=e}toString(){return"{"+this.key+":"+this.value+"}"}key;value}class MapIterator{j;oe;constructor(t){this.j=t,this.oe=t.g.entries()}[Symbol.iterator](){return this.j.g.entries()}key;value;get iterator(){return this}reset(){const t=this.j;this.oe=t.g.entries()}next(){const t=this.oe.next();return t.done?(this.key=null,this.value=null,!1):(this.key=t.value[0],this.value=t.value[1],!0)}hasNext(){return this.next()}first(){if(this.j.g.size===0)return null;this.oe=this.j.g.entries();const t=this.oe.next().value;return this.key=t[0],this.value=t[1],new KeyValuePair(t[0],t[1])}any(t){return this.j.any(t)}all(t){return this.j.all(t)}each(t){return this.j.each(t),this}map(t){const e=new List;let i=null;return this.j.g.forEach((s,n)=>{i===null?i=new KeyValuePair(n,s):(i.key=n,i.value=s),e.add(t(i))}),e.iterator}filter(t){const e=new List;let i=null;return this.j.g.forEach((s,n)=>{i===null?i=new KeyValuePair(n,s):(i.key=n,i.value=s),t(i)&&(e.add(i),i=null)}),e.iterator}get count(){return this.j.size}Ml(){this.key=null,this.value=null,this.oe=null}toString(){return"MapIterator"}}class GMap{u;g;constructor(t){GSet.Je(this),this.u=!1,this.g=new Map,t!==void 0&&this.addAll(t)}[Symbol.iterator](){return this.g.entries()}entries(){return this.g.entries()}k(){return this.u=!0,this}ce(){return this.u=!1,this}toString(){return"Map()#"+GSet.xs(this)}set(t,e){return this.u&&U.L(this,t),this.g.set(t,e),this}add(t,e){return this.set(t,e)}addAll(t){if(t===null)return this;if(this.u&&U.L(this),t instanceof GMap){const e=t.iterator;for(;e.next();)this.g.set(e.key,e.value)}else if(t.first){const e=t.iterator;for(;e.next();){const i=e.value;this.g.set(i.key,i.value)}}else for(const e of t){const i=e;Array.isArray(i)?this.g.set(i[0],i[1]):this.g.set(i.key,i.value)}return this}first(){if(this.g.size===0)return null;const t=this.g.entries().next().value;return t?new KeyValuePair(t[0],t[1]):null}any(t){let e=null;for(const[i,s]of this.g)if(e===null?e=new KeyValuePair(i,s):(e.key=i,e.value=s),t(e))return!0;return!1}all(t){let e=null;for(const[i,s]of this.g)if(e===null?e=new KeyValuePair(i,s):(e.key=i,e.value=s),!t(e))return!1;return!0}each(t){let e=null;for(const[i,s]of this.g)e===null?e=new KeyValuePair(i,s):(e.key=i,e.value=s),t(e);return this}map(t){const e=new GMap;let i=null;for(const[s,n]of this.g)i===null?i=new KeyValuePair(s,n):(i.key=s,i.value=n),e.set(s,t(i));return e}filter(t){const e=new GMap;let i=null;for(const[s,n]of this.g)i===null?i=new KeyValuePair(s,n):(i.key=s,i.value=n),t(i)&&e.set(s,n);return e}has(t){return this.g.has(t)}contains(t){return this.has(t)}get(t){const e=this.g.get(t);return e===void 0?null:e}getValue(t){return this.get(t)}delete(t){return t===null?!1:(this.u&&U.L(this,t),this.g.delete(t))}remove(t){return this.delete(t)}clear(){this.u&&U.L(this),this.g.clear()}copy(){const t=new GMap;return t.g=new Map(this.g),t}toArray(){const t=this.g,e=new Array(t.size);let i=0;for(const s of t)e[i]=new KeyValuePair(s[0],s[1]),i++;return e}toKeySet(){return new MapKeySet(this)}get count(){return this.g.size}get size(){return this.g.size}get iterator(){return this.g.size<=0?EmptyIterator.instance:new MapIterator(this)}get iteratorKeys(){return this.count<=0?EmptyIterator.instance:new MapKeySetIterator(this)}keys(){return this.g.keys()}get iteratorValues(){return this.count<=0?EmptyIterator.instance:new MapValueSetIterator(this)}values(){return this.g.values()}forEach(t,e){return this.g.forEach(t,e)}}class Point{px;py;u;constructor(t,e){t===void 0?(this.px=0,this.py=0):typeof t=="number"&&typeof e=="number"?(this.px=t,this.py=e):U.o("Invalid arguments to Point constructor: "+t+", "+e),this.u=!1}h(t){return this.px=t.px,this.py=t.py,this}e(t,e){return this.px=t,this.py=e,this}setTo(t,e){return this.px=t,this.py=e,this}set(t){return this.px=t.px,this.py=t.py,this}copy(){const t=new Point;return t.px=this.px,t.py=this.py,t}kt(){return this.u=!0,Object.freeze(this),this}N(){return this.u||Object.isFrozen(this)?this:this.copy().k()}k(){return this.u||(this.u=!0),this}Jw(t){}static parse(t){if(typeof t=="string"){const e=t.split(" ");let i=0,s=0;for(;e[i]==="";)i++;let n=e[i++];n&&(s=parseFloat(n));let o=0;for(;e[i]==="";)i++;return n=e[i++],n&&(o=parseFloat(n)),new Point(s,o)}else return new Point}static stringify(t){return t.x.toString()+" "+t.y.toString()}static stringifyFixed(t){return U.s(t,"number",Point,"stringifyFixed:digits"),e=>e.x.toFixed(t)+" "+e.y.toFixed(t)}toString(){return"Point("+this.x+","+this.y+")"}equals(t){return t instanceof Point?this.px===t.x&&this.py===t.y:!1}equalTo(t,e){return this.px===t&&this.py===e}equalsApprox(t){return G.c(this.px,t.x)&&G.c(this.py,t.y)}add(t){return this.px+=t.x,this.py+=t.y,this}subtract(t){return this.px-=t.x,this.py-=t.y,this}offset(t,e){return this.px+=t,this.py+=e,this}rotate(t){if(t===0)return this;const e=this.px,i=this.py;if(e===0&&i===0)return this;let s=0,n=0;if(t=G.Ee(t),t===90)s=0,n=1;else if(t===180)s=-1,n=0;else if(t===270)s=0,n=-1;else{const o=t*Math.PI/180;s=Math.cos(o),n=Math.sin(o)}return this.px=s*e-n*i,this.py=n*e+s*i,this}scale(t,e){return this.px*=t,this.py*=e,this}distanceSquaredPoint(t){const e=t.x-this.px,i=t.y-this.py;return e*e+i*i}distanceSquared(t,e){const i=t-this.px,s=e-this.py;return i*i+s*s}normalize(){const t=this.px,e=this.py,i=Math.sqrt(t*t+e*e);return i>0&&(this.px=t/i,this.py=e/i),this}directionPoint(t){return this.vL(t.x-this.px,t.y-this.py)}direction(t,e){return this.vL(t-this.px,e-this.py)}vL(t,e){if(t===0)return e>0?90:e<0?270:0;if(e===0)return t>0?0:180;{if(isNaN(t)||isNaN(e))return 0;let i=Math.atan(Math.abs(e/t))*180/Math.PI;return t<0?e<0?i+=180:i=180-i:e<0&&(i=360-i),i}}static compareWithLineSegment(t,e,i,s,n,o){return G.bu(t,e,i,s,n,o)}compareWithLineSegmentPoint(t,e){return G.bu(t.x,t.y,e.x,e.y,this.x,this.y)}static intersectingLineSegments(t,e,i,s,n,o,r,l){return G.ku(t,e,i,s,n,o,r,l)}projectOntoLineSegment(t,e,i,s){return G.Nl(t,e,i,s,this.px,this.py,this),this}projectOntoLineSegmentPoint(t,e){return G.Nl(t.x,t.y,e.x,e.y,this.px,this.py,this),this}snapToGrid(t,e,i,s){return G.tm(this.px,this.py,t,e,i,s,this),this}snapToGridPoint(t,e){return G.tm(this.px,this.py,t.x,t.y,e.width,e.height,this),this}setRectSpot(t,e){return this.px=t.x+e.x*t.width+e.offsetX,this.py=t.y+e.y*t.height+e.offsetY,this}setSpot(t,e,i,s,n){return this.px=t+n.x*i+n.offsetX,this.py=e+n.y*s+n.offsetY,this}v(t){return t.gt(this),this}Yi(t){return t.Ci(this),this}static distanceLineSegmentSquared(t,e,i,s,n,o){let r=n-i,l=o-s;const a=r*r+l*l,h=i-t,c=s-e,f=-h*r-c*l;if(f<=0||f>=a)return r=n-t,l=o-e,Math.min(h*h+c*c,r*r+l*l);{const u=r*c-l*h;return u*u/a}}static distanceSquared(t,e,i,s){const n=i-t,o=s-e;return n*n+o*o}static direction(t,e,i,s){const n=i-t,o=s-e;if(n===0)return o>0?90:o<0?270:0;if(o===0)return n>0?0:180;{if(isNaN(n)||isNaN(o))return 0;let r=Math.atan(Math.abs(o/n))*180/Math.PI;return n<0?o<0?r+=180:r=180-r:o<0&&(r=360-r),r}}get x(){return this.px}set x(t){this.px=t}get y(){return this.py}set y(t){this.py=t}isReal(){return isFinite(this.x)&&isFinite(this.y)}static dn=new Point(0,0).kt();static FL=new Point(-1/0,-1/0).kt();static RL=new Point(1/0,1/0).kt();static OL=new Point(6,6).kt();static gn=new Point(NaN,NaN).kt();static $w=[];static l(){const t=Point.$w.pop();return t===void 0?new Point:t}static bs(t){const e=Point.$w.pop();return e===void 0?t.copy():e.h(t)}static z(t,e){const i=Point.$w.pop();return i===void 0?new Point(t,e):(i.x=t,i.y=e,i)}static i(t){Point.$w.push(t)}}class Size{sw;sh;u;constructor(t,e){t===void 0?(this.sw=0,this.sh=0):typeof t=="number"&&(t>=0||isNaN(t))&&typeof e=="number"&&(e>=0||isNaN(e))?(this.sw=t,this.sh=e):U.o("Invalid arguments to Size constructor: "+t+", "+e),this.u=!1}h(t){return this.sw=t.sw,this.sh=t.sh,this}e(t,e){return this.sw=t,this.sh=e,this}setTo(t,e){return this.sw=t,this.sh=e,this}set(t){return this.sw=t.sw,this.sh=t.sh,this}copy(){const t=new Size;return t.sw=this.sw,t.sh=this.sh,t}kt(){return this.u=!0,Object.freeze(this),this}N(){return this.u||Object.isFrozen(this)?this:this.copy().k()}k(){return this.u||(this.u=!0),this}Jw(t){}static parse(t){if(typeof t=="string"){const e=t.split(" ");let i=0,s=0;for(;e[i]==="";)i++;let n=e[i++];n&&(s=parseFloat(n));let o=0;for(;e[i]==="";)i++;return n=e[i++],n&&(o=parseFloat(n)),new Size(s,o)}else return new Size}static stringify(t){return t.width.toString()+" "+t.height.toString()}static stringifyFixed(t){return U.s(t,"number",Size,"stringifyFixed:digits"),e=>e.width.toFixed(t)+" "+e.height.toFixed(t)}toString(){return"Size("+this.width+","+this.height+")"}equals(t){return t instanceof Size?this.sw===t.width&&this.sh===t.height:!1}equalTo(t,e){return this.sw===t&&this.sh===e}equalsApprox(t){return G.c(this.sw,t.width)&&G.c(this.sh,t.height)}inflate(t,e){const i=this.width+t;this.sw=i>=0?i:0;const s=this.height+e;return this.sh=s>=0?s:0,this}get width(){return this.sw}set width(t){t<0&&U.J(t,">= 0",Size,"width"),this.sw=t}get height(){return this.sh}set height(t){t<0&&U.J(t,">= 0",Size,"height"),this.sh=t}isReal(){return isFinite(this.width)&&isFinite(this.height)}static xc=new Size(0,0).kt();static TP=new Size(1,1).kt();static IL=new Size(6,6).kt();static Pu=new Size(8,8).kt();static EL=new Size(10,10).kt();static DP=new Size(1/0,1/0).kt();static Zw=new Size(NaN,NaN).kt();static UL=[];static l(){const t=Size.UL.pop();return t===void 0?new Size:t}static i(t){Size.UL.push(t)}}class Rect{rx;ry;rw;rh;u;constructor(t,e,i,s){if(t===void 0)this.rx=0,this.ry=0,this.rw=0,this.rh=0;else if(typeof t=="number"&&typeof e=="number"&&typeof i=="number"&&(i>=0||isNaN(i))&&typeof s=="number"&&(s>=0||isNaN(s)))this.rx=t,this.ry=e,this.rw=i,this.rh=s;else if(t instanceof Point){const n=t.x,o=t.y;if(e instanceof Point){const r=e.x,l=e.y;this.rx=Math.min(n,r),this.ry=Math.min(o,l),this.rw=Math.abs(n-r),this.rh=Math.abs(o-l)}else e instanceof Size?(this.rx=n,this.ry=o,this.rw=e.width,this.rh=e.height):U.o("Incorrect second argument supplied to Rect constructor "+e)}else U.o("Invalid arguments to Rect constructor: "+t+", "+e+", "+i+", "+s);this.u=!1}h(t){return this.rx=t.rx,this.ry=t.ry,this.rw=t.rw,this.rh=t.rh,this}e(t,e,i,s){return this.rx=t,this.ry=e,this.rw=i,this.rh=s,this}Hn(t,e){return this.rw=t,this.rh=e,this}setTo(t,e,i,s){return this.rx=t,this.ry=e,this.rw=i,this.rh=s,this}set(t){return this.rx=t.rx,this.ry=t.ry,this.rw=t.rw,this.rh=t.rh,this}setPoint(t){return this.rx=t.x,this.ry=t.y,this}setSize(t){return this.rw=t.width,this.rh=t.height,this}copy(){const t=new Rect;return t.rx=this.rx,t.ry=this.ry,t.rw=this.rw,t.rh=this.rh,t}kt(){return this.u=!0,Object.freeze(this),this}N(){return this.u||Object.isFrozen(this)?this:this.copy().k()}k(){return this.u||(this.u=!0),this}ce(){return this.u&&(Object.isFrozen(this)&&U.o("cannot thaw constant: "+this),this.u=!1),this}Jw(t){}static parse(t){if(typeof t=="string"){const e=t.split(" ");let i=0,s=0;for(;e[i]==="";)i++;let n=e[i++];n&&(s=parseFloat(n));let o=0;for(;e[i]==="";)i++;n=e[i++],n&&(o=parseFloat(n));let r=0;for(;e[i]==="";)i++;n=e[i++],n&&(r=parseFloat(n));let l=0;for(;e[i]==="";)i++;return n=e[i++],n&&(l=parseFloat(n)),new Rect(s,o,r,l)}else return new Rect}static stringify(t){return t.x.toString()+" "+t.y.toString()+" "+t.width.toString()+" "+t.height.toString()}static stringifyFixed(t){return U.s(t,"number",Rect,"stringifyFixed:digits"),e=>e.x.toFixed(t)+" "+e.y.toFixed(t)+" "+e.width.toFixed(t)+" "+e.height.toFixed(t)}toString(){return"Rect("+this.x+","+this.y+","+this.width+","+this.height+")"}equals(t){return t instanceof Rect?this.rx===t.x&&this.ry===t.y&&this.rw===t.width&&this.rh===t.height:!1}equalTo(t,e,i,s){return this.rx===t&&this.ry===e&&this.rw===i&&this.rh===s}equalsApprox(t){return G.c(this.rx,t.x)&&G.c(this.ry,t.y)&&G.c(this.rw,t.width)&&G.c(this.rh,t.height)}equalsApproxTo(t,e,i,s){return G.c(this.rx,t)&&G.c(this.ry,e)&&G.c(this.rw,i)&&G.c(this.rh,s)}equalsApproxClose(t){return G.X(this.rx,t.x)&&G.X(this.ry,t.y)&&G.X(this.rw,t.width)&&G.X(this.rh,t.height)}containsPoint(t){return this.rx<=t.x&&this.rx+this.rw>=t.x&&this.ry<=t.y&&this.ry+this.rh>=t.y}containsRect(t){return this.rx<=t.x&&t.x+t.width<=this.rx+this.rw&&this.ry<=t.y&&t.y+t.height<=this.ry+this.rh}contains(t,e,i,s){return i===void 0&&(i=0),s===void 0&&(s=0),this.rx<=t&&t+i<=this.rx+this.rw&&this.ry<=e&&e+s<=this.ry+this.rh}offset(t,e){return this.rx+=t,this.ry+=e,this}inflate(t,e){return this.Qw(e,t,e,t)}addMargin(t){return this.Qw(t.top,t.right,t.bottom,t.left)}subtractMargin(t){return this.Qw(-t.top,-t.right,-t.bottom,-t.left)}grow(t,e,i,s){return this.Qw(t,e,i,s)}Qw(t,e,i,s){const n=this.rw;e+s<=-n?(this.rx+=n/2,this.rw=0):(this.rx-=s,this.rw+=e+s);const o=this.rh;return t+i<=-o?(this.ry+=o/2,this.rh=0):(this.ry-=t,this.rh+=t+i),this}intersectRect(t){return this.VL(t.x,t.y,t.width,t.height)}intersect(t,e,i,s){return this.VL(t,e,i,s)}VL(t,e,i,s){const n=Math.max(this.rx,t),o=Math.max(this.ry,e),r=Math.min(this.rx+this.rw,t+i),l=Math.min(this.ry+this.rh,e+s);return this.rx=n,this.ry=o,this.rw=Math.max(0,r-n),this.rh=Math.max(0,l-o),this}intersectsRect(t){return this.intersects(t.x,t.y,t.width,t.height)}intersects(t,e,i,s){let n=this.rw;const o=this.rx;if(n!==1/0&&i!==1/0&&(n+=o,i+=t,isNaN(i)||isNaN(n)||o>i||t>n))return!1;let r=this.rh;const l=this.ry;return!(r!==1/0&&s!==1/0&&(r+=l,s+=e,isNaN(s)||isNaN(r)||l>s||e>r))}BL(t,e){let i=this.rw,s=t.width+e+e;const n=this.rx,o=t.x-e;if(i+=n,s+=o,n>s||o>i)return!1;let r=this.rh,l=t.height+e+e;const a=this.ry,h=t.y-e;return r+=a,l+=h,!(a>l||h>r)}unionPoint(t){return this.re(t.x,t.y,0,0)}unionRect(t){return this.re(t.rx,t.ry,t.rw,t.rh)}union(t,e,i,s){return i===void 0&&(i=0),s===void 0&&(s=0),this.re(t,e,i,s)}re(t,e,i,s){const n=Math.min(this.rx,t),o=Math.min(this.ry,e),r=Math.max(this.rx+this.rw,t+i),l=Math.max(this.ry+this.rh,e+s);return this.rx=n,this.ry=o,this.rw=r-n,this.rh=l-o,this}setSpot(t,e,i){return this.rx=t-i.offsetX-i.x*this.rw,this.ry=e-i.offsetY-i.y*this.rh,this}nearestSideDirection(t,e){return G._w(this,t,e,!0)}nearestSideDirectionPoint(t){return G._w(this,t.x,t.y,!0)}static contains(t,e,i,s,n,o,r,l){return r===void 0&&(r=0),l===void 0&&(l=0),t<=n&&n+r<=t+i&&e<=o&&o+l<=e+s}static intersects(t,e,i,s,n,o,r,l){let a=i,h=r;const c=t,f=n;if(a+=c,h+=f,c>h||f>a)return!1;let u=s,d=l;const m=e,g=o;return u+=m,d+=g,!(m>d||g>u)}static intersectsLineSegment(t,e,i,s,n,o,r,l){return G.zL(t,e,i,s,n,o,r,l)}get x(){return this.rx}set x(t){this.rx=t}get y(){return this.ry}set y(t){this.ry=t}get width(){return this.rw}set width(t){t<0&&U.J(t,">= 0",Rect,"width"),this.rw=t}get height(){return this.rh}set height(t){t<0&&U.J(t,">= 0",Rect,"height"),this.rh=t}get left(){return this.rx}set left(t){this.rx=t}get top(){return this.ry}set top(t){this.ry=t}get right(){return this.rx+this.rw}set right(t){this.rx+=t-(this.rx+this.rw)}get bottom(){return this.ry+this.rh}set bottom(t){this.ry+=t-(this.ry+this.rh)}get position(){return new Point(this.rx,this.ry)}set position(t){this.rx=t.x,this.ry=t.y}get size(){return new Size(this.rw,this.rh)}set size(t){this.rw=t.width,this.rh=t.height}get center(){return new Point(this.rx+this.rw/2,this.ry+this.rh/2)}set center(t){this.rx=t.x-this.rw/2,this.ry=t.y-this.rh/2}get centerX(){return this.rx+this.rw/2}set centerX(t){this.rx=t-this.rw/2}get centerY(){return this.ry+this.rh/2}set centerY(t){this.ry=t-this.rh/2}isReal(){return isFinite(this.x)&&isFinite(this.y)&&isFinite(this.width)&&isFinite(this.height)}isEmpty(){return this.width===0&&this.height===0}static em=new Rect(0,0,0,0).kt();static YF=new Rect(NaN,NaN,NaN,NaN).kt();static tx=[];static l(){const t=Rect.tx.pop();return t===void 0?new Rect:t}static bs(t){const e=Rect.tx.pop();return e===void 0?t.copy():e.h(t)}static z(t,e,i,s){const n=Rect.tx.pop();return n===void 0?new Rect(t,e,i,s):n.e(t,e,i,s)}static i(t){Rect.tx.push(t)}}class Margin{mt;mr;mb;ml;constructor(t,e,i,s){t===void 0?(this.mt=0,this.mr=0,this.mb=0,this.ml=0):e===void 0?(e=t,i=t,s=t,this.mt=t,this.mr=e,this.mb=i,this.ml=s):i===void 0?(i=t,s=e,this.mt=t,this.mr=e,this.mb=i,this.ml=s):s!==void 0?(this.mt=t,this.mr=e,this.mb=i,this.ml=s):U.o("Invalid arguments to Margin constructor: "+t+", "+e+", "+i+", "+s)}setTo(t,e,i,s){return this.mt=t,this.mr=e,this.mb=i,this.ml=s,this}set(t){return this.mt=t.mt,this.mr=t.mr,this.mb=t.mb,this.ml=t.ml,this}copy(){const t=new Margin;return t.mt=this.mt,t.mr=this.mr,t.mb=this.mb,t.ml=this.ml,t}kt(){return Object.freeze(this),this}N(){return Object.isFrozen(this)?this:this.copy().kt()}Jw(t){}static parse(t){if(typeof t=="string"){const e=t.split(" ");let i=0,s=NaN;for(;e[i]==="";)i++;let n=e[i++];if(n&&(s=parseFloat(n)),isNaN(s))return new Margin;let o=NaN;for(;e[i]==="";)i++;if(n=e[i++],n&&(o=parseFloat(n)),isNaN(o))return new Margin(s);let r=NaN;for(;e[i]==="";)i++;if(n=e[i++],n&&(r=parseFloat(n)),isNaN(r))return new Margin(s,o);let l=NaN;for(;e[i]==="";)i++;return n=e[i++],n&&(l=parseFloat(n)),isNaN(l)?new Margin(s,o):new Margin(s,o,r,l)}else return new Margin}static stringify(t){return t.top.toString()+" "+t.right.toString()+" "+t.bottom.toString()+" "+t.left.toString()}static stringifyFixed(t){return U.s(t,"number",Margin,"stringifyFixed:digits"),e=>e.top.toFixed(t)+" "+e.right.toFixed(t)+" "+e.bottom.toFixed(t)+" "+e.left.toFixed(t)}toString(){return"Margin("+this.top+","+this.right+","+this.bottom+","+this.left+")"}equals(t){return t instanceof Margin?this.mt===t.top&&this.mr===t.right&&this.mb===t.bottom&&this.ml===t.left:!1}equalTo(t,e,i,s){return this.mt===t&&this.mr===e&&this.mb===i&&this.ml===s}equalsApprox(t){return G.c(this.mt,t.top)&&G.c(this.mr,t.right)&&G.c(this.mb,t.bottom)&&G.c(this.ml,t.left)}get top(){return this.mt}set top(t){this.mt=t}get right(){return this.mr}set right(t){this.mr=t}get bottom(){return this.mb}set bottom(t){this.mb=t}get left(){return this.ml}set left(t){this.ml=t}isReal(){return isFinite(this.top)&&isFinite(this.right)&&isFinite(this.bottom)&&isFinite(this.left)}static im=new Margin(0,0,0,0).kt();static XL=new Margin(2,2,2,2).kt()}class Spot{sx;sy;ox;oy;constructor(t,e,i,s){t===void 0?(this.sx=0,this.sy=0,this.ox=0,this.oy=0):(e===void 0&&(e=0),i===void 0&&(i=0),s===void 0&&(s=0),this.sx=t,this.sy=e,this.ox=i,this.oy=s)}setTo(t,e,i,s){return this.sx=t,this.sy=e,this.ox=i,this.oy=s,this}set(t){return this.sx=t.sx,this.sy=t.sy,this.ox=t.ox,this.oy=t.oy,this}copy(){const t=new Spot;return t.sx=this.sx,t.sy=this.sy,t.ox=this.ox,t.oy=this.oy,t}kt(){return Object.freeze(this),this}N(){return Object.isFrozen(this)?this:this.copy().kt()}Jw(t){}Ki(t){return this.sx=NaN,this.sy=NaN,this.ox=t,this.kt()}DU(t,e){(isNaN(t)||t>1||t<0)&&U.J(t,"0 <= "+e+" <= 1",Spot,e)}vU(t,e){(isNaN(t)||t===1/0||t===-1/0)&&U.J(t,"real number, not NaN or Infinity",Spot,e)}static parse(t){if(typeof t=="string"){if(t=t.trim(),t==="None")return Spot.None;if(t==="TopLeft")return Spot.TopLeft;if(t==="Top"||t==="TopCenter"||t==="MiddleTop")return Spot.TopCenter;if(t==="TopRight")return Spot.TopRight;if(t==="Left"||t==="LeftCenter"||t==="MiddleLeft")return Spot.LeftCenter;if(t==="Center")return Spot.Center;if(t==="Right"||t==="RightCenter"||t==="MiddleRight")return Spot.RightCenter;if(t==="BottomLeft")return Spot.BottomLeft;if(t==="Bottom"||t==="BottomCenter"||t==="MiddleBottom")return Spot.BottomCenter;if(t==="BottomRight")return Spot.BottomRight;if(t==="TopSide")return Spot.TopSide;if(t==="LeftSide")return Spot.LeftSide;if(t==="RightSide")return Spot.RightSide;if(t==="BottomSide")return Spot.BottomSide;if(t==="TopBottomSides")return Spot.TopBottomSides;if(t==="LeftRightSides")return Spot.LeftRightSides;if(t==="TopLeftSides")return Spot.TopLeftSides;if(t==="TopRightSides")return Spot.TopRightSides;if(t==="BottomLeftSides")return Spot.BottomLeftSides;if(t==="BottomRightSides")return Spot.BottomRightSides;if(t==="NotTopSide")return Spot.NotTopSide;if(t==="NotLeftSide")return Spot.NotLeftSide;if(t==="NotRightSide")return Spot.NotRightSide;if(t==="NotBottomSide")return Spot.NotBottomSide;if(t==="AllSides")return Spot.AllSides;if(t==="Default")return Spot.Default;const e=t.split(" ");let i=0,s=0;for(;e[i]==="";)i++;let n=e[i++];n!==void 0&&n.length>0&&(s=parseFloat(n));let o=0;for(;e[i]==="";)i++;n=e[i++],n!==void 0&&n.length>0&&(o=parseFloat(n));let r=0;for(;e[i]==="";)i++;n=e[i++],n!==void 0&&n.length>0&&(r=parseFloat(n));let l=0;for(;e[i]==="";)i++;return n=e[i++],n!==void 0&&n.length>0&&(l=parseFloat(n)),new Spot(s,o,r,l)}else return new Spot}static stringify(t){return t.isSpot()?t.x.toString()+" "+t.y.toString()+" "+t.offsetX.toString()+" "+t.offsetY.toString():t.toString()}static stringifyFixed(t){return U.s(t,"number",Spot,"stringifyFixed:digits"),e=>e.x.toFixed(t)+" "+e.y.toFixed(t)+" "+e.offsetX.toFixed(t)+" "+e.offsetY.toFixed(t)}toString(){return this.isSpot()?this.ox===0&&this.oy===0?"Spot("+this.x+","+this.y+")":"Spot("+this.x+","+this.y+","+this.offsetX+","+this.offsetY+")":this.equals(Spot.None)?"None":this.equals(Spot.TopLeft)?"TopLeft":this.equals(Spot.TopCenter)?"Top":this.equals(Spot.TopRight)?"TopRight":this.equals(Spot.LeftCenter)?"Left":this.equals(Spot.Center)?"Center":this.equals(Spot.RightCenter)?"Right":this.equals(Spot.BottomLeft)?"BottomLeft":this.equals(Spot.BottomCenter)?"Bottom":this.equals(Spot.BottomRight)?"BottomRight":this.equals(Spot.TopSide)?"TopSide":this.equals(Spot.LeftSide)?"LeftSide":this.equals(Spot.RightSide)?"RightSide":this.equals(Spot.BottomSide)?"BottomSide":this.equals(Spot.TopBottomSides)?"TopBottomSides":this.equals(Spot.LeftRightSides)?"LeftRightSides":this.equals(Spot.TopLeftSides)?"TopLeftSides":this.equals(Spot.TopRightSides)?"TopRightSides":this.equals(Spot.BottomLeftSides)?"BottomLeftSides":this.equals(Spot.BottomRightSides)?"BottomRightSides":this.equals(Spot.NotTopSide)?"NotTopSide":this.equals(Spot.NotLeftSide)?"NotLeftSide":this.equals(Spot.NotRightSide)?"NotRightSide":this.equals(Spot.NotBottomSide)?"NotBottomSide":this.equals(Spot.AllSides)?"AllSides":this.equals(Spot.Default)?"Default":"None"}equals(t){return t instanceof Spot?(this.sx===t.x||isNaN(this.sx)&&isNaN(t.x))&&(this.sy===t.y||isNaN(this.sy)&&isNaN(t.y))&&this.ox===t.offsetX&&this.oy===t.offsetY:!1}opposite(){return new Spot(.5-(this.sx-.5),.5-(this.sy-.5),-this.ox,-this.oy)}includesSide(t){if(!this.isSide())return!1;if(!t.isSide())if(t.equals(Spot.Left))t=Spot.LeftSide;else if(t.equals(Spot.Right))t=Spot.RightSide;else if(t.equals(Spot.Top))t=Spot.TopSide;else if(t.equals(Spot.Bottom))t=Spot.BottomSide;else return!1;const e=this.oy,i=t.offsetY;return(e&i)===i}get x(){return this.sx}set x(t){this.sx=t}get y(){return this.sy}set y(t){this.sy=t}get offsetX(){return this.ox}set offsetX(t){this.ox=t}get offsetY(){return this.oy}set offsetY(t){this.oy=t}isSpot(){return!isNaN(this.x)&&!isNaN(this.y)}isNoSpot(){return isNaN(this.x)||isNaN(this.y)}isSide(){return isNaN(this.x)&&isNaN(this.y)&&this.offsetX===1&&this.offsetY!==0}isNone(){return isNaN(this.x)&&isNaN(this.y)&&this.offsetX===0&&this.offsetY===0}isDefault(){return isNaN(this.x)&&isNaN(this.y)&&this.offsetX===-1&&this.offsetY===0}static None=new Spot(0,0,0,0).Ki(0);static Default=new Spot(0,0,-1,0).Ki(-1);static TopLeft=new Spot(0,0,0,0).kt();static TopCenter=new Spot(.5,0,0,0).kt();static TopRight=new Spot(1,0,0,0).kt();static LeftCenter=new Spot(0,.5,0,0).kt();static Center=new Spot(.5,.5,0,0).kt();static RightCenter=new Spot(1,.5,0,0).kt();static BottomLeft=new Spot(0,1,0,0).kt();static BottomCenter=new Spot(.5,1,0,0).kt();static BottomRight=new Spot(1,1,0,0).kt();static MiddleTop=Spot.TopCenter;static MiddleLeft=Spot.LeftCenter;static MiddleRight=Spot.RightCenter;static MiddleBottom=Spot.BottomCenter;static Top=Spot.TopCenter;static Left=Spot.LeftCenter;static Right=Spot.RightCenter;static Bottom=Spot.BottomCenter;static TopSide=new Spot(0,0,1,1).Ki(1);static LeftSide=new Spot(0,0,1,2).Ki(1);static RightSide=new Spot(0,0,1,4).Ki(1);static BottomSide=new Spot(0,0,1,8).Ki(1);static TopBottomSides=new Spot(0,0,1,9).Ki(1);static LeftRightSides=new Spot(0,0,1,6).Ki(1);static TopLeftSides=new Spot(0,0,1,3).Ki(1);static TopRightSides=new Spot(0,0,1,5).Ki(1);static BottomLeftSides=new Spot(0,0,1,10).Ki(1);static BottomRightSides=new Spot(0,0,1,12).Ki(1);static NotTopSide=new Spot(0,0,1,14).Ki(1);static NotLeftSide=new Spot(0,0,1,13).Ki(1);static NotRightSide=new Spot(0,0,1,11).Ki(1);static NotBottomSide=new Spot(0,0,1,7).Ki(1);static AllSides=new Spot(0,0,1,15).Ki(1);static vP=new Spot(.156,.156).kt();static FP=new Spot(.844,.844).kt()}class Transform{m11;m12;m21;m22;dx;dy;constructor(){this.m11=1,this.m12=0,this.m21=0,this.m22=1,this.dx=0,this.dy=0}set(t){return this.m11=t.m11,this.m12=t.m12,this.m21=t.m21,this.m22=t.m22,this.dx=t.dx,this.dy=t.dy,this}setTo(t,e,i,s,n,o){return this.m11=t,this.m12=e,this.m21=i,this.m22=s,this.dx=n,this.dy=o,this}copy(){const t=new Transform;return t.m11=this.m11,t.m12=this.m12,t.m21=this.m21,t.m22=this.m22,t.dx=this.dx,t.dy=this.dy,t}toString(){return"Transform("+this.m11+","+this.m12+","+this.m21+","+this.m22+","+this.dx+","+this.dy+")"}equals(t){return this.m11===t.m11&&this.m12===t.m12&&this.m21===t.m21&&this.m22===t.m22&&this.dx===t.dx&&this.dy===t.dy}RP(){return this.dx===0&&this.dy===0&&this.m11===1&&this.m12===0&&this.m21===0&&this.m22===1}Ue(){return this.m11=1,this.m12=0,this.m21=0,this.m22=1,this.dx=0,this.dy=0,this}bc(t){const e=this.m11*t.m11+this.m21*t.m12,i=this.m12*t.m11+this.m22*t.m12,s=this.m11*t.m21+this.m21*t.m22,n=this.m12*t.m21+this.m22*t.m22;return this.dx=this.m11*t.dx+this.m21*t.dy+this.dx,this.dy=this.m12*t.dx+this.m22*t.dy+this.dy,this.m11=e,this.m12=i,this.m21=s,this.m22=n,this}GL(t){const e=1/(t.m11*t.m22-t.m12*t.m21),i=t.m22*e,s=-t.m12*e,n=-t.m21*e,o=t.m11*e,r=e*(t.m21*t.dy-t.m22*t.dx),l=e*(t.m12*t.dx-t.m11*t.dy),a=this.m11*i+this.m21*s,h=this.m12*i+this.m22*s,c=this.m11*n+this.m21*o,f=this.m12*n+this.m22*o;return this.dx=this.m11*r+this.m21*l+this.dx,this.dy=this.m12*r+this.m22*l+this.dy,this.m11=a,this.m12=h,this.m21=c,this.m22=f,this}ex(){const t=1/(this.m11*this.m22-this.m12*this.m21),e=this.m22*t,i=-this.m12*t,s=-this.m21*t,n=this.m11*t,o=t*(this.m21*this.dy-this.m22*this.dx),r=t*(this.m12*this.dx-this.m11*this.dy);return this.m11=e,this.m12=i,this.m21=s,this.m22=n,this.dx=o,this.dy=r,this}ks(t,e,i){if(t=G.Ee(t),t===0)return this;this.Xs(e,i);let s=0,n=0;if(t===90)s=0,n=1;else if(t===180)s=-1,n=0;else if(t===270)s=0,n=-1;else{const h=t*Math.PI/180;s=Math.cos(h),n=Math.sin(h)}const o=this.m11*s+this.m21*n,r=this.m12*s+this.m22*n,l=this.m11*-n+this.m21*s,a=this.m12*-n+this.m22*s;return this.m11=o,this.m12=r,this.m21=l,this.m22=a,this.Xs(-e,-i),this}Xs(t,e){return this.dx+=this.m11*t+this.m21*e,this.dy+=this.m12*t+this.m22*e,this}it(t,e){return e===void 0&&(e=t),this.m11*=t,this.m12*=t,this.m21*=e,this.m22*=e,this}KF(){if(this.m11===1&&this.m12===0)return 0;let t=Math.atan2(this.m12,this.m11)*180/Math.PI;return t<0&&(t+=360),t}gt(t){const e=t.x,i=t.y;return t.e(e*this.m11+i*this.m21+this.dx,e*this.m12+i*this.m22+this.dy)}Ci(t){const e=1/(this.m11*this.m22-this.m12*this.m21),i=this.m22*e,s=-this.m12*e,n=-this.m21*e,o=this.m11*e,r=t.x-this.dx,l=t.y-this.dy;return t.e(r*i+l*n,r*s+l*o)}Su(t){const e=1/(this.m11*this.m22-this.m12*this.m21),i=this.m22*e,s=-this.m12*e,n=-this.m21*e,o=this.m11*e,r=e*(this.m21*this.dy-this.m22*this.dx),l=e*(this.m12*this.dx-this.m11*this.dy),a=t.x*1.25,h=t.y*1.2;return t.e(a*i+h*n+r,a*s+h*o+l)}sm(t){const e=t.x,i=t.y,s=e+t.width,n=i+t.height,o=this.m11,r=this.m12,l=this.m21,a=this.m22,h=this.dx,c=this.dy,f=e*o+i*l+h,u=e*r+i*a+c,d=s*o+i*l+h,m=s*r+i*a+c,g=e*o+n*l+h,p=e*r+n*a+c,y=s*o+n*l+h,x=s*r+n*a+c;let b=f,k=f,P=u,S=u;return b=Math.min(b,d),k=Math.max(k,d),P=Math.min(P,m),S=Math.max(S,m),b=Math.min(b,g),k=Math.max(k,g),P=Math.min(P,p),S=Math.max(S,p),b=Math.min(b,y),k=Math.max(k,y),P=Math.min(P,x),S=Math.max(S,x),t.e(b,P,k-b,S-P),t}static YL=[];static l(){const t=Transform.YL.pop();return t===void 0?new Transform:t}static i(t){Transform.YL.push(t)}static OP="54a702f3e53909c447824c6706603faf4c"}const G={HF:"7da71ca0ad381e90",qn:4*((Math.sqrt(2)-1)/3),KL:[],ix:w=>{if(w<=0)return 0;let t=G.KL;if(t===null){t=[];for(let e=0;e<=2e3;e++)t[e]=Math.sqrt(e);G.KL=t}if(w<1){const e=1/w;return e<=2e3?1/t[e|0]:Math.sqrt(w)}else return w<=2e3?t[w|0]:Math.sqrt(w)},c:(w,t)=>{const e=w-t;return e<.5&&e>-.5},X:(w,t)=>{const e=w-t;return e<5e-8&&e>-5e-8},Ve:(w,t,e,i,s,n,o)=>{s<=0&&(s=1e-6);let r=0,l=0,a=0,h=0;if(w<e?(l=w,r=e):(l=e,r=w),t<i?(h=t,a=i):(h=i,a=t),w===e)return h<=o&&o<=a&&w-s<=n&&n<=w+s;if(t===i)return l<=n&&n<=r&&t-s<=o&&o<=t+s;const c=r+s,f=l-s;if(f<=n&&n<=c){const u=a+s,d=h-s;if(d<=o&&o<=u)if(c-f>u-d)if(w-e>s||e-w>s){const g=(i-t)/(e-w)*(n-w)+t;if(g-s<=o&&o<=g+s)return!0}else return!0;else if(t-i>s||i-t>s){const g=(e-w)/(i-t)*(o-t)+w;if(g-s<=n&&n<=g+s)return!0}else return!0}return!1},nx:(w,t,e,i,s,n,o,r,l,a,h,c)=>{if(!G.Ve(w,t,o,r,c,e,i)||!G.Ve(w,t,o,r,c,s,n)){const f=(w+e)/2,u=(t+i)/2,d=(e+s)/2,m=(i+n)/2,g=(s+o)/2,p=(n+r)/2,y=(f+d)/2,x=(u+m)/2,b=(d+g)/2,k=(m+p)/2,P=(y+b)/2,S=(x+k)/2;return G.nx(w,t,f,u,y,x,P,S,l,a,h,c)||G.nx(P,S,b,k,g,p,o,r,l,a,h,c)}else return G.Ve(w,t,o,r,c,a,h)},HL:(w,t,e,i,s,n,o,r,l)=>{const a=(w+e)/2,h=(t+i)/2,c=(e+s)/2,f=(i+n)/2,u=(s+o)/2,d=(n+r)/2,m=(a+c)/2,g=(h+f)/2,p=(c+u)/2,y=(f+d)/2;return l.e((m+p)/2,(g+y)/2),l},qF:(w,t,e,i,s,n,o,r)=>{const l=(w+e)/2,a=(t+i)/2,h=(e+s)/2,c=(i+n)/2,f=(s+o)/2,u=(n+r)/2,d=(l+h)/2,m=(a+c)/2,g=(h+f)/2,p=(c+u)/2;return Point.direction(d,m,g,p)},Mu:(w,t,e,i,s,n,o,r,l,a)=>{if(!G.Ve(w,t,o,r,l,e,i)||!G.Ve(w,t,o,r,l,s,n)){const h=(w+e)/2,c=(t+i)/2,f=(e+s)/2,u=(i+n)/2,d=(s+o)/2,m=(n+r)/2,g=(h+f)/2,p=(c+u)/2,y=(f+d)/2,x=(u+m)/2,b=(g+y)/2,k=(p+x)/2;G.Mu(w,t,h,c,g,p,b,k,l,a),G.Mu(b,k,y,x,d,m,o,r,l,a)}else a.re(w,t,0,0),a.re(o,r,0,0);return a},jn:(w,t,e,i,s,n,o,r,l,a)=>{if(!G.Ve(w,t,o,r,l,e,i)||!G.Ve(w,t,o,r,l,s,n)){const h=(w+e)/2,c=(t+i)/2,f=(e+s)/2,u=(i+n)/2,d=(s+o)/2,m=(n+r)/2,g=(h+f)/2,p=(c+u)/2,y=(f+d)/2,x=(u+m)/2,b=(g+y)/2,k=(p+x)/2;G.jn(w,t,h,c,g,p,b,k,l,a),G.jn(b,k,y,x,d,m,o,r,l,a)}else a.length===0&&(a.push(w),a.push(t)),a.push(o),a.push(r);return a},IP:(w,t,e,i,s,n,o,r,l,a)=>{if(G.Ve(w,t,s,n,a,e,i))return G.Ve(w,t,s,n,a,r,l);{const h=(w+e)/2,c=(t+i)/2,f=(e+s)/2,u=(i+n)/2,d=(h+f)/2,m=(c+u)/2;return G.IP(w,t,h,c,d,m,o,r,l,a)||G.IP(d,m,f,u,s,n,o,r,l,a)}},EP:(w,t,e,i,s,n,o,r)=>{if(G.Ve(w,t,s,n,o,e,i))r.re(w,t,0,0),r.re(s,n,0,0);else{const l=(w+e)/2,a=(t+i)/2,h=(e+s)/2,c=(i+n)/2,f=(l+h)/2,u=(a+c)/2;G.EP(w,t,l,a,f,u,o,r),G.EP(f,u,h,c,s,n,o,r)}return r},nm:(w,t,e,i,s,n,o,r)=>{if(G.Ve(w,t,s,n,o,e,i))r.length===0&&(r.push(w),r.push(t)),r.push(s),r.push(n);else{const l=(w+e)/2,a=(t+i)/2,h=(e+s)/2,c=(i+n)/2,f=(l+h)/2,u=(a+c)/2;G.nm(w,t,l,a,f,u,o,r),G.nm(f,u,h,c,s,n,o,r)}return r},om:(w,t,e,i,s,n,o,r,l,a,h,c,f,u)=>{if(!G.Ve(w,t,o,r,f,e,i)||!G.Ve(w,t,o,r,f,s,n)){const d=(w+e)/2,m=(t+i)/2,g=(e+s)/2,p=(i+n)/2,y=(s+o)/2,x=(n+r)/2,b=(d+g)/2,k=(m+p)/2,P=(g+y)/2,S=(p+x)/2,L=(b+P)/2,C=(k+S)/2;let M=1/0,N=!1,A=0,T=0;if(G.om(w,t,d,m,b,k,L,C,l,a,h,c,f,u)){const D=(u.x-l)**2+(u.y-a)**2;D<M&&(M=D,N=!0,A=u.x,T=u.y)}if(G.om(L,C,P,S,y,x,o,r,l,a,h,c,f,u)){const D=(u.x-l)**2+(u.y-a)**2;D<M&&(M=D,N=!0,A=u.x,T=u.y)}return N&&(u.x=A,u.y=T),N}else{if(!G.ku(w,t,o,r,l,a,h,c))return!1;const d=(w-o)*(a-c)-(t-r)*(l-h);if(d===0)return!1;const m=((w*r-t*o)*(l-h)-(w-o)*(l*c-a*h))/d,g=((w*r-t*o)*(a-c)-(t-r)*(l*c-a*h))/d;return u.e(m,g),!0}},rm:(w,t,e,i,s,n,o,r,l,a,h,c,f)=>{let u=0;if(!G.Ve(w,t,o,r,f,e,i)||!G.Ve(w,t,o,r,f,s,n)){const d=(w+e)/2,m=(t+i)/2,g=(e+s)/2,p=(i+n)/2,y=(s+o)/2,x=(n+r)/2,b=(d+g)/2,k=(m+p)/2,P=(g+y)/2,S=(p+x)/2,L=(b+P)/2,C=(k+S)/2;u+=G.rm(w,t,d,m,b,k,L,C,l,a,h,c,f),u+=G.rm(L,C,P,S,y,x,o,r,l,a,h,c,f)}else{const d=(w-o)*(a-c)-(t-r)*(l-h);if(d===0)return u;const m=((w*r-t*o)*(l-h)-(w-o)*(l*c-a*h))/d,g=((w*r-t*o)*(a-c)-(t-r)*(l*c-a*h))/d;if(m>=h)return u;let p=0,y=0;if((l>h?l-h:h-l)<(a>c?a-c:c-a)){if(t<r?(p=t,y=r):(p=r,y=t),g<p||g>y)return u}else if(w<o?(p=w,y=o):(p=o,y=w),m<p||m>y)return u;d>0?u++:d<0&&u--}return u},Nl:(w,t,e,i,s,n,o)=>{if(G.X(w,e)){let r=0,l=0;t<i?(r=t,l=i):(r=i,l=t);const a=n;return a<r?(o.e(w,r),!1):a>l?(o.e(w,l),!1):(o.e(w,a),!0)}else if(G.X(t,i)){let r=0,l=0;w<e?(r=w,l=e):(r=e,l=w);const a=s;return a<r?(o.e(r,t),!1):a>l?(o.e(l,t),!1):(o.e(a,t),!0)}else{const r=(e-w)**2+(i-t)**2,l=((w-s)*(w-e)+(t-n)*(t-i))/r;if(l<-5e-6)return o.e(w,t),!1;if(l>1.000005)return o.e(e,i),!1;{const a=w+l*(e-w),h=t+l*(i-t);return o.e(a,h),!0}}},Do:(w,t,e,i,s,n,o,r,l)=>{if(G.c(w,e)&&G.c(t,i))return l.e(w,t),!1;if(G.X(s,o)){if(G.X(w,e))return G.Nl(w,t,e,i,s,n,l),!1;{const h=(i-t)/(e-w)*(s-w)+t;return G.Nl(w,t,e,i,s,h,l)}}else{const a=(r-n)/(o-s);if(G.X(w,e)){const h=a*(w-s)+n;let c=0,f=0;return t<i?(c=t,f=i):(c=i,f=t),h<c?(l.e(w,c),!1):h>f?(l.e(w,f),!1):(l.e(w,h),!0)}else{const h=(i-t)/(e-w);if(G.X(a,h))return G.Nl(w,t,e,i,s,n,l),!1;{const c=(h*w-a*s+n-t)/(h-a);if(G.X(h,0)){let f=0,u=0;return w<e?(f=w,u=e):(f=e,u=w),c<f?(l.e(f,t),!1):c>u?(l.e(u,t),!1):(l.e(c,t),!0)}else{const f=h*(c-w)+t;return G.Nl(w,t,e,i,c,f,l)}}}}},Cl:(w,t,e,i,s,n,o,r,l)=>{let a=1e21,h=w,c=t;if(G.Do(w,t,w,i,s,n,o,r,l)){const f=(l.x-s)**2+(l.y-n)**2;f<a&&(a=f,h=l.x,c=l.y)}if(G.Do(e,t,e,i,s,n,o,r,l)){const f=(l.x-s)**2+(l.y-n)**2;f<a&&(a=f,h=l.x,c=l.y)}if(G.Do(w,t,e,t,s,n,o,r,l)){const f=(l.x-s)**2+(l.y-n)**2;f<a&&(a=f,h=l.x,c=l.y)}if(G.Do(w,i,e,i,s,n,o,r,l)){const f=(l.x-s)**2+(l.y-n)**2;f<a&&(a=f,h=l.x,c=l.y)}return l.e(h,c),a<1e21},lx:(w,t,e)=>G.zL(w.x,w.y,w.width,w.height,t.x,t.y,e.x,e.y),zL:(w,t,e,i,s,n,o,r)=>{const l=w,a=w+e,h=t,c=t+i;if(s===o){let f=0,u=0;return n<r?(f=n,u=r):(f=r,u=n),l<=s&&s<=a&&f<=c&&u>=h}if(n===r){let f=0,u=0;return s<o?(f=s,u=o):(f=o,u=s),h<=n&&n<=c&&f<=a&&u>=l}return!!(Rect.contains(w,t,e,i,s,n)||Rect.contains(w,t,e,i,o,r)||G.ku(l,h,a,h,s,n,o,r)||G.ku(a,h,a,c,s,n,o,r)||G.ku(a,c,l,c,s,n,o,r)||G.ku(l,c,l,h,s,n,o,r))},ku:(w,t,e,i,s,n,o,r)=>w===e&&t===i&&s===o&&n===r?w===s&&t===n:G.bu(w,t,e,i,s,n)*G.bu(w,t,e,i,o,r)<=0&&G.bu(s,n,o,r,w,t)*G.bu(s,n,o,r,e,i)<=0,bu:(w,t,e,i,s,n)=>{const o=e-w,r=i-t;let l=s-w,a=n-t,h=l*r-a*o;return h===0&&(h=l*o+a*r,h>0&&(l-=o,a-=r,h=l*o+a*r,h<0&&(h=0))),h},_w(w,t,e,i){i===void 0&&(i=!1);let s=0;const n=w===null?t:(t-w.x)/(w.width>0?w.width:1),o=w===null?e:(e-w.y)/(w.height>0?w.height:1);return n>o?n>1-o||(i||n<1-o?s=270:s=315):i||n<o?n>1-o?s=90:i||n<1-o?s=180:s=135:n<.5?s=225:n>.5&&(s=45),s},Ee:w=>(w>=360?w-=360:w<0&&(w+=360),w),jF:(w,t)=>w>t?Math.min(w-t,Math.abs(w-360-t)):t>w?Math.min(t-w,Math.abs(w-(t-360))):0,qL:(w,t,e,i,s,n)=>{const o=Math.PI;n||(i=i*(o/180),s=s*(o/180));const r=i>s?-1:1,l=1e-5,a=o*2,h=[],c=o/2;let f=i,u=Math.min(a,Math.abs(s-i));if(u<l){const d=f+r*Math.min(u,c),m=w+e*Math.cos(f),g=t+e*Math.sin(f),p=w+e*Math.cos(d),y=t+e*Math.sin(d),x=(m+p)/2,b=(g+y)/2;return h.push([m,g,x,b,x,b,p,y]),h}for(;u>l;){const d=f+r*Math.min(u,c);h.push(G.WF(e,f,d,w,t)),u-=Math.abs(d-f),f=d}return h},WF:(w,t,e,i,s)=>{const n=(e-t)/2,o=w*Math.cos(n),r=w*Math.sin(n),l=o,a=-r,h=l*l+a*a,c=h+l*o+a*r,f=4/3*(Math.sqrt(2*h*c)-c)/(l*r-a*o),u=l-f*a,d=a+f*l,m=u,g=-d,p=n+t,y=Math.cos(p),x=Math.sin(p);return[i+w*Math.cos(t),s+w*Math.sin(t),i+u*y-d*x,s+u*x+d*y,i+m*y-g*x,s+m*x+g*y,i+w*Math.cos(e),s+w*Math.sin(e)]},tm:(w,t,e,i,s,n,o)=>{const r=s,l=n,a=Math.floor((w-e)/r)*r+e,h=Math.floor((t-i)/l)*l+i;let c=a;a+r-w<r/2&&(c=a+r);let f=h;return h+l-t<l/2&&(f=h+l),o.e(c,f),o},jL:(w,t)=>{let e=Math.max(w,t),i=Math.min(w,t),s=1,n=1;do s=e%i,n=i,e=i,i=s;while(s>0);return n},JF:(w,t,e,i)=>{const s=e<0,n=i<0;let o=0,r=0,l=0;w<t?(r=1,l=0):(r=0,l=1);let a=0,h=0,c=0,f=0;return o=r,a=o===0?w:t,c=o===0?e:i,(o===0?s:n)&&(c=-c),o=l,h=o===0?w:t,f=o===0?e:i,(o===0?s:n)&&(f=-f),G.$F(a,h,c,f,0,0)},$F:(w,t,e,i,s,n)=>{let o=0;if(i>0)if(e>0){const r=w*w,l=t*t,a=w*e,h=t*i;let c=-l+h,f=-l+Math.sqrt(a*a+h*h),u=c;const d=9999999999;for(let p=0;p<d&&(u=.5*(c+f),!(u===c||u===f));++p){const y=a/(u+r),x=h/(u+l),b=y*y+x*x-1;if(b>0)c=u;else if(b<0)f=u;else break}s=r*e/(u+r),n=l*i/(u+l);const m=s-e,g=n-i;o=Math.sqrt(m*m+g*g)}else s=0,n=t,o=Math.abs(i-t);else{const r=w*w-t*t,l=w*e;if(l<r){const a=l/r,h=a*a;s=w*a,n=t*Math.sqrt(Math.abs(1-h));const c=s-e;o=Math.sqrt(c*c+n*n)}else s=w,n=0,o=Math.abs(e-w)}return o},Wn:{},lm:new PropertyCollection,pr:new PropertyCollection,yr:0,am:100};G.za=G.HF;var GeometryType=(w=>(w[w.Line=1]="Line",w[w.Rectangle=2]="Rectangle",w[w.Ellipse=3]="Ellipse",w[w.Path=4]="Path",w))(GeometryType||{}),GeometryStretch=(w=>(w[w.None=0]="None",w[w.Default=1]="Default",w[w.Fill=2]="Fill",w[w.Uniform=6]="Uniform",w))(GeometryStretch||{});class Geometry{n;hm;cm;kc;Nu;Cu;Jn;$n;Zn;W;Li;Ai;ni;oi;Gs;Pc;Sc;constructor(t,e){GSet.Je(this),this.n=2,t===void 0&&(t=4),this.W=t,this.Li=0,this.Ai=0,this.ni=0,this.oi=0,t===4?this.Gs=new List:this.Gs=Geometry.hx,this.hm=this.Gs.rt,this.cm=new Rect,this.kc=null,this.Nu=null,this.Cu=NaN,this.Jn=Spot.TopLeft,this.$n=Spot.BottomRight,this.Pc=NaN,this.Sc=NaN,this.Zn=2,e&&Object.assign(this,e)}copy(){const t=new Geometry;if(t.n=this.n&-2,t.W=this.W,t.Li=this.Li,t.Ai=this.Ai,t.ni=this.ni,t.oi=this.oi,this.W===4){const e=this.Gs.r,i=t.Gs;for(let s=0;s<e.length;s++){const n=e[s];i.add(n.copy())}t.Gs=i}else t.Gs=this.Gs;return t.hm=this.hm,t.cm.h(this.cm),t.kc=this.kc,t.Nu=this.Nu,t.Cu=this.Cu,t.Jn=this.Jn.N(),t.$n=this.$n.N(),t.Pc=this.Pc,t.Sc=this.Sc,t.Zn=this.Zn,t}static Line=1;static Rectangle=2;static Ellipse=3;static Path=4;static hx=new List().k();get u(){return(this.n&1)!==0}set u(t){t?this.n|=1:this.n&=-2}get yt(){return(this.n&2)!==0}set yt(t){t?this.n|=2:this.n&=-3}k(){if(this.u=!0,this.type!==4)return this;const t=this.figures;t.k();for(const e of t)e.k();return this}equalsApprox(t){if(!(t instanceof Geometry))return!1;if(this.type!==t.type)return this.type===1&&t.type===4?this.WL(t):t.type===1&&this.type===4?t.WL(this):!1;if(this.type===4){const e=this.figures.r,i=t.figures.r,s=e.length;if(s!==i.length)return!1;for(let n=0;n<s;n++){const o=e[n],r=i[n];if(!o.equalsApprox(r))return!1}return!0}else return G.c(this.startX,t.startX)&&G.c(this.startY,t.startY)&&G.c(this.endX,t.endX)&&G.c(this.endY,t.endY)}WL(t){if(this.type!==1||t.type!==4)return!1;if(t.figures.count===1){const e=t.figures.elt(0);if(e.segments.count===1&&G.c(this.startX,e.startX)&&G.c(this.startY,e.startY)){const i=e.segments.elt(0);if(i.type===2&&G.c(this.endX,i.endX)&&G.c(this.endY,i.endY))return!0}}return!1}static stringify(t){return t.toString()}static stringifyFixed(t){return U.s(t,"number",Geometry,"stringifyFixed:digits"),e=>e.toString(t)}fe(t){t in GeometryType?this.type=t:U.ur(this,t)}toString(t){t===void 0&&(t=-1);const e=s=>s===0?"0":s.toFixed(t);let i;switch(this.type){case 1:return t<0?"M"+this.startX.toString()+" "+this.startY.toString()+"L"+this.endX.toString()+" "+this.endY.toString():"M"+e(this.startX)+" "+e(this.startY)+"L"+e(this.endX)+" "+e(this.endY);case 2:return i=new Rect(this.startX,this.startY,0,0),i.union(this.endX,this.endY,0,0),t<0?"M"+i.x.toString()+" "+i.y.toString()+"H"+i.right.toString()+"V"+i.bottom.toString()+"H"+i.left.toString()+"z":"M"+e(i.x)+" "+e(i.y)+"H"+e(i.right)+"V"+e(i.bottom)+"H"+e(i.left)+"z";case 3:if(i=new Rect(this.startX,this.startY,0,0),i.union(this.endX,this.endY,0,0),t<0){const r=i.left.toString()+" "+(i.y+i.height/2).toString(),l=i.right.toString()+" "+(i.y+i.height/2).toString();return"M"+r+"A"+(i.width/2).toString()+" "+(i.height/2).toString()+" 0 0 1 "+l+"A"+(i.width/2).toString()+" "+(i.height/2).toString()+" 0 0 1 "+r}else{const r=e(i.left)+" "+e(i.y+i.height/2),l=e(i.right)+" "+e(i.y+i.height/2);return"M"+r+"A"+e(i.width/2)+" "+e(i.height/2)+" 0 0 1 "+l+"A"+e(i.width/2)+" "+e(i.height/2)+" 0 0 1 "+r}case 4:let s="";const n=this.figures.r,o=n.length;for(let r=0;r<o;r++){const l=n[r];r>0&&(s+=" x "),l.isFilled&&(s+="F "),s+=l.toString(t)}return s;default:return GeometryType[this.type]}}static fillPath(t){typeof t!="string"&&U.si(t,"string",Geometry,"fillPath:str");const e=t.split(/[Xx]/),i=e.length;let s="";for(let n=0;n<i;n++){const o=e[n];if(o.match(/[Ff]/)!==null){n===0?s+=o:s+="X"+(o[0]===" "?"":" ")+o;continue}s+=(n===0?"":"X ")+"F"+(o[0]===" "?"":" ")+o}return s}static fm="UuBbMmZzLlHhVvCcSsQqTtAaFfXx";static parse(t,e){e===void 0&&(e=!1),typeof t!="string"&&U.si(t,"string",Geometry,"parse:str");const i=new RegExp("(["+Geometry.fm+"])(["+Geometry.fm+"])","gm"),s=new RegExp("(["+Geometry.fm+"])([^s])","gm"),n=new RegExp("([^s])(["+Geometry.fm+"])","gm");t=t.replace(/,/gm," "),t=t.replace(i,"$1 $2"),t=t.replace(i,"$1 $2"),t=t.replace(s,"$1 $2"),t=t.replace(n,"$1 $2"),t=t.replace(/([0-9])([+\-])/gm,"$1 $2"),t=t.replace(/[\s\r\t\n]+/gm," "),t=t.replace(/^\s+|\s+$/g,"");const o=t.split(" ");for(let A=0;A<o.length;A++){const T=o[A];if(T.match(/(\.[0-9]*)(\.)/gm)!==null){const D=U.nt();let v="",R=!1;for(let F=0;F<T.length;F++){const O=T[F];O==="."&&!R?(R=!0,v+=O):O==="."?(D.push(v),v="."):v+=O}D.push(v),o.splice(A,1);for(let F=0;F<D.length;F++)o.splice(A+F,0,D[F]);A+=D.length-1,U.Z(D)}}let r=-1,l="",a="";const h=new Point(0,0),c=new Point(0,0),f=new Point(0,0);let u=!0;function d(){return r>=b-1||o[r+1].match(M)!==null?!0:(u=!1,!1)}function m(){return r++,o[r]}function g(A){let T=parseFloat(m()),D=parseFloat(m());l===l.toLowerCase()&&(T=f.x+T,D=f.y+D),A.e(T,D)}function p(){return g(f),f}function y(){return g(c),c}function x(){const A=a.toLowerCase();return A==="c"||A==="s"||A==="q"||A==="t"?new Point(2*f.x-c.x,2*f.y-c.y):new Point(f.x,f.y)}const b=o.length,k=GeoStream.JL(null);let P=!1,S=!1,L=!1,C=!0;const M=new RegExp("["+Geometry.fm+"]");for(;!(r>=b-1);){if(a=l,l=m(),l==="")continue;u=!0;let A=!1;switch(l.toUpperCase()){case"X":C=!0,P=!1,S=!1;break;case"M":const T=p();for(k.Ne===null||C===!0?(k.Lu(T.x,T.y,P,!1,!S,L),C=!1):k.ZF(T.x,T.y),h.h(f);!d();){const D=p();k.Ys(D.x,D.y)}break;case"L":for(;!d();){const D=p();k.Ys(D.x,D.y)}u&&(A=!0);break;case"H":for(;!d();)f.e((l===l.toLowerCase()?f.x:0)+parseFloat(m()),f.y),k.Ys(f.x,f.y);break;case"V":for(;!d();)f.e(f.x,(l===l.toLowerCase()?f.y:0)+parseFloat(m())),k.Ys(f.x,f.y);u&&(A=!0);break;case"C":for(;!d();){const D=new Point;g(D);const v=y(),R=p();k.wr(D.x,D.y,v.x,v.y,R.x,R.y)}u&&(A=!0);break;case"S":for(;!d();){const D=x(),v=y(),R=p();k.wr(D.x,D.y,v.x,v.y,R.x,R.y)}u&&(A=!0);break;case"Q":for(;!d();){const D=y(),v=p();k.Au(D.x,D.y,v.x,v.y)}u&&(A=!0);break;case"T":for(;!d();){const D=x();c.h(D);const v=p();k.Au(D.x,D.y,v.x,v.y),c.h(v)}u&&(A=!0);break;case"B":for(;!d();){const D=parseFloat(m()),v=parseFloat(m());let R=parseFloat(m()),F=parseFloat(m());const O=parseFloat(m());let z=O,Y=!1;d()||(z=parseFloat(m()),d()||(Y=parseFloat(m())!==0)),l===l.toLowerCase()&&(R+=f.x,F+=f.y),k.QF(D,v,R,F,O,z,Y)}u&&(A=!0);break;case"A":for(;!d();){const D=Math.abs(parseFloat(m())),v=Math.abs(parseFloat(m())),R=parseFloat(m());let F=!1,O=!1,z=0,Y=0;const E=m();E.length===1?(F=!!parseFloat(E),O=!!parseFloat(m()),z=parseFloat(m()),Y=parseFloat(m())):E.length===2?(F=!!parseFloat(E[0]),O=!!parseFloat(E[1]),z=parseFloat(m()),Y=parseFloat(m())):(F=!!parseFloat(E[0]),O=!!parseFloat(E[1]),z=parseFloat(E.slice(2)),Y=parseFloat(m())),l===l.toLowerCase()&&(z=f.x+z,Y=f.y+Y),f.e(z,Y),k._F(D,v,R,F,O,z,Y)}u&&(A=!0);break;case"Z":k.tR(),f.h(h);break;case"F":{let D="",v=1;for(;o[r+v];){if(o[r+v]==="0"){L=!0,v++;continue}if(o[r+v].match(/[Uu]/)!==null){v++;continue}if(o[r+v].match(M)===null){v++;continue}D=o[r+v];break}D.match(/[Mm]/)?P=!0:k.eR();break}case"U":{let D="",v=1;for(;o[r+v];){if(o[r+v].match(/[Ff]/)!==null){v++;continue}if(o[r+v].match(M)===null){v++;continue}D=o[r+v];break}D.match(/[Mm]/)?S=!0:k.iR(!1);break}default:if(l==="0"||l==="1")break;U.ne("Unknown geometry command: "+l);break}if(A){U.ne(`Bad geometry command: ${l}, next token: ${m()},
string: ${t}`);break}}const N=k.um;if(GeoStream.$L(k),e){const A=N.figures.iterator;for(;A.next();){const T=A.value;T.isFilled=!0}}return N}static ZL(t,e){const i=t.length,s=Point.l();for(let n=0;n<i;n++){const o=t[n];s.x=o[0],s.y=o[1],e.gt(s),o[0]=s.x,o[1]=s.y,s.x=o[2],s.y=o[3],e.gt(s),o[2]=s.x,o[3]=s.y,s.x=o[4],s.y=o[5],e.gt(s),o[4]=s.x,o[5]=s.y,s.x=o[6],s.y=o[7],e.gt(s),o[6]=s.x,o[7]=s.y}Point.i(s)}UP(){if(this.yt)return!0;if(this.type===4){const t=this.figures;if(this.hm!==t.rt)return!0;const e=this.figures.r,i=e.length;for(let s=0;s<i;s++)if(e[s].UP())return!0}return!1}cx(){if(this.yt=!1,this.kc=null,this.Nu=null,this.Cu=NaN,this.type===4){const e=this.figures;this.hm=e.rt;const i=this.figures.r,s=i.length;for(let n=0;n<s;n++)i[n].sR()}const t=this.cm;isNaN(this.Pc)||isNaN(this.Sc)?t.e(0,0,0,0):t.e(0,0,this.Pc,this.Sc),this.QL(t,!1),t.re(0,0,0,0)}computeBoundsWithoutOrigin(){const t=new Rect;return this.QL(t,!0),t}QL(t,e){switch(this.type){case 1:case 2:case 3:e?t.e(this.Li,this.Ai,0,0):t.re(this.Li,this.Ai,0,0),t.re(this.ni,this.oi,0,0);break;case 4:const i=this.figures,s=i.r,n=i.length;for(let o=0;o<n;o++){const r=s[o];e&&o===0?t.e(r.startX,r.startY,0,0):t.re(r.startX,r.startY,0,0);const a=r.segments.r,h=a.length;let c=r.startX,f=r.startY;for(let u=0;u<h;u++){const d=a[u];switch(d.type){case 2:case 1:c=d.endX,f=d.endY,t.re(c,f,0,0);break;case 3:G.Mu(c,f,d.point1X,d.point1Y,d.point2X,d.point2Y,d.endX,d.endY,.5,t),c=d.endX,f=d.endY;break;case 4:G.EP(c,f,d.point1X,d.point1Y,d.endX,d.endY,.5,t),c=d.endX,f=d.endY;break;case 5:case 6:const m=d.type===5?d.vo(r):d.Za(r,c,f),g=m.length;if(g===0){c=d.type===5?d.centerX:d.endX,f=d.type===5?d.centerY:d.endY,t.re(c,f,0,0);break}let p=null;for(let y=0;y<g;y++)p=m[y],G.Mu(p[0],p[1],p[2],p[3],p[4],p[5],p[6],p[7],.5,t);p!==null&&(c=p[6],f=p[7]);break;default:U.o("Unknown Segment type: "+d.type)}}}break;default:U.o("Unknown Geometry type: "+this.type)}}nR(t,e){const i=this.bounds;let s=t/i.width,n=e/i.height;return isFinite(s)||(s=1),isFinite(n)||(n=1),s===1&&n===1?this:this.copy().scale(s,n)}normalize(){this.u&&U.L(this);const t=this.computeBoundsWithoutOrigin();return this.offset(-t.x,-t.y),new Point(-t.x,-t.y)}offset(t,e){return this.u&&U.L(this),this.v(1,0,0,1,t,e),this}scale(t,e){return this.u&&U.L(this),this.v(t,0,0,e,0,0),this}rotate(t,e,i){this.u&&U.L(this),e===void 0&&(e=0),i===void 0&&(i=0);const s=Transform.l();return s.Ue(),s.ks(t,e,i),this.v(s.m11,s.m12,s.m21,s.m22,s.dx,s.dy),Transform.i(s),this}v(t,e,i,s,n,o){let r=0,l=0;switch(this.type){case 1:case 2:case 3:r=this.Li,l=this.Ai,this.Li=r*t+l*i+n,this.Ai=r*e+l*s+o,r=this.ni,l=this.oi,this.ni=r*t+l*i+n,this.oi=r*e+l*s+o;break;case 4:const h=this.figures.r,c=h.length;for(let f=0;f<c;f++){const u=h[f];r=u.startX,l=u.startY,u.startX=r*t+l*i+n,u.startY=r*e+l*s+o;const m=u.segments.r,g=m.length;for(let p=0;p<g;p++){const y=m[p];switch(y.type){case 2:case 1:r=y.endX,l=y.endY,y.endX=r*t+l*i+n,y.endY=r*e+l*s+o;break;case 3:r=y.point1X,l=y.point1Y,y.point1X=r*t+l*i+n,y.point1Y=r*e+l*s+o,r=y.point2X,l=y.point2Y,y.point2X=r*t+l*i+n,y.point2Y=r*e+l*s+o,r=y.endX,l=y.endY,y.endX=r*t+l*i+n,y.endY=r*e+l*s+o;break;case 4:r=y.point1X,l=y.point1Y,y.point1X=r*t+l*i+n,y.point1Y=r*e+l*s+o,r=y.endX,l=y.endY,y.endX=r*t+l*i+n,y.endY=r*e+l*s+o;break;case 5:if(r=y.centerX,l=y.centerY,y.centerX=r*t+l*i+n,y.centerY=r*e+l*s+o,e!==0){let x=Math.atan2(e,t)*180/Math.PI;x<0&&(x+=360),y.startAngle+=x}t<0&&(y.startAngle=180-y.startAngle,y.sweepAngle=-y.sweepAngle),s<0&&(y.startAngle=-y.startAngle,y.sweepAngle=-y.sweepAngle),y.radiusX*=Math.sqrt(t*t+i*i),y.radiusY!==void 0&&(y.radiusY*=Math.sqrt(e*e+s*s));break;case 6:if(r=y.endX,l=y.endY,y.endX=r*t+l*i+n,y.endY=r*e+l*s+o,y.radiusX===0||y.radiusY===0)break;if(e!==0){let x=Math.atan2(e,t)*180/Math.PI;x<0&&(x+=360),y.xAxisRotation+=x}t<0&&(y.xAxisRotation=180-y.xAxisRotation,y.isClockwiseArc=!y.isClockwiseArc),s<0&&(y.xAxisRotation=-y.xAxisRotation,y.isClockwiseArc=!y.isClockwiseArc),y.radiusX*=Math.sqrt(t*t+i*i),y.radiusY*=Math.sqrt(e*e+s*s);break;default:U.o("Unknown Segment type: "+y.type)}}}break}return this.yt=!0,this}containsPoint(t,e){e===void 0&&(e=0);const i=this.Li,s=this.Ai,n=this.ni,o=this.oi;switch(this.type){case 1:return G.Ve(i,s,n,o,e,t.x,t.y);case 2:{const r=Math.min(i,n)-e,l=Math.min(s,o)-e,a=Math.abs(n-i)+e*2,h=Math.abs(o-s)+e*2,c=Rect.z(r,l,a,h),f=c.containsPoint(t);return Rect.i(c),f}case 3:{let r=Math.min(i,n)-e,l=Math.min(s,o)-e;const a=Math.abs(n-i)+e*2,h=Math.abs(o-s)+e*2,c=a/2,f=h/2;return c<=0||f<=0?!1:(r=t.x-(r+c),l=t.y-(l+f),r*r/(c*c)+l*l/(f*f)<=1)}case 4:return this.VP(t,e,!0,!1);default:return!1}}VP(t,e,i,s){const n=t.x,o=t.y,r=this.bounds.x-20,l=o;let a=0,h=0,c=0,f=0,u=0,d=0;const m=this.figures.r,g=m.length;for(let p=0;p<g;p++){const y=m[p],x=!y.isEvenOdd;if(y.isFilled){if(i&&y.BP(n,o,e))return!0}else{if(y.BP(n,o,s?e:e+2))return!0;continue}const b=y.segments;h=y.startX,c=y.startY;let k=h,P=c;const S=b.r;let L=S[0];for(let C=0;C<=b.length;C++){let M;switch(C!==b.length?(L=S[C],M=L.type,u=L.endX,d=L.endY):(M=2,u=k,d=P),M){case 1:{const N=this.fx(n,o,r,l,h,c,k,P);if(isNaN(N))return!0;a+=N,k=u,P=d;break}case 2:{const N=this.fx(n,o,r,l,h,c,u,d);if(isNaN(N))return!0;a+=N;break}case 3:f=G.rm(h,c,L.point1X,L.point1Y,L.point2X,L.point2Y,u,d,r,l,n,o,.5),a+=f;break;case 4:{const N=(h+2*L.point1X)/3,A=(c+2*L.point1Y)/3,T=(L.point1X*2+u)/3,D=(L.point1Y*2+d)/3;f=G.rm(h,c,N,A,T,D,u,d,r,l,n,o,.5),a+=f;break}case 5:case 6:{const N=L.type===5?L.vo(y):L.Za(y,h,c),A=N.length;if(A===0){const D=this.fx(n,o,r,l,h,c,L.type===5?L.centerX:L.endX,L.type===5?L.centerY:L.endY);if(isNaN(D))return!0;a+=D;break}let T=null;for(let D=0;D<A;D++){if(T=N[D],D===0){const v=this.fx(n,o,r,l,h,c,T[0],T[1]);if(isNaN(v))return!0;a+=v}f=G.rm(T[0],T[1],T[2],T[3],T[4],T[5],T[6],T[7],r,l,n,o,.5),a+=f}T!==null&&(u=T[6],d=T[7]);break}default:U.o("Unknown Segment type: "+L.type)}h=u,c=d}if(x){if(a!==0)return!0}else if(a%2!==0)return!0;a=0}return!1}fx(t,e,i,s,n,o,r,l){if(G.Ve(n,o,r,l,.05,t,e))return NaN;const a=(t-i)*(o-l);if(a===0)return 0;const h=((t*s-e*i)*(n-r)-(t-i)*(n*l-o*r))/a,c=(t*s-e*i)*(o-l)/a;if(h>=t)return 0;if((n>r?n-r:r-n)<(o>l?o-l:l-o)){if(o<l){if(c<o||c>l)return 0}else if(c<l||c>o)return 0}else if(n<r){if(h<n||h>r)return 0}else if(h<r||h>n)return 0;return a>0?1:-1}_L(t,e,i){const s=this.figures.r,n=s.length;for(let o=0;o<n;o++)if(s[o].BP(t,e,i))return!0;return!1}getPointAlongPath(t,e){if(t<0?t=0:t>1&&(t=1),e===void 0&&(e=new Point),this.type===1)return e.e(this.startX+t*(this.endX-this.startX),this.startY+t*(this.endY-this.startY)),e;const i=this.flattenedSegments,s=this.flattenedLengths,n=this.flattenedTotalLength,o=i.length,r=n*t;let l=0;for(let a=0;a<o;a++){const h=s[a],c=h.length;for(let f=0;f<c;f++){const u=h[f];if(l+u>=r){const d=r-l,m=u===0?0:d/u,g=i[a],p=g[f*2],y=g[f*2+1],x=g[f*2+2],b=g[f*2+3];return e.e(p+(x-p)*m,y+(b-y)*m),e}l+=u}}return e}getAngleAlongPath(t){if(t<0?t=0:t>1&&(t=1),this.type===1)return Math.atan2(this.endY-this.startY,this.endX-this.startX)*180/Math.PI;const e=this.flattenedSegments,i=this.flattenedLengths,s=this.flattenedTotalLength,n=e.length,o=s*t;let r=0;for(let l=0;l<n;l++){const a=i[l],h=a.length;for(let c=0;c<h;c++){const f=a[c];if(r+f>=o){const u=e[l],d=u[c*2],m=u[c*2+1],g=u[c*2+2],p=u[c*2+3];return Math.abs(g-d)<1&&Math.abs(p-m)<1?0:Math.abs(g-d)<1?p-m>=0?90:270:Math.abs(p-m)<1?g-d>=0?0:180:Math.atan2(p-m,g-d)*180/Math.PI}r+=f}}return NaN}getPointAndAngleAlongPath(t,e){if(t<0?t=0:t>1&&(t=1),e===void 0&&(e=[]),e.length=3,this.type===1)return e[0]=this.startX+t*(this.endX-this.startX),e[1]=this.startY+t*(this.endY-this.startY),e[2]=Math.atan2(this.endY-this.startY,this.endX-this.startX)*180/Math.PI,e;const i=this.flattenedSegments,s=this.flattenedLengths,n=this.flattenedTotalLength,o=i.length,r=n*t;let l=0;for(let a=0;a<o;a++){const h=s[a],c=h.length;for(let f=0;f<c;f++){const u=h[f];if(l+u>=r){const d=r-l,m=u===0?0:d/u,g=i[a],p=g[f*2],y=g[f*2+1],x=g[f*2+2],b=g[f*2+3];e[0]=p+(x-p)*m,e[1]=y+(b-y)*m;let k;return Math.abs(x-p)<1&&Math.abs(b-y)<1?k=0:Math.abs(x-p)<1?k=b-y>=0?90:270:Math.abs(b-y)<1?k=x-p>=0?0:180:k=Math.atan2(b-y,x-p)*180/Math.PI,e[2]=k,e}l+=u}}return e}getFractionForPoint(t){if(this.type===1){const e=this.startX,i=this.startY,s=this.endX,n=this.endY;if(e===s&&i===n)return 0;{const o=t.x,r=t.y;let l=0,a=0;if(e===s)return i<n?(l=i,a=n):(l=n,a=i),r<=l?l===i?0:1:r>=a?a===i?0:1:Math.abs(r-i)/(a-l);if(i===n)return e<s?(l=e,a=s):(l=s,a=e),o<=l?l===e?0:1:o>=a?a===e?0:1:Math.abs(o-e)/(a-l);{const h=(s-e)**2+(n-i)**2,c=Point.l();G.Nl(e,i,s,n,o,r,c);const f=c.x,u=c.y;return Point.i(c),Math.sqrt(((f-e)**2+(u-i)**2)/h)}}}else if(this.type===2){const e=this.startX,i=this.startY,s=this.endX,n=this.endY;if(e===s&&i===n)return 0;{const o=s-e,r=n-i,l=o*2+r*2;let a=t.x,h=t.y;a=Math.min(Math.max(a,e),s),h=Math.min(Math.max(h,i),n);const c=Math.abs(a-e),f=Math.abs(a-s),u=Math.abs(h-i),d=Math.abs(h-n),m=Math.min(c,f,u,d);if(m===u)return a/l;if(m===f)return(o+h)/l;if(m===d)return(o*2+r-a)/l;if(m===c)return(o*2+r*2-h)/l}}else{const e=this.flattenedSegments,i=this.flattenedLengths,s=this.flattenedTotalLength,n=Point.l();let o=1/0,r=0,l=0;const a=e.length;let h=0,c=0;for(let u=0;u<a;u++){const d=e[u],m=i[u],g=d.length;for(let p=0;p<g;p+=2){const y=d[p],x=d[p+1];if(p===0){h=y,c=x;continue}G.Nl(h,c,y,x,t.x,t.y,n);const b=(n.x-t.x)**2+(n.y-t.y)**2;b<o&&(o=b,r=l,r+=Math.sqrt((n.x-h)**2+(n.y-c)**2)),l+=m[(p-2)/2],h=y,c=x}}Point.i(n);const f=r/s;return f<0?0:f>1?1:f}return 0}get flattenedSegments(){return this.tA(),this.kc}tA(){if(this.kc===null){const t=this.kc=[],e=this.Nu=[];this.oR(t,e)}}get flattenedLengths(){return this.tA(),this.Nu}get flattenedTotalLength(){let t=this.Cu;if(isNaN(t)){if(this.type===1){const e=Math.abs(this.endX-this.startX),i=Math.abs(this.endY-this.startY);t=Math.sqrt(e*e+i*i)}else if(this.type===2){const e=Math.abs(this.endX-this.startX),i=Math.abs(this.endY-this.startY);t=e*2+i*2}else{const e=this.flattenedLengths,i=e.length;t=0;for(let s=0;s<i;s++){const n=e[s],o=n.length;for(let r=0;r<o;r++)t+=n[r]}}this.Cu=t}return t}zP(t){const e=[];let i=0,s=0;const n=t.length;for(let o=0;o<n;o+=2){const r=t[o],l=t[o+1];if(o===0){i=r,s=l;continue}const a=Math.sqrt(Point.distanceSquared(i,s,r,l));e.push(a),i=r,s=l}return e}oR(t,e){let i=[];const s=[];if(this.type===1)i.push(this.startX),i.push(this.startY),i.push(this.endX),i.push(this.endY),t.push(i),s.push(Math.sqrt((this.startX-this.endX)**2+(this.startY-this.endY)**2)),e.push(s);else if(this.type===2)i.push(this.startX),i.push(this.startY),i.push(this.endX),i.push(this.startY),i.push(this.endX),i.push(this.endY),i.push(this.startX),i.push(this.endY),i.push(this.startX),i.push(this.startY),t.push(i),s.push(Math.abs(this.startX-this.endX)),s.push(Math.abs(this.startY-this.endY)),s.push(Math.abs(this.startX-this.endX)),s.push(Math.abs(this.startY-this.endY)),e.push(s);else if(this.type===3){const n=new PathFigure;n.startX=this.endX,n.startY=(this.startY+this.endY)/2;const o=new PathSegment(5);o.startAngle=0,o.sweepAngle=360,o.centerX=(this.startX+this.endX)/2,o.centerY=(this.startY+this.endY)/2,o.radiusX=Math.abs(this.startX-this.endX)/2,o.radiusY=Math.abs(this.startY-this.endY)/2,n.add(o);const r=o.vo(n),l=r.length;if(l===0)i.push(o.centerX),i.push(o.centerY);else{let a=n.startX,h=n.startY;for(let c=0;c<l;c++){const f=r[c];G.jn(a,h,f[2],f[3],f[4],f[5],f[6],f[7],.5,i),a=f[6],h=f[7]}}t.push(i),e.push(this.zP(i))}else{const n=this.figures.iterator;for(;n.next();){const o=n.value;i=[],i.push(o.startX),i.push(o.startY);let r=o.startX,l=o.startY,a=r,h=l;const c=o.segments.r,f=c.length;for(let u=0;u<f;u++){const d=c[u];switch(d.type){case 1:i.length>=4&&(t.push(i),e.push(this.zP(i))),i=[],i.push(d.endX),i.push(d.endY),r=d.endX,l=d.endY,a=r,h=l;break;case 2:i.push(d.endX),i.push(d.endY),r=d.endX,l=d.endY;break;case 3:G.jn(r,l,d.point1X,d.point1Y,d.point2X,d.point2Y,d.endX,d.endY,.5,i),r=d.endX,l=d.endY;break;case 4:G.nm(r,l,d.point1X,d.point1Y,d.endX,d.endY,.5,i),r=d.endX,l=d.endY;break;case 5:{const m=d.vo(o),g=m.length;if(g===0){i.push(d.centerX),i.push(d.centerY),r=d.centerX,l=d.centerY;break}for(let p=0;p<g;p++){const y=m[p];G.jn(r,l,y[2],y[3],y[4],y[5],y[6],y[7],.5,i),r=y[6],l=y[7]}break}case 6:{const m=d.Za(o,r,l),g=m.length,p=d.endX,y=d.endY;if(g===0){i.push(p),i.push(y),r=p,l=y;break}for(let x=0;x<g;x++){const b=m[x];G.jn(r,l,b[2],b[3],b[4],b[5],b[6],b[7],.5,i),r=b[6],l=b[7]}break}default:U.o("Segment not of valid type: "+d.type)}d.isClosed&&(i.push(a),i.push(h))}i.length>=4&&(t.push(i),e.push(this.zP(i)))}}}get type(){return this.W}set type(t){this.W!==t&&(this.u&&U.L(this,t),this.W=t,t===4?this.Gs=new List:(Geometry.hx===null&&(Geometry.hx=new List().k()),this.Gs=Geometry.hx),this.yt=!0)}get startX(){return this.Li}set startX(t){this.Li!==t&&(this.u&&U.L(this,t),this.Li=t,this.yt=!0)}get startY(){return this.Ai}set startY(t){this.Ai!==t&&(this.u&&U.L(this,t),this.Ai=t,this.yt=!0)}get endX(){return this.ni}set endX(t){this.ni!==t&&(this.u&&U.L(this,t),this.ni=t,this.yt=!0)}get endY(){return this.oi}set endY(t){this.oi!==t&&(this.u&&U.L(this,t),this.oi=t,this.yt=!0)}get figures(){return this.Gs}set figures(t){this.Gs!==t&&(this.u&&U.L(this,t),this.Gs=t,this.yt=!0)}add(t){return this.Gs.add(t),this}setSpots(t,e,i,s,n,o,r,l){return this.u&&U.L(this),this.Jn=new Spot(t,e,n,o),this.$n=new Spot(i,s,r,l),this}get spot1(){return this.Jn}set spot1(t){this.u&&U.L(this,t),this.Jn=t.N()}get spot2(){return this.$n}set spot2(t){this.u&&U.L(this,t),this.$n=t.N()}get defaultStretch(){return this.Zn}set defaultStretch(t){this.Zn=t}get bounds(){return this.UP()&&this.cx(),this.cm}polygonClosestSegment(t,e){if(e===void 0&&(e=10),this.type!==4)return null;const i=t.x,s=t.y;let n=1/0,o=0,r=0,l=0,a=0,h=0,c=0,f=0,u=0;return this.figures.each(d=>{let m=d.startX,g=d.startY;d.segments.each(p=>{let y=p.endX,x=p.endY,b=0;if(p.type===2)b=Point.distanceLineSegmentSquared(i,s,m,g,y,x);else{m=p.endX,g=p.endY;return}b<n&&(n=b,o=l,r=a,h=m,c=g,f=y,u=x),m=y,g=x,a++,p.isClosed&&(y=d.startX,x=d.startY,b=Point.distanceLineSegmentSquared(i,s,m,g,y,x),b<n&&(n=b,o=l,r=a,h=m,c=g,f=y,u=x),a++)}),l++,a=0}),n<e*e?{figi:o,segi:r,ax:h,ay:c,bx:f,by:u}:null}get polygonArea(){if(this.type===4){const t=this.figures.iterator;let e=0,i=0,s=0,n=0,o=0;for(;t.next();){const r=t.value;if(!r.isFilled)continue;e=r.startX,i=r.startY;const l=r.segments.iterator;for(;l.next();){const a=l.value;s=a.endX,n=a.endY,a.type===1||a.type!==5&&(o+=e*n-i*s),e=s,i=n}o+=e*r.startY-i*r.startX}return Math.abs(o)/2}else if(this.type===2){const t=Math.abs(this.startX-this.endX),e=Math.abs(this.startY-this.endY);return t*e}else if(this.type===3){const t=Math.abs(this.startX-this.endX),e=Math.abs(this.startY-this.endY);return Math.PI*t/2*e/2}else return 0}get polygonLength(){if(this.type===4){const t=this.figures.iterator;let e=0,i=0,s=0,n=0,o=0;for(;t.next();){const r=t.value;e=r.startX,i=r.startY;const l=r.segments.iterator;for(;l.next();){const h=l.value;s=h.endX,n=h.endY,h.type===1||h.type!==5&&(o+=Math.sqrt((s-e)*(s-e)+(n-i)*(n-i))),e=s,i=n}const a=r.segments.last();a&&a.isClosed&&(s=r.startX,n=r.startY,o+=Math.sqrt((s-e)*(s-e)+(n-i)*(n-i)))}return o}else if(this.type===2){const t=Math.abs(this.startX-this.endX),e=Math.abs(this.startY-this.endY);return t*2+e*2}else if(this.type===3){const t=Math.abs(this.startX-this.endX)/2,e=Math.abs(this.startY-this.endY)/2;if(t+e===0)return 0;const i=(t-e)*(t-e)/((t+e)*(t+e));let s=i,n=1+s/4;return s*=i,n+=s/64,s*=i,n+=s/256,s*=i,n+=s*25/16384,s*=i,n+=s*49/65536,s*=i,n+=s*441/1048576,Math.PI*(t+e)*n}else{const t=this.startX,e=this.startY,i=this.endX,s=this.endY;return Math.sqrt((i-t)*(i-t)+(s-e)*(s-e))}}static computeConvexHull(t){t.sort((s,n)=>s.x===n.x?n.y-s.y:n.x-s.x);const e=[];for(let s=0;s<t.length;s++){for(;e.length>=2&&t[s].compareWithLineSegmentPoint(e[e.length-2],e[e.length-1])>=0;)e.pop();e.push(t[s])}e.pop();const i=[];for(let s=t.length-1;s>=0;s--){for(;i.length>=2&&t[s].compareWithLineSegmentPoint(i[i.length-2],i[i.length-1])>=0;)i.pop();i.push(t[s])}return i.pop(),e.concat(i)}static generatePolygon(t,e,i){e===void 0&&(e=0),i===void 0&&(i=!0);const s=new Geometry;if(t.length>1)if(e>0)if(i){t.push(t[0]),t.push(t[1]);let n=!0;const o=new PathFigure(0,0,i,!1);for(let l=1;l<t.length;l++){const a=(t[l-1].x+t[l].x)/2,h=(t[l-1].y+t[l].y)/2,c=t[l-1].distanceSquaredPoint(t[l]),f=.5*e/Math.sqrt(c);if(f<.5){const u=t[l-1].x+(t[l].x-t[l-1].x)*f,d=t[l-1].y+(t[l].y-t[l-1].y)*f;if(n?(n=!1,o.startX=u,o.startY=d):o.add(new PathSegment(3,u,d,t[l-1].x,t[l-1].y,t[l-1].x,t[l-1].y)),l<t.length-1){const m=t[l].x+(t[l-1].x-t[l].x)*f,g=t[l].y+(t[l-1].y-t[l].y)*f;o.add(new PathSegment(2,m,g))}}else n?(n=!1,o.startX=a,o.startY=h):o.add(new PathSegment(3,a,h,t[l-1].x,t[l-1].y,t[l-1].x,t[l-1].y))}const r=o.segments.last();r&&r.close(),s.add(o)}else{const n=new PathFigure(t[0].x,t[0].y,!1,!1);for(let o=1;o<t.length;o++){const r=(t[o-1].x+t[o].x)/2,l=(t[o-1].y+t[o].y)/2,a=t[o-1].distanceSquaredPoint(t[o]),h=.5*e/Math.sqrt(a);if(h<.5){if(o>1){const u=t[o-1].x+(t[o].x-t[o-1].x)*h,d=t[o-1].y+(t[o].y-t[o-1].y)*h;n.add(new PathSegment(3,u,d,t[o-1].x,t[o-1].y,t[o-1].x,t[o-1].y))}const c=t[o].x+(t[o-1].x-t[o].x)*h,f=t[o].y+(t[o-1].y-t[o].y)*h;n.add(new PathSegment(2,c,f))}else o>1&&n.add(new PathSegment(3,r,l,t[o-1].x,t[o-1].y,t[o-1].x,t[o-1].y));o===t.length-1&&n.add(new PathSegment(2,t[o].x,t[o].y))}s.add(n)}else{const n=new PathFigure(t[0].x,t[0].y,i,!1);for(let o=1;o<t.length;o++)n.add(new PathSegment(2,t[o].x,t[o].y));if(i){const o=n.segments.last();o&&o.close()}s.add(n)}return s}}Geometry.stringify=Geometry.stringify;Geometry.stringifyFixed=Geometry.stringifyFixed;Geometry.fillPath=Geometry.fillPath;Geometry.parse=Geometry.parse;class PathFigure{n;Li;Ai;Mc;dm;Hi;constructor(t,e,i,s,n){i===void 0&&(i=!0),s===void 0&&(s=!0),n===void 0&&(n=!1),this.n=2|(i?4:0)|(s?8:0)|(n?16:0),t!==void 0?this.Li=t:this.Li=0,e!==void 0?this.Ai=e:this.Ai=0,this.Mc=new List,this.dm=this.Mc.rt,this.Hi=null}copy(){const t=new PathFigure;t.n=this.n&-2,t.Li=this.Li,t.Ai=this.Ai;const e=this.Mc.r,i=e.length,s=t.Mc;for(let n=0;n<i;n++){const r=e[n].copy();s.add(r)}return t.dm=this.dm,t.Hi=this.Hi,t}equalsApprox(t){if(!(t instanceof PathFigure)||!G.c(this.startX,t.startX)||!G.c(this.startY,t.startY))return!1;const e=this.segments.r,i=t.segments.r,s=e.length;if(s!==i.length)return!1;for(let n=0;n<s;n++){const o=e[n],r=i[n];if(!o.equalsApprox(r))return!1}return!0}toString(t){t===void 0&&(t=-1);let e="";if(t<0)e="M"+this.startX.toString()+" "+this.startY.toString();else{const n=o=>o===0?"0":o.toFixed(t);e="M"+n(this.startX)+" "+n(this.startY)}const i=this.segments.r,s=i.length;for(let n=0;n<s;n++){const o=i[n];e+=" "+o.toString(t)}return e}get u(){return(this.n&1)!==0}set u(t){t?this.n|=1:this.n&=-2}get yt(){return(this.n&2)!==0}set yt(t){t?this.n|=2:this.n&=-3}k(){this.u=!0;const t=this.segments;t.k();const e=t.r,i=t.length;for(let s=0;s<i;s++)e[s].k();return this}UP(){if(this.yt)return!0;const t=this.segments;if(this.dm!==t.rt)return!0;for(const e of t)if(e.yt)return!0;return!1}sR(){this.yt=!1,this.Hi=null;const t=this.segments;this.dm=t.rt;for(const e of t)e.yt=!1,e.Ks=null}get isFilled(){return(this.n&4)!==0}set isFilled(t){this.u&&U.L(this,t),t?this.n|=4:this.n&=-5}get isShadowed(){return(this.n&8)!==0}set isShadowed(t){this.u&&U.L(this,t),t?this.n|=8:this.n&=-9}get isEvenOdd(){return(this.n&16)!==0}set isEvenOdd(t){this.u&&U.L(this,t),t?this.n|=16:this.n&=-17}get startX(){return this.Li}set startX(t){this.u&&U.L(this,t),this.Li=t,this.Hi=null,this.yt=!0}get startY(){return this.Ai}set startY(t){this.u&&U.L(this,t),this.Ai=t,this.Hi=null,this.yt=!0}get segments(){return this.Mc}set segments(t){this.u&&U.L(this,t),this.Mc=t,this.Hi=null,this.yt=!0}add(t){return this.Mc.add(t),this.Hi=null,this}BP(t,e,i){const s=this;let n=s.startX,o=s.startY,r=n,l=o;const a=s.segments.r,h=a.length;for(let c=0;c<h;c++){const f=a[c];switch(f.type){case 1:r=f.endX,l=f.endY,n=f.endX,o=f.endY;break;case 2:if(G.Ve(n,o,f.endX,f.endY,i,t,e))return!0;n=f.endX,o=f.endY;break;case 3:if(G.nx(n,o,f.point1X,f.point1Y,f.point2X,f.point2Y,f.endX,f.endY,.5,t,e,i))return!0;n=f.endX,o=f.endY;break;case 4:if(G.IP(n,o,f.point1X,f.point1Y,f.endX,f.endY,.5,t,e,i))return!0;n=f.endX,o=f.endY;break;case 5:case 6:const u=f.type===5?f.vo(s):f.Za(s,n,o),d=u.length,m=f.type===5?f.centerX:f.endX,g=f.type===5?f.centerY:f.endY;if(d===0){if(G.Ve(n,o,m,g,i,t,e))return!0;n=m,o=g;break}let p=null;for(let y=0;y<d;y++)if(p=u[y],y===0&&G.Ve(n,o,p[0],p[1],i,t,e)||G.nx(p[0],p[1],p[2],p[3],p[4],p[5],p[6],p[7],.5,t,e,i))return!0;p!==null&&(n=p[6],o=p[7]);break;default:U.o("Unknown Segment type: "+f.type)}if(f.isClosed&&(n!==r||o!==l)&&G.Ve(n,o,r,l,i,t,e))return!0}return!1}}var SegmentType=(w=>(w[w.Move=1]="Move",w[w.Line=2]="Line",w[w.Bezier=3]="Bezier",w[w.QuadraticBezier=4]="QuadraticBezier",w[w.Arc=5]="Arc",w[w.SvgArc=6]="SvgArc",w))(SegmentType||{});class PathSegment{W;n;ni;oi;mn;Ll;Al;xr;Ks;constructor(t,e,i,s,n,o,r,l){if(GSet.Je(this),t===void 0&&(t=2),this.W=t,this.n=2,e!==void 0?this.ni=e:this.ni=0,i!==void 0?this.oi=i:this.oi=0,s===void 0&&(s=0),n===void 0&&(n=0),o===void 0&&(o=0),r===void 0&&(r=0),t===6){let a=o;a=a%360,a<0&&(a+=360),this.mn=a,this.Ll=0,this.Al=Math.max(s,0),this.xr=Math.max(n,0),typeof r=="boolean"?r&&(this.isLargeArc=!0):typeof r=="number"&&r&&(this.isLargeArc=!0),l&&(this.isClockwiseArc=!0)}else this.mn=s,this.Ll=n,t===5&&(o=Math.max(o,0)),this.Al=o,typeof r=="number"?(t===5&&(r=Math.max(r,0)),this.xr=r):this.xr=0;this.Ks=null}copy(){const t=new PathSegment;return t.W=this.W,t.n=this.n&-2,t.ni=this.ni,t.oi=this.oi,t.mn=this.mn,t.Ll=this.Ll,t.Al=this.Al,t.xr=this.xr,t}equalsApprox(t){if(!(t instanceof PathSegment)||this.type!==t.type||this.isClosed!==t.isClosed)return!1;switch(this.type){case 1:case 2:return G.c(this.endX,t.endX)&&G.c(this.endY,t.endY);case 3:return G.c(this.endX,t.endX)&&G.c(this.endY,t.endY)&&G.c(this.point1X,t.point1X)&&G.c(this.point1Y,t.point1Y)&&G.c(this.point2X,t.point2X)&&G.c(this.point2Y,t.point2Y);case 4:return G.c(this.endX,t.endX)&&G.c(this.endY,t.endY)&&G.c(this.point1X,t.point1X)&&G.c(this.point1Y,t.point1Y);case 5:return G.c(this.startAngle,t.startAngle)&&G.c(this.sweepAngle,t.sweepAngle)&&G.c(this.centerX,t.centerX)&&G.c(this.centerY,t.centerY)&&G.c(this.radiusX,t.radiusX)&&G.c(this.radiusY,t.radiusY);case 6:return this.isClockwiseArc===t.isClockwiseArc&&this.isLargeArc===t.isLargeArc&&G.c(this.xAxisRotation,t.xAxisRotation)&&G.c(this.endX,t.endX)&&G.c(this.endY,t.endY)&&G.c(this.radiusX,t.radiusX)&&G.c(this.radiusY,t.radiusY);default:return!1}}fe(t){t in SegmentType?this.type=t:U.ur(this,t)}toString(t){t===void 0&&(t=-1);const e=s=>s===0?"0":s.toFixed(t);let i="";switch(this.type){case 1:t<0?i="M"+this.endX.toString()+" "+this.endY.toString():i="M"+e(this.endX)+" "+e(this.endY);break;case 2:t<0?i="L"+this.endX.toString()+" "+this.endY.toString():i="L"+e(this.endX)+" "+e(this.endY);break;case 3:t<0?i="C"+this.point1X.toString()+" "+this.point1Y.toString()+" "+this.point2X.toString()+" "+this.point2Y.toString()+" "+this.endX.toString()+" "+this.endY.toString():i="C"+e(this.point1X)+" "+e(this.point1Y)+" "+e(this.point2X)+" "+e(this.point2Y)+" "+e(this.endX)+" "+e(this.endY);break;case 4:t<0?i="Q"+this.point1X.toString()+" "+this.point1Y.toString()+" "+this.endX.toString()+" "+this.endY.toString():i="Q"+e(this.point1X)+" "+e(this.point1Y)+" "+e(this.endX)+" "+e(this.endY);break;case 5:t<0?i="B"+this.startAngle.toString()+" "+this.sweepAngle.toString()+" "+this.centerX.toString()+" "+this.centerY.toString()+" "+this.radiusX.toString()+" "+this.radiusY.toString():i="B"+e(this.startAngle)+" "+e(this.sweepAngle)+" "+e(this.centerX)+" "+e(this.centerY)+" "+e(this.radiusX)+" "+e(this.radiusY);break;case 6:t<0?i="A"+this.radiusX.toString()+" "+this.radiusY.toString()+" "+this.xAxisRotation.toString()+" "+(this.isLargeArc?1:0)+" "+(this.isClockwiseArc?1:0)+" "+this.endX.toString()+" "+this.endY.toString():i="A"+e(this.radiusX)+" "+e(this.radiusY)+" "+e(this.xAxisRotation)+" "+(this.isLargeArc?1:0)+" "+(this.isClockwiseArc?1:0)+" "+e(this.endX)+" "+e(this.endY);break;default:i=SegmentType[this.type]}return i+(this.isClosed?"z":"")}static Move=1;static Line=2;static Bezier=3;static QuadraticBezier=4;static Arc=5;static SvgArc=6;get u(){return(this.n&1)!==0}set u(t){t?this.n|=1:this.n&=-2}get yt(){return(this.n&2)!==0}set yt(t){t?this.n|=2:this.n&=-3}k(){return this.u=!0,this}close(){return this.isClosed=!0,this}vo(t){if(this.Ks!==null&&t.yt===!1)return this.Ks;const e=this.radiusX;let i=this.radiusY;if(i===void 0&&(i=e),e===0||i===0)return this.Ks=[],this.Ks;const s=this.mn,n=this.Ll,o=G.qL(0,0,e<i?e:i,this.startAngle,this.startAngle+this.sweepAngle,!1);if(e!==i){const l=Transform.l();l.Ue(),e<i?l.it(1,i/e):l.it(e/i,1),Geometry.ZL(o,l),Transform.i(l)}const r=o.length;for(let l=0;l<r;l++){const a=o[l];a[0]+=s,a[1]+=n,a[2]+=s,a[3]+=n,a[4]+=s,a[5]+=n,a[6]+=s,a[7]+=n}return this.Ks=o,this.Ks}Za(t,e,i){if(this.Ks!==null&&t.yt===!1)return this.Ks;if(this.radiusX===0||this.radiusY===0)return this.Ks=[],this.Ks;const s=e,n=i;let o=this.Al,r=this.xr;o===0&&(o=1e-4),r===0&&(r=1e-4);const l=this.mn*(Math.PI/180),a=this.isLargeArc,h=this.isClockwiseArc,c=this.ni,f=this.oi,u=Math.cos(l),d=Math.sin(l),m=u*(s-c)/2+d*(n-f)/2,g=-d*(s-c)/2+u*(n-f)/2,p=m*m/(o*o)+g*g/(r*r);p>1&&(o*=Math.sqrt(p),r*=Math.sqrt(p));let y=(a===h?-1:1)*Math.sqrt((o*o*r*r-o*o*g*g-r*r*m*m)/(o*o*g*g+r*r*m*m));isNaN(y)&&(y=0);let x=y*o*g/r,b=y*-r*m/o;isNaN(x)&&(x=0),isNaN(b)&&(b=0);const k=(s+c)/2+u*x-d*b,P=(n+f)/2+d*x+u*b,S=(X,B)=>Math.sqrt(X*X+B*B),L=(X,B,H,q)=>(X*H+B*q)/(S(X,B)*S(H,q)),C=(X,B,H,q)=>(X*q<B*H?-1:1)*Math.acos(L(X,B,H,q)),M=C(1,0,(m-x)/o,(g-b)/r),N=(m-x)/o,A=(g-b)/r,T=(-m-x)/o,D=(-g-b)/r;let v=C(N,A,T,D);const R=L(N,A,T,D);R<=-1?v=Math.PI:R>=1&&(v=0),!h&&v>0&&(v=v-2*Math.PI),h&&v<0&&(v=v+2*Math.PI);const F=o>r?o:r,O=o>r?1:o/r,z=o>r?r/o:1,Y=G.qL(0,0,F,M,M+v,!0),E=Transform.l();return E.Ue(),E.Xs(k,P),E.ks(this.mn,0,0),E.it(O,z),Geometry.ZL(Y,E),Transform.i(E),this.Ks=Y,this.Ks}get isClosed(){return(this.n&8)!==0}set isClosed(t){this.isClosed!==t&&(t?this.n|=8:this.n&=-9,this.yt=!0)}get type(){return this.W}set type(t){this.u&&U.L(this,t),this.W=t,this.yt=!0}get endX(){return this.ni}set endX(t){this.u&&U.L(this,t),this.ni=t,this.yt=!0}get endY(){return this.oi}set endY(t){this.u&&U.L(this,t),this.oi=t,this.yt=!0}get point1X(){return this.mn}set point1X(t){this.u&&U.L(this,t),this.mn=t,this.yt=!0}get point1Y(){return this.Ll}set point1Y(t){this.u&&U.L(this,t),this.Ll=t,this.yt=!0}get point2X(){return this.Al}set point2X(t){this.u&&U.L(this,t),this.Al=t,this.yt=!0}get point2Y(){return this.xr}set point2Y(t){this.u&&U.L(this,t),this.xr=t,this.yt=!0}get centerX(){return this.mn}set centerX(t){this.u&&U.L(this,t),this.mn=t,this.yt=!0}get centerY(){return this.Ll}set centerY(t){this.u&&U.L(this,t),this.Ll=t,this.yt=!0}get radiusX(){return this.Al}set radiusX(t){t<0&&U.J(t,">= zero",PathSegment,"radiusX"),this.u&&U.L(this,t),this.Al=t,this.yt=!0}get radiusY(){return this.xr}set radiusY(t){t<0&&U.J(t,">= zero",PathSegment,"radiusY"),this.u&&U.L(this,t),this.xr=t,this.yt=!0}get startAngle(){return this.ni}set startAngle(t){this.u&&U.L(this,t),t=t%360,t<0&&(t+=360),this.ni=t,this.yt=!0}get sweepAngle(){return this.oi}set sweepAngle(t){this.u&&U.L(this,t),t>360&&(t=360),t<-360&&(t=-360),this.oi=t,this.yt=!0}get isClockwiseArc(){return(this.n&4)!==0}set isClockwiseArc(t){this.u&&U.L(this,t),t?this.n|=4:this.n&=-5,this.yt=!0}get isLargeArc(){return(this.n&16)!==0}set isLargeArc(t){this.u&&U.L(this,t),t?this.n|=16:this.n&=-17,this.yt=!0}get xAxisRotation(){return this.mn}set xAxisRotation(t){this.u&&U.L(this,t),t=t%360,t<0&&(t+=360),this.mn=t,this.yt=!0}}class InputEvent{a;ux;gx;gm;mm;pm;ym;wm;xm;bm;km;Pm;Sm;Mm;Fo;Nm;Cm;Ps;Ti;constructor(){this.a=null,this.ux=new Point(0,0).k(),this.gx=new Point(0,0).k(),this.gm=0,this.mm=0,this.pm=1,this.ym="",this.wm="",this.xm=!1,this.bm=!1,this.km=0,this.Pm=0,this.Sm=!1,this.Mm=!1,this.Fo=!1,this.Nm=null,this.Cm=0,this.Ps=null,this.Ti=null}copy(){const t=new InputEvent;return this.clone(t)}clone(t){return t.a=this.a,t.ux.h(this.viewPoint),t.gx.h(this.documentPoint),t.gm=this.gm,t.mm=this.mm,t.pm=this.pm,t.ym=this.ym,t.wm=this.wm,t.xm=this.xm,t.bm=this.bm,t.km=this.km,t.Pm=this.Pm,t.Sm=this.Sm,t.Mm=this.Mm,t.Fo=this.Fo,t.Nm=this.Nm,t.Cm=this.Cm,t.Ps=this.Ps,t.Ti=this.Ti,t}toString(){let t="^";return this.modifiers!==0&&(t+="M:"+this.modifiers),this.button!==0&&(t+="B:"+this.button),this.key!==""&&(t+="K:"+this.key),this.clickCount!==0&&(t+="C:"+this.clickCount),this.delta!==0&&(t+="D:"+this.delta),this.handled&&(t+="h"),this.bubbles&&(t+="b"),this.documentPoint!==null&&(t+="@"+this.documentPoint.toString()),t}get diagram(){return this.a}set diagram(t){this.a=t}get viewPoint(){return this.ux}set viewPoint(t){this.ux.h(t)}get documentPoint(){return this.gx}set documentPoint(t){this.gx.h(t)}getMultiTouchViewPoint(t,e){const i=this.diagram;return i===null||i.eA(this.event,t,e),e}getMultiTouchDocumentPoint(t,e){const i=this.diagram;return i===null||(i.eA(this.event,t,e),e.h(i.transformViewToDoc(e))),e}get modifiers(){return this.gm}set modifiers(t){this.gm=t}get button(){return this.mm}set button(t){if(this.mm=t,this.event===null)switch(t){case 0:this.buttons=1;return;case 1:this.buttons=4;return;case 2:this.buttons=2;return}}get buttons(){return this.pm}set buttons(t){this.pm=t}get key(){return this.ym}set key(t){this.ym=t}get code(){return this.wm}set code(t){this.wm=t}get down(){return this.xm}set down(t){this.xm=t}get up(){return this.bm}set up(t){this.bm=t}get clickCount(){return this.km}set clickCount(t){this.km=t}get delta(){return this.Pm}set delta(t){this.Pm=t}get isMultiTouch(){return this.Sm}set isMultiTouch(t){this.Sm=t}get handled(){return this.Mm}set handled(t){this.Mm=t}get bubbles(){return this.Fo}set bubbles(t){this.Fo=t}get event(){return this.Nm}set event(t){this.Nm=t}get isTouchEvent(){const t=this.event;return t===null?!1:t.pointerType==="touch"||t.pointerType==="pen"}get timestamp(){return this.Cm}set timestamp(t){this.Cm=t}get targetDiagram(){return this.Ps}set targetDiagram(t){this.Ps=t}get targetObject(){return this.Ti}set targetObject(t){this.Ti=t}get control(){return(this.modifiers&1)!==0}set control(t){this.modifiers=t?this.modifiers|1:this.modifiers&-2}get shift(){return(this.modifiers&4)!==0}set shift(t){this.modifiers=t?this.modifiers|4:this.modifiers&-5}get alt(){return(this.modifiers&2)!==0}set alt(t){this.modifiers=t?this.modifiers|2:this.modifiers&-3}get meta(){return(this.modifiers&8)!==0}set meta(t){this.modifiers=t?this.modifiers|8:this.modifiers&-9}get left(){const t=this.event;return t!==null&&(t.type==="mousedown"||t.type==="mouseup"||t.type==="pointerdown"||t.type==="pointerup")?this.button===0:(this.buttons&1)!==0}set left(t){t?this.buttons|=1:this.buttons&=-2}get right(){const t=this.event;return t!==null&&(t.type==="mousedown"||t.type==="mouseup"||t.type==="pointerdown"||t.type==="pointerup")?this.button===2:(this.buttons&2)!==0}set right(t){t?this.buttons|=2:this.buttons&=-3}get middle(){const t=this.event;return t!==null&&(t.type==="mousedown"||t.type==="mouseup"||t.type==="pointerdown"||t.type==="pointerup")?this.button===1:(this.buttons&4)!==0}set middle(t){t?this.buttons|=4:this.buttons&=-5}get commandKey(){const t=this.code,e=this.key;return"cxvyzagCXVYZAG".includes(e)?e.toLowerCase():t==="KeyC"?"c":t==="KeyX"?"x":t==="KeyV"?"v":t==="KeyY"?"y":t==="KeyZ"?"z":t==="KeyA"?"a":t==="KeyG"?"g":t!==""?t:e}}class DiagramEvent{a;Pt;Lm;Am;constructor(){this.a=null,this.Pt="",this.Lm=null,this.Am=null}copy(){const t=new DiagramEvent;return t.a=this.a,t.Pt=this.Pt,t.Lm=this.Lm,t.Am=this.Am,t}toString(){let t="*"+this.name;return this.subject!==null&&(t+=":"+this.subject.toString()),this.parameter!==null&&(t+="("+this.parameter.toString()+")"),t}get diagram(){return this.a}set diagram(t){this.a=t}get name(){return this.Pt}set name(t){this.Pt=t}get subject(){return this.Lm}set subject(t){this.Lm=t}get parameter(){return this.Am}set parameter(t){this.Am=t}}var ChangeType=(w=>(w[w.Transaction=1]="Transaction",w[w.Property=2]="Property",w[w.Insert=3]="Insert",w[w.Remove=4]="Remove",w))(ChangeType||{});class ChangedEvent{Tu;Tm;pn;Ce;a;Du;Nc;Cc;Lc;Ac;constructor(){this.Tu=2,this.Tm="",this.pn="",this.Ce=null,this.a=null,this.Du=null,this.Nc=null,this.Cc=null,this.Lc=null,this.Ac=null}static Transaction=1;static Property=2;static Insert=3;static Remove=4;clear(){this.Ce=null,this.a=null,this.Du=null,this.Nc=null,this.Cc=null,this.Lc=null,this.Ac=null}copy(){const t=new ChangedEvent;t.Tu=this.Tu,t.Tm=this.Tm,t.pn=this.pn,t.Ce=this.Ce,t.a=this.a,t.Du=this.Du;let e=this.Nc;return U.$(e)&&U.st(e.copyFrozen)?t.Nc=e.copyFrozen():t.Nc=e,e=this.Cc,U.$(e)&&U.st(e.copyFrozen)?t.Cc=e.copyFrozen():t.Cc=e,e=this.Lc,U.$(e)&&U.st(e.copyFrozen)?t.Lc=e.copyFrozen():t.Lc=e,e=this.Ac,U.$(e)&&U.st(e.copyFrozen)?t.Ac=e.copyFrozen():t.Ac=e,t}fe(t){t in ChangeType?this.change=t:U.ur(this,t)}toString(){let t="";return this.change===1?t+="* ":this.change===2?t+=this.model!==null?"!m":"!d":t+=(this.model!==null?"!m":"!d")+this.change,this.propertyName&&typeof this.propertyName=="string"&&(t+=" "+this.propertyName),this.modelChange&&this.modelChange!==this.propertyName&&(t+=" "+this.modelChange),t+=": ",this.change===1?this.oldValue!==null&&(t+=" "+this.oldValue):(this.object!==null&&(t+=U.toString(this.object)),this.oldValue!==null&&(t+="  old: "+U.toString(this.oldValue)),this.oldParam!==null&&(t+=" "+this.oldParam),this.newValue!==null&&(t+="  new: "+U.toString(this.newValue)),this.newParam!==null&&(t+=" "+this.newParam)),t}getValue(t){return t?this.oldValue:this.newValue}getParam(t){return t?this.oldParam:this.newParam}canUndo(){return this.model!==null||this.diagram!==null}undo(){this.canUndo()&&(this.model!==null?this.model.changeState(this,!0):this.diagram!==null&&this.diagram.iA(this,!0))}canRedo(){return this.model!==null||this.diagram!==null}redo(){this.canRedo()&&(this.model!==null?this.model.changeState(this,!1):this.diagram!==null&&this.diagram.iA(this,!1))}get model(){return this.Ce}set model(t){this.Ce=t}get diagram(){return this.a}set diagram(t){this.a=t}get change(){return this.Tu}set change(t){this.Tu=t}get modelChange(){return this.Tm}set modelChange(t){this.Tm=t}get propertyName(){return this.pn}set propertyName(t){this.pn=t}get isTransactionFinished(){return this.Tu===1&&(this.pn==="CommittedTransaction"||this.pn==="FinishedUndo"||this.pn==="FinishedRedo")}get object(){return this.Du}set object(t){this.Du=t}get oldValue(){return this.Nc}set oldValue(t){this.Nc=t}get oldParam(){return this.Cc}set oldParam(t){this.Cc=t}get newValue(){return this.Lc}set newValue(t){this.Lc=t}get newParam(){return this.Ac}set newParam(t){this.Ac=t}}class Transaction{sA;Pt;XP;constructor(){this.sA=new List().k(),this.Pt="",this.XP=!1}toString(t){let e="Transaction: "+this.name+" "+this.changes.count.toString()+(this.isComplete?"":", incomplete");if(t!==void 0&&t>0){const i=this.changes.count;for(let s=0;s<i;s++){const n=this.changes.elt(s);n!==null&&(e+=`
  `+n.toString())}}return e}clear(){const t=this.changes;t.ce();for(let e=t.count-1;e>=0;e--){const i=t.elt(e);i!==null&&i.clear()}t.clear(),t.k()}canUndo(){return this.isComplete}undo(){if(this.canUndo())for(let t=this.changes.count-1;t>=0;t--){const e=this.changes.elt(t);e!==null&&e.undo()}}canRedo(){return this.isComplete}redo(){if(!this.canRedo())return;const t=this.changes.count;for(let e=0;e<t;e++){const i=this.changes.elt(e);i!==null&&i.redo()}}rR(t){const e=this.changes;for(let i=e.count-1;i>=t;i--){const s=e.elt(i);s!==null&&s.undo(),e.ce(),e.removeAt(i)}e.k()}thaw(){this.changes.ce()}optimize(){if(!this.isComplete)return;const t=this.changes;t.ce();const e=new Map;for(let s=0;s<t.count;s++){const n=t.elt(s);if(n===null||n.change!==2||!n.object)continue;let o=e.get(n.object);o||(o=new Map,e.set(n.object,o));const r=o.get(n.propertyName);r===void 0?o.set(n.propertyName,-1):(r>0&&t.setElt(r,null),o.set(n.propertyName,s))}let i=0;for(let s=0;s<t.count;s++){const n=t.elt(s);n!==null&&(s>i&&t.setElt(i,n),i++)}for(;t.length>i;)t.pop();t.k()}get changes(){return this.sA}get name(){return this.Pt}set name(t){this.Pt=t}get isComplete(){return this.XP}set isComplete(t){this.XP=t}}class UndoManager{mx;Be;nA;Hs;GP;Dm;Tl;YP;KP;yn;Tc;yx;qs;wx;xx;vm;kx;constructor(t){this.mx=new GSet,this.Be=!1,this.nA=new List().k(),this.Hs=-1,this.GP=999,this.qs=!1,this.Dm=null,this.Tl=0,this.YP=!1,this.KP=23,this.yn=new List().k(),this.Tc=new List,this.yx=!0,this.wx=!1,this.xx=!1,this.vm=!1,this.kx=!1,t&&Object.assign(this,t)}toString(t){let e="UndoManager "+this.historyIndex+"<"+this.history.count+"<="+this.maxHistoryLength;e+="[";let i=this.nestedTransactionNames.count;for(let s=0;s<i;s++)s>0&&(e+=" "),e+=this.nestedTransactionNames.elt(s);if(e+="]",t!==void 0&&t>0){i=this.history.count;for(let s=0;s<i;s++)e+=`
 `+this.history.elt(s).toString(t-1)}return e}clear(){const t=this.history;t.ce();for(let e=t.count-1;e>=0;e--){const i=t.elt(e);i!==null&&i.clear()}t.clear(),this.Hs=-1,t.k(),this.qs=!1,this.Dm=null,this.Tl=0,this.yn.ce(),this.yn.clear(),this.yn.k(),this.Tc.clear(),this.wx=!1,this.xx=!1,this.vm=!1,this.kx=!1}copyProperties(t){this.isEnabled=t.isEnabled,this.maxHistoryLength=t.maxHistoryLength,this.Fm=t.Fm}addModel(t){this.mx.add(t)}removeModel(t){this.mx.delete(t)}startTransaction(t){if(t===void 0&&(t=""),t===null&&(t=""),this.isUndoingRedoing)return!1;this.yx===!0&&(this.yx=!1,this.Tl++,this.Dl||this.vl("StartingFirstTransaction",t,this.currentTransaction),this.Tl>0&&this.Tl--),this.isEnabled&&(this.yn.ce(),this.yn.add(t),this.yn.k(),this.currentTransaction===null?this.Tc.add(0):this.Tc.add(this.currentTransaction.changes.count)),this.Tl++;const e=this.transactionLevel===1;return e&&(this.Dl||this.vl("StartedTransaction",t,this.currentTransaction)),e}commitTransaction(t){return t===void 0&&(t=""),this.oA(!0,t)}rollbackTransaction(){return this.oA(!1,"")}oA(t,e){if(this.isUndoingRedoing)return!1;this.Fm&&this.transactionLevel<1&&U.ne("Ending transaction without having started a transaction: "+e);const i=this.transactionLevel===1;let s=this.currentTransaction;i&&t&&(this.Dl||this.vl("CommittingTransaction",e,s));let n=0;if(this.transactionLevel>0&&(this.Tl--,this.isEnabled)){const o=this.yn.count;o>0&&(e===""&&(e=this.yn.elt(0)),this.yn.ce(),this.yn.removeAt(o-1),this.yn.k());const r=this.Tc.count;r>0&&(n=this.Tc.elt(r-1),this.Tc.removeAt(r-1))}if(i){if(t){if(this.vm=!1,s===null&&e!==""&&(s=this.currentTransaction),this.isEnabled&&s!==null){const o=s;o.isComplete||(o.isComplete=!0,o.name=e),this.discardHistoryAfterIndex();const r=this.history;r.ce();const l=this.maxHistoryLength;if(l>=0){if(l===0)r.clear();else if(r.count>=l){const a=r.elt(0);a!==null&&a.clear(),r.removeAt(0),this.Hs--}}l!==0&&(r.count===0||r.get(r.count-1)!==o)&&(r.add(o),this.Hs++),r.k(),s=o}this.Dl||this.vl("CommittedTransaction",e,s)}else{this.qs=!0;try{this.isEnabled&&s!==null&&(s.isComplete=!0,s.undo())}finally{this.Dl||this.vl("RolledBackTransaction",e,s),this.qs=!1}s!==null&&s.clear()}return this.Dm=null,this.Px&&this.clear(),this.Px=!1,this.Sx=!1,!0}else return this.isEnabled&&!t&&s!==null&&s.rR(n),!1}discardHistoryAfterIndex(){if(this.isUndoingRedoing||!this.canRedo())return;const t=this.history;t.ce();for(let e=t.count-1;e>this.historyIndex;e--){const i=t.elt(e);i!==null&&i.clear(),t.removeAt(e),this.vm=!0}t.k()}thaw(){this.history.ce()}canUndo(){if(!this.isEnabled||this.transactionLevel>0)return!1;const t=this.transactionToUndo;return!!(t!==null&&t.canUndo())}undo(){if(!this.canUndo())return;const t=this.transactionToUndo;if(t!==null)try{this.qs=!0,this.vl("StartingUndo","Undo",t),this.Hs--,t.undo()}catch(e){U.ne("undo error: "+e.toString())}finally{this.vl("FinishedUndo","Undo",t),this.qs=!1}}canRedo(){if(!this.isEnabled||this.transactionLevel>0)return!1;const t=this.transactionToRedo;return!!(t!==null&&t.canRedo())}redo(){if(!this.canRedo())return;const t=this.transactionToRedo;if(t!==null)try{this.qs=!0,this.vl("StartingRedo","Redo",t),this.Hs++,t.redo()}catch(e){U.ne("redo error: "+e.toString())}finally{this.vl("FinishedRedo","Redo",t),this.qs=!1}}vl(t,e,i){const s=new ChangedEvent;s.change=1,s.propertyName=t,s.object=i,s.oldValue=e;const n=this.models;for(;n.next();){const o=n.value;s.model=o,o.lR(s)}}handleChanged(t){if(this.isEnabled&&!this.isUndoingRedoing&&!this.skipsEvent(t)){let e=this.currentTransaction;e===null&&(e=new Transaction,this.Dm=e);const i=t.copy(),s=e.changes;if(s.ce(),s.add(i),s.k(),this.Fm&&this.KP>0&&this.transactionLevel<=0&&!this.yx){const n=t.diagram;if(n!==null&&n.Qa===!1)return;U.ne("Change not within a transaction: "+i.toString()),this.KP--}}}skipsEvent(t){if(t===null||t.change===1)return!0;const e=t.object;if(e===null)return!1;if(e.layer!==void 0){const i=e.layer;if(i!==null&&i.isTemporary)return!0}else if(e.isTemporary)return!0;return!1}get models(){return this.mx.iterator}get isEnabled(){return this.Be}set isEnabled(t){this.Be=t}get transactionToUndo(){return this.historyIndex>=0&&this.historyIndex<=this.history.count-1?this.history.elt(this.historyIndex):null}get transactionToRedo(){return this.historyIndex<this.history.count-1?this.history.elt(this.historyIndex+1):null}get isUndoingRedoing(){return this.qs}get history(){return this.nA}get maxHistoryLength(){return this.GP}set maxHistoryLength(t){this.GP=t}get historyIndex(){return this.Hs}get currentTransaction(){return this.Dm}get transactionLevel(){return this.Tl}get isInTransaction(){return this.Tl>0}get Fm(){return this.YP}set Fm(t){this.YP=t}get nestedTransactionNames(){return this.yn}get Px(){return this.wx}set Px(t){this.wx=t}get Sx(){return this.xx}set Sx(t){this.xx=t}get Dl(){return this.kx}set Dl(t){this.kx=t}get isJustDiscarded(){return this.vm}}class Tool{a;Pt;Be;HP;qP;Rm;rA;constructor(){GSet.Je(this),this.a=Diagram.Om(),this.Pt="",this.Be=!0,this.HP=!1,this.qP=null,this.rA=new InputEvent,this.Rm=-1}get diagram(){return this.a}set diagram(t){t instanceof Diagram&&(this.a=t)}toString(){return this.name!==""?this.name+" Tool":U.Kn(this.constructor)}updateAdornments(t){}canStart(){return this.isEnabled}doStart(){}doActivate(){this.isActive=!0}doDeactivate(){this.isActive=!1}doStop(){}doCancel(){this.transactionResult=null,this.stopTool()}stopTool(){const t=this.diagram;t.currentTool===this&&(t.currentTool=null,t.currentCursor="")}doMouseDown(){!this.isActive&&this.canStart()&&this.doActivate()}doMouseMove(){}doMouseUp(){this.stopTool()}doMouseWheel(){}canStartMultiTouch(){return!0}standardPinchZoomStart(){const t=this.diagram,e=t.lastInput,i=e.getMultiTouchViewPoint(0,Point.z(NaN,NaN)),s=e.getMultiTouchViewPoint(1,Point.z(NaN,NaN));if(!i.isReal()||!s.isReal()){Point.i(i),Point.i(s);return}if(this.doCancel(),t.getInputOption("hasGestureZoom")){t.jP=t.scale;const n=s.x-i.x,o=s.y-i.y,r=Math.sqrt(n*n+o*o);t.WP=r,e.bubbles=!1}Point.i(i),Point.i(s)}standardPinchZoomMove(){const t=this.diagram,e=t.lastInput,i=e.getMultiTouchViewPoint(0,Point.z(NaN,NaN)),s=e.getMultiTouchViewPoint(1,Point.z(NaN,NaN));if(!i.isReal()||!s.isReal()){Point.i(i),Point.i(s);return}if(this.doCancel(),t.getInputOption("hasGestureZoom")){const n=s.x-i.x,o=s.y-i.y,l=Math.sqrt(n*n+o*o)/t.WP,a=new Point((Math.min(s.x,i.x)+Math.max(s.x,i.x))/2,(Math.min(s.y,i.y)+Math.max(s.y,i.y))/2),h=t.jP*l,c=t.commandHandler;if(h!==t.scale&&c.canResetZoom(h)){const f=t.zoomPoint;t.zoomPoint=a,c.resetZoom(h),t.zoomPoint=f}e.bubbles=!1}Point.i(i),Point.i(s)}doKeyDown(){this.diagram.lastInput.code==="Escape"&&this.doCancel()}doKeyUp(){}startTransaction(t){return t===void 0&&(t=this.name),this.transactionResult=null,this.diagram.startTransaction(t)}stopTransaction(){const t=this.diagram;return this.transactionResult===null?t.rollbackTransaction():t.commitTransaction(this.transactionResult)}standardMouseSelect(){const t=this.diagram;if(!t.allowSelect)return;const e=t.lastInput,i=t.findPartAt(e.documentPoint,!1);if(i!==null){if(U.fr?e.meta:e.control){t.T("ChangingSelection",t.selection);let s=i;for(;s!==null&&!s.canSelect();)s=s.containingGroup;s!==null&&(s.isSelected=!s.isSelected),t.T("ChangedSelection",t.selection)}else if(e.shift){if(!i.isSelected){t.T("ChangingSelection",t.selection);let s=i;for(;s!==null&&!s.canSelect();)s=s.containingGroup;s!==null&&(s.isSelected=!0),t.T("ChangedSelection",t.selection)}}else if(!i.isSelected){let s=i;for(;s!==null&&!s.canSelect();)s=s.containingGroup;s!==null&&t.select(s)}}else e.left&&!(U.fr?e.meta:e.control)&&!e.shift&&t.clearSelection()}standardMouseClick(t,e){t===void 0&&(t=null),e===void 0&&(e=o=>!o.layer?.isTemporary);const i=this.diagram,s=i.lastInput,n=i.findObjectAt(s.documentPoint,t,e);return s.targetObject=n,this.lA(n,s,i)}lA(t,e,i){if(e.handled=!1,t!==null&&!t.isEnabledObject())return!1;let s=0;e.left?e.clickCount===1?s=1:e.clickCount===2?s=2:s=1:e.right&&e.clickCount===1&&(s=3);let n="ObjectSingleClicked";if(t!==null){switch(s){case 1:n="ObjectSingleClicked";break;case 2:n="ObjectDoubleClicked";break;case 3:n="ObjectContextClicked";break}s!==0&&i.T(n,t)}else{switch(s){case 1:n="BackgroundSingleClicked";break;case 2:n="BackgroundDoubleClicked";break;case 3:n="BackgroundContextClicked";break}s!==0&&i.T(n)}if(t!==null)for(;t!==null;){let o=null;switch(s){case 1:o=t.click;break;case 2:o=t.doubleClick?t.doubleClick:t.click;break;case 3:o=t.contextClick;break}if(o!==null&&(o(e,t),e.handled))break;t=t.panel}else{let o=null;switch(s){case 1:o=i.click;break;case 2:o=i.doubleClick?i.doubleClick:i.click;break;case 3:o=i.contextClick;break}o!==null&&o(e)}return e.handled}standardMouseOver(){const t=this.diagram,e=t.lastInput;if(t.animationManager.ke===!0)return;const i=t.skipsUndoManager;t.skipsUndoManager=!0;let s=t.viewportBounds.containsPoint(e.documentPoint)?t.findObjectAt(e.documentPoint,null,null):null;e.event&&(e.event.type==="pointercancel"||e.event.type==="pointerout")&&(s=null),e.targetObject=s;let n=!1;if(s!==t.Dc){let o=t.Dc;const r=o;for(t.Dc=s,this.aA(o,s),e.handled=!1;o!==null;){const l=o.mouseLeave;if(l!==null&&(s===o||s!==null&&s.isContainedBy(o)||(l(e,o,s),n=!0,e.handled)))break;o=o.panel}for(o=r,e.handled=!1;s!==null;){const l=s.mouseEnter;if(l!==null&&(o===s||o!==null&&o.isContainedBy(s)||(l(e,s,o),n=!0,e.handled)))break;s=s.panel}s=t.Dc}if(s!==null){let o=s,r="";for(;o!==null&&(r=o.cursor,r==="");)o=o.panel;for(t.currentCursor=r,e.handled=!1,o=s;o!==null;){const l=o.mouseOver;if(l!==null&&(l(e,o),n=!0,e.handled))break;o=o.panel}}else{this.doUpdateCursor(null);const o=t.mouseOver;o!==null&&(o(e),n=!0)}n&&t.requestUpdate(),t.skipsUndoManager=i}doUpdateCursor(t){const e=this.diagram;e&&(e.currentCursor="")}aA(t,e){}standardMouseWheel(){const t=this.diagram,e=t.lastInput;let i=e.delta;if(i===0||!t.documentBounds.isReal())return;const s=t.commandHandler,n=t.toolManager.mouseWheelBehavior;if(s!==null&&(n===2&&!e.shift||n===1&&e.control)){if(i>0?s.canIncreaseZoom():s.canDecreaseZoom()){const o=t.zoomPoint;t.zoomPoint=e.viewPoint,i>0?s.increaseZoom():s.decreaseZoom(),t.zoomPoint=o}e.bubbles=!1}else if(n===2&&e.shift||n===1&&!e.control){const o=t.position.copy(),r=e.event,l=r.deltaMode;let a=r.deltaX,h=r.deltaY,c="pixel";if((a!==0||h!==0)&&!e.shift){switch(l){case 0:c="pixel";break;case 1:c="line";break;case 2:c="page";break}if(a!==0&&t.allowHorizontalScroll){const f=t.scrollHorizontalLineChange;a=a*(f/16),t.scroll(c,a>0?"right":"left",Math.abs(a))}if(h!==0&&t.allowVerticalScroll){const f=t.scrollVerticalLineChange;h=h*(f/16),t.scroll(c,h>0?"down":"up",Math.abs(h))}}else!e.shift&&t.allowVerticalScroll?(i=i*3*t.scrollVerticalLineChange,t.scroll(c,i>0?"up":"down",Math.abs(i))):e.shift&&t.allowHorizontalScroll&&(i=i*3*t.scrollHorizontalLineChange,t.scroll(c,i>0?"left":"right",Math.abs(i)));this.doWheelChange(t,o,e)}}doWheelChange(t,e,i){(!t.position.equals(e)||i.event.wheelDeltaX!==0)&&(i.bubbles=!1)}standardWaitAfter(t,e){e===void 0&&(e=this.diagram.lastInput),this.cancelWaitAfter();const i=this,s=e.clone(this.rA);this.Rm=U.un(()=>i.doWaitAfter(s),t)}cancelWaitAfter(){this.Rm!==-1&&U.yc(this.Rm),this.Rm=-1}doWaitAfter(t){}findToolHandleAt(t,e){const s=this.diagram.findObjectAt(t,n=>{for(;n!==null&&!(n.panel instanceof Adornment);)n=n.panel;return n});return s===null?null:s.part.category===e?s:null}isBeyondDragSize(t,e){const i=this.diagram;t===void 0&&(t=i.firstInput.viewPoint),e===void 0&&(e=i.lastInput.viewPoint);const s=i.toolManager.dragSize;let n=s.width,o=s.height;return i.firstInput.isTouchEvent&&(n+=6,o+=6),Math.abs(e.x-t.x)>n||Math.abs(e.y-t.y)>o}get name(){return this.Pt}set name(t){U.s(t,"string",Tool,"name"),this.Pt=t}get isEnabled(){return this.Be}set isEnabled(t){U.s(t,"boolean",Tool,"isEnabled"),this.Be=t}get isActive(){return this.HP}set isActive(t){U.s(t,"boolean",Tool,"isActive"),this.HP=t}get transactionResult(){return this.qP}set transactionResult(t){t!==null&&U.s(t,"string",Tool,"transactionResult"),this.qP=t}}var WheelMode=(w=>(w[w.Scroll=1]="Scroll",w[w.Zoom=2]="Zoom",w[w.None=3]="None",w))(WheelMode||{}),GestureMode=(w=>(w[w.Zoom=1]="Zoom",w[w.Cancel=2]="Cancel",w[w.None=3]="None",w))(GestureMode||{});class ToolManager extends Tool{hA;cA;fA;JP;$P;ZP;QP;_P;tS;eS;Im;_a;constructor(t){super(),this.name="ToolManager",this.hA=new List,this.cA=new List,this.fA=new List,this.JP=850,this.$P=850,this.ZP=new Size(2,2).kt(),this.QP=5e3,this._P=1,this.tS=1,this.eS=null,this.Im=null,this._a=-1,t&&Object.assign(this,t)}static WheelScroll=1;static WheelZoom=2;static WheelNone=3;static GestureZoom=1;static GestureCancel=2;static GestureNone=3;get mouseWheelBehavior(){return this._P}set mouseWheelBehavior(t){this._P=t}get gestureBehavior(){return this.tS}set gestureBehavior(t){this.tS=t}initializeStandardTools(){return this}updateAdornments(t){const e=this.currentToolTip;if(e instanceof Adornment&&this.Im===t){const i=e.adornedObject;(t!==null?i!==null&&i.part===t:i===null)?this.showToolTip(e,i):this.hideToolTip()}}doMouseDown(){const t=this.diagram,e=t.lastInput;if(e.isTouchEvent&&this.gestureBehavior===2&&(e.bubbles=!1),e.isMultiTouch){if(this.cancelWaitAfter(),this.gestureBehavior===3){e.bubbles=!0;return}if(this.gestureBehavior===2)return;if(t.currentTool.canStartMultiTouch()){t.currentTool.standardPinchZoomStart();return}}const i=t.undoManager,s=this.mouseDownTools.length;for(let n=0;n<s;n++){const o=this.mouseDownTools.elt(n);if(o.diagram=this.diagram,o.canStart()){t.doFocus(),t.currentTool=o,t.currentTool===o&&(o.isActive||o.doActivate(),o.doMouseDown());return}}t.lastInput.button===1&&(this.mouseWheelBehavior===1?this.mouseWheelBehavior=2:this.mouseWheelBehavior===2&&(this.mouseWheelBehavior=1)),this.doActivate(),this.standardWaitAfter(this.holdDelay,e)}doMouseMove(){const t=this.diagram,e=t.lastInput;if(e.isMultiTouch){if(this.gestureBehavior===3){e.bubbles=!0;return}if(this.gestureBehavior===2)return;if(t.currentTool.canStartMultiTouch()){t.currentTool.standardPinchZoomMove();return}}if(this.isActive){const s=this.mouseMoveTools.length;for(let n=0;n<s;n++){const o=this.mouseMoveTools.elt(n);if(o.diagram=this.diagram,o.canStart()){t.doFocus(),t.currentTool=o,t.currentTool===o&&(o.isActive||o.doActivate(),o.doMouseMove());return}}}this.uA(t);const i=e.event;i!==null&&(i.type==="pointermove"||!i.cancelable)&&(e.bubbles=!0)}uA(t){this.standardMouseOver(),this.isBeyondDragSize()&&this.standardWaitAfter(this.isActive?this.holdDelay:this.hoverDelay,t.lastInput)}aA(t,e){const i=this.currentToolTip;i!==null&&(e!==null&&i instanceof Adornment&&(e===i||e.isContainedBy(i))||this.hideToolTip())}doWaitAfter(t){const e=this.diagram;if(!e.aR())return;const i=e.lastInput;if(e.lastInput=t,this.doMouseHover(),this.isActive||this.doToolTip(),t.isTouchEvent&&!e.lastInput.handled){const s=t.copy();s.button=2,e.lastInput=s,e.Mx=!0,e.doMouseUp()}e.lastInput=i}doMouseHover(){const t=this.diagram,e=t.lastInput;e.targetObject===null&&(e.targetObject=t.findObjectAt(e.documentPoint,null,null));let i=e.targetObject;if(i!==null)for(e.handled=!1;i!==null;){const s=this.isActive?i.mouseHold:i.mouseHover;if(s!==null&&(s(e,i),e.handled))break;i=i.panel}else{const s=this.isActive?t.mouseHold:t.mouseHover;s!==null&&s(e)}}doToolTip(){const t=this.diagram,e=t.lastInput;e.targetObject===null&&(e.targetObject=t.findObjectAt(e.documentPoint,null,null));let i=e.targetObject;if(i!==null){const s=this.currentToolTip;if(s instanceof Adornment&&(i===s||i.isContainedBy(s)))return;for(;i!==null;){const n=i.toolTip;if(n!==null){this.showToolTip(n,i);return}i=i.panel}this.hideToolTip()}else{const s=t.toolTip;s!==null?this.showToolTip(s,null):this.hideToolTip()}}showToolTip(t,e){e!==null&&U.se(e,GraphObject,ToolManager,"showToolTip:obj");const i=this.diagram;if(t!==this.currentToolTip&&this.hideToolTip(),t instanceof Adornment){t.layerName="Tool",t.selectable=!1,t.scale=1/i.scale,t.category="ToolTip",t.hasPlaceholder()&&(t.placeholder.scale=i.scale);const s=t.diagram;s!==null&&s!==i&&s.remove(t),i.add(t),e!==null?t.adornedObject=e:t.data=i.model,t.ensureBounds(),this.positionToolTip(t,e)}else t instanceof HTMLInfo&&t!==this.currentToolTip&&t.show!==null&&t.show(e,i,this);this.currentToolTip=t,this.extendToolTip(this.toolTipDuration)}positionToolTip(t,e){if(t.hasPlaceholder())return;const i=t,s=this.diagram,n=s.lastInput.documentPoint.copy(),o=i.measuredBounds,r=s.viewportBounds;s.lastInput.isTouchEvent&&(n.x-=o.width),n.x+o.width>r.right&&(n.x-=o.width+5/s.scale),n.x<r.x&&(n.x=r.x),n.y+20/s.scale+o.height>r.bottom?n.y-=o.height+5/s.scale:n.y+=20/s.scale,n.y<r.y&&(n.y=r.y),i.position=n}extendToolTip(t){t===void 0&&(t=3e3),this.currentToolTip!==null&&(this._a!==-1&&(U.yc(this._a),this._a=-1),t>0&&t!==1/0&&(this._a=U.un(()=>this.hideToolTip(),t)))}hideToolTip(){this._a!==-1&&(U.yc(this._a),this._a=-1);const t=this.diagram,e=this.currentToolTip;e!==null&&(e instanceof Adornment?(t.remove(e),this.Im!==null&&this.Im.removeAdornment(e.category),e.data=null,e.adornedObject=null):e instanceof HTMLInfo&&e.hide!==null&&e.hide(t,this),this.currentToolTip=null)}get currentToolTip(){return this.eS}set currentToolTip(t){this.eS=t,this.Im=t!==null&&t instanceof Adornment?t.adornedPart:null}doMouseUp(){this.cancelWaitAfter();const t=this.diagram;if(this.isActive){const e=this.mouseUpTools.length;for(let i=0;i<e;i++){const s=this.mouseUpTools.elt(i);if(s.diagram=this.diagram,s.canStart()){t.doFocus(),t.currentTool=s,t.currentTool===s&&(s.isActive||s.doActivate(),s.doMouseUp());return}}}t.doFocus(),this.doDeactivate()}doMouseWheel(){this.standardMouseWheel()}doKeyDown(){const t=this.diagram;t.commandHandler!==null&&t.commandHandler.doKeyDown()}doKeyUp(){const t=this.diagram;t.commandHandler!==null&&t.commandHandler.doKeyUp()}findTool(t){U.s(t,"string",ToolManager,"findTool:name");let e=this.mouseDownTools.length;for(let i=0;i<e;i++){const s=this.mouseDownTools.elt(i);if(s.name===t)return s}e=this.mouseMoveTools.length;for(let i=0;i<e;i++){const s=this.mouseMoveTools.elt(i);if(s.name===t)return s}e=this.mouseUpTools.length;for(let i=0;i<e;i++){const s=this.mouseUpTools.elt(i);if(s.name===t)return s}return null}replaceTool(t,e){U.s(t,"string",ToolManager,"replaceTool:name"),e!==null&&(e.diagram=this.diagram);let i=this.mouseDownTools.length;for(let s=0;s<i;s++){const n=this.mouseDownTools.elt(s);if(n.name===t)return e!==null?this.mouseDownTools.setElt(s,e):this.mouseDownTools.removeAt(s),n}i=this.mouseMoveTools.length;for(let s=0;s<i;s++){const n=this.mouseMoveTools.elt(s);if(n.name===t)return e!==null?this.mouseMoveTools.setElt(s,e):this.mouseMoveTools.removeAt(s),n}i=this.mouseUpTools.length;for(let s=0;s<i;s++){const n=this.mouseUpTools.elt(s);if(n.name===t)return e!==null?this.mouseUpTools.setElt(s,e):this.mouseUpTools.removeAt(s),n}return null}replaceStandardTool(t,e,i){this.Jt(t,e,i)}Jt(t,e,i){U.s(t,"string",ToolManager,"replaceStandardTool:name"),e!==null&&(e.name=t,e.diagram=this.diagram),this.findTool(t)?this.replaceTool(t,e):e!==null&&i.add(e)}get mouseDownTools(){return this.hA}get mouseMoveTools(){return this.cA}get mouseUpTools(){return this.fA}get hoverDelay(){return this.JP}set hoverDelay(t){U.s(t,"number",ToolManager,"hoverDelay"),this.JP=t}get holdDelay(){return this.$P}set holdDelay(t){U.s(t,"number",ToolManager,"holdDelay"),this.$P=t}get dragSize(){return this.ZP}set dragSize(t){this.ZP=t.N()}get toolTipDuration(){return this.QP}set toolTipDuration(t){U.s(t,"number",ToolManager,"toolTipDuration"),this.QP=t}get actionTool(){return this.findTool("Action")}set actionTool(t){this.Jt("Action",t,this.mouseDownTools)}get relinkingTool(){return this.findTool("Relinking")}set relinkingTool(t){this.Jt("Relinking",t,this.mouseDownTools)}get linkReshapingTool(){return this.findTool("LinkReshaping")}set linkReshapingTool(t){this.Jt("LinkReshaping",t,this.mouseDownTools)}get resizingTool(){return this.findTool("Resizing")}set resizingTool(t){this.Jt("Resizing",t,this.mouseDownTools)}get rotatingTool(){return this.findTool("Rotating")}set rotatingTool(t){this.Jt("Rotating",t,this.mouseDownTools)}get linkingTool(){return this.findTool("Linking")}set linkingTool(t){this.Jt("Linking",t,this.mouseMoveTools)}get draggingTool(){return this.findTool("Dragging")}set draggingTool(t){this.Jt("Dragging",t,this.mouseMoveTools)}get dragSelectingTool(){return this.findTool("DragSelecting")}set dragSelectingTool(t){this.Jt("DragSelecting",t,this.mouseMoveTools)}get panningTool(){return this.findTool("Panning")}set panningTool(t){this.Jt("Panning",t,this.mouseMoveTools)}get contextMenuTool(){return this.findTool("ContextMenu")}set contextMenuTool(t){this.Jt("ContextMenu",t,this.mouseUpTools)}get textEditingTool(){return this.findTool("TextEditing")}set textEditingTool(t){this.Jt("TextEditing",t,this.mouseUpTools)}get clickCreatingTool(){return this.findTool("ClickCreating")}set clickCreatingTool(t){this.Jt("ClickCreating",t,this.mouseUpTools)}get clickSelectingTool(){return this.findTool("ClickSelecting")}set clickSelectingTool(t){this.Jt("ClickSelecting",t,this.mouseUpTools)}}class DraggingTool extends Tool{iS;sS;wn;nS;oS;rS;lS;vc;Em;aS;th;br;dA;hS;vu;Fu;cS;fS;uS;dS;static Nx=new List;static le=null;static eh=null;constructor(t){super(),this.name="Dragging",this.iS=!0,this.dS=!0,this.sS=!0,this.wn=null,this.nS=null,this.oS=null,this.rS=null,this.lS=!1,this.vu=!1,this.vc=new Point(NaN,NaN),this.Em=new Point,this.aS=!0,this.th=100,this.br=[],this.dA=new GSet().k(),this.hS=new DraggingOptions,this.Fu=null,this.cS="copy",this.fS="",this.uS="no-drop",t&&Object.assign(this,t)}get isCopyEnabled(){return this.iS}set isCopyEnabled(t){U.s(t,"boolean",DraggingTool,"isCopyEnabled"),this.iS=t}get copiesEffectiveCollection(){return this.sS}set copiesEffectiveCollection(t){U.s(t,"boolean",DraggingTool,"copiesEffectiveCollection"),this.sS=t}get dragOptions(){return this.hS}set dragOptions(t){this.hS=t}get isGridSnapEnabled(){return this.dragOptions.isGridSnapEnabled}set isGridSnapEnabled(t){U.s(t,"boolean",DraggingTool,"isGridSnapEnabled"),this.dragOptions.isGridSnapEnabled=t}get isComplexRoutingRealtime(){return this.aS}set isComplexRoutingRealtime(t){this.aS=t;const e=this.diagram.findRouter("AvoidsLinks");e!==null&&(e.isRealtime=t)}get isGridSnapRealtime(){return this.dragOptions.isGridSnapRealtime}set isGridSnapRealtime(t){U.s(t,"boolean",DraggingTool,"isGridSnapRealtime"),this.dragOptions.isGridSnapRealtime=t}get gridSnapCellSize(){return this.dragOptions.gridSnapCellSize}set gridSnapCellSize(t){this.dragOptions.gridSnapCellSize.equals(t)||(t=t.N(),this.dragOptions.gridSnapCellSize=t)}get gridSnapCellSpot(){return this.dragOptions.gridSnapCellSpot}set gridSnapCellSpot(t){this.dragOptions.gridSnapCellSpot.equals(t)||(t=t.N(),this.dragOptions.gridSnapCellSpot=t)}get gridSnapOrigin(){return this.dragOptions.gridSnapOrigin}set gridSnapOrigin(t){this.dragOptions.gridSnapOrigin.equals(t)||(t=t.N(),this.dragOptions.gridSnapOrigin=t)}get dragsLink(){return this.dragOptions.dragsLink}set dragsLink(t){U.s(t,"boolean",DraggingTool,"dragsLink"),this.dragOptions.dragsLink=t}get dragsTree(){return this.dragOptions.dragsTree}set dragsTree(t){U.s(t,"boolean",DraggingTool,"dragsTree"),this.dragOptions.dragsTree=t}get copyCursor(){return this.cS}set copyCursor(t){this.cS=t}get moveCursor(){return this.fS}set moveCursor(t){this.fS=t}get nodropCursor(){return this.uS}set nodropCursor(t){this.uS=t}get currentPart(){return this.nS}set currentPart(t){t!==null&&U.se(t,Part,DraggingTool,"currentPart"),this.nS=t}get copiedParts(){return this.rS}set copiedParts(t){this.rS=t}get draggedParts(){return this.oS}set draggedParts(t){this.oS=t}get draggingParts(){return this.copiedParts!==null?this.copiedParts.toKeySet():this.draggedParts!==null?this.draggedParts.toKeySet():this.dA}get draggedLink(){return this.diagram.draggedLink}set draggedLink(t){t!==null&&U.se(t,Link,DraggingTool,"draggedLink"),this.diagram.draggedLink=t}get isDragOutStarted(){return this.lS}set isDragOutStarted(t){this.lS=t}get startPoint(){return this.Em}set startPoint(t){this.Em.equals(t)||this.Em.h(t)}get delay(){return this.th}set delay(t){U.s(t,"number",DraggingTool,"delay"),this.th=t}canStart(){if(!this.isEnabled)return!1;const t=this.diagram;if(t===null||t.isReadOnly&&!t.allowDragOut||!t.allowMove&&!t.allowCopy&&!t.allowDragOut||!t.allowSelect)return!1;const e=t.lastInput;return!e.left||t.currentTool!==this&&(!this.isBeyondDragSize()||e.isTouchEvent&&e.timestamp-t.firstInput.timestamp<this.th)?!1:this.findDraggablePart()!==null}findDraggablePart(){const t=this.diagram;let e=t.findPartAt(t.firstInput.documentPoint,!1);if(e===null)return null;for(;e!==null&&!e.canSelect();)e=e.containingGroup;return e!==null&&(e.canMove()||e.canCopy())?e:null}standardMouseSelect(){const t=this.diagram;if(!t.allowSelect)return;let e=t.findPartAt(t.firstInput.documentPoint,!1);if(e!==null){for(;e!==null&&!e.canSelect();)e=e.containingGroup;if(this.currentPart=e,this.currentPart!==null&&!this.currentPart.isSelected){t.T("ChangingSelection",t.selection);const i=t.lastInput;!(U.fr?i.meta:i.control)&&!i.shift&&t.clearSelection(!0),this.currentPart.isSelected=!0,t.T("ChangedSelection",t.selection)}}}doActivate(){const t=this.diagram;this.Fu=null,this.currentPart===null&&this.standardMouseSelect();const e=this.currentPart;if(e===null||!e.canMove()&&!e.canCopy())return;t.cacheGroupExternalLinks(!0),DraggingTool.le=null,this.isActive=!0,this.vc.set(t.position),this.gS(t.selection),this.br.length=0,t.animationManager.stopAnimation();const i=this.computeEffectiveCollection(t.selection,this.dragOptions);this.draggedParts=i,this.dS=!!this.diagram.layout.isRealtime,this.diagram.layout.isRealtime=!1,t.Ru=!0,t.getRenderingHint("temporaryPixelRatio")===!0&&t.avgSpf>30&&t.Cx(),t.gA(this.draggedParts),t.Ou=!0,this.startTransaction("Drag"),this.startPoint=t.firstInput.documentPoint,t.isMouseCaptured=!0,t.allowDragOut&&this.hR()}gS(t){if(!this.dragsLink)return;const e=this.diagram,i=e.model.Um(),s=t.first();i&&t.count===1&&s instanceof Link&&this.mayDragLink(s)?(this.draggedLink=s,this.draggedLink.canRelinkFrom()&&this.draggedLink.canRelinkTo()&&this.draggedLink.clearAdornments(),this.wn=e.toolManager.findTool("Relinking"),this.wn===null&&(this.wn=new RelinkingTool,this.wn.diagram=e),this.wn.originalLink=this.draggedLink):(this.draggedLink=null,this.wn=null)}mayDragLink(t){const e=this.diagram;return e!==null&&e.allowRelink}computeEffectiveCollection(t,e){return this.diagram.commandHandler.computeEffectiveCollection(t,e)}js(t){return t===void 0?new DraggingInfo(Point.dn):this.isGridSnapEnabled?new DraggingInfo(new Point(Math.round(t.x*1e3)/1e3,Math.round(t.y*1e3)/1e3)):new DraggingInfo(t.copy())}doDeactivate(){this.isActive=!1;const t=this.diagram;this.diagram.layout.isRealtime=this.dS,t.Ou=!1,t.Fl=!0,t.cacheGroupExternalLinks(!1),t.stopAutoScroll(),this.mS(),t.pS(this.draggedParts),this.Fu=null,this.currentPart=null,this.draggedParts=null,this.isDragOutStarted=!1,this.vu=!1,DraggingTool.cR(),this.mA(),this.vc.e(NaN,NaN),DraggingTool.eh!==null&&(DraggingTool.eh.currentCursor=""),DraggingTool.eh=null,DraggingTool.le=null,this.Rl(),t.isMouseCaptured=!1,t.currentCursor="",t.Ru=!1,this.stopTransaction(),t.yS(!0)}stopTransaction(){const t=this.diagram,e=super.stopTransaction();return e&&t.undoManager.transactionToUndo!==null&&t.undoManager.transactionToUndo.optimize(),e}mS(){const t=this.diagram,e=t.skipsUndoManager;t.skipsUndoManager=!0;const i=t.lastInput;this.pA(i,null),t.skipsUndoManager=e,this.br.length=0}yA(){this.Rl(),this.wS();const t=this.diagram;this.vc.isReal()&&(t.position=this.vc),t.stopAutoScroll()}doCancel(){this.Rl(),this.wS();const t=this.diagram;this.vc.isReal()&&(t.position=this.vc),this.stopTool()}doKeyDown(){const t=this.diagram;if(!this.isActive)return;const e=t.lastInput,i=t.previousInput;e.code==="Escape"?this.doCancel():(e.code!==i.code||e.modifiers!==i.modifiers)&&this.doMouseMove()}doKeyUp(){this.isActive&&this.doMouseMove()}fR(t,e){let i=1/0,s=1/0,n=-1/0,o=-1/0;const r=t.iterator;for(;r.next();){const l=r.value;if(!l.isVisible())continue;const a=l.location,h=a.x,c=a.y;isNaN(h)||isNaN(c)||(h<i&&(i=h),c<s&&(s=c),h>n&&(n=h),c>o&&(o=c))}return i===1/0?e.e(0,0,0,0):e.e(i,s,n-i,o-s),e}xS(t){if(this.copiedParts!==null)return;const e=this.diagram;if(t&&(e.isReadOnly||e.isModelReadOnly)||this.draggedParts===null)return;const i=e.undoManager;i.isEnabled&&i.isInTransaction?i.currentTransaction!==null&&i.currentTransaction.changes.count>0&&(e.undoManager.rollbackTransaction(),e.startTransaction("Drag")):this.wS(),e.skipsUndoManager=!t,e.partManager.addsToTemporaryLayer=!t,this.startPoint=e.firstInput.documentPoint;const s=this.copiesEffectiveCollection?this.draggedParts.toKeySet():e.selection,n=e.copyParts(s,e,!0),o=new GMap,r=this.draggedParts.iterator;for(;r.next();){const a=r.key;if(a.Di()&&a.canCopy()){const h=n.get(a);if(h===null)continue;h.location=a.location,h.ensureBounds(),o.set(h,this.js(h.location))}}const l=n.iterator;for(;l.next();){const a=l.value;a instanceof Link&&a.canCopy()&&o.set(a,this.js())}if(this.copiedParts=o,this.gS(o.toKeySet()),this.draggedLink!==null){const a=this.draggedLink,h=a.routeBounds;a.kr(this.startPoint.x-(h.x+h.width/2),this.startPoint.y-(h.y+h.height/2))}this.doUpdateCursor(null)}Rl(){const t=this.diagram;if(this.copiedParts!==null){if(t.removeParts(this.copiedParts.toKeySet(),!1),this.copiedParts=null,this.draggedParts!==null){const e=this.draggedParts.iterator;for(;e.next();)if(e.key instanceof Link){const s=e.value;s.point=new Point(0,0)}}this.doUpdateCursor(null)}t.skipsUndoManager=!1,t.partManager.addsToTemporaryLayer=!1,this.startPoint=t.firstInput.documentPoint}mA(){this.draggedLink!==null&&(this.dragsLink&&this.wn!==null&&(this.wn.stopDraggingMouseMove(),this.wn.originalLink=null),this.draggedLink=null,this.wn=null)}Fc(t,e){if(t===null)return;const i=this.diagram,s=this.startPoint,n=Point.l();n.h(i.lastInput.documentPoint),this.moveParts(t,n.subtract(s),e),Point.i(n),i.getRenderingHint("temporaryPixelRatio")===!0&&i.Ol===null&&i.avgSpf>30&&(i.Cx(),i.Iu())}moveParts(t,e,i){i===void 0&&(i=!1);const s=this.diagram;s!==null&&s.Lx(t,e,this.dragOptions,i)}wS(){if(this.draggedParts===null)return;const t=this.diagram;let e=this.draggedParts.iterator;for(;e.next();){const i=e.key;i.Di()&&(i.location=e.value.point)}for(e=this.draggedParts.iterator;e.next();){const i=e.key;if(i instanceof Link&&i.suspendsRouting){const s=e.value.point;this.draggedParts.set(i,this.js()),i.kr(-s.x,-s.y)}}t.maybeUpdate()}uR(t){if(t===null)return!0;const e=t.part;return!!(e===null||e instanceof Adornment||e.layer?.isTemporary||this.draggedParts&&this.draggedParts.has(e)||this.copiedParts&&this.copiedParts.has(e))}bS(t){const e=this.diagram;this.dragsLink&&(this.draggedLink!==null&&(this.draggedLink.fromNode=null,this.draggedLink.toNode=null),this.wA(!1));const i=this.findDragOverObject(t),s=e.lastInput;s.targetObject=i,this.doUpdateCursor(i);const n=e.skipsUndoManager;let o=!1;try{if(e.skipsUndoManager=!0,o=this.pA(s,i),!this.isActive&&DraggingTool.le===null)return;const r=i!==null?i.part:null;if(r===null||e.handlesDragDropForTopLevelParts&&r.isTopLevel&&!(r instanceof Group)){const l=e.mouseDragOver;l!==null&&(l(s),o=!0)}if(!this.isActive&&DraggingTool.le===null||(this.doDragOver(t,i),!this.isActive&&DraggingTool.le===null))return}finally{e.skipsUndoManager=n,o&&e.maybeUpdate()}this.Fu=i,!e.isReadOnly&&(e.allowMove||e.allowCopy)&&(e.allowHorizontalScroll||e.allowVerticalScroll)&&e.doAutoScroll(s.viewPoint)}findDragOverObject(t){return this.diagram.kS(t,null,e=>!this.uR(e))}doUpdateCursor(t){const e=this.diagram;(t===null||this.Fu!==t)&&(!this.diagram.currentTool.isActive||this.mayCopy()?e.currentCursor=this.copyCursor:this.mayMove()?e.currentCursor=this.moveCursor:this.mayDragOut()&&(e.currentCursor=this.nodropCursor))}pA(t,e){let i=!1,s=this.br.length;const n=s>0?this.br[0]:null;if(e===n)return!1;t.handled=!1;for(let r=0;r<s;r++){const l=this.br[r],a=l.mouseDragLeave;if(a!==null&&(a(t,l,e),i=!0,t.handled))break}if(this.br.length=0,!this.isActive&&DraggingTool.le===null||e===null)return i;t.handled=!1;let o=e;for(;o!==null;)this.br.push(o),o=this.xA(o);s=this.br.length;for(let r=0;r<s;r++){const l=this.br[r],a=l.mouseDragEnter;if(a!==null&&(a(t,l,n),i=!0,t.handled))break}return i}FU(t,e){return t===null?!1:!!(t===e||t.isContainedBy(e)||e instanceof Group&&!(t instanceof Group)&&e.handlesDragDropForMembers&&t.part?.isMemberOf(e))}xA(t){const e=t.panel;if(e!==null)return e;if(t instanceof Part&&!(t instanceof Group)){const i=t.containingGroup;if(i!==null&&i.handlesDragDropForMembers)return i}return null}bA(t,e){const i=this.diagram,s=this.wn;if(s===null)return null;const n=s.portGravity,o=i.findObjectsNear(t,n,h=>s.findValidLinkablePort(h,e)),r=Point.l();let l=1/0,a=null;for(const h=o.iterator;h.next();){const c=h.value;if(c.part===null)continue;const u=c.getDocumentPoint(Spot.Center,r),d=t.distanceSquaredPoint(u);d<l&&(a=c,l=d)}return Point.i(r),a}wA(t){const e=this.draggedLink;if(e!==null){if(e.pointsCount<2)return;const i=this.diagram;if(i.isReadOnly)return;const s=this.wn;if(s===null)return;let n=null,o=null;e.fromNode===null&&(n=this.bA(e.getPoint(0),!1),n!==null&&(o=n.part));let r=null,l=null;e.toNode===null&&(r=this.bA(e.getPoint(e.pointsCount-1),!0),r!==null&&(l=r.part)),s.isValidLink(o,n,l,r)?t?(e.defaultFromPoint=e.getPoint(0),e.defaultToPoint=e.getPoint(e.pointsCount-1),e.suspendsRouting=!1,e.fromNode=o,n!==null&&(e.fromPortId=n.portId),e.toNode=l,r!==null&&(e.toPortId=r.portId),e.fromPort!==i.PS&&i.T("LinkRelinked",e,i.PS),e.toPort!==i.SS&&i.T("LinkRelinked",e,i.SS)):s.doDraggingMouseMove(o,n,l,r):s.doDraggingMouseMove(null,null,null,null)}}doDragOver(t,e){}kA(t){const e=this.diagram;this.dragsLink&&this.wA(!0),this.mS();const i=this.findDragOverObject(t),s=e.lastInput;if(s.targetObject=i,i!==null){s.handled=!1;let l=i;for(;l!==null;){const a=l.mouseDrop;if(a!==null&&(a(s,l),s.handled))break;this.dR(s,l),l=this.xA(l)}}else{const l=e.mouseDrop;l!==null&&l(s)}if(!this.isActive&&DraggingTool.le===null)return;const n=this.copiedParts||this.draggedParts;if(n!==null){const l=n.iterator;for(;l.next();){const a=l.key;a instanceof Node&&a.linksConnected.each(h=>h.suspendsRouting=!1)}}if(this.doDropOnto(t,i),!this.isActive&&DraggingTool.le===null)return;const o=Rect.l(),r=e.selection.iterator;for(;r.next();){const l=r.value;l instanceof Node&&this.gR(e,l,o)}Rect.i(o)}dR(t,e){const i=this.diagram,s=e.part;if(i.handlesDragDropForTopLevelParts&&s!==null&&s.isTopLevel&&!(s instanceof Group)){const n=i.mouseDrop;n!==null&&n(t)}}gR(t,e,i){if(!e.canAvoid())return;let s=!1;i=e.getAvoidableRect(i),t.viewportBounds.containsRect(i)&&(s=!0);const n=this.copiedParts||this.draggedParts;if(n===null)return;const o=t.MS(i,l=>l.part,l=>l instanceof Link,!0,l=>l instanceof Link,s);if(o.count===0)return;const r=o.iterator;for(;r.next();){const l=r.value;n.has(l)&&n.has(e)||!l.isMemberOf(e)&&l.isAvoiding&&l.$t()}}doDropOnto(t,e){}doMouseMove(){if(!this.isActive)return;const t=this.diagram,e=t.lastInput;if(this.simulatedMouseMove(e.event,e.documentPoint,e.targetDiagram))return;this.currentPart!==null&&this.draggedParts!==null&&(this.mayCopy()?(this.xS(!1),this.Fc(this.copiedParts,!1)):this.mayMove()?(this.Rl(),this.Fc(this.draggedParts,!0)):this.mayDragOut()?(this.xS(!1),this.Fc(this.copiedParts,!1)):this.Rl(),this.bS(t.lastInput.documentPoint))}doMouseUp(){if(!this.isActive)return;const t=this.diagram,e=t.lastInput;if(this.simulatedMouseUp(e.event,e.documentPoint,e.targetDiagram))return;let i=!1;const s=this.mayCopy();if(s&&this.copiedParts!==null?(this.Rl(),this.xS(!0),this.Fc(this.copiedParts,!1),this.copiedParts!==null&&(t.T("ChangingSelection",t.selection),t.clearSelection(!0),this.copiedParts.iteratorKeys.each(n=>{n.isSelected=!0}))):(i=!0,this.Rl(),this.mayMove()&&(this.Fc(this.draggedParts,!0),this.bS(t.lastInput.documentPoint))),this.vu=!0,this.kA(t.lastInput.documentPoint),this.isActive){const n=s&&this.copiedParts,o=n?this.copiedParts?.toKeySet():this.draggedParts?this.draggedParts.toKeySet():null;this.copiedParts=null,i&&this.mR(),t.invalidateDocumentBounds(),t.pS(this.draggedParts),this.transactionResult=n?"Copy":"Move",t.T(n?"SelectionCopied":"SelectionMoved",o)}this.stopTool(),s&&t.T("ChangedSelection",t.selection)}simulatedMouseMove(t,e,i){if(DraggingTool.le===null)return!1;const s=DraggingTool.le.diagram;i instanceof Diagram||(i=null);const n=DraggingTool.eh;if(i!==n){if(n!==null&&n!==s){n.stopAutoScroll(),DraggingTool.le.isDragOutStarted=!1;const r=n.toolManager.findTool("Dragging");r!==null&&r.doSimulatedDragLeave()}if(DraggingTool.eh=i,i!==null&&i!==s){DraggingTool.le.yA();const r=i.toolManager.findTool("Dragging");r!==null&&(r.PA(),r.doSimulatedDragEnter())}this.doUpdateCursor(null)}if(i===null||i===s||!i.allowDrop||i.isReadOnly||!i.allowInsert)return!1;const o=i.toolManager.findTool("Dragging");if(o!==null){let r=e;t!==null&&(t.targetTouches!==void 0&&(t.targetTouches.length>0?t=t.targetTouches[0]:t.changedTouches.length>0&&(t=t.changedTouches[0])),r=i.getMouse(t)),i.lastInput.documentPoint=r,i.lastInput.viewPoint=i.transformDocToView(r),i.lastInput.down=!1,i.lastInput.up=!1,o.doSimulatedDragOver()}return!0}simulatedMouseUp(t,e,i){if(DraggingTool.le===null)return!1;const s=DraggingTool.eh,n=DraggingTool.le.diagram;if(i===null)return DraggingTool.le.doCancel(),!0;if(i!==s){if(s!==null){const r=s.toolManager.findTool("Dragging");if(s!==null&&s!==n&&r!==null)return s.stopAutoScroll(),DraggingTool.le.isDragOutStarted=!1,r.doSimulatedDragLeave(),!1}DraggingTool.eh=i;const o=i.toolManager.findTool("Dragging");o!==null&&(DraggingTool.le.yA(),o.PA(),o.doSimulatedDragEnter())}if(i!==this.diagram){let o=e;t!==null?(t.targetTouches!==void 0&&(t.targetTouches.length>0?t=t.targetTouches[0]:t.changedTouches.length>0&&(t=t.changedTouches[0])),o=i.getMouse(t)):o===null&&(o=new Point),i.lastInput.documentPoint=o,i.lastInput.viewPoint=i.transformDocToView(o),i.lastInput.down=!1,i.lastInput.up=!0;const r=i.toolManager.findTool("Dragging");r!==null&&r.doSimulatedDrop();const l=DraggingTool.le;if(l!==null){const a=l.mayCopy();l.transactionResult=a?"Copy":"Move",l.stopTool()}return!0}return!1}mR(){if(this.draggedParts===null)return;const t=this.draggedParts.iterator;for(;t.next();){const e=t.key;if(e instanceof Node){const i=e.containingGroup;i!==null&&i.hasPlaceholder()&&!this.draggedParts.has(i)&&i.placeholder.f()}}}mayCopy(){if(!this.isCopyEnabled)return!1;const t=this.diagram;if(t.isReadOnly||t.isModelReadOnly||!t.allowInsert||!t.allowCopy||!(U.fr?t.lastInput.alt:t.lastInput.control))return!1;const e=t.selection.iterator;for(;e.next();)if(e.value.canCopy())return!0;return!!(this.draggedLink!==null&&this.dragsLink&&this.draggedLink.canCopy())}mayDragOut(){if(!this.isCopyEnabled)return!1;const t=this.diagram;if(!t.allowDragOut||!t.allowCopy||t.allowMove)return!1;const e=t.selection.iterator;for(;e.next();)if(e.value.canCopy())return!0;return!!(this.draggedLink!==null&&this.dragsLink&&this.draggedLink.canCopy())}mayMove(){const t=this.diagram;if(t.isReadOnly||!t.allowMove)return!1;const e=t.selection.iterator;for(;e.next();)if(e.value.canMove())return!0;return!!(this.draggedLink!==null&&this.dragsLink&&this.draggedLink.canMove())}PA(){DraggingTool.Nx.has(this)||DraggingTool.Nx.add(this)}static cR(){if(DraggingTool.Nx.count>0){const t=DraggingTool.Nx,e=t.length;for(let i=0;i<e;i++){const s=t.elt(i);s.mA(),s.Rl(),s.mS(),s.diagram.stopAutoScroll()}t.clear()}}pR(t,e,i){return!this.vu&&this.draggedParts!==null&&!this.draggedParts.has(t)?(i.h(e),!0):!1}get draggingSource(){return DraggingTool.le}mayDragIn(){const t=this.diagram;if(!t.allowDrop||t.isReadOnly||t.isModelReadOnly||!t.allowInsert)return!1;const e=DraggingTool.le;return!(e===null||e.diagram.model.dataFormat!==t.model.dataFormat)}doSimulatedDragEnter(){if(!this.mayDragIn())return;const t=this.diagram;t.animationManager.stopAnimation(),t.Pr(),t.animationManager.stopAnimation();const e=DraggingTool.le;e!==null&&(this.diagram.Ru=!0,t.lastInput.event===null&&(t.lastInput.event=e.diagram.lastInput.event)),this.doUpdateCursor(null)}doSimulatedDragLeave(){const t=DraggingTool.le;t!==null&&t.doSimulatedDragOut(),this.diagram.Ru=!1,this.doCancel()}doSimulatedDragOver(){const t=this.diagram;t.animationManager.Eu=!0;const e=DraggingTool.le;if(e!==null&&e.draggedParts!==null){if(!this.mayDragIn())return;this.SA(e.draggedParts.toKeySet(),!1,t.firstInput),this.Fc(this.copiedParts,!1),this.bS(t.lastInput.documentPoint)}t.animationManager.Eu=!1}doSimulatedDrop(){const t=this.diagram,e=DraggingTool.le;if(e!==null){const i=e.diagram;if(e.vu=!0,this.Rl(),e.draggedParts===null||!this.mayDragIn())return;t.animationManager.Eu=!0,t.T("ChangingSelection",t.selection),this.startTransaction("Drop"),this.SA(e.draggedParts.toKeySet(),!0,t.lastInput),this.Fc(this.copiedParts,!1);const s=new GSet;this.copiedParts!==null&&(t.clearSelection(!0),this.copiedParts.iteratorKeys.each(n=>{n.isSelected=!0,s.add(n)})),this.kA(t.lastInput.documentPoint),t.invalidateDocumentBounds(),this.copiedParts!==null&&(this.transactionResult="ExternalCopy"),this.copiedParts=null,t.doFocus(),t.Ru=!1,t.T("ExternalObjectsDropped",s,i),this.stopTransaction(),t.T("ChangedSelection",t.selection)}t.animationManager.Eu=!1}SA(t,e,i){if(this.copiedParts!==null)return;const s=this.diagram;if(s.isReadOnly||s.isModelReadOnly)return;s.skipsUndoManager=!e,s.partManager.addsToTemporaryLayer=!e,this.startPoint=i.documentPoint;const n=s.copyParts(t,s,!0),o=Rect.l();this.fR(t,o);const r=o.x+o.width/2,l=o.y+o.height/2;Rect.i(o);const a=this.Em,h=new GMap,c=Point.l(),f=t.iterator;for(;f.next();){const d=f.value;if(d instanceof Link&&d.canCopy()){const m=n.get(d);if(m===null)continue;m.points=d.points,m.kr(a.x-r,a.y-l),m.suspendsRouting=!0,h.set(m,this.js())}}const u=t.iterator;for(;u.next();){const d=u.value;if(d.Di()&&d.canCopy()){const m=n.get(d);if(m===null)continue;const g=d.location;c.e(a.x-(r-g.x),a.y-(l-g.y)),m.location=c,m.ensureBounds(),h.set(m,this.js(c))}}if(Point.i(c),this.copiedParts=h,this.gS(h.toKeySet()),this.draggedLink!==null){const d=this.draggedLink,m=d.routeBounds;d.kr(this.startPoint.x-(m.x+m.width/2),this.startPoint.y-(m.y+m.height/2))}this.doUpdateCursor(null)}hR(){this.isDragOutStarted=!0,this.vu=!1,DraggingTool.le=this,DraggingTool.eh=this.diagram,this.doSimulatedDragOut()}doSimulatedDragOut(){const t=this.diagram;!this.mayCopy()&&!this.mayMove()?t.currentCursor=this.nodropCursor:t.currentCursor="",this.Fu=null}computeMove(t,e,i,s){const n=this.diagram;return n!==null?n.computeMove(t,e,this.dragOptions,s):new Point}}ToolManager.prototype.doCancel=function(){DraggingTool.le!==null&&DraggingTool.le.doCancel(),Tool.prototype.doCancel.call(this)};class LinkingBaseTool extends Tool{NS;CS;Il;LS;AS;ih;TS;nh;DS;vS;FS;RS;OS;IS;MA;ES;El;US;constructor(){super(),this.NS=100,this.CS=!1,this.Il="pointer",this.LS=new Link({layerName:"Tool"}).add(new Shape({isPanelMain:!0,stroke:"blue"}).theme("stroke","tempLink"),new Shape({toArrow:"Standard",fill:"blue",stroke:"blue"}).theme("fill","tempLink").theme("stroke","tempLink")).It(),this.ih=new Shape("Rectangle",{portId:"",fill:null,stroke:"magenta",strokeWidth:2,desiredSize:Size.TP}).theme("stroke","tempPort"),this.AS=new Node({selectable:!1,layerName:"Tool"}).add(this.ih).It(),this.nh=new Shape("Rectangle",{portId:"",fill:null,stroke:"magenta",strokeWidth:2,desiredSize:Size.TP}).theme("stroke","tempPort"),this.TS=new Node({selectable:!1,layerName:"Tool"}).add(this.nh).It(),this.DS=null,this.vS=null,this.FS=null,this.RS=null,this.OS=null,this.IS=!0,this.MA=new GMap,this.ES=null,this.El=null,this.US=null}doStop(){this.diagram.stopAutoScroll(),this.originalLink=null,this.originalFromNode=null,this.originalFromPort=null,this.originalToNode=null,this.originalToPort=null,this.validPortsCache.clear(),this.targetPort=null}get portGravity(){return this.NS}set portGravity(t){U.s(t,"number",LinkingBaseTool,"portGravity"),t>=0&&(this.NS=t)}get isUnconnectedLinkValid(){return this.CS}set isUnconnectedLinkValid(t){U.s(t,"boolean",LinkingBaseTool,"isUnconnectedLinkValid"),this.CS=t}get linkingCursor(){return this.Il}set linkingCursor(t){this.Il=t}get temporaryLink(){return this.LS}set temporaryLink(t){t.It(),this.LS=t}get temporaryFromNode(){return this.AS}set temporaryFromNode(t){t.It(),this.AS=t,t&&(this.ih=t.port)}get temporaryFromPort(){return this.ih}set temporaryFromPort(t){if(this.ih!==null){const e=this.ih.panel;if(e!==null){const i=e.D.indexOf(this.ih);e.removeAt(i),e.insertAt(i,t)}}this.ih=t}get temporaryToNode(){return this.TS}set temporaryToNode(t){t.It(),this.TS=t,t&&(this.nh=t.port)}get temporaryToPort(){return this.nh}set temporaryToPort(t){if(this.nh!==null){const e=this.nh.panel;if(e!==null){const i=e.D.indexOf(this.nh);e.removeAt(i),e.insertAt(i,t)}}this.nh=t}get originalLink(){return this.DS}set originalLink(t){t!==null&&U.se(t,Link,LinkingBaseTool,"originalLink"),this.DS=t}get originalFromNode(){return this.vS}set originalFromNode(t){t!==null&&U.se(t,Node,LinkingBaseTool,"originalFromNode"),this.vS=t}get originalFromPort(){return this.FS}set originalFromPort(t){t!==null&&U.se(t,GraphObject,LinkingBaseTool,"originalFromPort"),this.FS=t}get originalToNode(){return this.RS}set originalToNode(t){t!==null&&U.se(t,Node,LinkingBaseTool,"originalToNode"),this.RS=t}get originalToPort(){return this.OS}set originalToPort(t){t!==null&&U.se(t,GraphObject,LinkingBaseTool,"originalToPort"),this.OS=t}get isForwards(){return this.IS}set isForwards(t){this.IS=t}get validPortsCache(){return this.MA}get targetPort(){return this.ES}set targetPort(t){t!==null&&U.se(t,GraphObject,LinkingBaseTool,"targetPort"),this.ES=t}copyPortProperties(t,e,i,s,n){if(t===null||e===null||i===null||s===null)return;const o=e.getDocumentScale(),r=Size.l();r.width=e.naturalBounds.width*o,r.height=e.naturalBounds.height*o,s.desiredSize=r,Size.i(r),n?(s.toSpot=e.toSpot,s.toEndSegmentLength=e.toEndSegmentLength):(s.fromSpot=e.fromSpot,s.fromEndSegmentLength=e.fromEndSegmentLength),i.locationSpot=Spot.Center;const l=Point.l();i.location=e.getDocumentPoint(Spot.Center,l),Point.i(l),s.angle=e.getDocumentAngle(),this.portTargeted!==null&&this.portTargeted(t,e,i,s,n)}setNoTargetPortProperties(t,e,i){e!==null&&(e.desiredSize=Size.TP,e.fromSpot=Spot.None,e.toSpot=Spot.None),t!==null&&(t.location=this.diagram.lastInput.documentPoint),this.portTargeted!==null&&this.portTargeted(null,null,t,e,i)}doMouseDown(){this.isActive&&this.doMouseMove()}doMouseMove(){if(this.isActive){const t=this.diagram;if(this.targetPort=this.findTargetPort(this.isForwards),this.targetPort!==null&&this.targetPort.part instanceof Node){const e=this.targetPort.part;this.isForwards?this.copyPortProperties(e,this.targetPort,this.temporaryToNode,this.temporaryToPort,!0):this.copyPortProperties(e,this.targetPort,this.temporaryFromNode,this.temporaryFromPort,!1)}else this.isForwards?this.setNoTargetPortProperties(this.temporaryToNode,this.temporaryToPort,!0):this.setNoTargetPortProperties(this.temporaryFromNode,this.temporaryFromPort,!1);(t.allowHorizontalScroll||t.allowVerticalScroll)&&t.doAutoScroll(t.lastInput.viewPoint)}}findValidLinkablePort(t,e){if(t===null)return null;const i=t.part;if(!(i instanceof Node))return null;for(;t!==null;){const s=e?t.toLinkable:t.fromLinkable;if(s===!0&&(t.portId!==null||t instanceof Node)&&(e?this.isValidTo(i,t):this.isValidFrom(i,t)))return t;if(s===!1)return null;t=t.panel}return null}findTargetPort(t){const e=this.diagram,i=e.lastInput.documentPoint;let s=this.portGravity;const n=e.findObjectsNear(i,s,a=>this.findValidLinkablePort(a,t),null,!0);let o=1/0,r=null;const l=n.iterator;for(;l.next();){const a=l.value,h=a.part;if(!(h instanceof Node))continue;const c=a.getDocumentPoint(Spot.Center,Point.l()),f=i.x-c.x,u=i.y-c.y;Point.i(c);const d=f*f+u*u;if(d<o){const m=this.validPortsCache.get(a);m!==null?m&&(r=a,o=d):t&&this.isValidLink(this.originalFromNode,this.originalFromPort,h,a)||!t&&this.isValidLink(h,a,this.originalToNode,this.originalToPort)?(this.validPortsCache.set(a,!0),r=a,o=d):this.validPortsCache.set(a,!1)}}if(r!==null){const a=r.part;if(a instanceof Node&&(a.layer===null||a.layer.allowLink))return r}return null}isValidFrom(t,e){if(t===null||e===null)return this.isUnconnectedLinkValid;if(this.diagram.currentTool===this&&(t.layer!==null&&!t.layer.allowLink||e.fromLinkable!==!0))return!1;const i=e.fromMaxLinks;if(i<1/0){if(this.originalLink!==null&&t===this.originalFromNode&&e===this.originalFromPort)return!0;let s=e.portId;if(s===null&&(s=""),t.findLinksOutOf(s).count>=i)return!1}return!0}isValidTo(t,e){if(t===null||e===null)return this.isUnconnectedLinkValid;if(this.diagram.currentTool===this&&(t.layer!==null&&!t.layer.allowLink||e.toLinkable!==!0))return!1;const i=e.toMaxLinks;if(i<1/0){if(this.originalLink!==null&&t===this.originalToNode&&e===this.originalToPort)return!0;let s=e.portId;if(s===null&&(s=""),t.findLinksInto(s).count>=i)return!1}return!0}isInSameNode(t,e){if(t===null||e===null)return!1;if(t===e)return!0;const i=t.part,s=e.part;return i!==null&&i===s}isLinked(t,e){if(t===null||e===null)return!1;const i=t.part;if(!(i instanceof Node))return!1;let s=t.portId;s===null&&(s="");const n=e.part;if(!(n instanceof Node))return!1;let o=e.portId;o===null&&(o="");const r=n.findLinksInto(o);for(;r.next();){const l=r.value;if(l.fromNode===i&&l.fromPortId===s)return!0}return!1}isValidLink(t,e,i,s){if(!this.isValidFrom(t,e)||!this.isValidTo(i,s)||e!==null&&s!==null&&(!(e.fromLinkableSelfNode&&s.toLinkableSelfNode)&&this.isInSameNode(e,s)||!(e.fromLinkableDuplicates&&s.toLinkableDuplicates)&&this.isLinked(e,s))||this.originalLink!==null&&(t!==null&&this.isLabelDependentOnLink(t,this.originalLink)||i!==null&&this.isLabelDependentOnLink(i,this.originalLink))||t!==null&&i!==null&&(t.data===null&&i.data!==null||t.data!==null&&i.data===null)||!this.isValidCycle(t,i,this.originalLink))return!1;let n;return t!==null&&e!==null&&(n=t.linkValidation,n!==null&&!n(t,e,i,s,this.originalLink))||i!==null&&s!==null&&(n=i.linkValidation,n!==null&&!n(t,e,i,s,this.originalLink))?!1:(n=this.linkValidation,n!==null?n(t,e,i,s,this.originalLink):!0)}isLabelDependentOnLink(t,e){if(t===null)return!1;const i=t.labeledLink;if(i===null)return!1;if(i===e)return!0;const s=new GSet;return s.add(t),this.VS(i,e,s)}VS(t,e,i){if(t===e)return!0;const s=t.fromNode;if(s!==null&&s.labeledLink&&(i.add(s),this.VS(s.labeledLink,e,i)))return!0;const n=t.toNode;return!!(n!==null&&n.labeledLink&&(i.add(n),this.VS(n.labeledLink,e,i)))}isValidCycle(t,e,i){if(i===void 0&&(i=null),t===null||e===null)return this.isUnconnectedLinkValid;const s=this.diagram;let n=1;if(s&&(s.model.Vm()?n=s.isTreePathToChildren?5:6:n=s.validCycle),n===1)return!0;if(n===5){const o=i||this.temporaryLink;if(o!==null&&!o.isTreeLink)return!0;const r=e.linksConnected;for(;r.next();){const l=r.value;if(l!==i&&l.isTreeLink&&l.toNode===e)return!1}return!this.Uu(t,e,i,!0)}else if(n===6){const o=i||this.temporaryLink;if(o!==null&&!o.isTreeLink)return!0;const r=t.linksConnected;for(;r.next();){const l=r.value;if(l!==i&&l.isTreeLink&&l.fromNode===t)return!1}return!this.Uu(t,e,i,!0)}else{if(n===2)return!this.yR(t,e,i);if(n===3)return!this.Uu(t,e,i,!1);if(n===4)return!this.wR(t,e,i)}return!0}Uu(t,e,i,s){if(t===e)return!0;if(t===null||e===null)return!1;const n=t.linksConnected;for(;n.next();){const o=n.value;if(o===i||s&&!o.isTreeLink||o.toNode!==t)continue;const r=o.fromNode;if(!(r===t||r===null)&&this.Uu(r,e,i,s))return!0}return!1}yR(t,e,i){if(t===e)return!0;const s=new Set;return s.add(e),this.NA(s,t,e,i)}NA(t,e,i,s){if(e===i)return!0;if(e===null||i===null||t.has(e))return!1;t.add(e);const n=e.linksConnected;for(;n.next();){const o=n.value;if(o===s||o.toNode!==e)continue;const r=o.fromNode;if(!(r===e||r===null)&&this.NA(t,r,i,s))return!0}return!1}wR(t,e,i){if(t===e)return!0;const s=new Set;return s.add(e),this.CA(s,t,e,i)}CA(t,e,i,s){if(e===i)return!0;if(e===null||i===null||t.has(e))return!1;t.add(e);const n=e.linksConnected;for(;n.next();){const o=n.value;if(o===s)continue;const r=o.fromNode,l=o.toNode,a=r===e?l:r;if(!(a===e||a===null)&&this.CA(t,a,i,s))return!0}return!1}get linkValidation(){return this.El}set linkValidation(t){t!==null&&U.S(t,LinkingBaseTool,"linkValidation"),this.El=t}get portTargeted(){return this.US}set portTargeted(t){t!==null&&U.S(t,LinkingBaseTool,"portTargeted"),this.US=t}}var LinkingDirection=(w=>(w[w.Either=1]="Either",w[w.ForwardsOnly=2]="ForwardsOnly",w[w.BackwardsOnly=3]="BackwardsOnly",w))(LinkingDirection||{});class LinkingTool extends LinkingBaseTool{BS;zS;P;XS;constructor(t){super(),this.name="Linking",this.BS={},this.zS=null,this.P=1,this.XS=null,t&&Object.assign(this,t)}static Either=1;static ForwardsOnly=2;static BackwardsOnly=3;get archetypeLinkData(){return this.BS}set archetypeLinkData(t){t!==null&&U.wc(t,LinkingTool,"archetypeLinkData"),t instanceof GraphObject&&U.se(t,Link,LinkingTool,"archetypeLinkData"),this.BS=t}get archetypeLabelNodeData(){return this.zS}set archetypeLabelNodeData(t){t!==null&&U.wc(t,LinkingTool,"archetypeLabelNodeData"),t instanceof GraphObject&&U.se(t,Node,LinkingTool,"archetypeLabelNodeData"),this.zS=t}get direction(){return this.P}set direction(t){this.P=t}get startObject(){return this.XS}set startObject(t){t!==null&&U.se(t,GraphObject,LinkingTool,"startObject"),this.XS=t}canStart(){if(!this.isEnabled)return!1;const t=this.diagram;return t.isReadOnly||t.isModelReadOnly||!t.allowLink||!t.model.Ax()||!t.lastInput.left||t.currentTool!==this&&!this.isBeyondDragSize()?!1:this.findLinkablePort()!==null}findLinkablePort(){const t=this.diagram;let e=this.startObject;if(e===null&&(e=t.findObjectAt(t.firstInput.documentPoint,null,null)),e===null)return null;const i=e.part;if(!(i instanceof Node))return null;const s=this.direction;if(s===1||s===2){const n=this.findValidLinkablePort(e,!1);if(n!==null)return this.isForwards=!0,n;if(this.startObject===i){const o=i.port;if(this.findValidLinkablePort(o,!1))return this.isForwards=!0,o}}if(s===1||s===3){const n=this.findValidLinkablePort(e,!0);if(n!==null)return this.isForwards=!1,n;if(this.startObject===i){const o=i.port;if(this.findValidLinkablePort(o,!0))return this.isForwards=!1,o}}return null}doActivate(){const t=this.diagram,e=this.findLinkablePort();if(e===null){this.stopTool();return}if(this.startTransaction(this.name),t.isMouseCaptured=!0,t.currentCursor=this.linkingCursor,this.isForwards){this.temporaryToNode!==null&&(this.temporaryToNode.location=t.lastInput.documentPoint),this.originalFromPort=e;const i=this.originalFromPort.part;i instanceof Node&&(this.originalFromNode=i),this.copyPortProperties(this.originalFromNode,this.originalFromPort,this.temporaryFromNode,this.temporaryFromPort,!1)}else{this.temporaryFromNode!==null&&(this.temporaryFromNode.location=t.lastInput.documentPoint),this.originalToPort=e;const i=this.originalToPort.part;i instanceof Node&&(this.originalToNode=i),this.copyPortProperties(this.originalToNode,this.originalToPort,this.temporaryToNode,this.temporaryToPort,!0)}t.add(this.temporaryFromNode),this.temporaryFromNode&&this.temporaryFromNode.ensureBounds(),t.add(this.temporaryToNode),this.temporaryToNode&&this.temporaryToNode.ensureBounds(),this.temporaryLink!==null&&(this.temporaryFromNode!==null&&(this.temporaryLink.fromNode=this.temporaryFromNode),this.temporaryToNode!==null&&(this.temporaryLink.toNode=this.temporaryToNode),this.temporaryLink.isTreeLink=this.isNewTreeLink(),this.temporaryLink.$t(),t.add(this.temporaryLink)),this.isActive=!0}doDeactivate(){this.isActive=!1;const t=this.diagram;t.remove(this.temporaryLink),t.remove(this.temporaryFromNode),t.remove(this.temporaryToNode),t.isMouseCaptured=!1,t.currentCursor="",this.stopTransaction()}doStop(){super.doStop(),this.startObject=null}doMouseUp(){if(this.isActive){const t=this.diagram;this.transactionResult=null;let e=null,i=null,s=null,n=null,o=null;try{this.targetPort=this.findTargetPort(this.isForwards);const r=this.targetPort;if(r!==null){const l=r.part;l instanceof Node&&(this.isForwards?(this.originalFromNode!==null&&(e=this.originalFromNode,i=this.originalFromPort),s=l,n=r):(e=l,i=r,this.originalToNode!==null&&(s=this.originalToNode,n=this.originalToPort)))}else this.isForwards?this.originalFromNode!==null&&this.isUnconnectedLinkValid&&(e=this.originalFromNode,i=this.originalFromPort):this.originalToNode!==null&&this.isUnconnectedLinkValid&&(s=this.originalToNode,n=this.originalToPort);e!==null||s!==null?(o=this.insertLink(e,i,s,n),o!==null?(r===null&&(this.isForwards?o.defaultToPoint=t.lastInput.documentPoint:o.defaultFromPoint=t.lastInput.documentPoint),t.allowSelect&&(t.T("ChangingSelection",t.selection),t.clearSelection(!0),o.isSelected=!0),this.transactionResult=this.name,t.T("LinkDrawn",o)):this.doNoLink(e,i,s,n)):this.isForwards?this.doNoLink(this.originalFromNode,this.originalFromPort,null,null):this.doNoLink(null,null,this.originalToNode,this.originalToPort)}finally{this.stopTool(),o&&t.allowSelect&&t.T("ChangedSelection",t.selection)}}}isNewTreeLink(){const t=this.archetypeLinkData;if(t===null)return!0;if(t instanceof Link)return t.isTreeLink;const e=this.diagram;if(e===null)return!0;const i=e.partManager.getLinkCategoryForData(t),s=e.partManager.findLinkTemplateForCategory(i);return s!==null?s.isTreeLink:!0}insertLink(t,e,i,s){return this.diagram.partManager.insertLink(t,e,i,s)}doNoLink(t,e,i,s){}}class RelinkingTool extends LinkingBaseTool{LA=null;AA=null;GS=null;YS=null;Ss;KS;constructor(t){super(),this.name="Relinking",this.fromHandleArchetype=new Shape("Diamond",{desiredSize:Size.Pu,fill:"lightblue",stroke:"dodgerblue",cursor:this.linkingCursor,segmentIndex:0}).theme("fill","adornmentFill").theme("stroke","adornmentStroke"),this.toHandleArchetype=new Shape("Diamond",{desiredSize:Size.Pu,fill:"lightblue",stroke:"dodgerblue",cursor:this.linkingCursor,segmentIndex:-1}).theme("fill","adornmentFill").theme("stroke","adornmentStroke"),this.Ss=null,this.KS=new Rect,t&&Object.assign(this,t)}updateAdornments(t){if(t===null||!(t instanceof Link))return;let e="RelinkFrom",i=null;if(t.isSelected&&!this.diagram.isReadOnly){const s=t.selectionObject;s!==null&&t.canRelinkFrom()&&t.actualBounds.isReal()&&t.isVisible()&&s.actualBounds.isReal()&&s.isVisibleObject()&&(i=t.findAdornment(e),i===null&&(i=this.makeAdornment(s,!1),t.addAdornment(e,i)))}if(i===null&&t.removeAdornment(e),e="RelinkTo",i=null,t.isSelected&&!this.diagram.isReadOnly){const s=t.selectionObject;s!==null&&t.canRelinkTo()&&t.actualBounds.isReal()&&t.isVisible()&&s.actualBounds.isReal()&&s.isVisibleObject()&&(i=t.findAdornment(e),i===null?(i=this.makeAdornment(s,!0),t.addAdornment(e,i)):i.f())}i===null&&t.removeAdornment(e)}makeAdornment(t,e){let i=e?this.YS:this.GS;return i&&(i=i.copy(),i.adornedObject=t),i}get fromHandleArchetype(){return this.LA}set fromHandleArchetype(t){t!==null&&U.se(t,GraphObject,RelinkingTool,"fromHandleArchetype"),this.LA=t,t!==null?this.GS=new Adornment(Panel.Link).add(t).It():this.GS=null}get toHandleArchetype(){return this.AA}set toHandleArchetype(t){t!==null&&U.se(t,GraphObject,RelinkingTool,"toHandleArchetype"),this.AA=t,t!==null?this.YS=new Adornment(Panel.Link).add(t).It():this.YS=null}get handle(){return this.Ss}set handle(t){t!==null&&(t.part instanceof Adornment||U.o("new handle is not in an Adornment: "+t)),this.Ss=t}canStart(){if(!this.isEnabled)return!1;const t=this.diagram;if(t.isReadOnly||t.isModelReadOnly||!t.allowRelink||!t.model.Ax()||!t.lastInput.left)return!1;let i=this.findToolHandleAt(t.firstInput.documentPoint,"RelinkFrom");return i===null&&(i=this.findToolHandleAt(t.firstInput.documentPoint,"RelinkTo")),i!==null}doActivate(){const t=this.diagram;if(this.originalLink===null){let i=this.handle;if(i===null&&(i=this.findToolHandleAt(t.firstInput.documentPoint,"RelinkFrom"),i===null&&(i=this.findToolHandleAt(t.firstInput.documentPoint,"RelinkTo"))),i===null)return;const s=i.part;if(!(s instanceof Adornment)||!(s.adornedPart instanceof Link))return;this.handle=i,this.isForwards=s===null||s.category==="RelinkTo",this.originalLink=s.adornedPart}const e=this.originalLink;e!==null&&(this.startTransaction(this.name),t.isMouseCaptured=!0,t.currentCursor=this.linkingCursor,this.originalFromPort=e.fromPort,this.originalFromNode=e.fromNode,this.originalToPort=e.toPort,this.originalToNode=e.toNode,this.KS.set(e.actualBounds),e.pointsCount>0&&(e.fromNode===null&&(this.temporaryFromPort!==null&&(this.temporaryFromPort.desiredSize=Size.xc),this.temporaryFromNode!==null&&(this.temporaryFromNode.location=e.getPoint(0))),e.toNode===null&&(this.temporaryToPort!==null&&(this.temporaryToPort.desiredSize=Size.xc),this.temporaryToNode!==null&&(this.temporaryToNode.location=e.getPoint(e.pointsCount-1)))),this.copyPortProperties(this.originalFromNode,this.originalFromPort,this.temporaryFromNode,this.temporaryFromPort,!1),this.copyPortProperties(this.originalToNode,this.originalToPort,this.temporaryToNode,this.temporaryToPort,!0),t.add(this.temporaryFromNode),t.add(this.temporaryToNode),this.temporaryLink!==null&&(this.temporaryFromNode!==null&&(this.temporaryLink.fromNode=this.temporaryFromNode),this.temporaryToNode!==null&&(this.temporaryLink.toNode=this.temporaryToNode),this.copyLinkProperties(e,this.temporaryLink),this.temporaryLink.$t(),t.add(this.temporaryLink)),this.isActive=!0)}copyLinkProperties(t,e){if(t===null||e===null)return;e.adjusting=t.adjusting,e.corner=t.corner;let i=t.curve;(i===11||i===10)&&(i=0),e.curve=i,e.curviness=t.curviness,e.isTreeLink=t.isTreeLink,e.points=t.points,e.routing=t.routing,e.smoothness=t.smoothness,e.fromSpot=t.fromSpot,e.fromEndSegmentLength=t.fromEndSegmentLength,e.fromShortLength=t.fromShortLength,e.toSpot=t.toSpot,e.toEndSegmentLength=t.toEndSegmentLength,e.toShortLength=t.toShortLength}doDeactivate(){this.isActive=!1;const t=this.diagram;t.remove(this.temporaryLink),t.remove(this.temporaryFromNode),t.remove(this.temporaryToNode),t.isMouseCaptured=!1,t.currentCursor="",this.stopTransaction()}doStop(){super.doStop(),this.handle=null}doMouseUp(){if(this.isActive){const t=this.diagram;this.transactionResult=null;let e=this.originalFromNode,i=this.originalFromPort,s=this.originalToNode,n=this.originalToPort,o=this.originalLink;try{if(this.targetPort=this.findTargetPort(this.isForwards),this.targetPort!==null){const r=this.targetPort.part;r instanceof Node&&(this.isForwards?(s=r,n=this.targetPort):(e=r,i=this.targetPort))}else this.isUnconnectedLinkValid?this.isForwards?(s=null,n=null):(e=null,i=null):o=null;o!==null?(this.reconnectLink(o,this.isForwards?s:e,this.isForwards?n:i,this.isForwards),this.targetPort===null&&(this.isForwards?o.defaultToPoint=t.lastInput.documentPoint:o.defaultFromPoint=t.lastInput.documentPoint,o.$t()),this.transactionResult=this.name,t.T("LinkRelinked",o,this.isForwards?this.originalToPort:this.originalFromPort)):this.originalLink!==null&&this.doNoRelink(this.originalLink,this.isForwards),this.originalLink!==null&&this.originalLink.invalidateOtherJumpOvers(this.KS)}finally{this.stopTool()}}}reconnectLink(t,e,i,s){const n=i!==null&&i.portId!==null?i.portId:"";return s?(t.toNode=e,t.toPortId=n):(t.fromNode=e,t.fromPortId=n),!0}doNoRelink(t,e){}doDraggingMouseMove(t,e,i,s){t!==null?(this.copyPortProperties(t,e,this.temporaryFromNode,this.temporaryFromPort,!1),this.diagram.add(this.temporaryFromNode)):this.diagram.remove(this.temporaryFromNode),i!==null?(this.copyPortProperties(i,s,this.temporaryToNode,this.temporaryToPort,!0),this.diagram.add(this.temporaryToNode)):this.diagram.remove(this.temporaryToNode)}stopDraggingMouseMove(){this.diagram.remove(this.temporaryFromNode),this.diagram.remove(this.temporaryToNode)}}var ReshapingBehavior=(w=>(w[w.None=0]="None",w[w.Horizontal=1]="Horizontal",w[w.Vertical=2]="Vertical",w[w.All=3]="All",w))(ReshapingBehavior||{});class LinkReshapingTool extends Tool{Sr;HS;qS;Ss;Tx;jS;Bm;constructor(t){super(),this.name="LinkReshaping",this.Sr=new Shape("Rectangle",{desiredSize:Size.IL,fill:"lightblue",stroke:"dodgerblue"}).theme("fill","adornmentFill").theme("stroke","adornmentStroke"),this.HS=new Shape("Diamond",{desiredSize:Size.Pu,fill:"lightblue",stroke:"dodgerblue",cursor:"move"}).theme("fill","adornmentFill").theme("stroke","adornmentStroke"),this.qS=3,this.Ss=null,this.Tx=null,this.jS=new Point,this.Bm=new List,t&&Object.assign(this,t)}static None=0;static Horizontal=1;static Vertical=2;static All=3;getReshapingBehavior(t){return t?t.Mr:0}setReshapingBehavior(t,e){t.Mr=e}updateAdornments(t){if(t===null||!(t instanceof Link))return;let e=null;if(t.isSelected&&!this.diagram.isReadOnly){const i=t.path;i!==null&&t.canReshape()&&t.actualBounds.isReal()&&t.isVisible()&&i.actualBounds.isReal()&&i.isVisibleObject()&&(e=t.findAdornment(this.name),(e===null||e.WS!==t.pointsCount||e.JS!==t.resegmentable)&&(e=this.makeAdornment(i),e!==null&&(e.WS=t.pointsCount,e.JS=t.resegmentable,t.addAdornment(this.name,e))))}e===null&&t.removeAdornment(this.name)}makeAdornment(t){const e=t.part,i=e.points,s=e.pointsCount,n=e.isOrthogonal;let o=null;if(i!==null&&s>1){o=new Adornment,o.type=Panel.Link;const r=e.firstPickIndex,l=e.lastPickIndex,a=n?1:0;if(e.resegmentable&&(e.computeCurve()!==9||e.isOrthogonal))for(let f=r+a;f<l-a;f++){const u=this.makeResegmentHandle(t,f);u!==null&&(u.segmentIndex=f,u.segmentFraction=.5,u.fromMaxLinks=999,o.add(u))}let h=r+1,c=l-1;for(;h<=c;)if(h<c)this.$S(t,o,r,l,h),this.$S(t,o,r,l,c),h++,c--;else if(h===c){this.$S(t,o,r,l,h);break}o.adornedObject=t}return o}$S(t,e,i,s,n){const o=t.part,r=o.isOrthogonal,l=this.makeHandle(t,n);if(l!==null){if(l.segmentIndex=n,n!==i)if(n===i+1&&r){const a=o.getPoint(i);let h=o.getPoint(i+1);G.c(a.x,h.x)&&G.c(a.y,h.y)?(h=o.getPoint(i-1),G.c(a.x,h.x)?(this.setReshapingBehavior(l,2),l.cursor="n-resize"):G.c(a.y,h.y)&&(this.setReshapingBehavior(l,1),l.cursor="w-resize")):G.c(a.x,h.x)?(this.setReshapingBehavior(l,2),l.cursor="n-resize"):G.c(a.y,h.y)&&(this.setReshapingBehavior(l,1),l.cursor="w-resize")}else if(n===s-1&&r){let a=o.getPoint(s-1);const h=o.getPoint(s);G.c(a.x,h.x)&&G.c(a.y,h.y)?(a=o.getPoint(s+1),G.c(a.x,h.x)?(this.setReshapingBehavior(l,2),l.cursor="n-resize"):G.c(a.y,h.y)&&(this.setReshapingBehavior(l,1),l.cursor="w-resize")):G.c(a.x,h.x)?(this.setReshapingBehavior(l,2),l.cursor="n-resize"):G.c(a.y,h.y)&&(this.setReshapingBehavior(l,1),l.cursor="w-resize")}else n===s||(this.setReshapingBehavior(l,3),l.cursor="move");e.add(l)}}makeHandle(t,e){const i=this.handleArchetype;return i===null?null:i.copy().ZS()}get handleArchetype(){return this.Sr}set handleArchetype(t){t!==null&&U.se(t,GraphObject,LinkReshapingTool,"handleArchetype"),this.Sr=t}makeResegmentHandle(t,e){const i=this.midHandleArchetype;return i===null?null:i.copy().ZS()}get midHandleArchetype(){return this.HS}set midHandleArchetype(t){t!==null&&U.se(t,GraphObject,LinkReshapingTool,"midHandleArchetype"),this.HS=t}get handle(){return this.Ss}set handle(t){t!==null&&(t.part instanceof Adornment||U.o("new handle is not in an Adornment: "+t)),this.Ss=t}get adornedLink(){return this.Tx}canStart(){if(!this.isEnabled)return!1;const t=this.diagram;return t.isReadOnly||!t.allowReshape||!t.lastInput.left?!1:this.findToolHandleAt(t.firstInput.documentPoint,this.name)!==null}doActivate(){const t=this.diagram;if(this.handle===null&&(this.handle=this.findToolHandleAt(t.firstInput.documentPoint,this.name)),this.handle===null)return;const e=this.handle.part.adornedPart;if(e instanceof Link){if(this.Tx=e,t.isMouseCaptured=!0,this.startTransaction(this.name),e.resegmentable&&this.handle.fromMaxLinks===999){const i=e.points.copy(),s=this.getResegmentingPoint();if(i.insertAt(this.handle.segmentIndex+1,s),e.isOrthogonal&&i.insertAt(this.handle.segmentIndex+1,s),e.points=i,e.invalidateAdornments(),e.updateAdornments(),this.handle=this.findToolHandleAt(t.firstInput.documentPoint,this.name),this.handle===null){this.doDeactivate();return}}this.jS=e.getPoint(this.handle.segmentIndex),this.Bm=e.points.copy(),this.isActive=!0}}doDeactivate(){this.stopTransaction(),this.handle=null,this.Tx=null;const t=this.diagram;t.isMouseCaptured=!1,this.isActive=!1}stopTransaction(){const t=this.diagram,e=super.stopTransaction();return e&&t.undoManager.transactionToUndo!==null&&t.undoManager.transactionToUndo.optimize(),e}doCancel(){const t=this.adornedLink;t!==null&&(t.points=this.Bm),this.stopTool()}getResegmentingPoint(){return this.handle===null?this.diagram.lastInput.documentPoint:this.handle.getDocumentPoint(Spot.Center)}doMouseMove(){const t=this.diagram;if(this.isActive){const e=this.computeReshape(t.lastInput.documentPoint);this.reshape(e)}}doMouseUp(){const t=this.diagram;if(this.isActive){const e=this.computeReshape(t.lastInput.documentPoint);this.reshape(e);const i=this.adornedLink;if(i!==null&&i.resegmentable&&this.handle!==null&&(i.computeCurve()!==9||i.isOrthogonal)){const s=this.handle.segmentIndex,n=i.getPoint(s-1),o=i.getPoint(s),r=i.getPoint(s+1);if(i.isOrthogonal){if(s>i.firstPickIndex+1&&s<i.lastPickIndex-1){let l=i.getPoint(s-2);if(this.isWithinResegmentingDistance(n,o)&&(this.isInLineOrtho(l,n,o,r,!0)||this.isInLineOrtho(l,n,o,r,!1))){const a=i.points.copy();this.isInLineOrtho(l,n,o,r,!0)?(a.setElt(s-2,new Point(l.x,(r.y+l.y)/2)),a.setElt(s+1,new Point(r.x,(r.y+l.y)/2))):(a.setElt(s-2,new Point((r.x+l.x)/2,l.y)),a.setElt(s+1,new Point((r.x+l.x)/2,r.y))),a.removeAt(s),a.removeAt(s-1),i.points=a,i.invalidateAdornments()}else if(l=i.getPoint(s+2),this.isWithinResegmentingDistance(o,r)&&(this.isInLineOrtho(n,o,r,l,!0)||this.isInLineOrtho(n,o,r,l,!1))){const a=i.points.copy();this.isInLineOrtho(n,o,r,l,!0)?(a.setElt(s-1,new Point(n.x,(n.y+l.y)/2)),a.setElt(s+2,new Point(l.x,(n.y+l.y)/2))):(a.setElt(s-1,new Point((n.x+l.x)/2,n.y)),a.setElt(s+2,new Point((n.x+l.x)/2,l.y))),a.removeAt(s+1),a.removeAt(s),i.points=a,i.invalidateAdornments()}}}else{const l=Point.l();if(G.Nl(n.x,n.y,r.x,r.y,o.x,o.y,l)&&l.distanceSquaredPoint(o)<this.resegmentingDistance*this.resegmentingDistance){const a=i.points.copy();a.removeAt(s),i.points=a,i.invalidateAdornments()}Point.i(l)}}t.invalidateDocumentBounds(),this.transactionResult=this.name,t.T("LinkReshaped",this.adornedLink,this.Bm)}this.stopTool()}isWithinResegmentingDistance(t,e){return Math.abs(t.x-e.x)<this.resegmentingDistance&&Math.abs(t.y-e.y)<this.resegmentingDistance}isInLineOrtho(t,e,i,s,n){return n?Math.abs(t.y-e.y)<this.resegmentingDistance&&Math.abs(e.y-i.y)<this.resegmentingDistance&&Math.abs(i.y-s.y)<this.resegmentingDistance:Math.abs(t.x-e.x)<this.resegmentingDistance&&Math.abs(e.x-i.x)<this.resegmentingDistance&&Math.abs(i.x-s.x)<this.resegmentingDistance}get resegmentingDistance(){return this.qS}set resegmentingDistance(t){U.s(t,"number",LinkReshapingTool,"resegmentingDistance"),this.qS=t}reshape(t){const e=this.adornedLink;if(e===null)return;const i=this.handle;if(i===null)return;e.startRoute();let s=i.segmentIndex;const n=this.getReshapingBehavior(i);if(e.isOrthogonal)if(s===e.firstPickIndex+1){const o=e.firstPickIndex+1;n===2?(e.setPointAt(o,e.getPoint(o-1).x,t.y),e.setPointAt(o+1,e.getPoint(o+2).x,t.y)):n===1&&(e.setPointAt(o,t.x,e.getPoint(o-1).y),e.setPointAt(o+1,t.x,e.getPoint(o+2).y))}else if(s===e.lastPickIndex-1){const o=e.lastPickIndex-1;n===2?(e.setPointAt(o-1,e.getPoint(o-2).x,t.y),e.setPointAt(o,e.getPoint(o+1).x,t.y)):n===1&&(e.setPointAt(o-1,t.x,e.getPoint(o-2).y),e.setPointAt(o,t.x,e.getPoint(o+1).y))}else{let o=s;const r=e.getPoint(o);if(!t.equalsApprox(r)){const l=e.getPoint(o-2),a=e.getPoint(o-1),h=e.getPoint(o+1),c=e.getPoint(o+2);G.c(a.x,r.x)&&G.c(r.y,h.y)?(G.c(a.x,l.x)&&!G.c(a.y,l.y)&&!G.c(t.x,r.x)?(e.insertPointAt(o,t.x,a.y),s++,o++):e.setPointAt(o-1,t.x,a.y),G.c(h.y,c.y)&&!G.c(h.x,c.x)&&!G.c(t.y,r.y)?e.insertPointAt(o+1,h.x,t.y):e.setPointAt(o+1,h.x,t.y)):G.c(a.y,r.y)&&G.c(r.x,h.x)?(G.c(a.y,l.y)&&!G.c(a.x,l.x)&&!G.c(t.y,r.y)?(e.insertPointAt(o,a.x,t.y),s++,o++):e.setPointAt(o-1,a.x,t.y),G.c(h.x,c.x)&&!G.c(h.y,c.y)&&!G.c(t.x,r.x)?e.insertPointAt(o+1,t.x,h.y):e.setPointAt(o+1,t.x,h.y)):G.c(a.x,r.x)&&G.c(r.x,h.x)?(G.c(a.x,l.x)&&!G.c(a.y,l.y)&&!G.c(t.x,r.x)?(e.insertPointAt(o,t.x,a.y),s++,o++):e.setPointAt(o-1,t.x,a.y),G.c(h.x,c.x)&&!G.c(h.y,c.y)&&!G.c(t.x,r.x)?e.insertPointAt(o+1,t.x,h.y):e.setPointAt(o+1,t.x,h.y)):G.c(a.y,r.y)&&G.c(r.y,h.y)&&(G.c(a.y,l.y)&&!G.c(a.x,l.x)&&!G.c(t.y,r.y)?(e.insertPointAt(o,a.x,t.y),s++,o++):e.setPointAt(o-1,a.x,t.y),G.c(h.y,c.y)&&!G.c(h.x,c.x)&&!G.c(t.y,r.y)?e.insertPointAt(o+1,h.x,t.y):e.setPointAt(o+1,h.x,t.y)),e.setPointAt(s,t.x,t.y)}}else{e.setPointAt(s,t.x,t.y);let o=e.fromNode,r=e.fromPort;if(o!==null){const h=o.findVisibleNode();h!==null&&h!==o&&(o=h,r=o.port)}if(s===1&&r!==null&&e.computeSpot(!0,r).isNoSpot()){const h=r.getDocumentPoint(Spot.Center,Point.l()),c=e.getLinkPointFromPoint(o,r,h,t,!0,Point.l());e.setPointAt(0,c.x,c.y),Point.i(h),Point.i(c)}let l=e.toNode,a=e.toPort;if(l!==null){const h=l.findVisibleNode();h!==null&&h!==l&&(l=h,a=l.port)}if(s===e.pointsCount-2&&a!==null&&e.computeSpot(!1,a).isNoSpot()){const h=a.getDocumentPoint(Spot.Center,Point.l()),c=e.getLinkPointFromPoint(l,a,h,t,!1,Point.l());e.setPointAt(e.pointsCount-1,c.x,c.y),Point.i(h),Point.i(c)}}e.commitRoute()}computeReshape(t){const e=this.adornedLink;if(e===null)return t;const i=this.handle;if(i===null)return t;const s=i.segmentIndex;switch(this.getReshapingBehavior(i)){case 3:return t;case 2:{const n=e.getPoint(s);return new Point(n.x,t.y)}case 1:{const n=e.getPoint(s);return new Point(t.x,n.y)}default:case 0:return e.getPoint(s)}}get originalPoint(){return this.jS}get originalPoints(){return this.Bm}}class ResizingTool extends Tool{Nr;Cr;Ro;Rc;QS;Ms;Sr;Ss;zm;_S;Oc;Dx;vx;Fx;constructor(t){super(),this.name="Resizing",this.Nr=new Size(1,1).k(),this.Cr=new Size(9999,9999).k(),this.Ro=new Size(NaN,NaN).k(),this.Rc=!1,this.QS=!0,this.Ms=null,this.Sr=new Shape("Rectangle",{alignmentFocus:Spot.Center,desiredSize:Size.IL,fill:"lightblue",stroke:"dodgerblue",strokeWidth:1,cursor:"pointer"}).theme("fill","adornmentFill").theme("stroke","adornmentStroke"),this.Ss=null,this.zm=new Point,this._S=new Size,this.Oc=new Point,this.Dx=new Size(0,0),this.vx=new Size(1/0,1/0),this.Fx=new Size(1,1),t&&Object.assign(this,t)}updateAdornments(t){if(t!==null){if(t.Lr()){const e=t.rotateObject;if(e===t||e===t.path||e.isPanelMain)return}if(t.isSelected&&!this.diagram.isReadOnly){const e=t.resizeObject;let i=t.findAdornment(this.name);if(e!==null&&t.canResize()&&t.actualBounds.isReal()&&t.isVisible()&&e.actualBounds.isReal()&&e.isVisibleObject()&&((i===null||i.adornedObject!==e)&&(i=this.makeAdornment(e)),i!==null)){const s=e.getDocumentAngle();t.Ul()&&this.updateResizeHandles(i,s),t.addAdornment(this.name,i);return}}t.removeAdornment(this.name)}}makeAdornment(t){let e=null;const i=t.part?.resizeAdornmentTemplate;if(i){if(e=i.copy(),e===null)return null}else{e=new Adornment,e.type=Panel.Spot,e.locationSpot=Spot.Center;const s=new Placeholder;s.isPanelMain=!0,e.add(s);let n=this.makeHandle(t,Spot.TopLeft);n!==null&&e.add(n),n=this.makeHandle(t,Spot.TopRight),n!==null&&e.add(n),n=this.makeHandle(t,Spot.BottomRight),n!==null&&e.add(n),n=this.makeHandle(t,Spot.BottomLeft),n!==null&&e.add(n),n=this.makeHandle(t,Spot.MiddleTop),n!==null&&e.add(n),n=this.makeHandle(t,Spot.MiddleRight),n!==null&&e.add(n),n=this.makeHandle(t,Spot.MiddleBottom),n!==null&&e.add(n),n=this.makeHandle(t,Spot.MiddleLeft),n!==null&&e.add(n)}return e.adornedObject=t,e}makeHandle(t,e){const i=this.handleArchetype;if(i===null)return null;const s=i.copy().ZS();return s.alignment=e,s}updateResizeHandles(t,e){if(t!==null){if(!t.alignment.isDefault()&&(t.cursor==="pointer"||t.cursor.indexOf("resize")>0))this.xR(t,e);else if(t instanceof Panel){const i=t.elements;for(;i.next();){const s=i.value;this.updateResizeHandles(s,e)}}}}xR(t,e){let i=t.alignment;i.isNoSpot()&&(i=Spot.Center);let s=e;if(i.x<=0)i.y<=0?s+=225:i.y>=1?s+=135:s+=180;else if(i.x>=1)i.y<=0?s+=315:i.y>=1&&(s+=45);else if(i.y<=0)s+=270;else if(i.y>=1)s+=90;else return;s=G.Ee(s),s<22.5?t.cursor="e-resize":s<67.5?t.cursor="se-resize":s<112.5?t.cursor="s-resize":s<157.5?t.cursor="sw-resize":s<202.5?t.cursor="w-resize":s<247.5?t.cursor="nw-resize":s<292.5?t.cursor="n-resize":s<337.5?t.cursor="ne-resize":t.cursor="e-resize"}get handleArchetype(){return this.Sr}set handleArchetype(t){t!==null&&U.se(t,GraphObject,ResizingTool,"handleArchetype"),this.Sr=t}get handle(){return this.Ss}set handle(t){t!==null&&(t.part instanceof Adornment||U.o("new handle is not in an Adornment: "+t)),this.Ss=t}get adornedObject(){return this.Ms}set adornedObject(t){t!==null&&t.part instanceof Adornment&&U.o("new handle must not be in an Adornment: "+t),this.Ms=t}canStart(){if(!this.isEnabled)return!1;const t=this.diagram;return t.isReadOnly||!t.allowResize||!t.lastInput.left?!1:this.findToolHandleAt(t.firstInput.documentPoint,this.name)!==null}doActivate(){const t=this.diagram;this.handle===null&&(this.handle=this.findToolHandleAt(t.firstInput.documentPoint,this.name)),this.handle!==null&&(this.adornedObject=this.handle.part.adornedObject,this.adornedObject!==null&&this.adornedObject.part!==null&&(t.isMouseCaptured=!0,t.animationManager.stopAnimation(),t.Ou=!0,this.startTransaction(this.name),this.zm.set(this.adornedObject.getDocumentPoint(this.handle.alignment.opposite())),this.Oc.set(this.adornedObject.part.location),this._S.set(this.adornedObject.desiredSize),this.Fx=this.computeCellSize(),this.Dx=this.computeMinSize(),this.vx=this.computeMaxSize(),this.isActive=!0))}doDeactivate(){const t=this.diagram;t.Ou=!1,t.Fl=!0,this.stopTransaction(),this.handle=null,this.Ms=null,t.isMouseCaptured=!1,this.isActive=!1}stopTransaction(){const t=this.diagram,e=super.stopTransaction();return e&&t.undoManager.transactionToUndo!==null&&t.undoManager.transactionToUndo.optimize(),e}doCancel(){this.adornedObject!==null&&this.adornedObject.part!==null&&(this.adornedObject.desiredSize=this.originalDesiredSize,this.adornedObject.part.location=this.originalLocation),this.stopTool()}doMouseMove(){const t=this.diagram;if(!this.isActive||this.adornedObject===null||this.handle===null)return;const e=this.Dx,i=this.vx,s=this.Fx,n=t.lastInput.documentPoint,o=this.adornedObject.getLocalPoint(n,Point.l()),r=this.computeReshape(),l=this.computeResize(o,this.handle.alignment,e,i,s,r);this.resize(l),t.maybeUpdate(),Point.i(o)}doMouseUp(){const t=this.diagram;if(this.isActive&&this.adornedObject!==null&&this.handle!==null){const e=this.Dx,i=this.vx,s=this.Fx,n=this.adornedObject.getLocalPoint(t.lastInput.documentPoint,Point.l()),o=this.computeReshape(),r=this.computeResize(n,this.handle.alignment,e,i,s,o);this.resize(r),Point.i(n),t.invalidateDocumentBounds(),this.transactionResult=this.name,t.T("PartResized",this.adornedObject,this.originalDesiredSize)}this.stopTool()}resize(t){const e=this.diagram,i=this.adornedObject;if(i===null)return;i.desiredSize=t.size;const s=i.part;if(s===null||this.handle===null)return;s.ensureBounds();const n=i.getDocumentPoint(this.handle.alignment.opposite());if(s instanceof Group){const o=new List;o.add(s);let r;!this.dragsMembers&&!s.hasPlaceholder()&&(r=new DraggingOptions,r.dragsMembers=!1),e.moveParts(o,this.oppositePoint.copy().subtract(n),!0,r)}else s.location=s.location.copy().subtract(n).add(this.oppositePoint);e.maybeUpdate()}computeResize(t,e,i,s,n,o){if(this.adornedObject===null)return Rect.em;e.isNoSpot()&&(e=Spot.Center);const r=this.adornedObject.naturalBounds,l=r.x,a=r.y,h=r.x+r.width,c=r.y+r.height;let f=1;if(!o){let m=r.width,g=r.height;m<=0&&(m=1),g<=0&&(g=1),f=g/m}const u=Point.l();G.tm(t.x,t.y,l,a,n.width,n.height,u);const d=r.copy();return e.x<=0?e.y<=0?(d.x=Math.max(u.x,h-s.width),d.x=Math.min(d.x,h-i.width),d.width=Math.max(h-d.x,i.width),d.y=Math.max(u.y,c-s.height),d.y=Math.min(d.y,c-i.height),d.height=Math.max(c-d.y,i.height),o||(d.height/d.width>=1?(d.height=Math.max(Math.min(f*d.width,s.height),i.height),d.width=d.height/f):(d.width=Math.max(Math.min(d.height/f,s.width),i.width),d.height=f*d.width),d.x=h-d.width,d.y=c-d.height)):e.y>=1?(d.x=Math.max(u.x,h-s.width),d.x=Math.min(d.x,h-i.width),d.width=Math.max(h-d.x,i.width),d.height=Math.max(Math.min(u.y-a,s.height),i.height),o||(d.height/d.width>=1?(d.height=Math.max(Math.min(f*d.width,s.height),i.height),d.width=d.height/f):(d.width=Math.max(Math.min(d.height/f,s.width),i.width),d.height=f*d.width),d.x=h-d.width)):(d.x=Math.max(u.x,h-s.width),d.x=Math.min(d.x,h-i.width),d.width=h-d.x,o||(d.height=Math.max(Math.min(f*d.width,s.height),i.height),d.width=d.height/f,d.y=a+.5*(c-a-d.height))):e.x>=1?e.y<=0?(d.width=Math.max(Math.min(u.x-l,s.width),i.width),d.y=Math.max(u.y,c-s.height),d.y=Math.min(d.y,c-i.height),d.height=Math.max(c-d.y,i.height),o||(d.height/d.width>=1?(d.height=Math.max(Math.min(f*d.width,s.height),i.height),d.width=d.height/f):(d.width=Math.max(Math.min(d.height/f,s.width),i.width),d.height=f*d.width),d.y=c-d.height)):e.y>=1?(d.width=Math.max(Math.min(u.x-l,s.width),i.width),d.height=Math.max(Math.min(u.y-a,s.height),i.height),o||(d.height/d.width>=1?(d.height=Math.max(Math.min(f*d.width,s.height),i.height),d.width=d.height/f):(d.width=Math.max(Math.min(d.height/f,s.width),i.width),d.height=f*d.width))):(d.width=Math.max(Math.min(u.x-l,s.width),i.width),o||(d.height=Math.max(Math.min(f*d.width,s.height),i.height),d.width=d.height/f,d.y=a+.5*(c-a-d.height))):e.y<=0?(d.y=Math.max(u.y,c-s.height),d.y=Math.min(d.y,c-i.height),d.height=c-d.y,o||(d.width=Math.max(Math.min(d.height/f,s.width),i.width),d.height=f*d.width,d.x=l+.5*(h-l-d.width))):e.y>=1&&(d.height=Math.max(Math.min(u.y-a,s.height),i.height),o||(d.width=Math.max(Math.min(d.height/f,s.width),i.width),d.height=f*d.width,d.x=l+.5*(h-l-d.width))),Point.i(u),d}computeReshape(){let t=0;return this.adornedObject instanceof Shape&&(t=this.adornedObject.tM()),!(t===6||this.diagram.lastInput.shift)}computeMinSize(){if(this.adornedObject===null)return Size.xc;const t=this.adornedObject.minSize.copy(),e=this.minSize;return!isNaN(e.width)&&e.width>t.width&&(t.width=e.width),!isNaN(e.height)&&e.height>t.height&&(t.height=e.height),t}computeMaxSize(){if(this.adornedObject===null)return Size.DP;const t=this.adornedObject.maxSize.copy(),e=this.maxSize;return!isNaN(e.width)&&e.width<t.width&&(t.width=e.width),!isNaN(e.height)&&e.height<t.height&&(t.height=e.height),t}computeCellSize(){const t=new Size(NaN,NaN),e=this.adornedObject?.part;if(e){const n=e.resizeCellSize;!isNaN(n.width)&&n.width>0&&(t.width=n.width),!isNaN(n.height)&&n.height>0&&(t.height=n.height)}let i=this.cellSize;isNaN(t.width)&&!isNaN(i.width)&&i.width>0&&(t.width=i.width),isNaN(t.height)&&!isNaN(i.height)&&i.height>0&&(t.height=i.height);const s=this.diagram;if((isNaN(t.width)||isNaN(t.height))&&s){const n=s.grid;n!==null&&n.visible&&this.isGridSnapEnabled&&(i=n.gridCellSize,isNaN(t.width)&&!isNaN(i.width)&&i.width>0&&(t.width=i.width),isNaN(t.height)&&!isNaN(i.height)&&i.height>0&&(t.height=i.height))}return(isNaN(t.width)||t.width===0||t.width===1/0)&&(t.width=1),(isNaN(t.height)||t.height===0||t.height===1/0)&&(t.height=1),t}get minSize(){return this.Nr}set minSize(t){if(!this.Nr.equals(t)){let i=t.width;isNaN(i)&&(i=0);let s=t.height;isNaN(s)&&(s=0),this.Nr.e(i,s)}}get maxSize(){return this.Cr}set maxSize(t){if(!this.Cr.equals(t)){let i=t.width;isNaN(i)&&(i=1/0);let s=t.height;isNaN(s)&&(s=1/0),this.Cr.e(i,s)}}get cellSize(){return this.Ro}set cellSize(t){this.Ro.equals(t)||this.Ro.h(t)}get isGridSnapEnabled(){return this.Rc}set isGridSnapEnabled(t){U.s(t,"boolean",ResizingTool,"isGridSnapEnabled"),this.Rc=t}get dragsMembers(){return this.QS}set dragsMembers(t){U.s(t,"boolean",ResizingTool,"dragsMembers"),this.QS=t}get oppositePoint(){return this.zm}set oppositePoint(t){this.zm.equals(t)||this.zm.h(t)}get originalDesiredSize(){return this._S}get originalLocation(){return this.Oc}}class RotatingTool extends Tool{eM;iM;Ms=null;Sr=null;Rx=null;Ss=null;sM;Xm;Oc;nM;oM;constructor(t){super(),this.name="Rotating",this.eM=45,this.iM=2,this.Oc=new Point,this.Ms=null,this.handleArchetype=new Shape("Ellipse",{desiredSize:Size.Pu,fill:"lightblue",stroke:"dodgerblue",strokeWidth:1,cursor:"pointer"}).theme("fill","adornmentFill").theme("stroke","adornmentStroke"),this.Ss=null,this.sM=0,this.Xm=new Point(NaN,NaN),this.nM=0,this.oM=50,t&&Object.assign(this,t)}updateAdornments(t){if(t!==null){if(t.Lr()){const e=t.rotateObject;if(e===t||e===t.path||e.isPanelMain)return}if(t.isSelected&&!this.diagram.isReadOnly){const e=t.rotateObject;if(e!==null&&t.canRotate()&&t.actualBounds.isReal()&&t.isVisible()&&e.actualBounds.isReal()&&e.isVisibleObject()){let i=t.findAdornment(this.name);if((i===null||i.adornedObject!==e)&&(i=this.makeAdornment(e)),i!==null){i.angle=e.getDocumentAngle(),i.hasPlaceholder()||(i.location=this.computeAdornmentLocation(e)),t.addAdornment(this.name,i);return}}}t.removeAdornment(this.name)}}makeAdornment(t){let e=null;const i=t.part?.rotateAdornmentTemplate;return i?e=i.copy():this.Rx!==null&&(e=this.Rx.copy()),e===null?null:(e.adornedObject=t,e)}get handleArchetype(){return this.Sr}set handleArchetype(t){t!==null&&U.se(t,GraphObject,RotatingTool,"handleArchetype"),this.Sr=t,t!==null?this.Rx=new Adornment(Panel.Position,{locationSpot:Spot.Center}).add(t).It():this.Rx=null}get handle(){return this.Ss}set handle(t){t!==null&&(t.part instanceof Adornment||U.o("new handle is not in an Adornment: "+t)),this.Ss=t}get adornedObject(){return this.Ms}set adornedObject(t){t!==null&&t.part instanceof Adornment&&U.o("new handle must not be in an Adornment: "+t),this.Ms=t}canStart(){if(!this.isEnabled)return!1;const t=this.diagram;return t.isReadOnly||!t.allowRotate||!t.lastInput.left?!1:this.findToolHandleAt(t.firstInput.documentPoint,this.name)!==null}doActivate(){const t=this.diagram;if(this.adornedObject===null){if(this.handle===null&&(this.handle=this.findToolHandleAt(t.firstInput.documentPoint,this.name)),this.handle===null)return;this.adornedObject=this.handle.part.adornedObject}this.adornedObject===null||this.adornedObject.part===null||(t.isMouseCaptured=!0,t.delaysLayout=!0,this.startTransaction(this.name),this.sM=this.adornedObject.angle,this.Xm=this.computeRotationPoint(this.adornedObject),this.Oc=this.adornedObject.part.location.copy(),this.isActive=!0)}computeRotationPoint(t){const e=t.part;if(e!==null){const i=e.locationObject;if(e.rotationSpot.isSpot())return t.getDocumentPoint(e.rotationSpot);if(t===e||t===i)return i.getDocumentPoint(e.locationSpot)}return t.getDocumentPoint(Spot.Center)}computeAdornmentLocation(t){let e=this.rotationPoint;e.isReal()||(e=this.computeRotationPoint(t));const i=t.getLocalPoint(e);let s=this.handleAngle;s=G.Ee(s),s=Math.round(Math.round(s/45)*45);const n=this.handleDistance;return s===0?i.x=t.naturalBounds.width+n:s===45?(i.x=t.naturalBounds.width+n,i.y=t.naturalBounds.height+n):s===90?i.y=t.naturalBounds.height+n:s===135?(i.x=-n,i.y=t.naturalBounds.height+n):s===180?i.x=-n:s===225?(i.x=-n,i.y=-n):s===270?i.y=-n:s===315&&(i.x=t.naturalBounds.width+n,i.y=-n),t.getDocumentPoint(i)}doDeactivate(){const t=this.diagram;this.stopTransaction(),this.handle=null,this.Ms=null,this.Xm=new Point(NaN,NaN),t.isMouseCaptured=!1,this.isActive=!1}stopTransaction(){const t=this.diagram,e=super.stopTransaction();return e&&t.undoManager.transactionToUndo!==null&&t.undoManager.transactionToUndo.optimize(),e}doCancel(){const t=this.diagram;t.delaysLayout=!1,this.rotate(this.originalAngle),this.stopTool()}doMouseMove(){const t=this.diagram;if(this.isActive){const e=this.computeRotate(t.lastInput.documentPoint);this.rotate(e)}}doMouseUp(){const t=this.diagram;if(this.isActive){t.delaysLayout=!1;const e=this.computeRotate(t.lastInput.documentPoint);this.rotate(e),t.invalidateDocumentBounds(),this.transactionResult=this.name,t.T("PartRotated",this.adornedObject,this.originalAngle)}this.stopTool()}rotate(t){const e=this.adornedObject;if(e===null||e.part===null)return;e.angle=t;const i=e.part;i.ensureBounds();const s=i.locationObject,n=i.rotateObject;if(s===n||s.isContainedBy(n)){const o=this.Oc.copy();i.location=o.subtract(this.rotationPoint).rotate(t-this.originalAngle).add(this.rotationPoint)}this.diagram.maybeUpdate()}computeRotate(t){let e=this.rotationPoint.directionPoint(t)-this.handleAngle;const i=this.adornedObject?.panel;i&&(e-=i.getDocumentAngle()),e=G.Ee(e);const s=Math.min(Math.abs(this.snapAngleMultiple),180),n=Math.min(Math.abs(this.snapAngleEpsilon),s/2);return!this.diagram.lastInput.shift&&s>0&&n>0&&(e%s<n?e=Math.floor(e/s)*s:e%s>s-n&&(e=(Math.floor(e/s)+1)*s)),G.Ee(e)}get snapAngleMultiple(){return this.eM}set snapAngleMultiple(t){U.s(t,"number",RotatingTool,"snapAngleMultiple"),this.eM=t}get snapAngleEpsilon(){return this.iM}set snapAngleEpsilon(t){U.s(t,"number",RotatingTool,"snapAngleEpsilon"),this.iM=t}get originalAngle(){return this.sM}get rotationPoint(){return this.Xm}set rotationPoint(t){this.Xm=t.copy()}get handleAngle(){return this.nM}set handleAngle(t){U.s(t,"number",RotatingTool,"handleAngle"),this.nM=t}get handleDistance(){return this.oM}set handleDistance(t){U.s(t,"number",RotatingTool,"handleDistance"),this.oM=t}}class ClickSelectingTool extends Tool{constructor(t){super(),this.name="ClickSelecting",t&&Object.assign(this,t)}canStart(){return!(!this.isEnabled||this.isBeyondDragSize())}doMouseUp(){this.isActive&&(this.standardMouseSelect(),this.standardMouseClick()||this.diagram.lastInput.isTouchEvent&&this.diagram.toolManager.doToolTip()),this.stopTool()}}class ActionTool extends Tool{Ic;constructor(t){super(),this.name="Action",this.Ic=null,t&&Object.assign(this,t)}canStart(){if(!this.isEnabled)return!1;const t=this.diagram,e=t.lastInput,i=t.findObjectAt(e.documentPoint,s=>{for(;s.panel!==null;){if(s.isActionable)return s;s=s.panel}return s});return i!==null&&i.isActionable?(this.Ic=i,t.Dc=t.findObjectAt(e.documentPoint,null,null),!0):!1}doMouseDown(){if(!this.isActive)this.canStart()&&this.doActivate();else{const e=this.diagram.lastInput,i=this.Ic;if(i===null)return;e.targetObject=i,i.actionDown!==null&&i.actionDown(e,i)}}doMouseMove(){if(this.isActive){const e=this.diagram.lastInput,i=this.Ic;if(i===null)return;e.targetObject=i,i.actionMove!==null&&i.actionMove(e,i)}}doMouseUp(){if(this.isActive){const e=this.diagram.lastInput,i=this.Ic;if(i===null)return;e.targetObject=i,i.actionUp!==null&&i.actionUp(e,i),this.standardMouseClick(s=>{for(;s.panel!==null;){if(s.isActionable&&s===i)return s;s=s.panel}return s},s=>s===i)}this.stopTool()}doCancel(){const e=this.diagram.lastInput,i=this.Ic;i!==null&&(e.targetObject=i,i.actionCancel!==null&&i.actionCancel(e,i),this.stopTool())}doStop(){this.Ic=null}}class ClickCreatingTool extends Tool{Vl;rM;Rc;lM;constructor(t){super(),this.name="ClickCreating",this.Vl=null,this.rM=!0,this.Rc=!1,this.lM=new Point(0,0),t&&Object.assign(this,t)}canStart(){if(!this.isEnabled||this.archetypeNodeData===null)return!1;const t=this.diagram;if(t.isReadOnly||t.isModelReadOnly||!t.allowInsert||!t.lastInput.left||this.isBeyondDragSize())return!1;if(this.isDoubleClick){if(t.lastInput.clickCount===1&&(this.lM=t.lastInput.viewPoint.copy()),t.lastInput.clickCount!==2||this.isBeyondDragSize(this.lM))return!1}else if(t.lastInput.clickCount!==1)return!1;return!(t.currentTool!==this&&t.findPartAt(t.lastInput.documentPoint,!0)!==null)}doMouseUp(){const t=this.diagram;this.isActive&&this.insertPart(t.lastInput.documentPoint),this.stopTool()}insertPart(t){const e=this.diagram,i=this.archetypeNodeData;if(i===null)return null;let s=null;try{if(e.T("ChangingSelection",e.selection),this.startTransaction(this.name),i instanceof Part)i.Di()&&(i.It(),s=i.copy(),s!==null&&e.add(s));else if(i!==null){const n=e.model.copyNodeData(i);e.model.addNodeData(n),s=e.findPartForData(n)}if(s!==null){const n=Point.z(t.x,t.y);this.isGridSnapEnabled&&this.diagram.aM(s,t,n),s.location=n,e.allowSelect&&(e.clearSelection(!0),s.isSelected=!0),Point.i(n)}e.invalidateDocumentBounds(),this.transactionResult=this.name,e.T("PartCreated",s)}finally{this.stopTransaction(),e.T("ChangedSelection",e.selection)}return s}get archetypeNodeData(){return this.Vl}set archetypeNodeData(t){t!==null&&U.wc(t,ClickCreatingTool,"archetypeNodeData"),this.Vl=t}get isDoubleClick(){return this.rM}set isDoubleClick(t){U.s(t,"boolean",ClickCreatingTool,"isDoubleClick"),this.rM=t}get isGridSnapEnabled(){return this.Rc}set isGridSnapEnabled(t){U.s(t,"boolean",ClickCreatingTool,"isGridSnapEnabled"),this.Rc=t}}class DragSelectingTool extends Tool{th;hM;Bl;constructor(t){super(),this.name="DragSelecting",this.th=175,this.hM=!1,this.Bl=new Part({layerName:"Tool",selectable:!1}).add(new Shape("Rectangle",{name:"SHAPE",fill:null,stroke:"magenta"}).theme("stroke","dragSelect")).It(),t&&Object.assign(this,t)}canStart(){if(!this.isEnabled)return!1;const t=this.diagram;if(!t.allowSelect)return!1;const e=t.lastInput;return!(!e.left||t.currentTool!==this&&(!this.isBeyondDragSize()||e.timestamp-t.firstInput.timestamp<this.delay||t.findPartAt(e.documentPoint,!0)!==null))}doActivate(){const t=this.diagram;this.isActive=!0,t.isMouseCaptured=!0,t.skipsUndoManager=!0,this.box&&t.add(this.box),this.doMouseMove()}doDeactivate(){const t=this.diagram;t.stopAutoScroll(),this.box&&t.remove(this.box),t.skipsUndoManager=!1,t.isMouseCaptured=!1,this.isActive=!1}doMouseMove(){const t=this.diagram;if(this.isActive&&this.box!==null){const e=this.computeBoxBounds();let i=this.box.findObject("SHAPE");i===null&&(i=this.box.findMainElement());const s=Size.l().e(e.width,e.height);i!==null&&(i.desiredSize=s),this.box.Ec(e.x,e.y,!1),Size.i(s),(t.allowHorizontalScroll||t.allowVerticalScroll)&&t.doAutoScroll(t.lastInput.viewPoint)}}doMouseUp(){if(this.isActive){const t=this.diagram;this.box&&t.remove(this.box);try{t.currentCursor="wait",t.T("ChangingSelection",t.selection),this.selectInRect(this.computeBoxBounds()),t.T("ChangedSelection",t.selection)}finally{t.currentCursor=""}}this.stopTool()}computeBoxBounds(){const t=this.diagram;return new Rect(t.firstInput.documentPoint,t.lastInput.documentPoint)}selectInRect(t){const e=this.diagram,i=e.lastInput,s=e.findPartsIn(t,this.isPartialInclusion);if(U.fr?i.meta:i.control)if(i.shift){const n=s.iterator;for(;n.next();){const o=n.value;o.isSelected&&(o.isSelected=!1)}}else{const n=s.iterator;for(;n.next();){const o=n.value;o.isSelected=!o.isSelected}}else if(i.shift){const n=s.iterator;for(;n.next();){const o=n.value;o.isSelected||(o.isSelected=!0)}}else{const n=new List,o=e.selection.iterator;for(;o.next();){const a=o.value;s.has(a)||n.add(a)}const r=n.iterator;for(;r.next();){const a=r.value;a.isSelected=!1}const l=s.iterator;for(;l.next();){const a=l.value;a.isSelected||(a.isSelected=!0)}}}get delay(){return this.th}set delay(t){U.s(t,"number",DragSelectingTool,"delay"),this.th=t}get isPartialInclusion(){return this.hM}set isPartialInclusion(t){U.s(t,"boolean",DragSelectingTool,"isPartialInclusion"),this.hM=t}get box(){return this.Bl}set box(t){t!==null&&t.It(),this.Bl=t}}class PanningTool extends Tool{Ox;TA;Fo;cM;constructor(t){super(),this.name="Panning",this.Ox=new Point,this.TA=new Point,this.Fo=!1;const e=this;this.cM=()=>{const i=e.diagram;i!==null&&i.Le(root.document,"scroll",e.cM,!1),e.stopTool()},t&&Object.assign(this,t)}canStart(){if(!this.isEnabled)return!1;const t=this.diagram;return!(!t.allowHorizontalScroll&&!t.allowVerticalScroll||!t.lastInput.left||t.currentTool!==this&&!this.isBeyondDragSize())}doActivate(){const t=this.diagram;this.Fo?(t.lastInput.bubbles=!0,t.Et(root.document,"scroll",this.cM,!1)):(t.currentCursor="move",t.isMouseCaptured=!0,this.Ox.h(t.position)),this.isActive=!0}doDeactivate(){const t=this.diagram;t.currentCursor="",t.isMouseCaptured=!1,this.isActive=!1}doCancel(){const t=this.diagram;t.position=this.Ox,t.isMouseCaptured=!1,this.stopTool()}doMouseMove(){this.DA()}doMouseUp(){this.DA(),this.stopTool()}DA(){const t=this.diagram;if(this.isActive&&t){if(this.Fo){t.lastInput.bubbles=!0;return}const e=t.position,i=t.firstInput.documentPoint,s=t.lastInput.documentPoint;let n=e.x+i.x-s.x,o=e.y+i.y-s.y;t.allowHorizontalScroll||(n=e.x),t.allowVerticalScroll||(o=e.y),t.position=this.TA.e(n,o)}}get bubbles(){return this.Fo}set bubbles(t){U.s(t,"boolean",PanningTool,"bubbles"),this.Fo=t}get originalPosition(){return this.Ox}}class HTMLInfo{Ix;Ex;fM;uM;constructor(t){this.Ix=null,this.Ex=null,this.fM=null,this.uM=null,t&&Object.assign(this,t)}get mainElement(){return this.fM}set mainElement(t){t!==null&&U.se(t,HTMLElement,HTMLInfo,"mainElement"),this.fM=t}get show(){return this.Ix}set show(t){this.Ix!==t&&(t!==null&&U.S(t,HTMLInfo,"show"),this.Ix=t)}get hide(){return this.Ex}set hide(t){this.Ex!==t&&(t!==null&&U.S(t,HTMLInfo,"hide"),this.Ex=t)}get valueFunction(){return this.uM}set valueFunction(t){this.uM=t}}class ContextMenuButtonInfo{ue;Ux;Uc;constructor(t,e,i){this.ue=t,this.Ux=e,this.Uc=i}}class ContextMenuTool extends Tool{dM;Vx;gM;mM;Bx;zx;Gm;constructor(t){super(),this.name="ContextMenu",this.dM=null,this.Vx=null,this.gM=null,this.mM=new Point,this.Bx=null,this.Gm=!1;const e=this;this.zx=()=>e.stopTool(),t&&Object.assign(this,t)}bR(){const t=new HTMLInfo;t.show=(r,l,a)=>a.showDefaultContextMenu(),t.hide=(r,l)=>l.hideDefaultContextMenu(),ContextMenuTool.Vu=t;const e=this;this.zx=()=>e.stopTool();const i=U.Ni("div"),s=U.Ni("div");i.style.cssText="top: 0px;z-index:10002;position: fixed;display: none;text-align: center;left: 25%;width: 50%;background-color: #F5F5F5;padding: 16px;border: 16px solid #444;border-radius: 10px;margin-top: 10px",s.style.cssText="z-index:10001;position: fixed;display: none;top: 0;left: 0;width: 100%;height: 100%;background-color: black;opacity: 0.8;";const n=U.Ni("style");root.document.getElementsByTagName("head")[0].appendChild(n),n.sheet.insertRule(".goCXul { list-style: none; }",0),n.sheet.insertRule(".goCXli {font:700 1.5em Helvetica, Arial, sans-serif;position: relative;min-width: 60px; }",0),n.sheet.insertRule(".goCXa {color: #444;display: inline-block;padding: 4px;text-decoration: none;margin: 2px;border: 1px solid gray;border-radius: 10px; }",0);const o=this.diagram;o!==null&&(o.Et(i,"contextmenu",ContextMenuTool.oh,!1),o.Et(i,"selectstart",ContextMenuTool.oh,!1),o.Et(s,"contextmenu",ContextMenuTool.oh,!1)),i.className="goCXforeground",s.className="goCXbackground",root.document.body&&(root.document.body.appendChild(i),root.document.body.appendChild(s)),ContextMenuTool.Ym=i,ContextMenuTool.Km=s,ContextMenuTool.pM=!0}static Vu=null;static pM=!1;static Km;static Ym;static oh(t){return t.preventDefault(),!1}canStart(){if(!this.isEnabled)return!1;const t=this.diagram;return this.isBeyondDragSize()||!t.lastInput.right||t.lastInput.clickCount>1?!1:!!(t.lastInput.isTouchEvent&&this.defaultTouchContextMenu!==null||this.findObjectWithContextMenu()!==null)}doStart(){const t=this.diagram;this.mM.set(t.firstInput.documentPoint)}doStop(){this.hideContextMenu(),this.currentObject=null,this.Gm=!1}findObjectWithContextMenu(t){t===void 0&&(t=null);const e=this.diagram,i=e.lastInput;let s=null;if(t instanceof Diagram||(t instanceof GraphObject?s=t:s=e.findObjectAt(i.documentPoint,null,n=>!n.layer?.isTemporary)),s!==null){let n=s;for(;n!==null;){if(n.contextMenu!==null)return n;n=n.panel}if(e.lastInput.isTouchEvent&&this.defaultTouchContextMenu)return s.part}else if(e.contextMenu!==null)return e;return null}doActivate(){}doMouseDown(){if(super.doMouseDown(),this.isActive&&this.currentContextMenu instanceof Adornment){const t=this.diagram.toolManager.findTool("Action");t!==null&&t.canStart()&&(t.doActivate(),t.doMouseDown(),t.doDeactivate())}this.diagram.toolManager.mouseDownTools.has(this)&&this.doContextClick()}doMouseUp(){if(this.isActive&&this.currentContextMenu instanceof Adornment){const t=this.diagram.toolManager.findTool("Action");t!==null&&t.canStart()&&(t.doActivate(),t.doCancel(),t.doDeactivate())}this.doContextClick()}doContextClick(){const t=this.diagram;if(!this.isActive)this.canStart()&&(this.openMenu(!0),this.isActive||this.stopTool());else{const e=this.currentContextMenu;if(e===null)return;let i=null;e instanceof HTMLInfo||(i=t.findObjectAt(t.lastInput.documentPoint,null,null),i!==null&&i.isContainedBy(e)&&this.standardMouseClick(null,null)),this.maybeStopTool(i)}}maybeStopTool(t){this.stopTool(),this.canStart()&&(this.diagram.currentTool=this,this.doMouseUp())}openMenu(t,e){if(e===void 0&&(e=null),this.Gm)return;this.Gm=!0;let i=!1;if(e instanceof Diagram){const s=this.diagram.lastInput;s.targetObject=null,i=this.lA(null,s,this.diagram)}else t&&this.standardMouseSelect(),i=this.standardMouseClick();if(this.Gm=!1,!i){this.isActive=!0;const s=ContextMenuTool.Vu;if(e===null&&(e=this.findObjectWithContextMenu()),e!==null){const n=e.contextMenu;n!==null?(this.currentObject=e instanceof GraphObject?e:null,this.showContextMenu(n,this.currentObject)):s!==null&&this.showContextMenu(s,this.currentObject)}else s!==null&&this.showContextMenu(s,null);this.currentContextMenu instanceof Adornment&&!this.currentContextMenu.visible&&this.stopTool()}}doMouseMove(){const t=this.diagram.toolManager.findTool("Action");t!==null&&t.doMouseMove(),this.isActive&&this.diagram.toolManager.doMouseMove()}showContextMenu(t,e){e!==null&&U.se(e,GraphObject,ContextMenuTool,"showContextMenu:obj");const i=this.diagram;if(t!==this.currentContextMenu&&this.hideContextMenu(),t instanceof Adornment){const s=t;s.layerName="Tool",s.selectable=!1,s.scale=1/i.scale,s.category=this.name,s.hasPlaceholder()&&(s.placeholder.scale=i.scale);const n=s.diagram;n!==null&&n!==i&&n.remove(s),i.add(s),e!==null?s.adornedObject=e:s.data=i.model,s.ensureBounds(),this.positionContextMenu(s,e)}else t instanceof HTMLInfo&&t.show!==null&&t.show(e,i,this);this.currentContextMenu=t}positionContextMenu(t,e){if(t.hasPlaceholder())return;const i=t,s=this.diagram,n=s.lastInput.documentPoint.copy(),o=i.measuredBounds,r=s.viewportBounds;s.lastInput.isTouchEvent&&(n.x-=o.width),n.x+o.width>r.right&&(n.x-=o.width+5/s.scale),n.x<r.x&&(n.x=r.x),n.y+o.height>r.bottom&&(n.y-=o.height+5/s.scale),n.y<r.y&&(n.y=r.y),i.position=n}hideContextMenu(){const t=this.diagram,e=this.currentContextMenu;e!==null&&(e instanceof Adornment?(t.remove(e),this.Vx!==null&&this.Vx.removeAdornment(e.category),e.data=null,e.adornedObject=null):e instanceof HTMLInfo&&(e.hide!==null?e.hide(t,this):e.mainElement!==null&&(e.mainElement.style.display="none")),this.currentContextMenu=null,this.standardMouseOver())}kR(){const t=this,e=new List;return e.add(new ContextMenuButtonInfo("Copy",i=>i.commandHandler.copySelection(),i=>i.commandHandler.canCopySelection())),e.add(new ContextMenuButtonInfo("Cut",i=>i.commandHandler.cutSelection(),i=>i.commandHandler.canCutSelection())),e.add(new ContextMenuButtonInfo("Delete",i=>i.commandHandler.deleteSelection(),i=>i.commandHandler.canDeleteSelection())),e.add(new ContextMenuButtonInfo("Paste",i=>i.commandHandler.pasteSelection(t.mouseDownPoint),i=>i.commandHandler.canPasteSelection(t.mouseDownPoint))),e.add(new ContextMenuButtonInfo("Select All",i=>i.commandHandler.selectAll(),i=>i.commandHandler.canSelectAll())),e.add(new ContextMenuButtonInfo("Undo",i=>i.commandHandler.undo(),i=>i.commandHandler.canUndo())),e.add(new ContextMenuButtonInfo("Redo",i=>i.commandHandler.redo(),i=>i.commandHandler.canRedo())),e.add(new ContextMenuButtonInfo("Scroll To Part",i=>i.commandHandler.scrollToPart(),i=>i.commandHandler.canScrollToPart())),e.add(new ContextMenuButtonInfo("Zoom To Fit",i=>i.commandHandler.zoomToFit(),i=>i.commandHandler.canZoomToFit())),e.add(new ContextMenuButtonInfo("Reset Zoom",i=>i.commandHandler.resetZoom(),i=>i.commandHandler.canResetZoom())),e.add(new ContextMenuButtonInfo("Group Selection",i=>i.commandHandler.groupSelection(),i=>i.commandHandler.canGroupSelection())),e.add(new ContextMenuButtonInfo("Ungroup Selection",i=>i.commandHandler.ungroupSelection(),i=>i.commandHandler.canUngroupSelection())),e.add(new ContextMenuButtonInfo("Edit Text",i=>i.commandHandler.editTextBlock(),i=>i.commandHandler.canEditTextBlock())),e}showDefaultContextMenu(){const t=this.diagram;this.Bx===null&&(this.Bx=this.kR()),ContextMenuTool.Ym.innerHTML="",ContextMenuTool.Km.addEventListener("pointerdown",this.zx,!1);const e=this,i=U.Ni("ul");i.className="goCXul",ContextMenuTool.Ym.appendChild(i),i.innerHTML="";const s=this.Bx.iterator;for(;s.next();){const n=s.value,o=n.Ux,r=n.Uc;if(!U.st(o)||U.st(r)&&!r(t))continue;const l=U.Ni("li");l.className="goCXli";const a=U.Ni("a");a.className="goCXa",a.href="#",a.Ux=o,a.addEventListener("pointerdown",function(h){return this.Ux(t),e.stopTool(),h.preventDefault(),!1},!1),a.textContent=n.ue,l.appendChild(a),i.appendChild(l)}ContextMenuTool.Ym.style.display="block",ContextMenuTool.Km.style.display="block"}hideDefaultContextMenu(){if(this.currentContextMenu===null||this.currentContextMenu!==ContextMenuTool.Vu)return;ContextMenuTool.Ym.style.display="none",ContextMenuTool.Km.style.display="none";const t=this.diagram;t!==null&&t.Le(ContextMenuTool.Km,"pointerdown",this.zx,!1),this.currentContextMenu=null}doMouseWheel(){this.standardMouseWheel()}get currentContextMenu(){return this.dM}set currentContextMenu(t){this.dM=t,this.Vx=t instanceof Adornment?t.adornedPart:null}get defaultTouchContextMenu(){return ContextMenuTool.pM===!1&&ContextMenuTool.Vu===null&&Diagram.isUsingDOM()&&this.bR(),ContextMenuTool.Vu}set defaultTouchContextMenu(t){t===null&&(ContextMenuTool.pM=!0),ContextMenuTool.Vu=t}get currentObject(){return this.gM}set currentObject(t){t!==null&&U.se(t,GraphObject,ContextMenuTool,"currentObject"),this.gM=t}get mouseDownPoint(){return this.mM}}var TextEditingAccept=(w=>(w[w.LostFocus=1]="LostFocus",w[w.MouseDown=2]="MouseDown",w[w.Tab=3]="Tab",w[w.Enter=4]="Enter",w))(TextEditingAccept||{}),TextEditingStarting=(w=>(w[w.SingleClick=1]="SingleClick",w[w.SingleClickSelected=2]="SingleClickSelected",w[w.DoubleClick=3]="DoubleClick",w))(TextEditingStarting||{}),TextEditingState=(w=>(w[w.None=1]="None",w[w.Active=2]="Active",w[w.Editing=3]="Editing",w[w.Validating=4]="Validating",w[w.Invalid=5]="Invalid",w[w.Validated=6]="Validated",w))(TextEditingState||{});class TextEditingTool extends Tool{vi;yM;wM;zl;Gt;xM;bM;kM;Xx;Gx;constructor(t){super(),this.name="TextEditing",this.vi=new TextBlock,this.yM=null,this.wM=2,this.zl=null,this.Gt=1,this.xM=1,this.bM=!0,this.kM=null,this.Xx=new HTMLInfo,this.Gx=null,this.PR(this.Xx),t&&Object.assign(this,t)}static LostFocus=1;static MouseDown=2;static Tab=3;static Enter=4;static SingleClick=1;static SingleClickSelected=2;static DoubleClick=3;static StateNone=1;static StateActive=2;static StateEditing=3;static StateValidating=4;static StateInvalid=5;static StateValidated=6;PR(t){if(!Diagram.isUsingDOM())return;const e=U.Ni("textarea");this.Gx=e;const i=this;e.addEventListener("input",function(s){if(i.textBlock===null)return;const n=i.measureTemporaryTextBlock(this.value),o=this.textScale;this.style.width=20+Math.max(i.textBlock.measuredBounds.width,n.measuredBounds.width)*o+"px",this.rows=Math.max(i.textBlock.lineCount,n.lineCount)},!1),e.addEventListener("keydown",function(s){if(s.isComposing||i.textBlock===null)return;const n=s.key;if(n==="Enter"){i.textBlock.isMultiline===!1&&s.preventDefault(),i.acceptText(4);return}else if(n==="Tab"){i.acceptText(3),s.preventDefault();return}else n==="Escape"&&(i.doCancel(),i.diagram!==null&&i.diagram.doFocus())},!1),e.addEventListener("focus",function(s){i.SR(s)},!1),e.addEventListener("blur",function(s){i.MR(s)},!1),t.valueFunction=()=>e.value,t.mainElement=e,t.show=(s,n,o)=>{if(!(s instanceof TextBlock)||!n||!n.div||!(o instanceof TextEditingTool))return;if(o.state===5){e.style.border="3px solid red",e.focus();return}const r=s.getDocumentPoint(Spot.Center),l=n.position,a=n.scale;let h=s.getDocumentScale()*a;h<o.minimumEditorScale&&(h=o.minimumEditorScale);const c=s.naturalBounds.width*h+6,f=s.naturalBounds.height*h+2,u=(r.x-l.x)*a,d=(r.y-l.y)*a,m=s.verticalAlignment,p=(s.lineHeight+s.spacingAbove+s.spacingBelow)*s.lineCount*h,y=.5*f-.5*p,x=m.y*f-m.y*p+m.offsetY-y-p/2;e.value=s.text,n.div.style.font=s.font;const b=1;e.style.position="absolute",e.style.zIndex="100",e.style.font="inherit",e.style.fontSize=h*100+"%",e.style.lineHeight="normal",e.style.width=c+"px",e.style.left=(u-c/2|0)-b+"px",e.style.top=(d+x|0)-b+"px",e.style.textAlign=s.textAlign,e.style.margin="0",e.style.padding=b+"px",e.style.border="0",e.style.outline="none",e.style.whiteSpace="pre-wrap",e.style.overflow="hidden",e.rows=s.lineCount,e.textScale=h,e.className="goTXarea",n.div.appendChild(e),e.focus(),o.selectsTextOnActivate&&(e.select(),e.setSelectionRange(0,9999))},t.hide=(s,n)=>{s.div&&s.div.removeChild(e)}}get textBlock(){return this.yM}set textBlock(t){t!==null&&U.se(t,TextBlock,TextEditingTool,"textBlock"),this.yM=t}get currentTextEditor(){return this.kM}set currentTextEditor(t){this.kM=t}get defaultTextEditor(){return this.Xx}set defaultTextEditor(t){this.Xx=t}get starting(){return this.wM}set starting(t){this.wM=t}canStart(){if(!this.isEnabled)return!1;const t=this.diagram;if(t===null||t.isReadOnly||TextEditingTool.Vc&&TextEditingTool.Vc!==this&&(TextEditingTool.Vc.acceptText(2),TextEditingTool.Vc&&TextEditingTool.Vc!==this)||!t.lastInput.left||this.isBeyondDragSize())return!1;const e=t.lastInput.documentPoint,i=t.findObjectAt(e);if(i===null||!(i instanceof TextBlock)||!i.editable||i.part===null||!i.part.canEdit())return!1;const s=i.part;return!(s===null||this.starting===2&&!s.isSelected||this.starting===3&&t.lastInput.clickCount<2)}doStart(){TextEditingTool.Vc=this,this.textBlock!==null&&this.doActivate()}doActivate(){if(this.isActive)return;const t=this.diagram;if(t===null)return;let e=this.textBlock;if(e===null&&(e=t.findObjectAt(t.lastInput.documentPoint)),e===null||!(e instanceof TextBlock)||(this.textBlock=e,e.part===null))return;t.animationManager.stopAnimation(),this.isActive=!0,this.Gt=2;let s=this.defaultTextEditor;e.textEditor!==null&&(s=e.textEditor),this.vi=this.textBlock.copy();const n=new Rect(this.textBlock.getDocumentPoint(Spot.TopLeft),this.textBlock.getDocumentPoint(Spot.BottomRight));t.scrollToRect(n),s!==null&&s.show!==null&&s.show(e,t,this),this.currentTextEditor=s}doCancel(){this.stopTool()}doMouseUp(){this.canStart()&&this.doActivate()}doMouseDown(){this.isActive&&this.acceptText(2)}acceptText(t){switch(t){case 2:this.Gt===6?this.currentTextEditor instanceof HTMLElement&&this.currentTextEditor.focus():(this.Gt===2||this.Gt===5||this.Gt===3)&&(this.Gt=4,this.vA());break;case 1:case 4:case 3:if(t===4&&this.textBlock!==null&&this.textBlock.isMultiline===!0)return;(this.Gt===2||this.Gt===5||this.Gt===3)&&(this.Gt=4,this.vA());break}}vA(){const t=this.textBlock,e=this.diagram,i=this.currentTextEditor;if(t!==null&&i!==null){const s=t.text;let n="";if(i.valueFunction!==null&&(n=i.valueFunction()),!this.isValidText(t,s,n)){this.Gt=5,this.doError(s,n);return}this.startTransaction(this.name),this.Gt=6,this.transactionResult=this.name,t.text=n,this.doSuccess(s,n),e!==null&&e.T("TextEdited",t,s),this.stopTransaction(),this.stopTool(),e!==null&&e.doFocus()}}doError(t,e){const i=this.textBlock;if(i===null)return;i.errorFunction!==null&&i.errorFunction(this,t,e);const s=this.currentTextEditor;s!==null&&s.show!==null&&s.show(i,this.diagram,this)}doSuccess(t,e){const i=this.textBlock;i!==null&&i.textEdited!==null&&i.textEdited(i,t,e)}doDeactivate(){const t=this.diagram;if(t!==null){if(this.Gt=1,this.currentTextEditor!==null){const e=this.currentTextEditor;e!==null&&e.hide!==null&&e.hide(t,this)}this.textBlock=null,this.isActive=!1}}doStop(){TextEditingTool.Vc=null}SR(t){if(this.currentTextEditor===null||this.state===1)return;const e=this.Gx;this.Gt===2&&(this.Gt=3),U.st(e.select)&&this.selectsTextOnActivate&&(e.select(),e.setSelectionRange(0,9999))}MR(t){if(this.currentTextEditor===null||this.state===1)return;const e=this.Gx;U.st(e.focus)&&e.focus(),U.st(e.select)&&this.selectsTextOnActivate&&(e.select(),e.setSelectionRange(0,9999))}isValidText(t,e,i){const s=this.textValidation;if(s!==null&&!s(t,e,i))return!1;const n=t.textValidation;return!(n!==null&&!n(t,e,i))}get textValidation(){return this.zl}set textValidation(t){t!==null&&U.S(t,TextEditingTool,"textValidation"),this.zl=t}get minimumEditorScale(){return this.xM}set minimumEditorScale(t){t!==null&&U.s(t,"number",TextEditingTool,"minimumEditorScale"),this.xM=t}get selectsTextOnActivate(){return this.bM}set selectsTextOnActivate(t){t!==null&&U.s(t,"boolean",TextEditingTool,"selectsTextOnActivate"),this.bM=t}get state(){return this.Gt}set state(t){this.Gt!==t&&(this.Gt=t)}measureTemporaryTextBlock(t){const e=this.vi;return e.text=t,this.textBlock!==null&&e.ht(this.textBlock.Xl,1/0),e}static Vc=null}var AnimationStyle=(w=>(w[w.Default=1]="Default",w[w.AnimateLocations=2]="AnimateLocations",w[w.None=3]="None",w))(AnimationStyle||{});class AnimationManager{a;Ae;Be;Ar;Qn;Oo;PM;SM;Hm;Yx;ke;Bc;xn;qm;lh;Kx;jm;Hx;zc;Eu;Wm;constructor(t){this.a=Diagram.Om(),this.Ae=!1,this.Hm=!1,this.Yx=!1,this.ke=!1,this.Bc=!1,this.Hx=!0,this.zc=1,this.Eu=!1,this.Be=!0,this.Ar=!0,this.Oo=600,this.PM=!1,this.SM=!1,this.Qn=new GSet,this.xn=new Animation,this.qm=new Animation,this.xn.Ns=this,this.lh=new GSet,this.Kx=new GSet,this.jm=new GSet,this.Wm=new GSet,t&&Object.assign(this,t)}Io(t){this.a=t}RU(){return this.a}canStart(t){return!0}Gl(t){return!this.Be||!this.canStart(t)?!1:(this.Qn.add(t),this.defaultAnimation.isAnimating&&this.stopAnimation(),this.a.Te(),this.ke=!0,!0)}getBundleAnimation(){return this.qm}MM(){if(!this.Be||(this.qm.yi.count>0&&this.qm.start(),!this.ke))return;const t=this.xn,e=this.a,i=this.Qn.has("Model");if(i&&(this.Bc=!0,this.zc===1?(t.isViewportUnconstrained=!0,t.yi.clear(),t.add(e,"position",e.position.copy().offset(0,-200),e.position),t.add(e,"opacity",0,1)):this.zc===3&&t.yi.clear(),this.zc===2&&e.qx.equals(e.ct)?this.Hx=!0:this.Hx=!1,e.T("InitialAnimationStarting",this)),i&&!this.Ar||t.yi.count===0){this.Qn.clear(),this.ke=!1,t.yi.clear(),t.jx(e),this.Bc=!1,e.C();return}this.Qn.clear(),e.Tr=!1;const s=t.yi.get(e);e.autoScale!==1&&s!==null&&(delete s.ae.scale,delete s.Cs.scale);const n=this;root.requestAnimationFrame(()=>{n.ke===!1||t.Ae||(e.getRenderingHint("temporaryPixelRatio")&&e.Cx(),e.NM(),n.ke=!1,t.start(),t.Ae&&(n.Bu(),e.invalidateDocumentBounds(),t.FA(0),e.Pr(!0),n.zu(),e.T("AnimationStarting",n)))})}CM(){return this.Qn.has("Trigger")&&this.Qn.count===1}RA(t,e,i,s){this.isTicking||this.CM()||t instanceof Link&&(t.fromNode!==null||t.toNode!==null)||this.xn.add(t,"position",e,i,s)}Wx(t){return this.xn.Wx(t)}LM(t){return this.xn.LM(t)}NR(t){const e=this.lh,i=this;function s(){if(i.jm.count>0&&(e.addAll(i.jm),i.jm.clear(),i.Ae=!0),i.Ae===!1||e.count===0){i.Yx=!1;return}i.Kx.addAll(e);const n=i.Kx.iterator;for(;n.next();){const o=n.value;o.Ae!==!1&&(o.CR()?o.OA(!1):o.Xc=!0)}if(i.Kx.clear(),i.Ae===!1){root.requestAnimationFrame(s);return}i.Bu(),i.a.Pr(),i.zu(),root.requestAnimationFrame(s)}this.Ae?this.IA(t):(this.Ae=!0,this.Yx?this.IA(t):(this.Yx=!0,e.add(t),root.requestAnimationFrame(()=>s())))}IA(t){this.jm.add(t)}LR(){const t=this.lh.iterator;for(;t.next();)t.value.Xc=!1}Bu(){if(this.Hm)return;const t=this.a;this.PM=t.skipsUndoManager,this.SM=t.wi,t.skipsUndoManager=!0,t.wi=!0,this.Hm=!0}zu(){const t=this.a;t.skipsUndoManager=this.PM,t.wi=this.SM,this.Hm=!1}stopAnimation(t){const e=this.xn;if(this.ke===!0&&(this.ke=!1,this.Bc=!1,this.Qn.clear(),e.AR()&&this.a.requestUpdate()),!this.Ae){e.yi.clear(),e.jx(this.a);return}if(e.Xu(!0),e.jx(null),t===!0){const i=this.lh.toArray();for(let s=0;s<i.length;s++)i[s].Xu(!0)}}Xu(t){this.lh.delete(t),this.lh.count===0&&(this.Ae=!1,this.a.requestUpdate()),t===this.defaultAnimation&&this.a.T("AnimationFinished",this)}Gc(t,e){this.ke&&(!this.Qn.has("Expand Tree")&&!this.Qn.has("Expand SubGraph")||(this.xn.Gc(t,e),this.EA(t)))}Yc(t,e){this.ke&&(!this.Qn.has("Collapse Tree")&&!this.Qn.has("Collapse SubGraph")||(this.xn.Yc(t,e),this.xn.AM(e,"position",e.position,e.position),this.EA(t)))}UA(t,e){!this.ke||t.equals(e)||this.CM()||(this.a.Qa||(t=e.copy()),this.xn.AM(this.a,"position",t,e))}VA(t,e){this.ke&&(this.CM()||this.xn.add(this.a,"scale",t,e))}TM(t,e){t.Fi&&(t.Dr=e,this.Wm.add(t))}EA(t){const e=t.findLinksConnected();for(;e.next();){const i=e.value;i.Fi&&(i.Dr=i.points.copy(),this.Wm.add(i))}}get isEnabled(){return this.Be}set isEnabled(t){U.s(t,"boolean",AnimationManager,"isEnabled"),this.Be=t,t&&this.lh.each(e=>{!e.isAnimating&&e.runCount===1/0&&e.start()})}get duration(){return this.Oo}set duration(t){U.s(t,"number",AnimationManager,"duration"),t<1&&U.J(t,">= 1",AnimationManager,"duration"),this.Oo=t}get isAnimating(){return this.Ae}get isTicking(){return this.Hm}get isInitial(){return this.Ar}set isInitial(t){U.s(t,"boolean",AnimationManager,"isInitial"),this.Ar=t}get defaultAnimation(){return this.xn}get activeAnimations(){return this.lh}get initialAnimationStyle(){return this.zc}set initialAnimationStyle(t){this.zc=t}static Jx=new GMap;static defineAnimationEffect(t,e){AnimationManager.Jx.set(t,e)}static DM(t,e,i,s,n){t===null&&(t=[0,0,0,0]),e===null&&(e=[0,0,0,0]);let o=t[0],r=t[1];const l=t[2],a=t[3];let h=e[0],c=e[1];const f=e[2],u=e[3];l===0||l===100?(o=h,r=c):(f===0||f===100)&&(h=o,c=r),Math.abs(h-o)>180&&(h>o?o+=360:h+=360);const d=n(i,o,h-o,s)%360,m=n(i,r,c-r,s),g=n(i,l,f-l,s),p=n(i,a,u-a,s);return"hsla("+d+", "+m+"%, "+g+"%, "+p+")"}static Default=1;static AnimateLocations=2;static None=3}{const w=AnimationManager.Jx,t=(e,i,s,n,o,r)=>{e.position=new Point(n(o,i.x,s.x-i.x,r),n(o,i.y,s.y-i.y,r))};w.set("position:diagram",t),w.set("position",t),w.set("position:part",(e,i,s,n,o,r)=>{o<r?e.Ec(n(o,i.x,s.x-i.x,r),n(o,i.y,s.y-i.y,r),!1):e.position=new Point(n(o,i.x,s.x-i.x,r),n(o,i.y,s.y-i.y,r))}),w.set("location",(e,i,s,n,o,r)=>{o<r?e.Ec(n(o,i.x,s.x-i.x,r),n(o,i.y,s.y-i.y,r),!0):e.location=new Point(n(o,i.x,s.x-i.x,r),n(o,i.y,s.y-i.y,r))}),w.set("position:placeholder",(e,i,s,n,o,r)=>{o<r?e.Ec(n(o,i.x,s.x-i.x,r),n(o,i.y,s.y-i.y,r),!1):e.position=new Point(n(o,i.x,s.x-i.x,r),n(o,i.y,s.y-i.y,r))}),w.set("position:nodeCollapse",(e,i,s,n,o,r)=>{const l=e.actualBounds,a=s.actualBounds,h=a.x+a.width/2-l.width/2,c=a.y+a.height/2-l.height/2;o<r?e.Ec(n(o,i.x,h-i.x,r),n(o,i.y,c-i.y,r),!1):e.position=new Point(n(o,i.x,h-i.x,r),n(o,i.y,c-i.y,r))}),w.set("desiredSize",(e,i,s,n,o,r)=>{e.desiredSize=new Size(n(o,i.width,s.width-i.width,r),n(o,i.height,s.height-i.height,r))}),w.set("width",(e,i,s,n,o,r)=>{e.width=n(o,i,s-i,r)}),w.set("height",(e,i,s,n,o,r)=>{e.height=n(o,i,s-i,r)}),w.set("fill",(e,i,s,n,o,r)=>{e.fill=AnimationManager.DM(i,s,o,r,n)}),w.set("stroke",(e,i,s,n,o,r)=>{e.stroke=AnimationManager.DM(i,s,o,r,n)}),w.set("strokeWidth",(e,i,s,n,o,r)=>{e.strokeWidth=n(o,i,s-i,r)}),w.set("strokeDashOffset",(e,i,s,n,o,r)=>{e.strokeDashOffset=n(o,i,s-i,r)}),w.set("background",(e,i,s,n,o,r)=>{e.background=AnimationManager.DM(i,s,o,r,n)}),w.set("opacity",(e,i,s,n,o,r)=>{e.opacity=n(o,i,s-i,r)}),w.set("scale",(e,i,s,n,o,r)=>{e.scale=n(o,i,s-i,r)}),w.set("angle",(e,i,s,n,o,r)=>{e.angle=n(o,i,s-i,r)})}class Animation{$x;Jm;Ae;Gu;Oo;Ls;BA;Kc;yi;Zx;ae;_n;Yu;Hc;Qx;_x;Xc;vM;tb;Ns;a;FM;RM;OM;constructor(t){this.a=null,this.Ns=null,this.vM=null,this.tb=null,this.FM=!1,this.Ae=!1,this.Xc=!1,this.ae=0,this._n=0,this.$x=Animation.EaseInOutQuad,this.Jm=Animation.EaseInOutQuad,this.Yu=!1,this.Hc=!1,this.Qx=1,this._x=0,this.Oo=NaN,this.Ls=NaN,this.RM=0,this.Gu=null,this.BA=Point.dn,this.yi=new GMap,this.Zx=new GMap,this.Kc=new GSet,this.OM=1,t&&Object.assign(this,t)}suspend(){this.Xc=!0}advanceTo(t,e){e&&(this.Xc=!1),this.Yu&&t>=this.Ls&&(this.Hc=!0,t=t-this.Ls),this.RM=t,this.OA(!0),this.Ns.Bu(),this.a.Pr(),this.Ns.zu(),this.a.redraw()}jx(t){if(this.Zx.clear(),this.Hc=!1,this._x=0,this.Ls=NaN,this.Kc.count>0&&this.Kc.clear(),t!==null){const e=t.links;for(;e.next();)e.value.Dr=null}}AR(){return this.yi.count>0}start(){if(this.yi.count===0)return this;if(this.Ae)return this;let t=this.a;const e=this.yi.iterator;for(;e.next();){const s=e.key;t===null&&(s instanceof Diagram?t=s:s instanceof GraphObject&&(t=s.diagram))}if(t!==null)this.a=t,this.Ns=t.animationManager;else return this;const i=this.Ns;return i.isEnabled===!1?this:(this.Ls=isNaN(this.Oo)?i.duration:this.Oo,this.Jm=this.$x,i.Bc&&i.zc===1&&this===i.defaultAnimation&&(this.Jm=Animation.EaseOutExpo,this.Ls=isNaN(this.Oo)?i.duration===600?900:i.duration:this.Oo),this.OM=t.scrollMode,this.isViewportUnconstrained&&(t.ah=2),i.Bu(),this.Kc.each(s=>{s.data=null,t.add(s)}),i.zu(),this.Ae=!0,this.ae=+new Date,this._n=this.ae+this.Ls,i.NR(this),this)}addTemporaryPart(t,e){return t.Di()?(this.Kc.add(t),this.a=e,this):this}add(t,e,i,s,n){if(this.a===null&&(t instanceof Diagram?this.a=t:t instanceof GraphObject&&t.diagram!==null&&(this.a=t.diagram)),t instanceof Part){if(!t.isAnimated)return this;e==="position"&&(e="position:part")}return this.AM(t,e,i,s,n),this}AM(t,e,i,s,n){const o=this.yi;let r,l,a;if(t instanceof Diagram&&e==="position"&&(e="position:diagram"),(e==="fill"||e==="stroke"||e==="background")&&(Brush.Eo(i),Brush.IM(),i=[Brush.ze.n0,Brush.ze.n1,Brush.ze.n2,Brush.ze.n3],Brush.Eo(s),Brush.IM(),s=[Brush.ze.n0,Brush.ze.n1,Brush.ze.n2,Brush.ze.n3]),o.has(t))r=o.get(t),l=r.ae,a=r.Cs,l[e]===void 0&&(l[e]=this.Ku(i)),a[e]=this.Ku(s);else{if(e==="position"&&i.equalsApprox(s))return;l={},a={},l[e]=this.Ku(i),a[e]=this.Ku(s),r=new AnimationState(l,a,n),o.set(t,r)}const h=l[e];h instanceof Point&&!h.isReal()&&h.h(this.BA),n&&e.indexOf("position:")===0&&t instanceof Part?r.eb.location=this.Ku(t.location):n&&(r.eb[e]=this.Ku(i))}Ku(t){return t instanceof Point||t instanceof Size?t.copy():t}TR(t){const e=this.yi;if(e.has(t)){const i=e.get(t);i.ib=!0}}Wx(t){if(!this.Ae)return!1;const e=this.yi.get(t);return e!==null&&e.ib}LM(t){if(!this.Ae)return!1;const e=this.yi.get(t);return e!==null&&!!(e.ae.position||e.ae["position:part"]||e.ae.location)}CR(){if(this.Kc.count>0)return!0;const t=this.yi.iterator;for(;t.next();){const e=t.key;if(e instanceof GraphObject&&e.diagram!==null||e instanceof Diagram)return!0}return!1}OA(t){if(this.Xc&&!t)return;const e=this.Ns;if(this.Ae===!1)return;const i=+new Date;let s=i>this._n?this.Ls:i-this.ae;t&&(s=this.RM,s<this.Ls?(this.ae=+new Date-s,this._n=this.ae+this.Ls):s=this.Ls),e.Bu(),this.FA(s),this.a.Pr(!0),e.zu(),i>this._n&&(this.Yu&&!this.Hc?(this.ae=+new Date,this._n=this.ae+this.Ls,this.Hc=!0):this.Xu(!1))}FA(t){const e=this.Ls,i=this.yi.iterator,s=this.Hc;for(;i.next();){const n=i.key;if(n instanceof GraphObject&&n.diagram===null)continue;const o=i.value,r=s?o.Cs:o.ae,l=s?o.ae:o.Cs,a=AnimationManager.Jx;for(const h in l)h==="position"&&(l["position:placeholder"]||l["position:nodeCollapse"])||a.get(h)!==null&&a.get(h)(n,r[h],l[h],this.Jm,t,e,this)}}stop(){return this.Ae?(this.Xu(!0),this):this}Xu(t){if(this.tb!==null&&this.tb.DR(this.vM),!this.Ae)return;const e=this.a,i=this.Ns;i.Bc=!1,this.Ae=!1,this.Xc=!1,i.Bu();const s=this.yi,n=this.Kc.iterator;for(;n.next();)e.remove(n.value);const o=this.Yu,r=s.iterator,l=AnimationManager.Jx;for(;r.next();){const h=r.key,c=r.value,f=o?c.Cs:c.ae,u=o?c.ae:c.Cs,d=c.eb;for(const m in u)if(l.get(m)!==null){let g=m;c.sb&&(g==="position:nodeCollapse"||g==="position:placeholder")&&(g="position"),l.get(g)(h,f[m],d[m]!==void 0?d[m]:c.sb?f[m]:u[m],this.Jm,this.Ls,this.Ls,this)}c.sb&&d.location!==void 0&&h instanceof Part&&(h.location=d.location),c.ib&&h instanceof Part&&h.Xe(!1)}this._x++;const a=!t&&this.Qx>this._x;if(!a&&(this===i.qm||this===i.defaultAnimation)&&this.yi.clear(),e.nb.clear(),e.yS(!1),e.invalidateDocumentBounds(),e.C(),e.Pr(!0),i.defaultAnimation===this){const h=i.Wm.iterator;for(;h.next();)h.value.vR();i.Wm.clear()}if(e.Pr(!0),this.isViewportUnconstrained&&(e.scrollMode=this.OM),i.zu(),a){this.Hc=!1,this.start();return}this.jx(null),e.zA(),i.Xu(this),this.Gu&&this.Gu(this),e.requestUpdate()}Gc(t,e){const i=e.actualBounds;let s=null;if(e instanceof Group&&(s=e.placeholder),s!==null&&s.visible){const n=s.getDocumentPoint(Spot.TopLeft),o=s.padding;n.x+=o.left,n.y+=o.top,this.add(t,"position",n,t.position,!1)}else this.add(t,"position",new Point(i.x+i.width/2,i.y+i.height/2),t.position,!1);this.add(t,"scale",.01,t.scale,!1),t instanceof Group&&this.FR(t,e)}FR(t,e){const i=t.memberParts;for(;i.next();){const s=i.value;s instanceof Node&&this.Gc(s,e)}}Yc(t,e){if(!t.isVisible())return;let i=null;if(e instanceof Group&&(i=e.placeholder),i!==null&&i.visible){const s=i.getDocumentPoint(Spot.TopLeft),n=i.padding;s.x+=n.left,s.y+=n.top,this.add(t,"position:placeholder",t.position,s,!0)}else this.add(t,"position:nodeCollapse",t.position,e,!0);this.add(t,"scale",t.scale,.01,!0),this.TR(t),t instanceof Group&&this.RR(t,e)}RR(t,e){const i=t.memberParts;for(;i.next();){const s=i.value;s instanceof Node&&this.Yc(s,e)}}get duration(){return this.Oo}set duration(t){U.s(t,"number",Animation,"duration"),t<1&&U.J(t,">= 1",Animation,"duration"),this.Oo=t}get reversible(){return this.Yu}set reversible(t){this.Yu=t}get runCount(){return this.Qx}set runCount(t){t>0?this.Qx=t:U.o("Animation.runCount value must be a positive integer.")}get finished(){return this.Gu}set finished(t){this.Gu!==t&&(t!==null&&U.S(t,Animation,"finished"),this.Gu=t)}get easing(){return this.$x}set easing(t){this.$x=t}get isViewportUnconstrained(){return this.FM}set isViewportUnconstrained(t){this.FM=t}get isAnimating(){return this.Ae}getTemporaryState(t){let e=this.Zx.get(t);return e===null&&(e={},this.Zx.set(t,e)),e}static EaseLinear=(t,e,i,s)=>i*t/s+e;static EaseInOutQuad=(t,e,i,s)=>(t/=s/2,t<1?i/2*t*t+e:-i/2*(--t*(t-2)-1)+e);static EaseInQuad=(t,e,i,s)=>i*(t/=s)*t+e;static EaseOutQuad=(t,e,i,s)=>-i*(t/=s)*(t-2)+e;static EaseInExpo=(t,e,i,s)=>t===0?e:i*Math.pow(2,10*(t/s-1))+e;static EaseOutExpo=(t,e,i,s)=>t===s?e+i:i*(-Math.pow(2,-10*t/s)+1)+e}class AnimationState{ae;Cs;eb;sb;ib;constructor(t,e,i){this.ae=t,this.Cs=e,this.eb={},this.sb=i,this.ib=!1}}var TriggerStart=(w=>(w[w.Default=1]="Default",w[w.Immediate=2]="Immediate",w[w.Bundled=3]="Bundled",w))(TriggerStart||{});class AnimationTrigger{Ti;pn;Hu;qc;constructor(t,e,i){this.Ti=null,this.pn=t,this.Hu=i||1,this.qc=null,e!==void 0&&(this.qc=e,i===void 0&&(this.Hu=2))}copy(){const t=new AnimationTrigger(this.pn);t.Hu=this.Hu;const e=this.qc;if(e!==null){const i={};e.duration!==void 0&&(i.duration=e.duration),e.finished!==void 0&&(i.finished=e.finished),e.easing!==void 0&&(i.easing=e.easing),t.qc=i}return t}get propertyName(){return this.pn}set propertyName(t){this.pn=t}get animationSettings(){return this.qc}set animationSettings(t){this.qc=t}OR(t){const e=this.qc;e!==null&&(e.duration&&(t.duration=e.duration),e.finished&&(t.finished=e.finished),e.easing&&(t.easing=e.easing))}get startCondition(){return this.Hu}set startCondition(t){this.Hu=t}static Default=1;static Immediate=2;static Bundled=3}class Layer{a;Pt;Zt;vr;Yl;Kl;Hl;ql;jl;Wl;Jl;$l;Zl;Ql;_l;ta;Uc;ea;ob;$m;qu;Ct;constructor(t){GSet.Je(this),this.a=null,this.Ct=new List,this.Pt="",this.Zt=1,this.vr=!1,this.Yl=!0,this.Kl=!0,this.Hl=!0,this.ql=!0,this.jl=!0,this.Wl=!0,this.Jl=!0,this.$l=!0,this.Zl=!0,this.Ql=!0,this._l=!0,this.ta=!0,this.Uc=!0,this.ea=!0,this.ob=!0,this.$m=!1,this.qu=[],t&&Object.assign(this,t)}IR(){const t=this.Ct;for(let e=0;e<t.length;e++)t.r[e].EM(null);t.clear(),this.qu.length=0}Io(t){this.a=t}toString(t){t===void 0&&(t=0);const e='Layer "'+this.name+'"';if(t<=0)return e;let i=0,s=0,n=0,o=0,r=0;const l=this.Ct.iterator;for(;l.next();){const h=l.value;h instanceof Group?n++:h instanceof Node?s++:h instanceof Link?o++:h instanceof Adornment?r++:i++}let a="";if(i>0&&(a+=i+" Parts "),s>0&&(a+=s+" Nodes "),n>0&&(a+=n+" Groups "),o>0&&(a+=o+" Links "),r>0&&(a+=r+" Adornments "),t>1){const h=this.Ct.iterator;for(;h.next();){const c=h.value;a+=`
    `+c.toString();const f=c.data;f!==null&&GSet.xs(f)&&(a+=" #"+GSet.xs(f)),c instanceof Node?a+=" "+U.toString(f):c instanceof Link&&(a+=" "+U.toString(c.fromNode)+" "+U.toString(c.toNode))}}return e+" "+this.Ct.count+": "+a}findObjectAt(t,e,i){if(e===void 0&&(e=null),i===void 0&&(i=null),this.ea===!1)return null;let s=!1;this.diagram!==null&&this.diagram.viewportBounds.containsPoint(t)&&(s=!0);const n=Point.l(),o=this.Ct.r,r=o.length;for(let l=r;l--;){const a=o[l];if(s===!0&&a.Ul()===!1||!a.isVisible())continue;n.h(t),n.Yi(a.Ws);let h=a.XA(n,e,i);if(h!==null&&(e!==null&&(h=e(h)),h!==null&&(i===null||i(h))))return Point.i(n),h}return Point.i(n),null}findObjectsAt(t,e,i,s){if(e===void 0&&(e=null),i===void 0&&(i=null),!(s instanceof List)&&!(s instanceof GSet)&&(s=new GSet),this.ea===!1)return s;let n=!1;this.diagram!==null&&this.diagram.viewportBounds.containsPoint(t)&&(n=!0);const o=Point.l(),r=this.Ct.r,l=r.length;for(let a=l;a--;){const h=r[a];if(n===!0&&h.Ul()===!1||!h.isVisible())continue;o.h(t),o.Yi(h.Ws);let c=h;h.GA(o,e,i,s)&&(e!==null&&(c=e(c)),c!==null&&(i===null||i(c))&&s.add(c))}return Point.i(o),s}findObjectsIn(t,e,i,s,n){if(e===void 0&&(e=null),i===void 0&&(i=null),s===void 0&&(s=!1),!(n instanceof List)&&!(n instanceof GSet)&&(n=new GSet),this.ea===!1)return n;let o=!1;this.diagram!==null&&this.diagram.viewportBounds.containsRect(t)&&(o=!0);const r=this.Ct.r,l=r.length;for(let a=l;a--;){const h=r[a];if(o===!0&&h.Ul()===!1||!h.isVisible())continue;let c=h;h.Zm(t,e,i,s,n)&&(e!==null&&(c=e(c)),c!==null&&(i===null||i(c))&&n.add(c))}return n}MS(t,e,i,s,n,o,r){if(this.ea===!1)return n;const l=this.Ct.r,a=l.length;for(let h=a;h--;){const c=l[h];if(r===!0&&c.Ul()===!1||!o(c)||!c.isVisible())continue;let f=c;c.Zm(t,e,i,s,n)&&(e!==null&&(f=e(f)),f!==null&&(i===null||i(f))&&n.add(f))}return n}findObjectsNear(t,e,i,s,n,o){if(i===void 0&&(i=null),s===void 0&&(s=null),n===void 0&&(n=!0),n!==!1&&n!==!0&&((n instanceof List||n instanceof GSet)&&(o=n),n=!0),!(o instanceof List)&&!(o instanceof GSet)&&(o=new GSet),this.ea===!1)return o;let r=!1;this.diagram!==null&&this.diagram.viewportBounds.containsPoint(t)&&(r=!0);const l=Point.l(),a=Point.l(),h=this.Ct.r,c=h.length;for(let f=c;f--;){const u=h[f];if(r===!0&&u.Ul()===!1||!u.isVisible())continue;l.h(t),l.Yi(u.Ws),a.e(t.x+e,t.y),a.Yi(u.Ws);let d=u;u.YA(l,a,i,s,n,o)&&(i!==null&&(d=i(d)),d!==null&&(s===null||s(d))&&o.add(d))}return Point.i(l),Point.i(a),o}UM(){return this.Ct.r}rs(t,e){if(!this.visible)return;const i=this.Ct.r,s=i.length;if(s===0)return;const n=U.nt(),o=U.nt();for(let r=0;r<s;r++){const l=i[r];if(l.VM=r,l instanceof Link){if(l.Fi===!1)continue}else if(l instanceof Adornment&&l.adornedPart!==null)continue;const a=l.actualBounds;l.isVisible()&&a.BL(e,10)?(l.rs(!0),n.push(l)):(l.rs(!1),l.adornments!==null&&l.adornments.count>0&&o.push(l))}for(let r=0;r<n.length;r++){const l=n[r];l.BM();const a=l.adornments;for(;a.next();){const h=a.value;h.ht(1/0,1/0),h.Ut(),h.rs(!0)}}for(let r=0;r<o.length;r++)o[r].BM();U.Z(n),U.Z(o)}ju(t){let e=1;return this.Zt!==1&&(e=t.globalAlpha,t.globalAlpha=e*this.Zt),e}KA(t,e){for(let i=0;i<e;i++)t[i].jc()}Ge(t,e,i){if(!this.visible||this.Zt===0||(i===void 0&&(i=!0),!i&&this.isTemporary))return;const s=this.Ct.r,n=s.length;if(n===0)return;t.vr&&this.KA(s,n);const o=this.ju(t),r=this.qu;r.length=0;const l=e.scale,a=Rect.l();for(let h=0;h<n;h++){const c=s[h];this.Qm(t,c,e,r,l,a,!0)}Rect.i(a),t.vr&&this.KA(s,n),t.globalAlpha=o}OU(t,e,i){if(!this.visible||this.Zt===0)return;const s=this.Ct.r,n=s.length;if(n===0)return;const o=this.ju(t),r=this.qu;r.length=0;const l=e.scale,a=Rect.l();for(let h=0;h<n;h++){const c=s[h];i.has(c)||this.Qm(t,c,e,r,l,a,!0)}Rect.i(a),t.globalAlpha=o}ER(t,e,i,s){if(!this.visible||this.Zt===0||!s&&this.isTemporary)return;const n=this.Ct.r,o=n.length;if(o===0)return;const r=this.ju(t),l=this.qu;l.length=0;const a=e.scale,h=Rect.l();for(let c=0;c<o;c++){const f=n[c];i.has(f)&&this.Qm(t,f,e,l,a,h,!1)}Rect.i(h),t.globalAlpha=r}UR(t,e,i,s,n){if(!this.visible||this.opacity===0)return;const o=this.diagram.grid.part;if(!s&&this.isTemporary){if(n&&o.layer===this){const r=this.ju(t);o.Ge(t,i),t.globalAlpha=r}}else{const r=this.ju(t),l=i.scale,a=Rect.l(),h=this.Ct.r,c=h.length;for(let f=0;f<c;f++){const u=h[f];!n&&u===o||this.Qm(t,u,i,null,l,a,!1)}Rect.i(a),t.globalAlpha=r}}IU(t,e,i){if(!this.visible||this.Zt===0)return;const s=this.ju(t),n=this.qu;n.length=0;const o=e.scale,r=Rect.l(),l=this.Ct.r,a=l.length,h=i.length;for(let c=0;c<a;c++){const f=l[c],u=f.hh(f.actualBounds);this.VR(u,i,h,o)&&this.Qm(t,f,e,n,o,r,!0)}Rect.i(r),t.globalAlpha=s}Qm(t,e,i,s,n,o,r){if(r&&!e.Ul()){t.removePartFromView(e);return}if(s!==null&&e instanceof Link&&(e.isOrthogonal&&s.push(e),e.Fi===!1)){t.removePartFromView(e);return}let l=!1,a=e.containingGroup;for(;a!==null;)l?a.he!==null&&o.intersectRect(a.he):a.he!==null&&(l=!0,o.h(a.he)),a=a.containingGroup;const h=e.actualBounds;let c=!1;if(l&&e.isVisible()){if(!o.intersectsRect(h)){t.removePartFromView(e);return}c=!o.containsRect(h)}c&&(t.save(),t instanceof SVGContext?t.partClipRect=o.copy():(t.beginPath(),t.rect(o.x,o.y,o.width,o.height),t.clip())),h.width*n>i._m||h.height*n>i._m?e.Ge(t,i):this.BR(t,e,i),c&&(t.restore(),t.clearContextCache(!0))}BR(t,e,i){if(t instanceof SVGContext){e.Ge(t,i);return}const s=e.actualBounds,n=e.naturalBounds;if(s.width===0||s.height===0||isNaN(s.x)||isNaN(s.y)||!e.isVisible())return;const o=e.v;if(e.background===null){e.bn(t,"rgba(0,0,0,0.3)",!0,!1,n,s),t.fillRect(s.x,s.y,s.width,s.height);return}if(t.transform(o.m11,o.m12,o.m21,o.m22,o.dx,o.dy),e.bn(t,e.background,!0,!1,n,s),t.fillRect(0,0,n.width/2,n.height/2),!o.RP()){const r=1/(o.m11*o.m22-o.m12*o.m21);t.transform(o.m22*r,-o.m12*r,-o.m21*r,o.m11*r,r*(o.m21*o.dy-o.m22*o.dx),r*(o.m12*o.dx-o.m11*o.dy))}}VR(t,e,i,s){const n=2/s,o=4/s;for(let r=0;r<i;r++){const l=e[r];if(!(l.width===0||l.height===0)&&t.intersects(l.x-n,l.y-n,l.width+o,l.height+o))return!0}return!1}t(t,e,i,s,n){const o=this.diagram;o!==null&&o.raiseChangedEvent(2,t,this,e,i,s,n)}ch(t,e,i){const s=this.Ct;if(e.EM(this),t>=s.count)t=s.count;else if(s.elt(t)===e)return-1;s.insertAt(t,e),e.tp(i);const n=this.diagram;return n!==null&&(i?n.C():n.ch(e)),this.rb(t,e),t}ri(t,e,i){if(!i&&e.layer!==this&&e.layer!==null)return e.layer.ri(t,e,i);const s=this.Ct;if(t<0||t>=s.length){if(t=s.indexOf(e),t<0)return-1}else if(s.elt(t)!==e&&(t=s.indexOf(e),t<0))return-1;e.ep(i),s.removeAt(t);const n=this.diagram;return n!==null&&(i?n.C():n.ri(e)),e.EM(null),t}rb(t,e){t=this.zR(t,e),e instanceof Group&&this.XR(t,e),e.svg!==null&&e.svg.remove()}zR(t,e){const i=e.zOrder;if(isNaN(i))return t;const s=this.Ct,n=s.count;if(n<=1)return t;if(t<0&&(t=s.indexOf(e)),t<0)return-1;let o=t-1,r=NaN;for(;o>=0&&(r=s.elt(o).zOrder,!!isNaN(r));)o--;let l=t+1,a=NaN;for(;l<n&&(a=s.elt(l).zOrder,!!isNaN(a));)l++;if(!isNaN(r)&&r>i)for(;;){if(o===-1||r<=i)return o++,o===t?t:(s.removeAt(t),s.insertAt(o,e),o);for(r=NaN;--o>=0&&(r=s.elt(o).zOrder,!!isNaN(r)););}else if(!isNaN(a)&&a<i)for(;;){if(l===n||a>=i)return l--,l===t?t:(s.removeAt(t),s.insertAt(l,e),l);for(a=NaN;++l<n&&(a=s.elt(l).zOrder,!!isNaN(a)););}return t}XR(t,e){if(e===null||!isNaN(e.zOrder))return;this.GR(t,e);const i=e.containingGroup;i!==null&&this.rb(-1,i)}GR(t,e){if(e.memberParts.count===0)return;let i=-1;const s=this.Ct.r,n=s.length;for(let o=0;o<n;o++){const r=s[o];if(r===e&&(t=o,i>=0)||i<0&&r.containingGroup===e&&(i=o,t>=0))break}if(!(i<0)&&i<t){const o=this.Ct;o.removeAt(t),o.insertAt(i,e)}}get parts(){return this.Ct.iterator}get partsBackwards(){return this.Ct.iteratorBackwards}get diagram(){return this.a}get name(){return this.Pt}set name(t){U.s(t,"string",Layer,"name");const e=this.Pt;if(e!==t){const i=this.diagram;if(i!==null){e===""&&U.o("Cannot rename default Layer to: "+t);const n=i.layers;for(;n.next();)n.value.name===t&&U.o("Layer.name is already present in this diagram: "+t)}this.Pt=t,this.t("name",e,t);const s=this.Ct.iterator;for(;s.next();){const n=s.value;n.layerName=this.Pt}}}get opacity(){return this.Zt}set opacity(t){const e=this.Zt;if(e!==t){U.s(t,"number",Layer,"opacity"),(t<0||t>1)&&U.J(t,"0 <= value <= 1",Layer,"opacity"),this.Zt=t;const i=this.diagram;i!==null&&i.C(),this.t("opacity",e,t)}}get isViewportAligned(){return this.$m}set isViewportAligned(t){const e=this.$m;e!==t&&(this.$m=t,this.diagram&&(this.HA(),this.diagram.C()),this.t("isViewportAligned",e,t),t&&(this.isInDocumentBounds=!1))}HA(){if(!this.$m)return;const t=this.diagram;if(t===null)return;const e=this.Ct.r,i=e.length,s=t.wt,n=t.xt;for(let o=0;o<i;o++){const r=e[o],l=r.naturalBounds.width,a=r.naturalBounds.height;let h=r.alignment;(h.isDefault()||!h.isSpot())&&(h=Spot.BottomRight);let c=r.alignmentFocus;c.isDefault()&&(c=new Spot(h.x,h.y));const f=h.x*s+h.offsetX-(c.x*l+c.offsetX),u=h.y*n+h.offsetY-(c.y*a+c.offsetY),d=Point.z(f,u);t.YR(d),r.Ec(d.x,d.y,!0),Point.i(d),r.it=1/t.scale}}get isTemporary(){return this.vr}set isTemporary(t){const e=this.vr;e!==t&&(U.s(t,"boolean",Layer,"isTemporary"),this.vr=t,this.t("isTemporary",e,t))}get visible(){return this.Uc}set visible(t){const e=this.Uc;if(e!==t){U.s(t,"boolean",Layer,"visible"),this.Uc=t;const i=this.Ct.iterator;for(;i.next();)i.value.Xe(t);const s=this.diagram;s!==null&&s.C(),this.t("visible",e,t)}}get pickable(){return this.ea}set pickable(t){const e=this.ea;e!==t&&(U.s(t,"boolean",Layer,"pickable"),this.ea=t,this.t("pickable",e,t))}get isInDocumentBounds(){return this.ob}set isInDocumentBounds(t){const e=this.ob;e!==t&&(this.ob=t,this.diagram!==null&&this.diagram.invalidateDocumentBounds(),this.t("isInDocumentBounds",e,t))}get allowCopy(){return this.Yl}set allowCopy(t){const e=this.Yl;e!==t&&(U.s(t,"boolean",Layer,"allowCopy"),this.Yl=t,this.t("allowCopy",e,t))}get allowDelete(){return this.Kl}set allowDelete(t){const e=this.Kl;e!==t&&(U.s(t,"boolean",Layer,"allowDelete"),this.Kl=t,this.t("allowDelete",e,t))}get allowTextEdit(){return this.Hl}set allowTextEdit(t){const e=this.Hl;e!==t&&(U.s(t,"boolean",Layer,"allowTextEdit"),this.Hl=t,this.t("allowTextEdit",e,t))}get allowGroup(){return this.ql}set allowGroup(t){const e=this.ql;e!==t&&(U.s(t,"boolean",Layer,"allowGroup"),this.ql=t,this.t("allowGroup",e,t))}get allowUngroup(){return this.jl}set allowUngroup(t){const e=this.jl;e!==t&&(U.s(t,"boolean",Layer,"allowUngroup"),this.jl=t,this.t("allowUngroup",e,t))}get allowLink(){return this.Wl}set allowLink(t){const e=this.Wl;e!==t&&(U.s(t,"boolean",Layer,"allowLink"),this.Wl=t,this.t("allowLink",e,t))}get allowRelink(){return this.Jl}set allowRelink(t){const e=this.Jl;e!==t&&(U.s(t,"boolean",Layer,"allowRelink"),this.Jl=t,this.t("allowRelink",e,t))}get allowMove(){return this.$l}set allowMove(t){const e=this.$l;e!==t&&(U.s(t,"boolean",Layer,"allowMove"),this.$l=t,this.t("allowMove",e,t))}get allowReshape(){return this.Zl}set allowReshape(t){const e=this.Zl;e!==t&&(U.s(t,"boolean",Layer,"allowReshape"),this.Zl=t,this.t("allowReshape",e,t))}get allowResize(){return this.Ql}set allowResize(t){const e=this.Ql;e!==t&&(U.s(t,"boolean",Layer,"allowResize"),this.Ql=t,this.t("allowResize",e,t))}get allowRotate(){return this._l}set allowRotate(t){const e=this._l;e!==t&&(U.s(t,"boolean",Layer,"allowRotate"),this._l=t,this.t("allowRotate",e,t))}get allowSelect(){return this.ta}set allowSelect(t){const e=this.ta;e!==t&&(U.s(t,"boolean",Layer,"allowSelect"),this.ta=t,this.t("allowSelect",e,t))}}var AutoScale=(w=>(w[w.None=1]="None",w[w.Uniform=2]="Uniform",w[w.UniformToFill=3]="UniformToFill",w))(AutoScale||{}),CycleMode=(w=>(w[w.All=1]="All",w[w.NotDirected=2]="NotDirected",w[w.NotDirectedFast=3]="NotDirectedFast",w[w.NotUndirected=4]="NotUndirected",w[w.DestinationTree=5]="DestinationTree",w[w.SourceTree=6]="SourceTree",w))(CycleMode||{}),ScrollMode=(w=>(w[w.Document=1]="Document",w[w.Infinite=2]="Infinite",w))(ScrollMode||{}),CollapsePolicy=(w=>(w[w.TreeParent=1]="TreeParent",w[w.AllParents=2]="AllParents",w[w.AnyParents=3]="AnyParents",w))(CollapsePolicy||{});class Diagram{Ns;jt;zM;lb;Fr;Wu;ab;hb;cb;fb;ub;db;fh;ah;gb;pb;yb;ia;Wc;Rr;ip;wb;xb;Ju;to;Or;uh;Uo;sp;Jc;np;$c;$u;Ir;eo;XM;GM;bb;kb;YM;Pb;KM;HM;qM;Sb;op;Er;Ur;Vr;Br;zr;Xr;Mb;Gr;Nb;Yr;Kr;Hr;qr;Cb;jM;Vo;WM;Lb;Ab;JM;Ce;$M;Zc;ZM;Hs;Bo;Be;Tb;Yl;Kl;Db;vb;Hl;ql;jl;Fb;Wl;Jl;$l;Zl;Ql;_l;ta;Rb;Ob;QM;Zu;Qu;Ib;Eb;Ub;Vb;rp;Bb;zb;Xb;Qt;qA;Gb;jA;_u;kn;io;li;so;WA;sa;_M;t2;lp;Yb;td;ap;Kb;jr;na;dh;e2;i2;hp;Hb;qb;ls;ed;cp;sd;zo;Qc;fp;Wr;gh;s2;dp;Ht;v;qi;Tr;Ye;As;o2;oa;Jr;Fl;$r;mh;_c;l2;nd;ph;od;Vt;ra;ct;it;rd;wt;xt;lt;tf;Mx;jb;yh;ef;Wb;Jb;gp;KR;HR;$e;Ol;_m;mp;a2;h2;JA;pp;qR;jR;WR;$b;JR;$R;ZR;wh;$A;la;xh;bh;kh;Ph;Iu;oh;Wt;Nt;sf;jP;WP;Dc;Zt;static Zb=null;static ZA=new GMap;static c2;static f2=null;Ou;Qb;_b;ld;t1;e1;yp;u2;wp;xp;bp;qx;d2;g2;nf;kp;Pp;constructor(t,e){if(Diagram.jw||(Diagram.OP(),Diagram.jw=!0),GSet.Je(this),Diagram.QA(this),this.Ht=!0,this.Nt=null,this.wt=0,this.xt=0,this.lt=null,Diagram.isUsingDOM()){const s=this,n=()=>{s.Le(root.document,"DOMContentLoaded",n,!1),s.setRTL()};root.document.body!==null?this.setRTL():s.Et(root.document,"DOMContentLoaded",n,!1)}this.tf=null,Diagram.m2("Model",PartManager);const i=this;return this.$M=s=>i.partManager.doModelDataChanged(s),this.Zc=s=>i.partManager.doModelChanged(s),this.Wb=null,this.Jb=null,this._A(),this.model=Model.p2(),this.themeManager=new ThemeManager,this.Vo=!0,this.tT(),this.layout=new Layout,this.Vo=!1,this.qR=null,this.jR=null,this.WR=null,this.$b=null,this.JR=null,this.$R=null,this.ZR=null,this.wh=null,this.$A=null,this.la=null,this.xh=null,this.bh=null,this.kh=null,this.Ph=null,this.Iu=()=>{},this.oh=null,this.sd=!1,this.sf=new DiagramHelper(this),t!==void 0&&(typeof t=="string"||root.Element&&t instanceof Element?this.w2(t):e=t),e&&this.setProperties(e),this.Ht=!1,this.requestUpdate(),this}aR(){return this.lt!==null}get renderer(){return this.Qc}set renderer(t){if(this instanceof Overview)return;t===""&&(t="default");const e=t.toLowerCase(),i=this.Qc;if(e===i)return;this.Qc=e;let s=null;e==="default"||e==="canvas"?(s=this.zo.get("svg"),s!==null&&s.bt.remove(),this.lt&&(this.Wt=this.lt._t,this.Wt.clearContextCache(!0))):e==="svg"?(this.zo.has("svg")?s=this.zo.get("svg"):(s=new SVGSurface(this,root.document),this.addRenderer("svg",s)),this.div!==null&&(s.bt.role="img",this.div.appendChild(s.bt)),this.lt&&(this.Wt=s._t,this.lt._t.setTransform(this.$e,0,0,this.$e,0,0),this.lt._t.clearRect(0,0,this.wt,this.xt))):e==="debug"&&(this.zo.has("SVG")||(s=new SVGSurface(this,root.document),this.addRenderer("SVG",s),s.bt.style.backgroundColor="whitesmoke",this.div!==null&&this.div.after(s.bt))),this.Ht||this.redraw()}_A(){if(this.nf=new List,this.setupRouters(),this.Ns=new AnimationManager,this.Ns.Io(this),this.jt=17,this.zM=!1,this.rd=!1,this.lb="default",this.Vt=new List,this.zo){const t=this.zo.get("svg");t!==null&&t.bt.remove(),this.lt&&(this.Wt=this.lt._t,this.Wt.clearContextCache(!0))}this.zo=new GMap,this.Qc="default",this.resetRenderingHints(),this.QR(),this.Zt=1,this.ct=new Point(NaN,NaN).k(),this.qx=new Point(NaN,NaN),this.it=1,this.dp=1,this.ab=new Point(NaN,NaN).k(),this.hb=NaN,this.cb=1e-4,this.fb=100,this.v=new Transform,this.ub=new Point(NaN,NaN).k(),this.db=new Rect(NaN,NaN,NaN,NaN).k(),this.fh=new Margin(0,0,0,0).kt(),this.ah=1,this.gb=!1,this.pb=null,this.yb=null,this.ia=1,this.Wc=Spot.Default,this.Rr=1,this.ip=Spot.Default,this.wb=Spot.None,this.xb=Spot.None,this.qi=!0,this.Ju=!1,this.to=new Set,this.Or=new GSet,this.uh=new GSet,this.Uo=!1,this.ra=new GMap,this.nd=!0,this.sp=250,this.Jc=-1,this.np=new Margin(16,16,16,16).kt(),this.Tr=!1,this.$c=!1,this.$u=!0,this.fp=new InputEvent,this.fp.diagram=this,this.Wr=new InputEvent,this.Wr.diagram=this,this.gh=new InputEvent,this.gh.diagram=this,this.Ir=null,this.eo=null,this.Mx=!1,this._R(),this.$r=new GSet,this.bb=!0,this.kb=1,this.YM=!1,this.Pb=1,this.Sb="auto",this.op="auto",this.Er=null,this.Ur=null,this.Vr=null,this.Br=null,this.zr=null,this.Xr=null,this.Mb=null,this.Gr=null,this.Nb=!1,this.Yr=null,this.Kr=null,this.Hr=null,this.qr=null,this.Cb=!1,this.jb={},this.yh=[null,null],this.Vo=!1,this.WM=!1,this.Lb=!1,this.Ab=!1,this.JM=!0,this.As=!1,this.ph=!1,this.ZM=!0,this.Hs=-2,this.oa=new GMap,this.od=new List,this.Bo=!1,this.Be=!0,this.Tb=!0,this.Yl=!0,this.Kl=!0,this.Db=!1,this.vb=!0,this.Hl=!0,this.ql=!0,this.jl=!0,this.Fb=!0,this.Wl=!0,this.Jl=!0,this.$l=!0,this.Zl=!0,this.Ql=!0,this._l=!0,this.ta=!0,this.Rb=!0,this.Ob=!0,this.QM=!1,this.ef=!1,this.Zu=!0,this.Qu=!0,this.Ib=!0,this.Eb=!0,this.Ub=16,this.Vb=16,this.rp=!1,this.Bb=!1,this.zb=0,this.Xb=0,this.Qt=new Margin(5).kt(),this.qA=new GSet().k(),this.Gb=999999999,this.jA=new GSet().k(),this.mh=!0,this._u=!0,this._c=!0,this.kn=!1,this.io=!1,this.Jr=!0,this.Fl=!1,this.so=!1,this.WA=new GSet,this.l2=new GSet,this.sa=null,this._M=new Size(Link.eT,Link.iT),this.t2=999,this.lp=!1,this.jP=1,this.WP=0,this.Ye={scale:1,position:new Point,bounds:new Rect,canvasSize:new Size,newCanvasSize:new Size,isScroll:!1},this.Ye.canvasSize=this.Ye.canvasSize,this.Ye.newCanvasSize=this.Ye.newCanvasSize,this.Ye.isScroll=!1,this.Yb=new Rect(NaN,NaN,NaN,NaN).k(),this.td=new Size(NaN,NaN).k(),this.ap=new Rect(NaN,NaN,NaN,NaN).k(),this.Kb=!1,this.kp=null,this.Pp=null,this.tO(),this.ls=null,this.ed=!1,this.Dc=null,this.partManager=new PartManager,this.toolManager=new ToolManager,this.toolManager.initializeStandardTools(),this.defaultTool=this.toolManager,this.currentTool=this.defaultTool,this._b=null,this.ld=new DraggingOptions,this.t1=null,this.e1=null,this.Qb=!1,this.Ou=!1,this.commandHandler=new CommandHandler,this.xp=null,this.bp=Point.gn,this.d2=!1,this.$e=1,this.Ol=null,this._m=1,this.yp=0,this.u2=[0,0,0,0,0],this.wp=0,this.mp=1,this.a2=0,this.h2=new Point,this.JA=500,this.cp=new Point,this.pp=!1}static sT=root.document!==void 0;static isUsingDOM(){return Diagram.sT}static setDocument(t){root.document=t}static useDOM(t){Diagram.sT=t?root.document!==void 0:!1}static ji=new WeakMap;clear(){this.animationManager.stopAnimation(),this.model.clear(),Diagram.nT(),this.oT(!1),this.od.clear(),this.rT(),this.sa=null,this.invalidateDocumentBounds(),this.ensureBounds(),this.C()}oT(t){this.animationManager.stopAnimation(!0),this.clearSelection(),this.clearHighlighteds();const e=this.skipsUndoManager,i=this.Ce!==null&&this.Ce!==void 0;i&&(this.skipsUndoManager=!0);let s=null;this.ls!==null&&(s=this.ls.part,s!==null&&this.remove(s));const n=[],o=this.Vt.length;if(t){for(let r=0;r<o;r++){const a=this.Vt.r[r].parts;for(;a.next();){const h=a.value;h!==s&&h.data===null&&n.push(h)}}for(let r=0;r<n.length;r++){const l=n[r];this.remove(l)}}for(let r=0;r<o;r++)this.Vt.r[r].IR();return this.partManager.clear(),this.to.clear(),this.Or.clear(),this.uh.clear(),this.ra.clear(),this.$r.clear(),this.Dc=null,this.od.clear(),this.rT(),U.LP=[],s!==null&&(this.add(s),this.partManager.parts.delete(s)),i&&(this.skipsUndoManager=e),n}static Sp=null;static i1="";static nT(){Diagram.Sp=null,Diagram.i1=""}static EU(){return null}reset(){this.clear(),this.Ht=!0,this._A(),this.themeManager=new ThemeManager,this.aa(),this.Vo=!0,this.tT(),this.layout=new Layout,this.Vo=!1,this.model=Model.p2(),this.model.undoManager=new UndoManager,this.sd=!1,this.Ht=!1,this.C()}tO(){this.jr=new GMap,this.e2=new Node().add(new TextBlock({stroke:"black",font:"10pt sans-serif"}).bind("text","",U.toString).theme("stroke","text").theme("font","normal")),this.jr.set("",this.e2),this.jr.set("Comment",new Node().add(new TextBlock({stroke:"brown",font:"10pt sans-serif"}).bind("text","",U.toString).theme("stroke","comment").theme("font","normal"))),this.jr.set("LinkLabel",new Node({selectable:!1,avoidable:!1}).add(new Shape("Ellipse",{fill:"black",stroke:null,desiredSize:new Size(3,3).kt()}).theme("fill","link"))),this.dh=new GMap,this.o2=new Group(Panel.Vertical,{selectionObjectName:"GROUPPANEL"}).add(new TextBlock({stroke:"black",font:"bold 12pt sans-serif"}).bind("text","",U.toString).theme("stroke","text").theme("font","bold"),new Panel(Panel.Auto,{name:"GROUPPPANEL"}).add(new Shape({fill:"rgba(128,128,128,0.2)",stroke:"black",strokeWidth:1}).theme("fill","group").theme("stroke","outline").theme("strokeWidth","group"),new Placeholder({padding:5}).theme("padding","group"))),this.dh.set("",this.o2),this.na=new GMap,this.i2=new Link().add(new Shape({isPanelMain:!0,stroke:"black"}).theme("stroke","link"),new Shape({toArrow:"Standard",fill:"black",stroke:null,strokeWidth:0}).theme("toArrow").theme("fill","link")),this.na.set("",this.i2),this.na.set("Comment",new Link().add(new Shape({isPanelMain:!0,stroke:"brown"}).theme("stroke","comment"))),this.hp=new Adornment(Panel.Auto).add(new Shape({fill:null,stroke:"dodgerblue",strokeWidth:3}).theme("stroke","selection").theme("strokeWidth","selection"),new Placeholder({margin:1.5}).theme("margin","selection","numbers",null,t=>t?new Margin(t/2):1.5)).freezeBindings(),this.Hb=this.hp,this.qb=new Adornment(Panel.Link).add(new Shape({isPanelMain:!0,fill:null,stroke:"dodgerblue",strokeWidth:3}).theme("stroke","selection").theme("strokeWidth","selection")).freezeBindings()}setRTL(t){let e=t===void 0?this.div:t;e===null&&(e=root.document.body);const i=U.Ni("div");i.dir="rtl",i.style.cssText="font-size: 14px; width: 1px; height: 1px; position: absolute; top: -1000px; overflow: scroll;",i.textContent="A",e.appendChild(i);let s="reverse";i.scrollLeft>0?s="default":(i.scrollLeft=1,i.scrollLeft===0&&(s="negative")),e.removeChild(i),this.lb=s}setScrollWidth(t){let e=t===void 0?this.div:t;e===null&&(e=root.document.body);let i=0;if(Diagram.isUsingDOM()){let s=Diagram.f2,n=Diagram.c2;s===null&&(Diagram.f2=U.Ni("p"),s=Diagram.f2,s.style.width="100%",s.style.height="200px",s.style.boxSizing="content-box",Diagram.c2=U.Ni("div"),n=Diagram.c2,n.style.position="absolute",n.style.visibility="hidden",n.style.width="200px",n.style.height="150px",n.style.boxSizing="content-box",n.appendChild(s)),n.style.overflow="hidden",e.appendChild(n);const o=s.offsetWidth;n.style.overflow="scroll";let r=s.offsetWidth;o===r&&(r=n.clientWidth),e.removeChild(n),i=o-r,i===0&&!U.fr&&(i=11)}this.jt=i,this.zM=!0}fe(t){t in AutoScale?this.autoScale=t:U.ur(this,t)}toString(t){t===void 0&&(t=0);let e="";this.div&&this.div.id&&(e=this.div.id);let i='Diagram "'+e+'"';if(t<=0)return i;const s=this.Vt.iterator;for(;s.next();){const n=s.value;i+=`
  `+n.toString(t-1)}return i}static QA(t){Diagram.Zb=t}static Om(){return Diagram.Zb}static fromDiv(t){let e=t;if(typeof t=="string"&&(e=root.document.getElementById(t)),e instanceof HTMLDivElement){const i=Diagram.ji.get(e);if(i)return i}return null}get div(){return this.Nt}set div(t){if(t!==null&&U.se(t,HTMLDivElement,Diagram,"div"),this.Nt!==t){const e=this.Nt;if(e!==null){if(Diagram.ji.delete(e),e.goDiagram=void 0,e.go=void 0,e.innerHTML="",this.lt!==null){const s=this.lt.bt;this.Le(s,"pointermove",this.xh,!1),this.Le(s,"pointerdown",this.la,!1),this.Le(s,"pointerup",this.bh,!1),this.Le(s,"pointerout",this.kh,!1),this.Le(s,"pointercancel",this.Ph,!1),this.lt.dispose()}this.tf&&(this.tf.disconnect(),this.tf=null);const i=this.toolManager;i!==null&&(i.mouseDownTools.each(s=>s.cancelWaitAfter()),i.mouseMoveTools.each(s=>s.cancelWaitAfter()),i.mouseUpTools.each(s=>s.cancelWaitAfter())),i.cancelWaitAfter(),this.currentTool.doCancel(),this.lt=null,this.Le(root,"resize",this.$b,!1),this.Le(root,"wheel",this.wh,!0),Diagram.Om()===this&&Diagram.QA(null)}else this.la===null&&(this.so=!1);if(this.Nt=null,t!==null){const i=Diagram.ji.get(t);i&&(i.div=null),this.w2(t),this.Iu(),this.themeManager&&this.themeManager.eO()}else this.themeManager&&this.themeManager.iO()}}setupRouters(){this.nf.push(new AvoidsNodesRouter)}w2(t){const e=this;if(!Diagram.isUsingDOM())return;t==null&&U.o("Diagram setup requires an argument DIV."),e.Nt!==null&&U.o("Diagram has already completed setup."),typeof t=="string"?e.Nt=root.document.getElementById(t):t instanceof HTMLDivElement?e.Nt=t:U.o("No DIV or DIV id supplied: "+t),e.Nt===null&&U.o("Invalid DIV id; could not get element with id: "+t);const i=Diagram.ji.get(e.Nt);if(i&&i!==this&&U.o("Invalid div id; div already has a Diagram associated with it."),!e.tf&&root.ResizeObserver){const c=root.ResizeObserver,f=U.CP(()=>e.requestUpdate(),250,!1);e.tf=new c(()=>f()),e.tf.observe(e.Nt)}root.getComputedStyle(e.Nt,null).position==="static"&&(e.Nt.style.position="relative");let s=5;const n="rgba(2"+s+"5, 255, 255, 0)";s--,e.Nt.style["-webkit-tap-highlight-color"]=n,e.Nt.innerHTML="",Diagram.ji.set(e.Nt,e),e.Nt.goDiagram=e,e.Nt.go=root.go;const o=new CanvasSurface(e);o.style!==void 0&&(o.style.position="absolute",o.style.top="0px",o.style.left="0px",root.getComputedStyle(e.Nt,null).getPropertyValue("direction")==="rtl"&&(e.rd=!0),o.style.zIndex="2",o.style.userSelect="none",o.style.MozUserSelect="none",o.style.touchAction="none",o.style.letterSpacing="normal !important",o.style.wordSpacing="normal !important",o.style.lang="unknown"),o.bt.setAttribute("role","application"),e.lt=o,e.Wt=o._t;const r=e.Wt;e.$e=e.computePixelRatio(),e.viewSize.isReal()||(e.wt=e.Nt.clientWidth||1,e.xt=e.Nt.clientHeight||1),e.lT(e.wt,e.xt);const l=e;e.Nt.insertBefore(o.bt,e.Nt.firstChild);const a=new CanvasSurface(null);if(a.width=1,a.height=1,e.KR=a,e.HR=a._t,Diagram.isUsingDOM()){const c=U.Ni("div"),f=U.Ni("div");c.style.position="absolute",c.style.overflow="auto",c.style.width=e.wt+"px",c.style.height=e.xt+"px",c.style.zIndex="1",f.style.position="absolute",f.style.width="1px",f.style.height="1px",e.Nt.appendChild(c),c.appendChild(f),c.onscroll=Diagram.sO,c.addEventListener("pointerdown",Diagram.nO),c.a=e,c.oO=!0,c.rO=!0,e.Wb=c,e.Jb=f}e.Iu=U.CP(()=>{e.Ol=null,e.C()},300,!1),e.$b=U.CP(()=>{e.NM()},250,!1),e.oh=c=>(c.preventDefault(),!1),e.wh=c=>{if(!l.isEnabled)return;const f=l.of(c,!0);f.bubbles=!0;let u=0,d=0;f.delta=0,c.deltaX!==void 0?(c.deltaX!==0&&(u=c.deltaX>0?1:-1),c.deltaY!==0&&(d=c.deltaY>0?1:-1),f.delta=Math.abs(c.deltaX)>Math.abs(c.deltaY)?-u:-d):c.wheelDeltaX!==void 0?(c.wheelDeltaX!==0&&(u=c.wheelDeltaX>0?-1:1),c.wheelDeltaY!==0&&(d=c.wheelDeltaY>0?-1:1),f.delta=Math.abs(c.wheelDeltaX)>Math.abs(c.wheelDeltaY)?-u:-d):c.wheelDelta!==void 0&&c.wheelDelta!==0&&(f.delta=c.wheelDelta>0?1:-1),l.doMouseWheel(),l.Sh(f,c)},e.$A=c=>{if(!l.isEnabled)return;e.ef=!1,l.of(c,!0);const f=l.currentTool;f.cancelWaitAfter(),f.standardMouseOver()},e.la=c=>{if(!l.isEnabled)return;e.ef=!0;const f=l.jb;f[c.pointerId]===void 0&&(f[c.pointerId]=c);const u=l.yh;let d=!1;if(u[0]!==null&&(u[0].pointerId===c.pointerId||u[0].pointerType!==c.pointerType))u[0]=c;else if(u[1]!==null&&u[1].pointerId===c.pointerId)u[1]=c,d=!0;else if(u[0]===null)u[0]=c;else if(u[1]===null)u[1]=c,d=!0;else{c.preventDefault();return}const m=c.pointerType==="touch"||c.pointerType==="pen";m&&(l.Mx=!1,l.pp=!0);const g=l.lO(c,c,d),p=l.h2,y=m?25:10;if(c.timeStamp-l.a2<l.JA&&!(Math.abs(p.x-c.screenX)>y||Math.abs(p.y-c.screenY)>y)?l.mp++:l.mp=1,g.clickCount=l.mp,l.a2=c.timeStamp,l.h2.setTo(c.screenX,c.screenY),l.doMouseDown(),c.button===1){c.preventDefault();return}l.Sh(g,c)},e.xh=c=>{if(!l.isEnabled)return;e.ef=!0;const f=l.yh;if(f[0]!==null&&(f[0].pointerId===c.pointerId||f[0].pointerType!==c.pointerType))f[0]=c;else if(f[1]!==null&&f[1].pointerId===c.pointerId){f[1]=c;return}else if(f[0]===null)f[0]=c;else return;if(f[0].pointerId!==c.pointerId)return;const u=l.aO(c,c,f[1]!==null);l.doMouseMove(),l.Sh(u,c)},e.bh=c=>{if(!l.isEnabled)return;e.ef=!0;const f=c.pointerType==="touch"||c.pointerType==="pen",u=l.jb;if(f&&l.Mx){delete u[c.pointerId],c.preventDefault();return}const d=l.yh;if(d[0]!==null&&(d[0].pointerId===c.pointerId||d[0].pointerType!==c.pointerType))d[0]=null;else if(d[1]!==null&&d[1].pointerId===c.pointerId){d[1]=null;return}else return;const m=l.b2(c,!1,!0,!1,!0,!1);let g=root.document.elementFromPoint(c.clientX,c.clientY)||null;g!==null&&g.shadowRoot&&(g=g.shadowRoot.elementFromPoint(c.clientX,c.clientY)||null),g!==null&&g.a instanceof Diagram&&g.a!==l&&g.a.Mp(c,m),g===null&&(g=c.target),l.Mp(c,m),m.clickCount=l.mp,m.targetDiagram=l.s1(c,g),m.targetObject=null,l.doMouseUp(),l.Sh(m,c),f&&(l.pp=!1)},e.kh=c=>{if(!l.isEnabled)return;e.ef=!1;const f=l.jb;f[c.pointerId]&&delete f[c.pointerId];const u=l.yh;if(u[0]!==null&&u[0].pointerId===c.pointerId&&(u[0]=null),u[1]!==null&&u[1].pointerId===c.pointerId&&(u[1]=null),c.pointerType==="touch"||c.pointerType==="pen")return;const d=l.currentTool;d.cancelWaitAfter(),d.standardMouseOver()},e.Ph=c=>{const f=l.yh;f[0]!==null&&f[0].pointerId===c.pointerId?(f[0]=null,l.pp=!1):f[1]!==null&&f[1].pointerId===c.pointerId&&(f[1]=null)};const h=r;if(e.gp=h.F[U.We("7eba17a4ca3b1a8346")][U.We("78a118b7")](h.F,Diagram.Mh,s,s),r.clearContextCache(!0),e.hO(),this.Qc==="svg"){const c=this.zo.get("svg");this.Nt&&this.Nt.appendChild(c.bt),this.Wt=c._t}}addEventListener(t,e,i,s){t.addEventListener(e,i,{capture:s,passive:!1})}Et(t,e,i,s){t.addEventListener(e,i,{capture:s,passive:!1})}removeEventListener(t,e,i,s){t.removeEventListener(e,i,{capture:s})}Le(t,e,i,s){t.removeEventListener(e,i,{capture:s})}hO(){const t=this;let e=this.lt.bt;e instanceof HTMLCanvasElement||(e=t.div),this.Et(e,"pointerdown",t.la,!1),this.Et(e,"pointermove",t.xh,!1),this.Et(e,"pointerup",t.bh,!1),this.Et(e,"pointerout",t.kh,!1),this.Et(e,"pointercancel",t.Ph,!1),this.Et(e,"pointerenter",t.cO,!1),this.Et(e,"pointerleave",t.fO,!1),this.Et(e,"wheel",t.wh,!1),this.Et(e,"keydown",t.uO,!1),this.Et(e,"keyup",t.dO,!1),this.Et(e,"blur",t.gO,!1),this.Et(e,"focus",t.mO,!1),this.Et(e,"selectstart",i=>(i.preventDefault(),!1),!1),this.Et(e,"contextmenu",i=>(i.preventDefault(),!1),!1),this.Et(root,"resize",t.$b,!1)}Cx(){this.yp>30&&(this.Ol=1)}yS(t){this.Ol!==null&&(this.Ol=null,t&&this.Iu(),this.yp=0,this.u2=[0,0,0,0,0],this.wp=0)}computePixelRatio(){return this.Ol!==null?this.Ol:root.devicePixelRatio||1}get avgSpf(){return this.yp}doMouseDown(){this.currentTool.doMouseDown()}doMouseMove(){this.currentTool.doMouseMove()}doMouseUp(){this.currentTool.doMouseUp()}doMouseWheel(){this.currentTool.doMouseWheel()}doKeyDown(){const t=this.commandHandler;if(!this.toggleKeyboardControl()){if((t.isFocusEnabled||t.isVirtualPointerEnabled)&&t.doVirtualFocusKeyDown()){const e=this.lastInput;e.bubbles=!1;const i=e.event;i&&(i.stopPropagation&&i.stopPropagation(),i.cancelable!==!1&&i.preventDefault());return}this.currentTool.doKeyDown()}}toggleKeyboardControl(){const t=this.lastInput,e=t.commandKey;if((t.control||t.meta)&&t.alt&&(e==="Enter"||e==="NumpadEnter")){const i=this.commandHandler,s=i.isFocusEnabled||i.isVirtualPointerEnabled;return i.isFocusEnabled=!s,i.isVirtualPointerEnabled=!s,i.focus=i.findFirstFocus(),this.T("FocusOrVirtualPointerEnabledChanged"),!0}return!1}doKeyUp(){const t=this.commandHandler;if((t.isFocusEnabled||t.isVirtualPointerEnabled)&&t.doVirtualFocusKeyUp()){const e=this.lastInput;e.bubbles=!1;const i=e.event;i&&(i.stopPropagation&&i.stopPropagation(),i.cancelable!==!1&&i.preventDefault());return}this.currentTool.doKeyUp()}ad(t,e){if(e)for(const i in e)i!=="sourceDiagram"&&(t[i]=e[i])}emitMouseDown(t,e,i,s){if(typeof t!="number"||typeof e!="number")throw new Error("Robot.mouseDown first two args must be X,Y numbers");i===void 0&&(i=0);let n=this;if(s&&s.sourceDiagram&&(n=s.sourceDiagram),!n.isEnabled)return this;const o=new InputEvent;return o.diagram=n,o.documentPoint=new Point(t,e),o.viewPoint=n.transformDocToView(o.documentPoint),o.timestamp=i,o.down=!0,this.ad(o,s),n.lastInput=o,n.firstInput=o.copy(),n.doMouseDown(),this}emitMouseMove(t,e,i,s){if(typeof t!="number"||typeof e!="number")throw new Error("Robot.mouseMove first two args must be X,Y numbers");i===void 0&&(i=0);let n=this;if(s&&s.sourceDiagram&&(n=s.sourceDiagram),!n.isEnabled)return this;const o=new InputEvent;return o.diagram=n,o.documentPoint=new Point(t,e),o.viewPoint=n.transformDocToView(o.documentPoint),o.timestamp=i,this.ad(o,s),n.lastInput=o,n.doMouseMove(),this}emitMouseUp(t,e,i,s){if(typeof t!="number"||typeof e!="number")throw new Error("Robot.mouseUp first two args must be X,Y numbers");i===void 0&&(i=0);let n=this;if(s&&s.sourceDiagram&&(n=s.sourceDiagram),!n.isEnabled)return this;const o=new InputEvent;return o.diagram=n,o.documentPoint=new Point(t,e),o.viewPoint=n.transformDocToView(o.documentPoint),o.timestamp=i,o.up=!0,n.firstInput.documentPoint.equals(o.documentPoint)&&(o.clickCount=1),this.ad(o,s),n.lastInput=o,n.doMouseUp(),this}emitMouseWheel(t,e,i){if(typeof t!="number")throw new Error("Robot.mouseWheel first arg must be DELTA number");e===void 0&&(e=0);const s=this;if(!s.isEnabled)return this;const n=new InputEvent;return n.diagram=s,n.documentPoint=s.lastInput.documentPoint,n.viewPoint=s.lastInput.viewPoint,n.delta=t,n.timestamp=e,this.ad(n,i),s.lastInput=n,s.doMouseWheel(),this}emitKeyDown(t,e,i){if(typeof t!="string"&&typeof t!="number")throw new Error("Robot.keyDown first arg must be a string or a number");e===void 0&&(e=0);const s=this;if(!s.isEnabled)return this;const n=new InputEvent;return n.diagram=s,n.documentPoint=s.lastInput.documentPoint,n.viewPoint=s.lastInput.viewPoint,typeof t=="string"?n.key=t:typeof t=="number"&&(n.key=String.fromCharCode(t)),n.timestamp=e,n.down=!0,this.ad(n,i),s.lastInput=n,s.doKeyDown(),this}emitKeyUp(t,e,i){if(typeof t!="string"&&typeof t!="number")throw new Error("Robot.keyUp first arg must be a string or a number");e===void 0&&(e=0);const s=this;if(!s.isEnabled)return this;const n=new InputEvent;return n.diagram=s,n.documentPoint=s.lastInput.documentPoint,n.viewPoint=s.lastInput.viewPoint,typeof t=="string"?n.key=t:typeof t=="number"&&(n.key=String.fromCharCode(t)),n.timestamp=e,n.up=!0,this.ad(n,i),s.lastInput=n,s.doKeyUp(),this}doFocus(){this.focus()}focus(){if(this.lt)if(this.scrollsPageOnFocus)this.lt.focus();else{const t=root.scrollX,e=root.scrollY;this.lt.focus(),root.scrollTo(t,e)}}mO(t){const e=Diagram.ji.get(this);e&&e.T("GainedFocus")}gO(t){const e=Diagram.ji.get(this);e&&e.T("LostFocus")}NM(){if(this.lt===null)return;const e=this.Nt;if(e===null||e.clientWidth===0||e.clientHeight===0)return;this.zM||this.setScrollWidth();const i=this.io?this.jt:0,s=this.kn?this.jt:0,n=this.$e;if(this.$e=this.computePixelRatio(),this.$e!==n&&(this.Ju=!0,this.requestUpdate()),e.clientWidth!==this.wt+i||e.clientHeight!==this.xt+s){this.Nh(),this.qi=!0;const o=this.layout;o!==null&&o.isViewportSized&&this.autoScale===1&&(this.$c=!0,o.p()),this.As||this.requestUpdate()}}tT(){let t=0,e=new Layer;e.name="Grid",e.allowSelect=!1,e.pickable=!1,e.isTemporary=!0,e.isInDocumentBounds=!1,this.Zr(e,t++),e=new Layer,e.name="ViewportBackground",e.isViewportAligned=!0,e.isTemporary=!0,e.isInDocumentBounds=!1,this.Zr(e,t++),e=new Layer,e.name="Background",this.Zr(e,t++),e=new Layer,e.name="",this.Zr(e,t++),e=new Layer,e.name="Foreground",this.Zr(e,t++),e=new Layer,e.name="ViewportForeground",e.isViewportAligned=!0,e.isTemporary=!0,e.isInDocumentBounds=!1,this.Zr(e,t++),e=new Layer,e.name="Adornment",e.isTemporary=!0,e.isInDocumentBounds=!1,this.Zr(e,t++),e=new Layer,e.name="Tool",e.isTemporary=!0,e.isInDocumentBounds=!0,this.Zr(e,t++)}aT(){const t=new Panel(Panel.Grid,{name:"GRID"}).add(new Shape("LineH",{stroke:"lightgray",strokeWidth:.5,interval:1}).theme("stroke","gridMinor"),new Shape("LineV",{stroke:"lightgray",strokeWidth:.5,interval:1}).theme("stroke","gridMinor"),new Shape("LineH",{stroke:"gray",strokeWidth:.5,interval:5}).theme("stroke","gridMajor"),new Shape("LineV",{stroke:"gray",strokeWidth:.5,interval:5}).theme("stroke","gridMajor"),new Shape("LineH",{stroke:"gray",strokeWidth:1,interval:10}).theme("stroke","gridMajor"),new Shape("LineV",{stroke:"gray",strokeWidth:1,interval:10}).theme("stroke","gridMajor")),e=new Part({layerName:"Grid",zOrder:0,isInDocumentBounds:!1,isAnimated:!1,pickable:!1,locationObjectName:"GRID"}).add(t);return this.add(e),this.partManager.parts.delete(e),t.visible=!1,t}static sO(){const t=Diagram.ji.get(this.parentElement||this);if(t){if(t.Bb){t.Bb=!1;return}if(!t.isEnabled){t.hT();return}t.diagramScroll(this)}}static nO(t){if(!this.a.isEnabled){this.a.updateScroll();return}this.a.zb=t.target.scrollTop,this.a.Xb=t.target.scrollLeft}diagramScroll(t){if(this.lt===null)return;const e=this.Wb,i=this.Jb;this.rp=!0;let s=this.documentBounds,n=this.viewportBounds;const o=this.fh;let r=s.x-o.left,l=s.y-o.top;const a=s.width+o.left+o.right,h=s.height+o.top+o.bottom;let c=s.right+o.right,f=s.bottom+o.bottom,u=n.x,d=n.y;const m=n.width,g=n.height;let p=n.right,y=n.bottom;const x=this.scale;let b,k=t.scrollLeft;if(this.rd)switch(this.lb){case"negative":k=k+t.scrollWidth-t.clientWidth;break;case"reverse":k=t.scrollWidth-k-t.clientWidth;break}const P=k;if(m<a||g<h){b=Point.z(this.position.x,this.position.y),this.allowHorizontalScroll&&this.Xb!==P&&(b.x=P/x+r,this.Xb=P),this.allowVerticalScroll&&this.zb!==t.scrollTop&&(b.y=t.scrollTop/x+l,this.zb=t.scrollTop),this.position=b,Point.i(b),this.rp=!1,this._u=!1;return}if(b=Point.l(),t.oO&&this.allowHorizontalScroll&&(r<u&&(this.position=b.e(P+r,this.position.y)),c>p)){const S=e.scrollWidth-this.wt;this.position=b.e(-S+P-this.wt/x+c,this.position.y)}if(t.rO&&this.allowVerticalScroll&&(l<d&&(this.position=b.e(this.position.x,t.scrollTop+l)),f>y)){const S=e.scrollHeight-this.xt;this.position=b.e(this.position.x,-S+t.scrollTop-this.xt/x+f)}Point.i(b),this.ha(),this.rp=!1,this._u=!1,s=this.documentBounds,n=this.viewportBounds,c=s.right,p=n.right,f=s.bottom,y=n.bottom,r=s.x,u=n.x,l=s.y,d=n.y,m>=a&&r>=u&&c<=p&&(i.style.width="1px"),g>=h&&l>=d&&f<=y&&(i.style.height="1px")}computeBounds(t){return t===void 0&&(t=new Rect),this.Te(),this.cT(t)}cT(t){if(this.fixedBounds.isReal())return t.h(this.fixedBounds),t.addMargin(this.Qt),t;let e=!0;const i=this.Vt.r,s=i.length;for(let n=0;n<s;n++){const o=i[n];if(!o.visible||!o.isInDocumentBounds)continue;const r=o.Ct.r,l=r.length;for(let a=0;a<l;a++){const h=r[a];if(!h.isInDocumentBounds||!h.isVisible())continue;const c=h.actualBounds;c.isReal()&&(e?(e=!1,t.h(c)):t.unionRect(c))}}return e&&t.e(0,0,0,0),t.addMargin(this.Qt),t}computePartsBounds(t,e){e===void 0&&(e=!1);let i;if(Array.isArray(t))for(let s=0;s<t.length;s++){const n=t[s];!e&&n instanceof Link||(n.ensureBounds(),i===void 0?i=n.actualBounds.copy():i.unionRect(n.actualBounds))}else{const s=t.iterator;for(;s.next();){const n=s.value;!e&&n instanceof Link||(n.ensureBounds(),i===void 0?i=n.actualBounds.copy():i.unionRect(n.actualBounds))}}return i===void 0?new Rect(NaN,NaN,0,0):i}Js(t){if(!t&&!this.so||this.Ht||this.lt===null||!this.documentBounds.isReal())return;if(this.Ht=!0,t){const f=this.initialPosition;if(f.isReal()){this.Ht=!1,this.position=f;return}let u=this.initialDocumentSpot,d=this.initialViewportSpot;u.isNoSpot()&&(u=Spot.TopLeft),d.isNoSpot()&&(d=Spot.TopLeft);const m=Point.l();m.setRectSpot(this.documentBounds,u);const g=this.viewportBounds,p=Rect.z(0,0,g.width,g.height),y=Point.l();y.setRectSpot(p,d),y.e(m.x-y.x,m.y-y.y),this.Ht=!1,this.position=y,Rect.i(p),Point.i(y)}let e=this.ia;t&&this.Rr!==1&&(e=this.Rr);const i=e!==1?this.hd(e):this.scale,s=this.ct.x,n=this.ct.y,o=this.wt/i,r=this.xt/i;let l=this.Wc;const a=this.ip;if(t&&!l.isSpot()&&(a.isSpot()||a.isDefault())){const f=this.initialDocumentSpot.isSpot()&&this.initialViewportSpot.isSpot();l=a.isDefault()&&!f?Spot.Center:a}this.k2(this.documentBounds,o,r,l,t);const h=this.scale;this.scale=i,this.Ht=!1;const c=this.viewportBounds;c.equalsApproxTo(s,n,o,r)||this.onViewportBoundsChanged(new Rect(s,n,o,r),c,h,!1)}hd(t){const e=this.dp;if(this.lt===null)return e;if(t===1)return this.scale;this.ensureBounds();const i=this.documentBounds;if(!i.isReal())return e;const s=i.width,n=i.height,o=this.wt+(this.io?this.jt:0),r=this.xt+(this.kn?this.jt:0);let l=o/s,a=r/n;const h=this.fh,c=h.left+h.right!==0,f=h.top+h.bottom!==0;(c||f)&&(a===l?(a=(r-this.jt)/n,l=(o-this.jt)/s):a>l?a=(r-this.jt)/n:l=(o-this.jt)/s);let u=0;return t===2?u=Math.min(a,l):t===3&&(a>l?u=(r-this.jt)/n:u=(o-this.jt)/s),u>e&&(u=e),u<this.minScale&&(u=this.minScale),u>this.maxScale&&(u=this.maxScale),u}zoomToFit(){const t=this.ah;this.ah=1,this.scale=this.hd(2),this.alignDocument(Spot.Center,Spot.Center),t!==1&&(this.Js(!1),this.k2(this.documentBounds,this.wt/this.it,this.xt/this.it,this.Wc,!1)),this.ah=t}zoomToRect(t,e){e===void 0&&(e=2);const i=t.width,s=t.height;if(i===0||s===0||isNaN(i)&&isNaN(s))return;let n=1;if(e===2||e===3)if(isNaN(i))n=this.viewportBounds.height*this.scale/s;else if(isNaN(s))n=this.viewportBounds.width*this.scale/i;else{const o=this.wt,r=this.xt;e===3?r/s>o/i?n=(r-(this.kn?this.jt:0))/s:n=(o-(this.io?this.jt:0))/i:n=Math.min(r/s,o/i)}this.scale=n,this.position=new Point(t.x,t.y)}get pO(){return this.Ht}set pO(t){this.Ht=t}alignDocument(t,e){this.ensureBounds();const i=this.documentBounds,s=this.viewportBounds;this.position=new Point(i.x+(t.x*i.width+t.offsetX)-(e.x*s.width-e.offsetX),i.y+(t.y*i.height+t.offsetY)-(e.y*s.height-e.offsetY))}focusObject(t){if(t instanceof GraphObject){this.xp=t;const e=Point.l();this.bp=this.transformDocToView(t.getDocumentPoint(Spot.TopLeft,e)),Point.i(e)}else this.xp=null,this.bp=Point.gn}k2(t,e,i,s,n){const o=Point.z(this.ct.x,this.ct.y);let r=o.x,l=o.y;if(this.xp!==null){let a=Point.l();a=this.xp.getDocumentPoint(Spot.TopLeft,a),r=a.x-this.bp.x/this.scale,l=a.y-this.bp.y/this.scale,s=Spot.None,Point.i(a)}if(n||this.scrollMode===1){s.isSpot()&&(e>t.width&&(r=t.x+(s.x*t.width+s.offsetX)-(s.x*e-s.offsetX)),i>t.height&&(l=t.y+(s.y*t.height+s.offsetY)-(s.y*i-s.offsetY)));const a=this.fh,h=e-t.width;if(e<t.width+a.left+a.right){let f=r+e/2;f=Math.min(f,t.right+Math.max(h,a.right)-e/2),f=Math.max(f,t.left-Math.max(h,a.left)+e/2),r=f-e/2}else r>t.left?r=t.left:r<t.right-e&&(r=t.right-e);const c=i-t.height;if(i<t.height+a.top+a.bottom){let f=l+i/2;f=Math.min(f,t.bottom+Math.max(c,a.bottom)-i/2),f=Math.max(f,t.top-Math.max(c,a.top)+i/2),l=f-i/2}else l>t.top?l=t.top:l<t.bottom-i&&(l=t.bottom-i)}if(o.x=isFinite(r)?r:-this.Qt.left,o.y=isFinite(l)?l:-this.Qt.top,this.positionComputation!==null){const a=this.positionComputation(this,o);o.x=a.x,o.y=a.y}this.Ns.UA(this.ct,o),this.ct.e(o.x,o.y),this.Np(),this.aa(),this.yO(),Point.i(o)}findPartAt(t,e){if(e===void 0&&(e=!0),e){const i=this.kS(t,s=>s.part,s=>s.canSelect());if(i instanceof Part)return i}else{const i=this.kS(t,s=>s.part);if(i instanceof Part)return i}return null}findObjectAt(t,e,i){e===void 0&&(e=null),i===void 0&&(i=null),this.Te();const s=this.Vt.iteratorBackwards;for(;s.next();){const n=s.value;if(!n.visible)continue;const o=n.findObjectAt(t,e,i);if(o!==null)return o}return null}kS(t,e,i){e===void 0&&(e=null),i===void 0&&(i=null),this.Te();const s=this.Vt.iteratorBackwards;for(;s.next();){const n=s.value;if(!n.visible||n.isTemporary)continue;const o=n.findObjectAt(t,e,i);if(o!==null)return o}return null}findPartsAt(t,e,i){return e===void 0&&(e=!0),this.wO(t,s=>s.part,e?s=>s instanceof Part&&s.canSelect():null,i)}wO(t,e,i,s){e===void 0&&(e=null),i===void 0&&(i=null),!(s instanceof List)&&!(s instanceof GSet)&&(s=new GSet),this.Te();const n=this.Vt.iteratorBackwards;for(;n.next();){const o=n.value;!o.visible||o.isTemporary||o.findObjectsAt(t,e,i,s)}return s}findObjectsAt(t,e,i,s){e===void 0&&(e=null),i===void 0&&(i=null),!(s instanceof List)&&!(s instanceof GSet)&&(s=new GSet),this.Te();const n=this.Vt.iteratorBackwards;for(;n.next();){const o=n.value;o.visible&&o.findObjectsAt(t,e,i,s)}return s}findPartsIn(t,e,i,s){return e===void 0&&(e=!1),i===void 0&&(i=!0),this.xO(t,null,n=>n instanceof Part&&(!i||n.canSelect()),e,s)}findObjectsIn(t,e,i,s,n){e===void 0&&(e=null),i===void 0&&(i=null),s===void 0&&(s=!1),!(n instanceof List)&&!(n instanceof GSet)&&(n=new GSet),this.Te();const o=this.Vt.iteratorBackwards;for(;o.next();){const r=o.value;r.visible&&r.findObjectsIn(t,e,i,s,n)}return n}MS(t,e,i,s,n,o){const r=new GSet;this.Te();const l=this.Vt.iteratorBackwards;for(;l.next();){const a=l.value;a.visible&&a.MS(t,e,i,s,r,n,o)}return r}xO(t,e,i,s,n){e===void 0&&(e=null),i===void 0&&(i=null),s===void 0&&(s=!1),!(n instanceof List)&&!(n instanceof GSet)&&(n=new GSet),this.Te();const o=this.Vt.iteratorBackwards;for(;o.next();){const r=o.value;!r.visible||r.isTemporary||r.findObjectsIn(t,e,i,s,n)}return n}findPartsNear(t,e,i,s,n){return i===void 0&&(i=!0),s===void 0&&(s=!0),this.bO(t,e,null,o=>o instanceof Part&&(!s||o.canSelect()),i,n)}findObjectsNear(t,e,i,s,n,o){i===void 0&&(i=null),s===void 0&&(s=null),n===void 0&&(n=!0),n!==!1&&n!==!0&&((n instanceof List||n instanceof GSet)&&(o=n),n=!0),!(o instanceof List)&&!(o instanceof GSet)&&(o=new GSet),this.Te();const r=this.Vt.iteratorBackwards;for(;r.next();){const l=r.value;l.visible&&l.findObjectsNear(t,e,i,s,n,o)}return o}bO(t,e,i,s,n,o){i===void 0&&(i=null),s===void 0&&(s=null),n===void 0&&(n=!0),n!==!1&&n!==!0&&((n instanceof List||n instanceof GSet)&&(o=n),n=!0),!(o instanceof List)&&!(o instanceof GSet)&&(o=new GSet),this.Te();const r=this.Vt.iteratorBackwards;for(;r.next();){const l=r.value;!l.visible||l.isTemporary||l.findObjectsNear(t,e,i,s,n,o)}return o}acceptEvent(t){return this.of(t,t instanceof MouseEvent)}of(t,e){const i=this.Wr;this.Wr=this.gh,this.gh=i,i.diagram=this,i.event=t,e?this.Mp(t,i):(i.viewPoint=this.Wr.viewPoint,i.documentPoint=this.Wr.documentPoint);let s=0;const n=t;return n.ctrlKey&&(s+=1),n.altKey&&(s+=2),n.shiftKey&&(s+=4),n.metaKey&&(s+=8),i.modifiers=s,i.button=n.button,n.buttons!==void 0&&(i.buttons=n.buttons),U.fr&&n.button===0&&n.ctrlKey&&(i.button=2),i.down=!1,i.up=!1,i.clickCount=1,i.delta=0,i.handled=!1,i.bubbles=!1,i.timestamp=t.timeStamp,i.isMultiTouch=!1,i.targetDiagram=this.s1(t,t.target),i.targetObject=null,i}s1(t,e){if(e===null)return null;const i=Diagram.ji.get(e);if(i)return i;let s=t.path;if(!s&&U.st(t.composedPath)&&(s=t.composedPath()),s&&s[0]){const n=Diagram.ji.get(s[0]);if(n)return n}return null}lO(t,e,i){const s=this.b2(t,!0,!1,!1,!0,i);return this.Mp(e,s),s.targetDiagram=this.s1(t,t.target),s.targetObject=null,i||s.clone(this.fp),s}aO(t,e,i){const s=this.b2(t,!1,!1,!1,!1,i);let n=root.document.elementFromPoint(e.clientX,e.clientY)||null;n!==null&&n.shadowRoot&&(n=n.shadowRoot.elementFromPoint(e.clientX,e.clientY)||null);let o=this,r=t;if(n){const l=this.s1(t,n);l&&(r=e,o=l)}return s.targetDiagram=o,this.Mp(r,s),s.targetObject=null,s}b2(t,e,i,s,n,o){const r=this.Wr;this.Wr=this.gh,this.gh=r,r.diagram=this,r.clickCount=1,r.delta=0;let l=0;return t.ctrlKey&&(l+=1),t.altKey&&(l+=2),t.shiftKey&&(l+=4),t.metaKey&&(l+=8),r.modifiers=l,r.event=t,r.timestamp=t.timeStamp,r.button=i?this.firstInput.button:t.button,r.buttons=t.buttons,U.fr&&t.button===0&&t.ctrlKey&&(r.button=2),r.down=e,r.up=i,r.handled=s,r.bubbles=n,r.isMultiTouch=o,r}Sh(t,e){return t.bubbles?!0:(e.stopPropagation!==void 0&&e.stopPropagation(),e.cancelable!==!1&&e.preventDefault(),e.cancelBubble=!0,!1)}uO(t){const e=Diagram.ji.get(this);if(!e||!e.isEnabled)return!1;const i=e.of(t,!1);return i.key=t.key,i.code=t.code,i.down=!0,e.doKeyDown(),e.Sh(i,t)}dO(t){const e=Diagram.ji.get(this);if(!e||!e.isEnabled)return!1;const i=e.of(t,!1);return i.key=t.key,i.code=t.code,i.up=!0,e.doKeyUp(),e.Sh(i,t)}cO(t){const e=Diagram.ji.get(this);if(!e||!e.isEnabled)return!1;const i=e.of(t,!0);return e.mouseEnter!==null&&e.mouseEnter(i),e.currentTool.standardMouseOver(),e.Sh(i,t)}fO(t){const e=Diagram.ji.get(this);if(!e||!e.isEnabled)return!1;const i=e.of(t,!0);return e.mouseLeave!==null&&e.mouseLeave(i),e.Sh(i,t)}getMouse(t){const e=this.lt;if(e===null)return new Point(0,0);const i=e.getBoundingClientRect(),s=(t.clientX-i.left)*(this.wt/i.width),n=(t.clientY-i.top)*(this.xt/i.height);return new Point(s,n).Yi(this.v)}Mp(t,e){const i=this.lt;let s=0,n=0;if(i!==null){const r=i.getBoundingClientRect();s=(t.clientX-r.left)*(this.wt/r.width),n=(t.clientY-r.top)*(this.xt/r.height)}e.viewPoint.e(s,n);const o=Point.z(s,n);this.v.Ci(o),e.documentPoint.h(o),Point.i(o)}eA(t,e,i){let s;if(this.yh[0]!==null)s=this.yh[e];else return;const n=this.lt;if(n!==null){const o=n.getBoundingClientRect();i.e((s.clientX-o.left)*(this.wt/o.width),(s.clientY-o.top)*(this.xt/o.height))}}invalidateDocumentBounds(){this.mh||(this.mh=!0,this.requestUpdate(!1))}kO(){this.As||this.Te(),this.ensureBounds()}redraw(){this.Ht||this.As||(this.C(),this.maybeUpdate())}isUpdateRequested(){return this.Tr}delayInitialization(t){t===void 0&&(t=null);const e=this.animationManager,i=e.isEnabled;e.stopAnimation(),e.isEnabled=!1,this.Pr(),this.so=!1,this.qx=new Point(NaN,NaN),e.isEnabled=i,this.As=!0;const s=this;t!==null&&U.un(()=>{s.As=!1,e.Gl("Model"),t(s)},1)}requestUpdate(t){if(t===void 0&&(t=!1),this.Tr===!0||this.Ht||t===!1&&this.As)return;this.Tr=!0;const e=this;root.requestAnimationFrame(()=>{e.Tr&&e.maybeUpdate()})}maybeUpdate(){this.$u&&!this.Tr||(this.$u&&(this.$u=!1),this.Pr())}P2(t,e){!this._u||this.Ht||this.animationManager.defaultAnimation.isAnimating||this.hT()||(t&&this.Te(),e&&this.Js(!1))}Pr(t){if(this.As||(this.Tr=!1,this.Nt===null&&!this.td.isReal()))return;this.As=!0;const e=this.animationManager,i=this.od;if(!e.isAnimating&&i.length!==0){const c=i.r,f=c.length;for(let u=0;u<f;u++){const d=c[u];d.xi(!1),d.f()}i.clear()}const s=this.l2;s.count>0&&(s.each(c=>c.S2()),s.clear());let n=!1,o=!1;e.defaultAnimation.isAnimating&&(o=!0,n=this.skipsUndoManager,this.skipsUndoManager=!0),e.ke||this.NM(),t||this.P2(!1,!0);const r=!this.undoManager.isUndoingRedoing&&(this.Fl||this.nf.count!==0&&this.Or.size!==0),l=!this.so||this.Jr;this.Te(!0);let a=!1;(l||r)&&(this.so?this.M2(!this.$c,r):(this.startTransaction("Initial Layout"),e.isEnabled===!1&&e.stopAnimation(),this.M2(!1,r)),a=l),this.$c=!1,this.Fl=!1,this.Te(),this.ls!==null&&(this.ls.visible&&!this.ed&&(this.ca(),this.ed=!0),!this.ls.visible&&this.ed&&(this.ed=!1)),this.Lb||this.kO(),t||this.P2(!0,!1);let h=!1;if(a){const c=Rect.l();c.h(this.viewportBounds),this.so||(this.so=!0,h=!0,this.skipsUndoManager||(this.undoManager.Px=!0),this.undoManager.Sx=!0,this.PO()),this.SO(),this.Te(!1),t||this.P2(!0,!0),Rect.i(c)}else if(e.Bc&&e.Hx){if(this.Rr!==1)this.scale=this.hd(this.Rr);else if(this.ia!==1)this.scale=this.hd(this.ia);else{const c=this.initialScale;isFinite(c)&&c>0&&(this.scale=c)}this.Js(!0)}a&&h&&this.commitTransaction("Initial Layout"),t||this.Ge(this.Wt),o&&(this.skipsUndoManager=n),this.As=!1}get Qa(){return this.so}PO(){if(this.Rr!==1)this.scale=this.hd(this.Rr);else if(this.ia!==1)this.scale=this.hd(this.ia);else{const e=this.initialScale;isFinite(e)&&e>0&&(this.scale=e)}this.Js(!0);const t=this.Vt.r;this.rs(t,t.length,this,this.viewportBounds),this.T("InitialLayoutCompleted"),this.qx.h(this.ct),this.ca()}SO(){this.T("LayoutCompleted")}Cp(t){this.to.add(t)}addInvalidRoute(t){this.Uo?this.uh.add(t):this.Or.add(t)}Te(t){if(this.to.size!==0&&!(!this.As&&this.animationManager.isTicking)){if(this.As||(this.Fl=!0),t){this.fT(this.to);return}for(let e=0;e<23&&this.to.size!==0;e++){const i=new Set(this.to);this.to.clear(),this.S2(i,this.to)}this.nodes.each(e=>{e instanceof Group&&e.uT(!1)})}}fT(t,e){for(const i of t)!i.Di()||i instanceof Group||(i.Qr()?(i.ht(1/0,1/0),i.Ut()):e&&e.add(i));for(const i of t)if(i instanceof Group){if(!i.isVisible())continue;this.o1(i)}}S2(t,e){this.fT(t,e);for(const i of t){if(!(i instanceof Link))continue;const s=i;s.isVisible()&&(s.Qr()?(s.ht(1/0,1/0),s.Ut()):e.add(s))}for(const i of t)i instanceof Adornment&&i.isVisible()&&(i.Qr()?(i.ht(1/0,1/0),i.Ut()):e.add(i))}cd(t){const e=t instanceof Diagram,i=e?t.links:t.memberParts,s=this.to;if(e)this.Te(!0);else{for(;i.next();){const n=i.value;s.has(n)&&(!n.Di()||n instanceof Group||n.Qr()&&(n.ht(1/0,1/0),n.Ut()))}for(i.reset();i.next();){const n=i.value;if(s.has(n)&&n instanceof Group){if(!n.isVisible())continue;this.o1(n)}}i.reset()}for(;i.next();){const n=i.value;n instanceof Link&&s.has(n)&&n.isVisible()&&n.Qr()&&(n.ht(1/0,1/0),n.Ut())}}o1(t){const e=U.nt(),i=U.nt(),s=t.memberParts;for(;s.next();){const o=s.value;o.isVisible()&&(o instanceof Group?(o.Xo()||o.as()||o.fa())&&this.o1(o):o instanceof Link?o.fromNode===t||o.toNode===t?i.push(o):e.push(o):(o.ht(1/0,1/0),o.Ut()))}let n=e.length;for(let o=0;o<n;o++){const r=e[o];r.ht(1/0,1/0),r.Ut()}U.Z(e),t.ht(1/0,1/0),t.Ut(),n=i.length;for(let o=0;o<n;o++){const r=i[o];r.ht(1/0,1/0),r.Ut()}U.Z(i)}rs(t,e,i,s){if(!(!this._c&&!this.animationManager.isAnimating)){for(let n=0;n<e;n++)t[n].rs(i,s);this.Te()}}Ge(t){if(this.Nt===null)return;this.lt===null&&U.o("No canvas specified"),this.Qc==="svg"?this.MO(t):this.NO(t)}NO(t){const e=this.animationManager;if(e.ke||e.isAnimating&&!e.isTicking)return;const i=new Date;if(this.Lp(),this.Nt&&this.Nt.style.opacity==="0")return;const s=t!==this.Wt,n=this.Vt.r,o=n.length,r=this;if(this.rs(n,o,r,r.viewportBounds),s)t.clearContextCache(!0),this.ha();else if(!this.qi&&!e.isAnimating)return;const l=this.v,a=this.$e;t.setTransform(a,0,0,a,0,0),t.clearRect(0,0,this.wt,this.xt),this.Zt!==1&&(t.globalAlpha=this.Zt),this.N2(t);for(let m=0;m<o;m++)t.setTransform(a,0,0,a,0,0),t.transform(l.m11,l.m12,l.m21,l.m22,l.dx,l.dy),t.commitTransform(),n[m].Ge(t,r);let h=!1;this.sf?this.sf.Mh(this,t)&&(h=this.gp()):h=!0,h&&(Transform.prototype.Ci=Transform.prototype.Su),s?(this.Wt.clearContextCache(!0),this.ha()):(this._c=!1,this.qi=!1);const f=+new Date-+i,u=!1,d=this.u2;if(u||this.Ol===null){d[this.wp]=f,this.wp=(this.wp+1)%d.length;let m=0;for(let g=0;g<d.length;g++)m+=d[g];this.yp=m/d.length}if(this.Zt!==1&&(t.globalAlpha=1),u){t.setTransform(1,0,0,1,0,0);for(let m=0;m<d.length;m++)t.fillText(d[m].toString(),20,150+ +(m*20))}}MO(t){if(this.Nt===null)return;const e=this.animationManager;if(e.ke||e.isAnimating&&!e.isTicking)return;this.Lp();const i=this.wt,s=this.xt;t.surface.resize(i,s,i,s);const o=this.Vt.r,r=o.length,l=this;if(this.rs(o,r,l,l.viewportBounds),!this.qi&&!e.isAnimating)return;const a=this.v;t.lastDrawnPart=null,t.setDiagramPosScale(a.m11,a.m12,a.m21,a.m22,a.dx,a.dy),this.Zt!==1&&(t.globalAlpha=this.Zt),this.N2(t);const h=this.$e,c=this.lt._t;c.setTransform(h,0,0,h,0,0),c.clearRect(0,0,this.wt,this.xt);for(let u=0;u<r;u++)o[u].Ge(t,l);let f=!1;this.sf?this.sf.Mh(this,c)&&(f=this.gp()):f=!0,f&&(Transform.prototype.Ci=Transform.prototype.Su),this._c=!1,this.qi=!1}l1(t,e,i,s,n,o,r,l,a){o===void 0&&(o=null),r===void 0&&(r=null),l===void 0&&(l=!1),a===void 0&&(a=!1),this.Lp(),t.clearContextCache(!0),this.ha(),this.ph=!0;const h=this.it;this.it=s;const c=this,f=this.Vt.r,u=f.length;try{const d=new Rect(n.x,n.y,i.width/s,i.height/s),m=d.copy();m.addMargin(e),this.ca(m),this.Te(),this.rs(f,u,c,d),t.setTransform(1,0,0,1,0,0),t.clearRect(0,0,i.width,i.height),r!==null&&r!==""&&(t.fillStyle=r,t.fillBackground(0,0,i.width,i.height));const g=Transform.l();g.Ue(),g.Xs(e.left,e.top),g.it(s),(n.x!==0||n.y!==0)&&g.Xs(-n.x,-n.y),t.setTransform(g.m11,g.m12,g.m21,g.m22,g.dx,g.dy),t.commitTransform(),t instanceof SVGContext&&t.setDiagramPosScale(g.m11,g.m12,g.m21,g.m22,g.dx,g.dy),Transform.i(g),this.N2(t),t.globalAlpha=this.Zt;const p=this.findLayer("Grid");if(o){const y=new GSet,x=o.iterator;for(x.reset();x.next();){const b=x.value;b instanceof Part&&(!a&&b.layer===p||(b.jc(),y.add(b)))}for(let b=0;b<u;b++)f[b].ER(t,c,y,l);y.each(b=>b.jc())}else for(let y=0;y<u;y++){const x=f[y];x===p?a&&x.Ge(t,c,!0):x.Ge(t,c,l)}this.ph=!1,this.sf&&this.Wt&&this.sf.Mh(this,this.Wt)&&this.gp()}finally{this.it=h,t.clearContextCache(!0),this.ha(),this.rs(f,u,c,c.viewportBounds),this.ca(),this.Wt instanceof SVGContext&&(this.Wt.diagramGroup.replaceChildren(),this.redraw())}}getRenderingHint(t){return this.Fr[t]}setRenderingHint(t,e){t==="minDrawingLength"&&(this._m=e),this.Fr[t]=e,this.redraw()}resetRenderingHints(){this.Fr=new PropertyCollection,this.Fr.drawShadows=!0,this.Fr.textGreeking=!0,this.Fr.viewportOptimizations=!U.fr,this.Fr.temporaryPixelRatio=!0,this.Fr.pictureRatioOptimization=!0,this.Fr.minDrawingLength=1,this._m=1}N2(t){const e=this.Fr;if(e===null)return;if(e.imageSmoothingEnabled!==void 0){const s=!!e.imageSmoothingEnabled;t.setImageSmoothingEnabled(s)}const i=e.defaultFont;i!=null&&(t.font=i)}getInputOption(t){return this.Wu[t]}setInputOption(t,e){this.Wu[t]=e}QR(){this.Wu=new PropertyCollection,this.Wu.extraTouchArea=10,this.Wu.extraTouchThreshold=10,this.Wu.hasGestureZoom=!0}set(t){return t?(Object.assign(this,t),this):this}attach(t){return this.setProperties(t)}setProperties(t){return Diagram.Ap(this,t),this}static Ap(t,e){if(!e)return;const i=t instanceof Panel,s=t instanceof Diagram;for(const n in e){n===""&&U.o("Setting properties requires non-empty property names");let o=t,r=n;if(i||s){const a=n.indexOf(".");if(a>0){const h=n.substring(0,a);i?o=t.findObject(h):(o=t[h],o==null&&(o=t.toolManager[h])),U.$(o)?r=n.substring(a+1):U.o("Unable to find object named: "+h+" in "+t.toString()+" when trying to set property: "+n)}}if(r[0]!=="_"&&!U.qw(o,r))if(s&&r==="ModelChanged"){t.addModelChangedListener(e[r]);continue}else if(s&&r==="Changed"){t.addChangedListener(e[r]);continue}else if(s&&U.qw(t.toolManager,r))o=t.toolManager;else if(s&&t.dT(r)){t.addDiagramListener(r,e[r]);continue}else if(t instanceof Model&&r==="Changed"){t.addChangedListener(e[r]);continue}else U.o('Trying to set undefined property "'+r+'" on object: '+o.toString());const l=e[n];o[r]=l,r[0]==="_"&&o instanceof GraphObject&&o.addCopyProperty(r)}}zA(){if(this.ra.count!==0&&!(this.undoManager.transactionLevel>1)){for(;this.ra.count>0;){const t=this.ra;this.ra=new GMap;const e=t.iterator;for(;e.next();){const i=e.key;i.invalidateOtherJumpOvers(e.value),i.ai()}}this.C()}}C(t){if(t===void 0)this.qi=!0,this.requestUpdate();else{const e=this.viewportBounds;t.isReal()&&e.intersectsRect(t)&&(this.qi=!0,this.requestUpdate())}this.T("InvalidateDraw")}invalidateViewport(t,e){if(this.qi===!0)return;if(this.qi=!0,this.Qc==="svg"){this.maybeUpdate();return}this.getRenderingHint("temporaryPixelRatio")===!0?(this.Cx(),this.maybeUpdate(),this.yS(!0)):this.maybeUpdate()}Nh(){this._u=!0}ha(){this._c=!0}Lp(){this.Ju!==!1&&(this.Ju=!1,this.lT(this.wt,this.xt))}lT(t,e){this.aa();const i=this.$e,s=t*i,n=e*i;this.lt.resize(s,n,t,e)&&(this.qi=!0,this.Wt.clearContextCache(!0))}hT(){const t=this.lt;if(t===null||this.td.isReal())return!0;const e=this.wt,i=this.xt,s=this.Nt;let n=!1,o=this.io?this.jt:0,r=this.kn?this.jt:0,l=s.clientWidth||e+o,a=s.clientHeight||i+r;const h=this.viewportBounds,c=h.x,f=h.y,u=h.width,d=h.height;if((l!==e+o||a!==i+r)&&(this.io=!1,this.kn=!1,o=0,r=0,this.wt=l,this.xt=a,this.Ju=!0,n=!0,this.aa()),!this.so||!this.viewportBounds.isReal())return!0;const m=this.Wb,g=this.Jb;if(this._u=!1,!n&&!this.io&&!this.kn&&!this.Zu&&!this.Qu)return!0;const p=this.documentBounds;let y=0,x=0,b=0,k=0;const P=h.width,S=h.height,L=this.fh;this.contentAlignment.isSpot()?(p.width>P&&(y=L.left,x=L.right),p.height>S&&(b=L.top,k=L.bottom)):(y=L.left,x=L.right,b=L.top,k=L.bottom);const C=p.width+y+x,M=p.height+b+k,N=this.scale,A=N;let T=C>l/N,D=M>a/N;if(!n&&!this.io&&!this.kn&&!T&&!D)return!0;const v=p.x-y,R=h.x,F=p.right+x;let O=h.right+o;const z=p.y-b,Y=h.y,E=p.bottom+k;let X=h.bottom+r,B="1px",H="1px";if(this.scrollMode===1&&(T||D)){if(T&&this.hasHorizontalScrollbar&&this.allowHorizontalScroll){let V=1;v+1<R&&(V=Math.max((R-v)*N+this.wt,V)),F>O+1&&(V=Math.max((F-O)*N+this.wt,V)),P+o+1<C&&(V=Math.max((C-P)*N+this.wt,V)),B=V.toString()+"px"}if(D&&this.hasVerticalScrollbar&&this.allowVerticalScroll){let V=1;z+1<Y&&(V=Math.max((Y-z)*N+this.xt,V)),E>X+1&&(V=Math.max((E-X)*N+this.xt,V)),S+r+1<M&&(V=Math.max((M-S)*N+this.xt,V)),H=V.toString()+"px"}}let q=B!=="1px",W=H!=="1px";if(!(q&&W)&&(q||W)){if(T=!(C<P+o),D=!(M<S+r),W&&(O-=this.jt),q&&(X-=this.jt),T&&this.hasHorizontalScrollbar&&this.allowHorizontalScroll){let $=1;v+1<R&&($=Math.max((R-v)*N+this.wt,$)),F>O+1&&($=Math.max((F-O)*N+this.wt,$)),P+1<C&&($=Math.max((C-P)*N+this.wt,$)),B=$.toString()+"px"}q=B!=="1px";let V=this.xt;if(q!==this.kn&&(V=q?this.xt-this.jt:this.xt+this.jt),D&&this.hasVerticalScrollbar&&this.allowVerticalScroll){let $=1;z+1<Y&&($=Math.max((Y-z)*N+V,$)),E>X+1&&($=Math.max((E-X)*N+V,$)),S+1<M&&($=Math.max((M-S)*N+V,$)),H=$.toString()+"px"}W=H!=="1px"}if(this.rp&&!(q!==this.kn||W!==this.io))return(e!==this.wt||i!==this.xt)&&this.maybeUpdate(),!1;if(q!==this.kn&&(B==="1px"?this.xt=this.xt+this.jt:this.xt=Math.max(this.xt-this.jt,1),n=!0),this.kn=q,g.style.width=B,W!==this.io&&(H==="1px"?this.wt=this.wt+this.jt:this.wt=Math.max(this.wt-this.jt,1),n=!0,this.rd)){const V=Point.l();W?(t.style.left=this.jt+"px",this.position=V.e(this.ct.x+this.jt/this.scale,this.ct.y)):(t.style.left="0px",this.position=V.e(this.ct.x-this.jt/this.scale,this.ct.y)),Point.i(V)}n&&this.aa(),this.io=W,g.style.height=H,this.Bb=!0,n&&(this.Ju=!0);let Z=m.scrollLeft;if(this.hasHorizontalScrollbar&&this.allowHorizontalScroll&&(P+1<C?Z=(this.position.x-v)*N:v+1<R?Z=m.scrollWidth-m.clientWidth:F>O+1&&(Z=this.position.x*N)),this.rd)switch(this.lb){case"negative":Z=-(m.scrollWidth-Z-m.clientWidth);break;case"reverse":Z=m.scrollWidth-Z-m.clientWidth;break}if(m.scrollLeft=Z,this.hasVerticalScrollbar&&this.allowVerticalScroll&&(S+1<M?m.scrollTop=(this.position.y-z)*N:z+1<Y?m.scrollTop=m.scrollHeight-m.clientHeight:E>X+1&&(m.scrollTop=this.position.y*N)),l=this.wt,a=this.xt,m.style.width=l+(this.io?this.jt:0)+"px",m.style.height=a+(this.kn?this.jt:0)+"px",e!==l||i!==a||this.animationManager.ke){const V=Rect.z(c,f,u,d);return this.onViewportBoundsChanged(V,this.viewportBounds,A,n),Rect.i(V),!1}return!0}add(t){const e=t.diagram;if(e===this)return;e!==null&&U.o("Cannot add part "+t.toString()+" to "+this.toString()+". It is already a part of "+e.toString());let i=this.findLayer(t.layerName);if(i===null&&(i=this.findLayer("")),i===null&&U.o('Cannot add a Part when unable find a Layer named "'+t.layerName+'" and there is no default Layer'),t.layer===i)return;const s=i.ch(99999999,t,t.diagram===this);s>=0&&this.raiseChangedEvent(3,"parts",i,null,t,null,s),i.isTemporary||this.invalidateDocumentBounds(),t.invalidateLayout(1);const n=t.layerChanged;n!==null&&n(t,null,i)}ch(t){this.partManager.ch(t);const e=this;Diagram.isUsingDOM()&&t.Pn(s=>e.gT(s)),t.data||t.Go(),t.hasPlaceholder()&&t.f(),t.data!==null&&t.Pn(s=>e.partManager.C2(s,null)),(t.as()===!0||t.fa()===!0)&&this.Cp(t),t.mT(!0,this),t instanceof Node&&t.canAvoid()&&this.fd(t),t.pT()?(t.actualBounds.isReal()&&this.C(t.hh(t.actualBounds)),this.invalidateDocumentBounds()):t.isVisible()&&t.actualBounds.isReal()&&this.C(t.hh(t.actualBounds)),this.kp!==null&&this.kp(this,t),this.requestUpdate()}ri(t){t.clearAdornments(),this.partManager.ri(t);const e=this;t.data!==null&&t.Pn(s=>e.partManager.L2(s,e)),this.to.delete(t),t instanceof Link?this.Or.delete(t):t instanceof Node&&t.canAvoid()&&this.fd(t),t.pT()?(t.actualBounds.isReal()&&this.C(t.hh(t.actualBounds)),this.invalidateDocumentBounds()):t.isVisible()&&t.actualBounds.isReal()&&this.C(t.hh(t.actualBounds)),this.Pp!==null&&this.Pp(this,t),this.requestUpdate()}remove(t){this.A2(t,!0)}A2(t,e){const i=t.layer;if(i===null||i.diagram!==this)return;t.isSelected=!1,t.isHighlighted=!1,t.invalidateLayout(2),e&&t.rf();const s=i.ri(-1,t,!1);s>=0&&this.raiseChangedEvent(4,"parts",i,t,null,s,null);const n=t.layerChanged;n!==null&&n(t,i,null)}removeParts(t,e){if(e===void 0&&(e=!1),Array.isArray(t)){const i=t.length;for(let s=0;s<i;s++){const n=t[s];e&&!n.canDelete()||this.remove(n)}}else{const i=new GSet;i.addAll(t);const s=i.iterator;for(;s.next();){const n=s.value;e&&!n.canDelete()||this.remove(n)}}}copyParts(t,e,i){i===void 0&&(i=!1);let s=null;const n=e||this,o=n.model;let r=!1,l=!1;try{o.Vm()&&(r=o.copiesParentKeyOfNodeData,o.copiesParentKeyOfNodeData=n.commandHandler.copiesParentKey),(o.Um()||o.a1())&&(l=o.copiesGroupKeyOfNodeData,o.copiesGroupKeyOfNodeData=n.commandHandler.copiesGroupKey),s=this.partManager.copyParts(t,e,i)}finally{o.Vm()&&(o.copiesParentKeyOfNodeData=r),(o.Um()||o.a1())&&(o.copiesGroupKeyOfNodeData=l)}return s}moveParts(t,e,i,s){if(i===void 0&&(i=!1),s===void 0&&(s=this.Tp()),this.toolManager===null)return;const o=new GMap;if(t!==null)if(Array.isArray(t))for(let r=0;r<t.length;r++)this._r(o,t[r],i,s);else{const r=t.iterator;for(;r.next();)this._r(o,r.value,i,s)}else{let r=this.parts;for(;r.next();){const l=r.value;this._r(o,l,i,s)}for(r=this.nodes;r.next();){const l=r.value;this._r(o,l,i,s)}for(r=this.links;r.next();){const l=r.value;this._r(o,l,i,s)}}this.Lx(o,e,s,i)}_r(t,e,i,s,n){if(!t.has(e)&&(n===void 0&&(n=!1),!(i&&!n&&!e.canMove()&&!e.canCopy())))if(s===void 0&&(s=this.Tp()),e instanceof Node){if(t.set(e,this.js(s,e,e.location)),e instanceof Group&&(e.hasPlaceholder()||s.dragsMembers)){const r=e.memberParts;for(;r.next();){const l=r.value;this._r(t,l,i,s,s.groupsAlwaysMove)}}const o=e.linksConnected;for(;o.next();){const r=o.value;if(t.has(r))continue;const l=r.fromNode,a=r.toNode;l!==null&&t.has(l)&&a!==null&&t.has(a)&&this._r(t,r,i,s)}if(s.dragsTree){const r=e.findTreeChildrenNodes();for(;r.next();){const l=r.value;this._r(t,l,i,s)}}}else if(e instanceof Link){t.set(e,this.js(s,e));const o=e.labelNodes;for(;o.next();){const r=o.value;this._r(t,r,i,s)}}else e instanceof Adornment||t.set(e,this.js(s,e,e.location))}Lx(t,e,i,s){if(t===null||t.count===0)return;const n=Point.l(),o=Point.l();o.h(e),isNaN(o.x)&&(o.x=0),isNaN(o.y)&&(o.y=0);const r=this.Qb;r||this.gA(t);const l=U.nt(),a=U.nt(),h=t.iterator;let c=Point.l();for(;h.next();){const g=h.key,p=h.value;if(g.Di()){const y=this.yT(g,t);if(y!==null)l.push(new DraggingNodeInfoPair(g,p,y));else if(!s||g.canMove()){const x=p.point;n.h(x),this.computeMove(g,n.add(o),i,c),g.location=c,p.shifted===void 0&&(p.shifted=new Point),p.shifted.h(c.subtract(x))}}else h.key instanceof Link&&a.push(new KeyValuePair(h.key,h.value))}Point.i(c);const f=l.length;for(let g=0;g<f;g++){const p=l[g],y=p.wT.point;n.h(y),p.h1.shifted===void 0&&(p.h1.shifted=new Point),p.Ri.location=n.add(p.h1.shifted)}const u=Point.l(),d=Point.l(),m=a.length;for(let g=0;g<m;g++){const p=a[g],y=p.key;if(y instanceof Link){if(y.suspendsRouting){y.Dr=null;const x=y.fromNode,b=y.toNode;if(this.draggedLink!==null&&i.dragsLink){const k=p.value.point;if(y.dragComputation===null){t.set(y,this.js(i,y,o));const P=o.x-k.x,S=o.y-k.y;y.kr(P,S)}else{const P=Point.z(0,0),S=y.getPoint(0);S&&S.isReal()&&P.h(S),c=Point.l().h(P).add(o);let L=c;i.isGridSnapEnabled&&(i.isGridSnapRealtime||this.lastInput.up)&&(L=Point.l(),this.aM(y,c,L,i)),c.h(y.dragComputation(y,c,L)).subtract(P),t.set(y,this.js(i,y,c));const C=c.x-k.x,M=c.y-k.y;y.kr(C,M),Point.i(P),Point.i(c),L!==c&&Point.i(L)}}else{if(x!==null){u.h(x.location);const k=t.get(x);k!==null&&u.subtract(k.point)}if(b!==null){d.h(b.location);const k=t.get(b);k!==null&&d.subtract(k.point)}if(x!==null&&b!==null){const k=p.value.point;if(u.equalsApprox(d)||y.computeAdjusting()!==0){const P=n;P.h(u),P.subtract(k),t.set(y,this.js(i,y,u)),y.kr(P.x,P.y)}else y.suspendsRouting=!1,y.$t()}else{const k=p.value.point;let P;x!==null?P=u:b!==null?P=d:P=o,t.set(y,this.js(i,y,P));const S=P.x-k.x,L=P.y-k.y;y.kr(S,L)}}}else if(y.fromNode===null||y.toNode===null){const x=p.value.point;t.set(y,this.js(i,y,o));const b=o.x-x.x,k=o.y-x.y;y.kr(b,k)}}}Point.i(n),Point.i(o),Point.i(u),Point.i(d),U.Z(l),U.Z(a),r||(this.Te(),this.pS(t))}computeMove(t,e,i,s){if(s===void 0&&(s=new Point),s.h(e),t===null)return s;let n=e;const o=i.isGridSnapEnabled;o&&(i.isGridSnapRealtime||this.lastInput.up)&&(n=Point.l(),this.aM(t,e,n,i));const r=t.dragComputation!==null?t.dragComputation(t,e,n):n,l=t.minLocation;let a=l.x;isNaN(a)&&(a=o?Math.round(t.location.x*1e3)/1e3:t.location.x);let h=l.y;isNaN(h)&&(h=o?Math.round(t.location.y*1e3)/1e3:t.location.y);const c=t.maxLocation;let f=c.x;isNaN(f)&&(f=o?Math.round(t.location.x*1e3)/1e3:t.location.x);let u=c.y;return isNaN(u)&&(u=o?Math.round(t.location.y*1e3)/1e3:t.location.y),s.e(Math.max(a,Math.min(r.x,f)),Math.max(h,Math.min(r.y,u))),n!==e&&Point.i(n),s}Tp(){const t=this.toolManager.findTool("Dragging");return t instanceof DraggingTool?t.dragOptions:this.ld}aM(t,e,i,s){if(s===void 0&&(s=this.Tp()),i.h(e),t===null)return i;const n=this.grid,o=s.gridSnapCellSize;let r=o.width,l=o.height;const a=s.gridSnapOrigin;let h=a.x,c=a.y;const f=s.gridSnapCellSpot;if(n!==null){const d=n.gridCellSize;isNaN(r)&&(r=d.width),isNaN(l)&&(l=d.height);const m=n.gridOrigin;isNaN(h)&&(h=m.x),isNaN(c)&&(c=m.y)}const u=Point.z(0,0);return u.setSpot(0,0,r,l,f),G.tm(e.x,e.y,h+u.x,c+u.y,r,l,i),Point.i(u),i}gA(t){if(t===null)return;this.Qb=!0;const e=t.iterator;for(;e.next();){const i=e.key;i instanceof Link&&(i.suspendsRouting=!0)}}pS(t){if(t===null)return;const e=t.iterator;for(;e.next();){const i=e.key;i instanceof Link&&(i.suspendsRouting=!1,i.xT()&&i.$t())}this.Qb=!1}get draggedLink(){return this._b}set draggedLink(t){this._b!==t&&(this._b=t,t!==null&&(this.t1=t.fromPort,this.e1=t.toPort))}get PS(){return this.t1}set PS(t){this.t1=t}get SS(){return this.e1}set SS(t){this.e1=t}yT(t,e){const i=t.containingGroup;if(i!==null){let s=this.yT(i,e);if(s!==null||(s=e.get(i),s!==null))return s}return null}js(t,e,i){if(i===void 0)return new DraggingInfo(Point.dn);let s=t.isGridSnapEnabled;return!t.groupsSnapMembers&&e.containingGroup!==null&&(s=!1),s?new DraggingInfo(new Point(Math.round(i.x*1e3)/1e3,Math.round(i.y*1e3)/1e3)):new DraggingInfo(i.copy())}T2(t,e){if(t.diagram!==null&&t.diagram!==this&&U.o("Cannot share a Layer with another Diagram: "+t+" of "+t.diagram),e===null?t.diagram!==null&&U.o("Cannot add an existing Layer to this Diagram again: "+t):(e.diagram!==this&&U.o("Existing Layer must be in this Diagram: "+e+" not in "+e.diagram),t===e&&U.o("Cannot move a Layer before or after itself: "+t)),t.diagram===this)return;const i=t.name,s=this.Vt,n=s.count;for(let o=0;o<n;o++)s.elt(o).name===i&&U.o("Cannot add Layer with the name '"+i+"'; a Layer with the same name is already present in this Diagram.")}addLayer(t){this.T2(t,null),t.Io(this);const e=this.Vt;let i=e.count-1;if(!t.isTemporary)for(;i>=0&&e.elt(i).isTemporary;)i--;return e.insertAt(i+1,t),this.Ce!==null&&this.raiseChangedEvent(3,"layers",this,null,t,null,i+1),this.C(),this.invalidateDocumentBounds(),this}addLayerBefore(t,e){this.T2(t,e),t.Io(this);const i=this.Vt,s=i.indexOf(t);s>=0&&(i.delete(t),this.Ce!==null&&this.raiseChangedEvent(4,"layers",this,t,null,s,null));const n=i.count;let o;for(o=0;o<n;o++)if(i.elt(o)===e){i.insertAt(o,t);break}return this.Ce!==null&&this.raiseChangedEvent(3,"layers",this,null,t,null,o),this.C(),s<0&&this.invalidateDocumentBounds(),this}addLayerAfter(t,e){this.T2(t,e),t.Io(this);const i=this.Vt,s=i.indexOf(t);s>=0&&(i.delete(t),this.Ce!==null&&this.raiseChangedEvent(4,"layers",this,t,null,s,null));const n=i.count;let o;for(o=0;o<n;o++)if(i.elt(o)===e){i.insertAt(o+1,t);break}return this.Ce!==null&&this.raiseChangedEvent(3,"layers",this,null,t,null,o+1),this.C(),s<0&&this.invalidateDocumentBounds(),this}Zr(t,e){t.Io(this),this.Vt.insertAt(e,t)}bT(t){this.Vt.removeAt(t)}removeLayer(t){if(t.diagram!==this&&U.o("Cannot remove a Layer from another Diagram: "+t+" of "+t.diagram),t.name==="")return;const e=this.Vt,i=e.indexOf(t);if(e.delete(t)){const n=t.Ct.copy().iterator;for(;n.next();){const o=n.value,r=o.layerName;r!==t.name?o.layerName=r:o.layerName=""}this.Ce!==null&&this.raiseChangedEvent(4,"layers",this,t,null,i,null),this.C(),this.invalidateDocumentBounds()}}findLayer(t){const e=this.layers;for(;e.next();){const i=e.value;if(i.name===t)return i}return null}findRouter(t){for(const e of this.nf)if(e.name===t)return e;return null}addModelChangedListener(t){return U.S(t,Diagram,"addModelChangedListener:listener"),this.eo===null&&(this.eo=new List),this.eo.add(t),this.model&&this.model.addChangedListener(t),this}removeModelChangedListener(t){U.S(t,Diagram,"removeModelChangedListener:listener"),this.eo!==null&&(this.eo.delete(t),this.eo.count===0&&(this.eo=null)),this.model.removeChangedListener(t)}addChangedListener(t){return U.S(t,Diagram,"addChangedListener:listener"),this.Ir===null&&(this.Ir=new List),this.Ir.add(t),this}removeChangedListener(t){U.S(t,Diagram,"removeChangedListener:listener"),this.Ir!==null&&(this.Ir.delete(t),this.Ir.count===0&&(this.Ir=null))}D2(t){if(!this.skipsUndoManager&&!this.model.skipsUndoManager&&this.model.undoManager.handleChanged(t),t.change!==1&&(this.isModified=!0),this.Ir!==null){const e=this.Ir,i=e.length;for(let s=0;s<i;s++)e.elt(s)(t)}}raiseChangedEvent(t,e,i,s,n,o,r){o===void 0&&(o=null),r===void 0&&(r=null);const l=new ChangedEvent;l.diagram=this,l.change=t,l.propertyName=e,l.object=i,l.oldValue=s,l.oldParam=o,l.newValue=n,l.newParam=r,this.D2(l)}raiseChanged(t,e,i,s,n){this.raiseChangedEvent(2,t,this,e,i,s,n)}t(t,e,i,s,n){this.raiseChangedEvent(2,t,this,e,i,s,n)}get partAdded(){return this.kp}set partAdded(t){this.partAdded!==t&&(this.kp=t)}get partRemoved(){return this.Pp}set partRemoved(t){this.partRemoved!==t&&(this.Pp=t)}get animationManager(){return this.Ns}get undoManager(){return this.Ce.undoManager}get skipsUndoManager(){return this.Vo}set skipsUndoManager(t){U.s(t,"boolean",Diagram,"skipsUndoManager"),this.Vo=t,this.Ce.skipsUndoManager=t}get delaysLayout(){return this.Ab}set delaysLayout(t){this.Ab=t}iA(t,e){if(t===null||t.diagram!==this)return;const i=this.wi;try{this.wi=!0;const s=t.change;if(s===2){const n=t.object,o=t.propertyName,r=t.getValue(e);if(t.diagram.model.et(n,o,r),n instanceof GraphObject){const l=n.part;l!==null&&(l.invalidateAdornments(),l instanceof Link&&(l.fromNode?.Ze(l.fromPort),l.toNode?.Ze(l.toPort)))}this.isModified=!0}else if(s===3){const n=t.object,o=t.newParam,r=t.newValue;if(n instanceof Panel)if(typeof o=="number"&&r instanceof GraphObject){e?n.ri(o):n.insertAt(o,r);const l=n.part;l!==null&&l.invalidateAdornments()}else typeof o=="number"&&r instanceof RowColumnDefinition&&(r.isRow?n.kT(o,e?void 0:r):n.PT(o,e?void 0:r));else if(n instanceof Layer){const l=t.oldParam===!0;typeof o=="number"&&r instanceof Part&&(e?(l||(r.isSelected=!1,r.isHighlighted=!1,r.invalidateAdornments()),n.ri(l?o:-1,r,l)):n.ch(o,r,l))}else n instanceof Diagram?typeof o=="number"&&r instanceof Layer&&(e?this.bT(o):this.Zr(r,o)):U.o("unknown ChangeType.Insert object: "+t.toString());this.isModified=!0}else if(s===4){const n=t.object,o=t.oldParam,r=t.oldValue;if(n instanceof Panel)typeof o=="number"&&r instanceof GraphObject?e?n.insertAt(o,r):n.ri(o):typeof o=="number"&&r instanceof RowColumnDefinition&&(r.isRow?n.kT(o,e?r:void 0):n.PT(o,e?r:void 0));else if(n instanceof Layer){const l=t.newParam===!0;typeof o=="number"&&r instanceof Part&&(e?n.Ct.indexOf(r)<0&&n.ch(o,r,l):(l||(r.isSelected=!1,r.isHighlighted=!1,r.invalidateAdornments()),n.ri(l?o:-1,r,l)))}else n instanceof Diagram?typeof o=="number"&&r instanceof Layer&&(e?this.Zr(r,o):this.bT(o)):U.o("unknown ChangeType.Remove object: "+t.toString());this.isModified=!0}else s===1||U.o("unknown ChangedEvent: "+t.toString())}finally{this.wi=i}}startTransaction(t){return this.undoManager.startTransaction(t)}commitTransaction(t){return this.undoManager.commitTransaction(t)}rollbackTransaction(){return this.undoManager.rollbackTransaction()}commit(t,e){let i=e;i===void 0&&(i="");const s=this.skipsUndoManager;i===null&&(this.skipsUndoManager=!0,i=""),this.undoManager.startTransaction(i);let n=!1;try{t(this),n=!0}finally{n?this.undoManager.commitTransaction(i):this.undoManager.rollbackTransaction(),this.skipsUndoManager=s}}updateAllTargetBindings(t){this.partManager.updateAllTargetBindings(t)}updateAllThemeBindings(){if(this.partManager.updateAllThemeBindings(),this.ls!==null){const t=this.ls.part;t!==null&&t.Go()}}setDivBackground(t){this.div&&(this.div.style.backgroundColor=t)}updateAllRelationshipsFromData(){this.partManager.updateAllRelationshipsFromData()}Np(){const t=this.v,e=this.it,i=this.ct;t.Ue(),e!==1&&t.it(e),(i.x!==0||i.y!==0)&&t.Xs(-i.x,-i.y)}ST(t,e){const i=this.animationManager;if(this.Ht||this.As){this.it=e,this.aa(),this.C(),this.Nh(),i.VA(t,this.it),this.Np();return}if(this.lt===null){this.it=e,this.Np();return}this.Ht=!0;const n=this.viewportBounds.copy(),o=this.wt,r=this.xt;let l=this.zoomPoint.x,a=this.zoomPoint.y;const h=this.contentAlignment;isNaN(l)&&(h.isSide()?h.includesSide(Spot.LeftSide)?l=0:h.includesSide(Spot.RightSide)&&(l=o-1):h.isSpot()?l=h.x*(o-1):l=o/2),isNaN(a)&&(h.isSide()?h.includesSide(Spot.TopSide)?a=0:h.includesSide(Spot.BottomSide)&&(a=r-1):h.isSpot()?a=h.y*(r-1):a=r/2),this.scaleComputation!==null&&!this.animationManager.defaultAnimation.isAnimating&&(e=this.scaleComputation(this,e)),e<this.minScale&&(e=this.minScale),e>this.maxScale&&(e=this.maxScale);const c=Point.z(this.ct.x+l/t-l/e,this.ct.y+a/t-a/e);this.position=c,Point.i(c),this.it=e,this.Np(),this.aa(),this.Ht=!1,this.onViewportBoundsChanged(n,this.viewportBounds,t,!1),this.Js(!1),i.VA(t,this.it),this.C()}yO(){const t=this.Vt.r;for(let e=0;e<t.length;e++)t[e].HA()}onViewportBoundsChanged(t,e,i,s){if(t.equals(e))return;s===void 0&&(s=!1),s||this.Nh(),this.ha();const n=this.layout;n!==null&&n.isViewportSized&&this.autoScale===1&&(t.width!==e.width||t.height!==e.height)&&n.p();const o=this.currentTool;this.ef===!0&&o instanceof ToolManager&&!this.animationManager.isTicking&&(this.lastInput.documentPoint=this.transformViewToDoc(this.lastInput.viewPoint),o.uA(this)),this.Ht||this.invalidateViewport(t,e),this.ca();const r=this.Vt.r;this.rs(r,r.length,this,this.viewportBounds),this.Ye.scale=i,this.Ye.position.x=t.x,this.Ye.position.y=t.y,this.Ye.bounds.h(t),this.Ye.canvasSize.width=Math.round(t.width*i),this.Ye.canvasSize.height=Math.round(t.height*i),this.Ye.newCanvasSize.width=this.wt,this.Ye.newCanvasSize.height=this.xt,this.Ye.isScroll=s,this.T("ViewportBoundsChanged",this.Ye,t),this.isVirtualized&&this.links.each(l=>{l.isAvoiding&&l.actualBounds.intersectsRect(e)&&l.$t()})}ca(t){const e=this.ls;if(e===null||!e.visible||e.part===null||e.layer===null)return;const i=t!==void 0?t:this.Yb;if(!i.isReal())return;const s=i.width,n=i.height;if(e.scale=1,e.angle=0,e.layer.isViewportAligned)e.width=s*this.scale,e.height=n*this.scale,e.part.alignment=Spot.TopLeft;else{e.Pe===null&&(e.Pe=new GridPanelSettings);const o=e.Pe.lf;if(!o.isReal())return;e.width=s+o.width*2,e.height=n+o.height*2;const r=Point.l();G.tm(i.x,i.y,0,0,o.width,o.height,r),r.offset(-o.width,-o.height),e.part.location=r,Point.i(r)}}clearSelection(t){t===void 0&&(t=!1);const e=this.selection;if(e.count===0)return;t||this.T("ChangingSelection",e);const i=e.toArray(),s=i.length;for(let n=0;n<s;n++){const o=i[n];o.isSelected=!1}e.ce(),e.clear(),e.k(),t||this.T("ChangedSelection",e)}select(t){t!==null&&t.diagram===this&&(!t.isSelected||this.selection.count>1)&&(this.T("ChangingSelection",this.selection),this.clearSelection(!0),t.isSelected=!0,this.T("ChangedSelection",this.selection))}selectCollection(t){if(this.T("ChangingSelection",this.selection),this.clearSelection(!0),Array.isArray(t)){const e=t.length;for(let i=0;i<e;i++){const s=t[i];s instanceof Part||U.o("Diagram.selectCollection given something that is not a Part: "+s),s.isSelected=!0}}else{const e=t.iterator;for(;e.next();){const i=e.value;i instanceof Part||U.o("Diagram.selectCollection given something that is not a Part: "+i),i.isSelected=!0}}this.T("ChangedSelection",this.selection)}clearHighlighteds(){const t=this.highlighteds;if(t.count>0){const e=t.toArray(),i=e.length;for(let s=0;s<i;s++){const n=e[s];n.isHighlighted=!1}t.ce(),t.clear(),t.k()}}highlight(t){t!==null&&t.diagram===this&&(!t.isHighlighted||this.highlighteds.count>1)&&(this.clearHighlighteds(),t.isHighlighted=!0)}highlightCollection(t){const e=new GSet().addAll(t),s=this.highlighteds.copy().removeAll(e).iterator;for(;s.next();){const o=s.value;o.isHighlighted=!1}const n=e.iterator;for(;n.next();){const o=n.value;o instanceof Part||U.o("Diagram.highlightCollection given something that is not a Part: "+o),o.isHighlighted=!0}}scroll(t,e,i){i===void 0&&(i=1);const s=e==="up"||e==="down";let n=0;const o=Point.l();if(t==="pixel")n=i;else if(t==="line")n=i*(s?this.scrollVerticalLineChange:this.scrollHorizontalLineChange);else if(t==="page"){let l=s?this.viewportBounds.height:this.viewportBounds.width;if(l*=this.scale,l!==0){const a=Math.max(l-(s?this.scrollVerticalLineChange:this.scrollHorizontalLineChange),0);n=i*a}}else if(t==="document"){const l=this.documentBounds,a=this.viewportBounds;e==="up"?this.position=o.e(a.x,l.y):e==="left"?this.position=o.e(l.x,a.y):e==="down"?this.position=o.e(a.x,l.bottom-a.height):e==="right"&&(this.position=o.e(l.right-a.width,a.y)),Point.i(o);return}else U.o("scrolling unit must be 'pixel', 'line', 'page', or 'document', not: "+t);n/=this.scale;const r=this.position;e==="up"?this.position=o.e(r.x,r.y-n):e==="down"?this.position=o.e(r.x,r.y+n):e==="left"?this.position=o.e(r.x-n,r.y):e==="right"?this.position=o.e(r.x+n,r.y):U.o("scrolling direction must be 'up', 'down', 'left', or 'right', not: "+e),Point.i(o)}scrollToRect(t){const e=this.viewportBounds;if(e.containsRect(t))return;const i=t.center;i.x-=e.width/2,i.y-=e.height/2,this.position=i}centerRect(t){const e=this.viewportBounds,i=t.center;i.x-=e.width/2,i.y-=e.height/2,this.position=i}transformDocToView(t){return t.copy().v(this.v)}transformViewToDoc(t){return t.copy().Yi(this.v)}YR(t){return t.Yi(this.v)}static None=1;static Uniform=2;static UniformToFill=3;static CycleAll=1;static CycleNotDirected=2;static CycleNotDirectedFast=3;static CycleNotUndirected=4;static CycleDestinationTree=5;static CycleSourceTree=6;static DocumentScroll=1;static InfiniteScroll=2;static TreeParentCollapsed=1;static AllParentsCollapsed=2;static AnyParentsCollapsed=3;get opacity(){return this.Zt}set opacity(t){const e=this.Zt;e!==t&&(U.s(t,"number",Diagram,"opacity"),(t<0||t>1)&&U.J(t,"0 <= value <= 1",Diagram,"opacity"),this.Zt=t,this.t("opacity",e,t),this.C())}get validCycle(){return this.Pb}set validCycle(t){const e=this.Pb;e!==t&&(this.Pb=t,this.t("validCycle",e,t))}get layers(){return this.Vt.iterator}get isModelReadOnly(){const t=this.Ce;return t===null?!1:t.isReadOnly}set isModelReadOnly(t){const e=this.Ce;e!==null&&(e.isReadOnly=t)}get isReadOnly(){return this.Bo}set isReadOnly(t){const e=this.Bo;e!==t&&(U.s(t,"boolean",Diagram,"isReadOnly"),this.Bo=t,this.t("isReadOnly",e,t))}get isEnabled(){return this.Be}set isEnabled(t){const e=this.Be;e!==t&&(U.s(t,"boolean",Diagram,"isEnabled"),this.Be=t,this.t("isEnabled",e,t))}get allowClipboard(){return this.Tb}set allowClipboard(t){const e=this.Tb;e!==t&&(U.s(t,"boolean",Diagram,"allowClipboard"),this.Tb=t,this.t("allowClipboard",e,t))}get allowCopy(){return this.Yl}set allowCopy(t){const e=this.Yl;e!==t&&(U.s(t,"boolean",Diagram,"allowCopy"),this.Yl=t,this.t("allowCopy",e,t))}get allowDelete(){return this.Kl}set allowDelete(t){const e=this.Kl;e!==t&&(U.s(t,"boolean",Diagram,"allowDelete"),this.Kl=t,this.t("allowDelete",e,t))}get allowDragOut(){return this.Db}set allowDragOut(t){const e=this.Db;e!==t&&(U.s(t,"boolean",Diagram,"allowDragOut"),this.Db=t,this.t("allowDragOut",e,t))}get allowDrop(){return this.vb}set allowDrop(t){const e=this.vb;e!==t&&(U.s(t,"boolean",Diagram,"allowDrop"),this.vb=t,this.t("allowDrop",e,t))}get allowTextEdit(){return this.Hl}set allowTextEdit(t){const e=this.Hl;e!==t&&(U.s(t,"boolean",Diagram,"allowTextEdit"),this.Hl=t,this.t("allowTextEdit",e,t))}get allowGroup(){return this.ql}set allowGroup(t){const e=this.ql;e!==t&&(U.s(t,"boolean",Diagram,"allowGroup"),this.ql=t,this.t("allowGroup",e,t))}get allowUngroup(){return this.jl}set allowUngroup(t){const e=this.jl;e!==t&&(U.s(t,"boolean",Diagram,"allowUngroup"),this.jl=t,this.t("allowUngroup",e,t))}get allowInsert(){return this.Fb}set allowInsert(t){const e=this.Fb;e!==t&&(U.s(t,"boolean",Diagram,"allowInsert"),this.Fb=t,this.t("allowInsert",e,t))}get allowLink(){return this.Wl}set allowLink(t){const e=this.Wl;e!==t&&(U.s(t,"boolean",Diagram,"allowLink"),this.Wl=t,this.t("allowLink",e,t))}get allowRelink(){return this.Jl}set allowRelink(t){const e=this.Jl;e!==t&&(U.s(t,"boolean",Diagram,"allowRelink"),this.Jl=t,this.t("allowRelink",e,t))}get allowMove(){return this.$l}set allowMove(t){const e=this.$l;e!==t&&(U.s(t,"boolean",Diagram,"allowMove"),this.$l=t,this.t("allowMove",e,t))}get allowReshape(){return this.Zl}set allowReshape(t){const e=this.Zl;e!==t&&(U.s(t,"boolean",Diagram,"allowReshape"),this.Zl=t,this.t("allowReshape",e,t))}get allowResize(){return this.Ql}set allowResize(t){const e=this.Ql;e!==t&&(U.s(t,"boolean",Diagram,"allowResize"),this.Ql=t,this.t("allowResize",e,t))}get allowRotate(){return this._l}set allowRotate(t){const e=this._l;e!==t&&(U.s(t,"boolean",Diagram,"allowRotate"),this._l=t,this.t("allowRotate",e,t))}get allowSelect(){return this.ta}set allowSelect(t){const e=this.ta;e!==t&&(U.s(t,"boolean",Diagram,"allowSelect"),this.ta=t,this.t("allowSelect",e,t))}get allowUndo(){return this.Rb}set allowUndo(t){const e=this.Rb;e!==t&&(U.s(t,"boolean",Diagram,"allowUndo"),this.Rb=t,this.t("allowUndo",e,t))}get allowZoom(){return this.Ob}set allowZoom(t){const e=this.Ob;e!==t&&(U.s(t,"boolean",Diagram,"allowZoom"),this.Ob=t,this.t("allowZoom",e,t))}get hasVerticalScrollbar(){return this.Qu}set hasVerticalScrollbar(t){const e=this.Qu;e!==t&&(U.s(t,"boolean",Diagram,"hasVerticalScrollbar"),this.Qu=t,this.Nh(),this.C(),this.t("hasVerticalScrollbar",e,t),this.Js(!1))}get hasHorizontalScrollbar(){return this.Zu}set hasHorizontalScrollbar(t){const e=this.Zu;e!==t&&(U.s(t,"boolean",Diagram,"hasHorizontalScrollbar"),this.Zu=t,this.Nh(),this.C(),this.t("hasHorizontalScrollbar",e,t),this.Js(!1))}get allowHorizontalScroll(){return this.Ib}set allowHorizontalScroll(t){const e=this.Ib;e!==t&&(U.s(t,"boolean",Diagram,"allowHorizontalScroll"),this.Ib=t,this.t("allowHorizontalScroll",e,t),this.Js(!1))}get allowVerticalScroll(){return this.Eb}set allowVerticalScroll(t){const e=this.Eb;e!==t&&(U.s(t,"boolean",Diagram,"allowVerticalScroll"),this.Eb=t,this.t("allowVerticalScroll",e,t),this.Js(!1))}get scrollHorizontalLineChange(){return this.Ub}set scrollHorizontalLineChange(t){const e=this.Ub;e!==t&&(U.s(t,"number",Diagram,"scrollHorizontalLineChange"),t<0&&U.J(t,">= 0",Diagram,"scrollHorizontalLineChange"),this.Ub=t,this.t("scrollHorizontalLineChange",e,t))}get scrollVerticalLineChange(){return this.Vb}set scrollVerticalLineChange(t){const e=this.Vb;e!==t&&(U.s(t,"number",Diagram,"scrollVerticalLineChange"),t<0&&U.J(t,">= 0",Diagram,"scrollVerticalLineChange"),this.Vb=t,this.t("scrollVerticalLineChange",e,t))}get lastInput(){return this.gh}set lastInput(t){this.gh=t}get previousInput(){return this.Wr}set previousInput(t){this.Wr=t}get firstInput(){return this.fp}set firstInput(t){this.fp=t}get currentCursor(){return this.Sb}set currentCursor(t){if(t===""&&(t=this.op),this.Sb!==t){U.s(t,"string",Diagram,"currentCursor");const i=this.lt,s=this.Nt;if(i===null||s===null)return;this.Sb=t;const n=i.style.cursor;i.style.cursor=t,s.style.cursor=t,i.style.cursor===n&&(i.style.cursor="-webkit-"+t,s.style.cursor="-webkit-"+t,i.style.cursor===n&&(i.style.cursor="-moz-"+t,s.style.cursor="-moz-"+t,i.style.cursor===n&&(i.style.cursor=t,s.style.cursor=t)))}}get defaultCursor(){return this.op}set defaultCursor(t){t===""&&(t="auto");const e=this.op;e!==t&&(U.s(t,"string",Diagram,"defaultCursor"),this.op=t,this.t("defaultCursor",e,t))}get click(){return this.Er}set click(t){const e=this.Er;e!==t&&(t!==null&&U.S(t,Diagram,"click"),this.Er=t,this.t("click",e,t))}get doubleClick(){return this.Ur}set doubleClick(t){const e=this.Ur;e!==t&&(t!==null&&U.S(t,Diagram,"doubleClick"),this.Ur=t,this.t("doubleClick",e,t))}get contextClick(){return this.Vr}set contextClick(t){const e=this.Vr;e!==t&&(t!==null&&U.S(t,Diagram,"contextClick"),this.Vr=t,this.t("contextClick",e,t))}get mouseOver(){return this.Br}set mouseOver(t){const e=this.Br;e!==t&&(t!==null&&U.S(t,Diagram,"mouseOver"),this.Br=t,this.t("mouseOver",e,t))}get mouseHover(){return this.zr}set mouseHover(t){const e=this.zr;e!==t&&(t!==null&&U.S(t,Diagram,"mouseHover"),this.zr=t,this.t("mouseHover",e,t))}get mouseHold(){return this.Xr}set mouseHold(t){const e=this.Xr;e!==t&&(t!==null&&U.S(t,Diagram,"mouseHold"),this.Xr=t,this.t("mouseHold",e,t))}get mouseDragOver(){return this.Mb}set mouseDragOver(t){const e=this.Mb;e!==t&&(t!==null&&U.S(t,Diagram,"mouseDragOver"),this.Mb=t,this.t("mouseDragOver",e,t))}get mouseDrop(){return this.Gr}set mouseDrop(t){const e=this.Gr;e!==t&&(this.Gr=t,this.t("mouseDrop",e,t))}get handlesDragDropForTopLevelParts(){return this.Nb}set handlesDragDropForTopLevelParts(t){const e=this.Nb;e!==t&&(U.s(t,"boolean",Diagram,"handlesDragDropForTopLevelParts"),this.Nb=t,this.t("handlesDragDropForTopLevelParts",e,t))}get mouseEnter(){return this.Yr}set mouseEnter(t){const e=this.Yr;e!==t&&(t!==null&&U.S(t,Diagram,"mouseEnter"),this.Yr=t,this.t("mouseEnter",e,t))}get mouseLeave(){return this.Kr}set mouseLeave(t){const e=this.Kr;e!==t&&(t!==null&&U.S(t,Diagram,"mouseLeave"),this.Kr=t,this.t("mouseLeave",e,t))}get toolTip(){return this.Hr}set toolTip(t){const e=this.Hr;e!==t&&(this.Hr=t,this.t("toolTip",e,t))}get contextMenu(){return this.qr}set contextMenu(t){const e=this.qr;e!==t&&(this.qr=t,this.t("contextMenu",e,t))}get commandHandler(){return this.jM}set commandHandler(t){const e=this.jM;e!==t&&(e&&e.doStop(),this.jM=t,t.Io(this),t.doStart())}get toolManager(){return this.KM}set toolManager(t){this.KM!==t&&(this.KM=t,t.diagram=this)}get defaultTool(){return this.HM}set defaultTool(t){const e=this.HM;e!==t&&(this.HM=t,t.diagram=this,this.currentTool===e&&(this.currentTool=t))}get currentTool(){return this.qM}set currentTool(t){const e=this.qM;e&&(e.isActive&&e.doDeactivate(),e.cancelWaitAfter(),e.doStop()),t===null&&(t=this.defaultTool),t!==null&&(this.qM=t,t.diagram=this,t.doStart())}get selection(){return this.qA}get maxSelectionCount(){return this.Gb}set maxSelectionCount(t){const e=this.Gb;if(e!==t)if(U.s(t,"number",Diagram,"maxSelectionCount"),t>=0&&!isNaN(t)){if(this.Gb=t,this.t("maxSelectionCount",e,t),!this.undoManager.isUndoingRedoing){const i=this.selection.count-t;if(i>0){this.T("ChangingSelection",this.selection);const s=this.selection.toArray();for(let n=0;n<i;n++)s[n].isSelected=!1;this.T("ChangedSelection",this.selection)}}}else U.J(t,">= 0",Diagram,"maxSelectionCount")}get nodeSelectionAdornmentTemplate(){return this.hp}set nodeSelectionAdornmentTemplate(t){const e=this.hp;e!==t&&(this.hp=t.It(),this.t("nodeSelectionAdornmentTemplate",e,t))}get groupSelectionAdornmentTemplate(){return this.Hb}set groupSelectionAdornmentTemplate(t){const e=this.Hb;e!==t&&(this.Hb=t.It(),this.t("groupSelectionAdornmentTemplate",e,t))}get linkSelectionAdornmentTemplate(){return this.qb}set linkSelectionAdornmentTemplate(t){const e=this.qb;e!==t&&(this.qb=t.It(),this.t("linkSelectionAdornmentTemplate",e,t))}get highlighteds(){return this.jA}get isModified(){const t=this.undoManager;return t.isEnabled?t.currentTransaction!==null?!0:this.sd&&this.Hs!==t.historyIndex:this.sd}set isModified(t){if(this.sd!==t){U.s(t,"boolean",Diagram,"isModified"),this.sd=t;const i=this.undoManager;!t&&i.isEnabled&&(this.Hs=i.historyIndex),t||this.MT()}}MT(){const t=this.isModified;this.ZM!==t&&(this.ZM=t,this.T("Modified"))}get model(){return this.Ce}set model(t){const e=this.Ce;if(e!==t){this.currentTool.doCancel(),e&&e.undoManager!==t.undoManager&&e.undoManager.isInTransaction&&U.o("Do not replace a Diagram.model while a transaction is in progress.");const i=this.oT(!0);this.so=!1,this.$u=!0,this.Hs=-2,this.Tr=!1;const s=this.Ht;this.Ht=!0,this.animationManager.Gl("Model"),e&&(this.eo!==null&&this.eo.each(n=>e.removeChangedListener(n)),e.removeChangedListener(this.Zc)),this.Ce=t,this.partManager=this.CO(this.Ce.type),this.initializePartManager(this.partManager);for(let n=0;n<i.length;n++)this.add(i[n]);t.addChangedListener(this.$M),this.partManager.v2(),t.removeChangedListener(this.$M),t.addChangedListener(this.Zc),this.eo!==null&&this.eo.each(n=>t.addChangedListener(n)),this.Ht=s,this.invalidateDocumentBounds(),this.Ht||this.C(),e&&t.undoManager.copyProperties(e.undoManager)}}get themeManager(){return this.g2}set themeManager(t){const e=this.g2;e!==t&&(e&&e.removeDiagram(this),this.g2=t,t!==null&&t.addDiagram(this))}initializePartManager(t){}static m2(t,e){Diagram.ZA.set(t,e)}static get licenseKey(){return Diagram.F2.last()}static set licenseKey(t){Diagram.F2.add(t.replace(/\s/g,""))}static get version(){return Diagram.LO}static F2=new List;static LO="3.1.5";CO(t){const e=Diagram.ZA.get(t);return e!==null?new e:new PartManager}get G(){return this.JM}set G(t){this.JM=t}get nb(){return this.WA}AO(t){if(t.model!==this.model)return;const e=t.change,i=t.propertyName;if(e===1&&i[0]==="S"){if(i==="StartingFirstTransaction"){const s=this,n=this.toolManager;n.mouseDownTools.each(o=>o.diagram=s),n.mouseMoveTools.each(o=>o.diagram=s),n.mouseUpTools.each(o=>o.diagram=s),this.routers.each(o=>o.diagram=s),!this.As&&!this.so&&(this.$c=!0,this.$u&&(this.Tr=!0))}else if(i==="StartingUndo"||i==="StartingRedo"){const s=this.animationManager;this.skipsUndoManager||(s.defaultAnimation.isAnimating&&s.stopAnimation(),s.getBundleAnimation().isAnimating&&s.getBundleAnimation().stop()),this.T("ChangingSelection",this.selection)}else if(i==="StartedTransaction"){const s=this.animationManager;s.defaultAnimation.isAnimating&&!this.skipsUndoManager&&s.stopAnimation()}return}if(this.G){this.G=!1;try{if(t.modelChange===""&&e===1){(i==="FinishedUndo"||i==="FinishedRedo")&&(this.T("ChangedSelection",this.selection),this.Te());const s=this.animationManager;i==="RolledBackTransaction"&&s.stopAnimation(),this.zA(),this.$c=!0,this.maybeUpdate(),(this.undoManager.transactionLevel===0||this.undoManager.transactionLevel===1)&&s.MM(),i==="CommittedTransaction"&&this.undoManager.isJustDiscarded&&(this.Hs=Math.min(this.Hs,this.undoManager.historyIndex-1)),(i==="CommittedTransaction"||i==="RolledBackTransaction")&&this.undoManager.Sx&&U.un(()=>{this.isModified=!1},1);const n=t.isTransactionFinished;if(n&&(this.MT(),this.nb.clear(),this.animationManager.LR()),!this.Cb&&n&&this.lastInput.targetDiagram){this.Cb=!0;const o=this;U.un(()=>{o.currentTool.standardMouseOver(),o.Cb=!1},10)}}}finally{this.G=!0}}}get wi(){return this.WM}set wi(t){this.WM=t}get Ru(){return this.Lb}set Ru(t){this.Lb=t}gT(t){const e=t.D.r;for(const i of e)i instanceof Picture&&this.R2(i)}R2(t){const e=t.element;if(e===null||!root.HTMLImageElement||!(e instanceof HTMLImageElement)||(e.hs instanceof GSet&&e.hs.add(this),t.TO(),!e.Dp))return;const i=e.getAttribute("src")||"",s=this.oa.get(i);if(s===null){Picture.NT(t,e);const n=[];n.push(t),this.oa.set(i,n)}else{for(let n=0;n<s.length;n++)if(s[n]===t)return;s.push(t)}}DO(t){const e=t.D.r,i=e.length;for(let s=0;s<i;s++)this.O2(e[s])}O2(t){if(!(t instanceof Picture))return;const e=t.element;if(e===null||!root.HTMLImageElement||!(e instanceof HTMLImageElement)||!e.Dp)return;const i=e.getAttribute("src")||"",s=this.oa.get(i);if(s!==null){for(let n=0;n<s.length;n++)if(s[n]===t){s.splice(n,1),s.length===0&&(this.oa.delete(i),Picture.vO(e),e.hs instanceof GSet&&e.hs.delete(this));return}}}rT(){Picture.clearCache(),this.oa.clear()}rebuildParts(){this.partManager.rebuildParts()}Yc(t,e){this.Ns.Yc(t,e)}Gc(t,e){this.Ns.Gc(t,e)}findPartForKey(t){return this.partManager.findPartForKey(t)}findNodeForKey(t){return this.partManager.findNodeForKey(t)}findLinkForKey(t){return this.partManager.findLinkForKey(t)}findPartForData(t){return this.partManager.findPartForData(t)}findNodeForData(t){return this.partManager.findNodeForData(t)}findLinkForData(t){return this.partManager.findLinkForData(t)}findNodesByExample(...t){return this.partManager.findNodesByExample(...t)}findLinksByExample(...t){return this.partManager.findLinksByExample(...t)}get nodeTemplate(){return this.jr.get("")}set nodeTemplate(t){const e=this.jr.get("");e!==t&&(this.jr.set("",t),this.t("nodeTemplate",e,t),this.undoManager.isUndoingRedoing||this.rebuildParts())}get nodeTemplateMap(){return this.jr}set nodeTemplateMap(t){const e=this.jr;e!==t&&(this.jr=t,this.t("nodeTemplateMap",e,t),this.undoManager.isUndoingRedoing||this.rebuildParts())}get groupTemplate(){return this.dh.get("")}set groupTemplate(t){const e=this.dh.get("");e!==t&&(this.dh.set("",t),this.t("groupTemplate",e,t),this.undoManager.isUndoingRedoing||this.rebuildParts())}get groupTemplateMap(){return this.dh}set groupTemplateMap(t){const e=this.dh;e!==t&&(this.dh=t,this.t("groupTemplateMap",e,t),this.undoManager.isUndoingRedoing||this.rebuildParts())}get linkTemplate(){return this.na.get("")}set linkTemplate(t){const e=this.na.get("");e!==t&&(this.na.set("",t),this.t("linkTemplate",e,t),this.undoManager.isUndoingRedoing||this.rebuildParts())}get linkTemplateMap(){return this.na}set linkTemplateMap(t){const e=this.na;e!==t&&(this.na=t,this.t("linkTemplateMap",e,t),this.undoManager.isUndoingRedoing||this.rebuildParts())}get isMouseCaptured(){return this.QM}set isMouseCaptured(t){const e=this.lt;if(e===null)return;const i=e.bt;i instanceof SVGElement||(t?(this.lastInput.bubbles=!1,this.Le(i,"pointermove",this.xh,!1),this.Le(i,"pointerdown",this.la,!1),this.Le(i,"pointerup",this.bh,!1),this.Le(i,"pointerout",this.kh,!1),this.Le(i,"pointercancel",this.Ph,!1),this.Et(root,"pointermove",this.xh,!0),this.Et(root,"pointerdown",this.la,!0),this.Et(root,"pointerup",this.bh,!0),this.Et(root,"pointerout",this.kh,!0),this.Et(root,"pointercancel",this.Ph,!0),this.Le(i,"wheel",this.wh,!1),this.Et(root,"wheel",this.wh,!0),this.Et(root,"selectstart",this.oh,!1)):(this.Le(root,"pointermove",this.xh,!0),this.Le(root,"pointerdown",this.la,!0),this.Le(root,"pointerup",this.bh,!0),this.Le(root,"pointerout",this.kh,!0),this.Le(root,"pointercancel",this.Ph,!0),this.Et(i,"pointermove",this.xh,!1),this.Et(i,"pointerdown",this.la,!1),this.Et(i,"pointerup",this.bh,!1),this.Et(i,"pointerout",this.kh,!1),this.Et(i,"pointercancel",this.Ph,!1),this.Le(root,"wheel",this.wh,!0),this.Le(root,"selectstart",this.oh,!1),this.Et(i,"wheel",this.wh,!1)),this.QM=t)}get position(){return this.ct}set position(t){if(this.ct.equals(t))return;const e=Point.l().h(this.ct),i=this.viewportBounds.copy();if(this.ct.h(t),this.animationManager.UA(e,this.ct),!this.Ht&&!(this.lt===null&&!this.td.isReal())){this.Ht=!0;const s=this.scale,n=this.wt/s,o=this.xt/s;this.k2(this.ap,n,o,this.Wc,!1),this.Ht=!1}else this.aa(),this.Np();if(!this.Ht){const s=this.viewportBounds;this.onViewportBoundsChanged(i,s,this.it,!1)}Point.i(e)}get initialPosition(){return this.ab}set initialPosition(t){this.ab.equals(t)||(this.ab=t.N())}get initialScale(){return this.hb}set initialScale(t){this.hb!==t&&(U.s(t,"number",Diagram,"initialScale"),this.hb=t)}get grid(){return this.ls===null&&(this.ls=this.aT()),this.ls}set grid(t){let e=this.ls;if(e!==t){e===null&&(this.ls=this.aT(),e=this.ls),t.type!==Panel.Grid&&U.o("Diagram.grid must be a Panel of type Panel.Grid");const i=e.panel;i!==null&&i.remove(e),this.ls=t,t.name="GRID",i!==null&&i.add(t),this.ed=!1,this.C(),this.t("grid",e,t)}}get viewportBounds(){return this.Yb}aa(){const t=this.Yb,e=this.ct,i=this.it;t.e(e.x,e.y,Math.max(this.wt,0)/i,Math.max(this.xt,0)/i),this.ha()}get viewSize(){return this.td}set viewSize(t){const e=this.viewSize;if(!e.equals(t)){t=t.N(),this.td=t;let i=0,s=0;t.isReal()?(i=t.width,s=t.height):this.Nt!==null&&(i=this.Nt.clientWidth||1,s=this.Nt.clientHeight||1),this.wt=i,this.xt=s,this.aa(),this.invalidateDocumentBounds(),this.t("viewSize",e,t),this.C()}}get fixedBounds(){return this.db}set fixedBounds(t){const e=this.db;e.equals(t)||((t.width===-1/0||t.height===1/0||t.height===-1/0)&&U.o("fixedBounds width/height must not be Infinity"),t=t.N(),this.db=t,this.invalidateDocumentBounds(),this.t("fixedBounds",e,t))}get scrollMargin(){return this.fh}set scrollMargin(t){typeof t=="number"&&(t=new Margin(t));const e=this.fh;e.equals(t)||(t=t.N(),this.fh=t,this.t("scrollMargin",e,t),this.Iu())}get scrollMode(){return this.ah}set scrollMode(t){const e=this.ah;e!==t&&(this.ah=t,t===1&&this.Js(!1),this.t("scrollMode",e,t),this.Nh(),this.C())}get scrollsPageOnFocus(){return this.gb}set scrollsPageOnFocus(t){const e=this.gb;e!==t&&(U.s(t,"boolean",Diagram,"scrollsPageOnFocus"),this.gb=t,this.t("scrollsPageOnFocus",e,t))}get positionComputation(){return this.pb}set positionComputation(t){const e=this.pb;e!==t&&(t!==null&&U.S(t,Diagram,"positionComputation"),this.pb=t,this.Js(!1),this.t("positionComputation",e,t))}get scaleComputation(){return this.yb}set scaleComputation(t){const e=this.yb;e!==t&&(t!==null&&U.S(t,Diagram,"scaleComputation"),this.yb=t,this.ST(this.scale,this.scale),this.t("scaleComputation",e,t))}get documentBounds(){return this.ap}CT(t){this.mh=!1;let e=this.ap;e.equals(t)||(e=e.copy(),this.ap.h(t),this.Js(!1),this.T("DocumentBoundsChanged",void 0,e),this.Nh(),this.C())}ensureBounds(){if(this.mh){const t=Rect.l();this.CT(this.computeBounds(t)),Rect.i(t)}}get isVirtualized(){return this.Kb}set isVirtualized(t){const e=this.Kb;e!==t&&(U.s(t,"boolean",Diagram,"isVirtualized"),this.Kb=t,this.t("isVirtualized",e,t))}get scale(){return this.it}set scale(t){const e=this.it;e!==t&&this.ST(e,t)}get defaultScale(){return this.dp}set defaultScale(t){this.dp=t}get autoScale(){return this.ia}set autoScale(t){const e=this.ia;e!==t&&(this.ia=t,this.t("autoScale",e,t),t!==1&&this.Js(!1))}get initialAutoScale(){return this.Rr}set initialAutoScale(t){const e=this.Rr;e!==t&&(this.Rr=t,this.t("initialAutoScale",e,t))}get initialViewportSpot(){return this.xb}set initialViewportSpot(t){const e=this.xb;e!==t&&(t.isSpot()||U.o("initialViewportSpot must be a specific Spot: "+t),this.xb=t,this.t("initialViewportSpot",e,t))}get initialDocumentSpot(){return this.wb}set initialDocumentSpot(t){const e=this.wb;e!==t&&(t.isSpot()||U.o("initialViewportSpot must be a specific Spot: "+t),this.wb=t,this.t("initialDocumentSpot",e,t))}get minScale(){return this.cb}set minScale(t){const e=this.cb;e!==t&&(t>0?(this.cb=t,this.t("minScale",e,t),t>this.scale&&(this.scale=t)):U.J(t,"> 0",Diagram,"minScale"))}get maxScale(){return this.fb}set maxScale(t){const e=this.fb;e!==t&&(t>0?(this.fb=t,this.t("maxScale",e,t),t<this.scale&&(this.scale=t)):U.J(t,"> 0",Diagram,"maxScale"))}get zoomPoint(){return this.ub}set zoomPoint(t){this.ub.equals(t)||(t=t.N(),this.ub=t)}get contentAlignment(){return this.Wc}set contentAlignment(t){const e=this.Wc;e.equals(t)||(t=t.N(),this.Wc=t,this.t("contentAlignment",e,t),this.Js(!1))}get initialContentAlignment(){return this.ip}set initialContentAlignment(t){const e=this.ip;e.equals(t)||(t=t.N(),this.ip=t,this.t("initialContentAlignment",e,t))}get padding(){return this.Qt}set padding(t){typeof t=="number"&&(t=new Margin(t));const e=this.Qt;e.equals(t)||(t=t.N(),this.Qt=t,this.invalidateDocumentBounds(),this.t("padding",e,t))}get partManager(){return this.s2}set partManager(t){const e=this.s2;e!==t&&(t.diagram!==null&&U.o("Cannot share PartManagers between Diagrams: "+t.toString()),e&&e.Io(null),this.s2=t,t.Io(this))}get nodes(){return this.partManager.nodes.iterator}get links(){return this.partManager.links.iterator}get parts(){return this.partManager.parts.iterator}findTopLevelNodesAndLinks(){const t=new GSet,e=this.nodes;for(;e.next();){const s=e.value;s.isTopLevel&&t.add(s)}const i=this.links;for(;i.next();){const s=i.value;s.isTopLevel&&t.add(s)}return t.iterator}findTopLevelGroups(){return this.$r.iterator}get routers(){return this.nf}doLinkRouting(t){this.Uo=!0;const e=this.nf.r;for(let i=0;i<e.length;i++)e[i].canRoute(t)&&e[i].routeLinks(this.Or,t);this.Uo=!1}get layout(){return this.li}set layout(t){const e=this.li;e!==t&&(this.li=t,t.diagram=this,t.group=null,this.Jr=!0,this.t("layout",e,t),this.requestUpdate())}layoutDiagram(t){this.Te(),t&&this.c1(!0),this.As?this.M2(!1,this.Fl||this.nf.count!==0&&this.to.size!==0):(this.$c=!0,this.Pr())}c1(t){const e=this.$r.iterator;for(;e.next();)this.LT(e.value,t);this.layout&&(t?this.layout.isValidLayout=!1:this.layout.p())}LT(t,e){if(t===null)return;const i=t.Ch.iterator;for(;i.next();){const s=i.value;this.LT(s,e)}t.layout!==null&&(e?t.layout.isValidLayout=!1:t.layout.p())}M2(t,e){if(this.Ab)return;const i=this.G;this.G=!0;const s="Layout",n=this.undoManager.transactionLevel,o=this.layout,r=this.animationManager;try{n===0&&(this.undoManager.Dl=!0,this.startTransaction(s)),n<=1&&!r.defaultAnimation.isAnimating&&!r.ke&&(t||r.Gl(s)),this.Jr=!1;let l=this.$r.iterator;for(;l.next();)this.cd(l.value),this.AT(l.value,t,n,e);let a=!1;if(o.isValidLayout||(!t||o.isRealtime||o.isRealtime===null||n===0?(o.doLayout(this),this.cd(this),a=!0,o.isValidLayout=!0):this.Jr=!0),a||this.cd(this),this.doLinkRouting(this),this.Or.clear(),this.uh.size!==0){for(let h=0;h<23&&this.uh.size!==0;h++){for(l=this.$r.iterator;l.next();)this.TT(l.value);const c=this.Or;this.Or=this.uh,this.uh=c,this.cd(this),this.doLinkRouting(this)}this.Or.clear(),this.uh.clear()}}finally{const l=this.undoManager.Dl;n===0&&(this.commitTransaction(s),this.undoManager.Dl=!1),l&&(n===0||n===1)&&r.MM(),this.Jr&&(this.Jr=!o.isValidLayout),this.G=i}}AT(t,e,i,s){const n=t.Ch.iterator;for(;n.next();)this.AT(n.value,e,i,s);const o=t.layout;o!==null&&!o.isValidLayout?!e||o.isRealtime||i===0?(t.Lh=!t.location.isReal(),o.doLayout(t),t.invalidateLayout(32),this.o1(t),this.cd(t),this.doLinkRouting(t),o.isValidLayout=!0):(this.doLinkRouting(t),this.Jr=!0):s&&this.doLinkRouting(t)}TT(t){const e=t.Ch.iterator;for(;e.next();)this.TT(e.value);this.cd(t),this.doLinkRouting(t)}get isTreePathToChildren(){return this.bb}set isTreePathToChildren(t){const e=this.bb;if(e!==t&&(U.s(t,"boolean",Diagram,"isTreePathToChildren"),this.bb=t,this.t("isTreePathToChildren",e,t),!this.undoManager.isUndoingRedoing)){const i=this.nodes;for(;i.next();)i.value.vp()}}findTreeRoots(){const t=new List,e=this.nodes;for(;e.next();){const i=e.value;i.isTopLevel&&i.findTreeParentLink()===null&&t.add(i)}return t.iterator}get treeCollapsePolicy(){return this.kb}set treeCollapsePolicy(t){const e=this.kb;e!==t&&(t!==1&&t!==2&&t!==3&&U.o("Unknown Diagram.treeCollapsePolicy: "+t),this.kb=t,this.t("treeCollapsePolicy",e,t))}get isCollapsingExpanding(){return this.YM}set isCollapsingExpanding(t){this.YM=t}_R(){const t=new GMap,e=new GMap;function i(s){const n=s.toLowerCase(),o=new List;t.set(s,o),t.set(n,o),e.set(s,s),e.set(n,s)}i("InitialAnimationStarting"),i("AnimationStarting"),i("AnimationFinished"),i("BackgroundSingleClicked"),i("BackgroundDoubleClicked"),i("BackgroundContextClicked"),i("ClipboardChanged"),i("ClipboardPasted"),i("DocumentBoundsChanged"),i("ExternalObjectsDropped"),i("FocusOrVirtualPointerEnabledChanged"),i("GainedFocus"),i("InitialLayoutCompleted"),i("LayoutCompleted"),i("LinkDrawn"),i("LinkRelinked"),i("LinkReshaped"),i("LostFocus"),i("Modified"),i("ObjectSingleClicked"),i("ObjectDoubleClicked"),i("ObjectContextClicked"),i("PartCreated"),i("PartResized"),i("PartRotated"),i("SelectionMoved"),i("SelectionCopied"),i("SelectionDeleting"),i("SelectionDeleted"),i("SelectionGrouped"),i("SelectionUngrouped"),i("ChangingSelection"),i("ChangedSelection"),i("SubGraphCollapsed"),i("SubGraphExpanded"),i("TextEdited"),i("ThemeChanged"),i("TreeCollapsed"),i("TreeExpanded"),i("ViewportBoundsChanged"),i("InvalidateDraw"),this.XM=t,this.GM=e}dT(t){const e=this.GM.get(t);return e!==null?e:this.GM.get(t.toLowerCase())}I2(t){let e=this.XM.get(t);if(e!==null)return e;const i=t.toLowerCase();if(e=this.XM.get(i),e!==null)return e;U.o("Unknown DiagramEvent name: "+t)}addDiagramListener(t,e){U.s(t,"string",Diagram,"addDiagramListener:name"),U.S(e,Diagram,"addDiagramListener:listener");const i=this.I2(t);return i!==null&&i.add(e),this}removeDiagramListener(t,e){U.s(t,"string",Diagram,"removeDiagramListener:name"),U.S(e,Diagram,"addDiagramListener:listener");const i=this.I2(t);i!==null&&i.delete(e)}raiseDiagramEvent(t,e,i){this.T(t,e,i)}T(t,e,i){const s=this.I2(t),n=new DiagramEvent;n.diagram=this;const o=this.dT(t);o!==null&&(n.name=o),e!==void 0&&(n.subject=e),i!==void 0&&(n.parameter=i);const r=s.length;if(r===1)s.elt(0)(n);else if(r!==0){const l=s.toArray();for(let a=0;a<r;a++){const h=l[a];h(n)}}}isUnoccupied(t,e){return this.getPositions(!1,null,e||null).isUnoccupied(t.x,t.y,t.width,t.height)}computeOccupiedArea(t){return this.isVirtualized?this.viewportBounds.copy():this.mh?this.cT(t):t.h(this.documentBounds)}getPositions(t,e,i){let s=this.sa;s===null&&(this.sa=s=new PositionArray(this.avoidanceCellSize));let n=e;if(s.Yo||s.Ah!==n||s.E2!==i){if(s.U2=Math.max(s.af+1,Math.floor(this.avoidanceLimit/this.avoidanceCellSize.width)),s.V2=Math.max(s.af+1,Math.floor(this.avoidanceLimit/this.avoidanceCellSize.height)),n!==null&&(n=this.DT(n)),n===null){const o=Rect.l();this.computeOccupiedArea(o),o.inflate(100,100),s.f1(o);const r=this.nodes;for(;r.next();){const l=r.value,a=l.layer;a===null||!a.visible||a.isTemporary||this.B2(l,i,o)}Rect.i(o)}else{if(n.memberParts.count>0){const l=this.computePartsBounds(n.memberParts,!1);l.inflate(20,20),s.f1(l)}const o=Rect.l(),r=n.memberParts;for(;r.next();){const l=r.value;l instanceof Node&&this.B2(l,i,o)}Rect.i(o)}s.Ah=n,s.E2=i,s.Yo=!1}else t&&s.vT();return s}get avoidanceCellSize(){return this._M}set avoidanceCellSize(t){this.sa=null,this._M=new Size(Math.max(1,t.width),Math.max(1,t.height))}get avoidanceLimit(){return this.t2}set avoidanceLimit(t){this.t2=Math.max(1,t)}DT(t){return t.canAvoid()?t:t.containingGroup!==null?this.DT(t.containingGroup):null}B2(t,e,i){if(t===e||!t.isVisible())return;const s=t.canAvoid();if(s){const n=t.getAvoidableRect(i);this.sa.FO(n.x,n.y,n.width,n.height)}if(t instanceof Group&&(!s||t.avoidableMembers)){const n=t.memberParts;for(;n.next();){const o=n.value;o instanceof Node&&this.B2(o,e,i)}}}fd(t){this.sa!==null&&!this.sa.Yo&&(t===void 0||t.canAvoid())&&(this.sa.Yo=!0)}get autoScrollInterval(){return this.sp}set autoScrollInterval(t){const e=this.sp;e!==t&&(this.sp=t,this.t("autoScrollInterval",e,t))}get autoScrollRegion(){return this.np}set autoScrollRegion(t){typeof t=="number"&&(t=new Margin(t));const e=this.np;e.equals(t)||(t=t.N(),this.np=t,this.invalidateDocumentBounds(),this.t("autoScrollRegion",e,t))}doAutoScroll(t){this.cp.h(t);const e=Point.l();this.computeAutoScrollPosition(this.cp,e).equalsApprox(this.position)?this.stopAutoScroll():this.FT(),Point.i(e)}FT(){if(this.Jc!==-1)return;const t=this.sp,e=this;this.Jc=U.un(()=>{if(e.Jc===-1||(e.stopAutoScroll(),e.lastInput.event===null))return;const s=Point.l(),n=e.computeAutoScrollPosition(e.cp,s);if(!n.equalsApprox(e.position)){e.position=n,e.lastInput.documentPoint=e.transformViewToDoc(e.cp),e.doMouseMove(),e.mh=!0;const o=Rect.l();e.computeBounds(o),o.unionRect(e.documentBounds),e.CT(o),Rect.i(o),e.qi=!0,e.maybeUpdate(),e.FT()}Point.i(s)},t)}stopAutoScroll(){this.Jc!==-1&&(U.yc(this.Jc),this.Jc=-1)}computeAutoScrollPosition(t,e){let i=this.position;e===void 0&&(e=new Point),e.h(i);const s=this.np;if(s.top<=0&&s.left<=0&&s.right<=0&&s.bottom<=0)return e;const n=this.viewportBounds,o=this.scale,r=Rect.z(0,0,n.width*o,n.height*o),l=Point.z(0,0);if(t.x>=r.x&&t.x<r.x+s.left&&this.allowHorizontalScroll){let a=Math.max(this.scrollHorizontalLineChange,1);a=a|0,l.x-=a,t.x<r.x+s.left/2&&(l.x-=a),t.x<r.x+s.left/4&&(l.x-=4*a)}else if(t.x<=r.x+r.width&&t.x>r.x+r.width-s.right&&this.allowHorizontalScroll){let a=Math.max(this.scrollHorizontalLineChange,1);a=a|0,l.x+=a,t.x>r.x+r.width-s.right/2&&(l.x+=a),t.x>r.x+r.width-s.right/4&&(l.x+=4*a)}if(t.y>=r.y&&t.y<r.y+s.top&&this.allowVerticalScroll){let a=Math.max(this.scrollVerticalLineChange,1);a=a|0,l.y-=a,t.y<r.y+s.top/2&&(l.y-=a),t.y<r.y+s.top/4&&(l.y-=4*a)}else if(t.y<=r.y+r.height&&t.y>r.y+r.height-s.bottom&&this.allowVerticalScroll){let a=Math.max(this.scrollVerticalLineChange,1);a=a|0,l.y+=a,t.y>r.y+r.height-s.bottom/2&&(l.y+=a),t.y>r.y+r.height-s.bottom/4&&(l.y+=4*a)}return l.equalsApprox(Point.dn)||(e.x=i.x+l.x/o,e.y=i.y+l.y/o),Rect.i(r),Point.i(l),e}makeSvg(t){this.zo.has("SVG")||this.addRenderer("SVG",new SVGSurface(this,root.document));const e=new SVGSurface(this,root.document,!0);t===void 0&&(t={});const i=this;function s(n,o){const r=i.RT(n,"SVG",e),l=r!==null?r.svg:null,a=n.svgFinished;return l&&a&&a(l),U.st(o)?(o(l),null):l}return this.OT(s,t)}makeSVG(t){return this.makeSvg(t)}addRenderer(t,e){this.zo.set(t,e)}removeRenderer(t){this.zo.delete(t)}cacheGroupExternalLinks(t){this.d2=t,t||this.nodes.each(e=>{e instanceof Group&&(e.Fp=null)})}OT(t,e){const i=e.callback;let s=!0;const o=this.oa.iterator;for(;o.next();)if(!o.value[0].Sn){s=!1;break}if(!U.st(i)||s)return t(e,i,this);const r=this;function l(){const c=+new Date;for(s=!0,o.reset();o.next();)if(!o.value[0].Sn){s=!1;break}if(s||c-h>a){t(e,i,r);return}root.requestAnimationFrame(l)}const a=e.callbackTimeout||300,h=+new Date;return root.requestAnimationFrame(()=>l()),null}makeImage(t){return Diagram.isUsingDOM()?(t===void 0&&(t={}),t.returnType="Image",this.makeImageData(t)):null}makeImageData(t){return t===void 0&&(t={}),this.OT(this.RO,t)}static img="image";RO(t,e,i){const s=i.RT(t,"canvas",null);if(s===null)return null;const n=s.F.canvas;let o=null;if(n!==null){let r=t.returnType;switch(r===void 0?r="string":r=r.toLowerCase(),r){case Diagram.img+"data":o=s.getImageData(0,0,n.width,n.height);break;case Diagram.img:const a=(t.document||document).createElement("img");a.src=n.toDataURL(t.type,t.details),o=a;break;case"blob":{const h=n;return U.st(e)||(o="",U.o('Error: Diagram.makeImageData called with "returnType: toBlob", but no required "callback" function property defined.')),U.st(h.toBlob)?(h.toBlob(e,t.type,t.details),"toBlob"):(e(null),null)}case"string":default:o=n.toDataURL(t.type,t.details)}}return U.st(e)?(e(o),null):o}static OO=!1;RT(t,e,i){this.animationManager.stopAnimation(),this.maybeUpdate(),U.$(t)||U.o("properties argument must be an Object.");let s=!1,n=t.size||null,o=t.scale||null;t.scale!==void 0&&isNaN(t.scale)&&(o="NaN");let r=t.maxSize;t.maxSize===void 0&&(s=!0,e==="SVG"?r=new Size(1/0,1/0):r=new Size(2e3,2e3));const l=t.position||null;let a=t.parts||null;Array.isArray(a)&&(a=new List(a));let h=t.padding===void 0?1:t.padding;const c=t.background||null;let f=t.omitTemporary;f===void 0&&(f=!0);const u=t.document||root.document,d=t.elementFinished||null;let m=t.showTemporary;m===void 0&&(m=!f);let g=t.showGrid;g===void 0&&(g=m),n!==null&&isNaN(n.width)&&isNaN(n.height)&&(n=null),typeof h=="number"?h=new Margin(h):h instanceof Margin||U.o("MakeImage padding must be a Margin or a number."),h.left=Math.max(h.left,0),h.right=Math.max(h.right,0),h.top=Math.max(h.top,0),h.bottom=Math.max(h.bottom,0),this.Wt&&this.Wt.clearContextCache(!0);const p=new CanvasSurface(null,u,void 0,!0),y=p._t;if(!(n||o||a||l))return p.width=this.wt+Math.ceil(h.left+h.right),p.height=this.xt+Math.ceil(h.top+h.bottom),e==="SVG"?i===null?null:(i.resize(p.width,p.height,p.width,p.height),i.tl=u,i.ud=d,this.l1(i._t,h,new Size(p.width,p.height),this.it,this.ct,a,c,m,g),i._t):(this.nd=!1,this.l1(y,h,new Size(p.width,p.height),this.it,this.ct,a,c,m,g),this.nd=!0,p._t);const x=this.dp,b=this.documentBounds.copy();if(b.subtractMargin(this.Qt),m){const A=this.Vt.r,T=A.length;for(let D=0;D<T;D++){const v=A[D];if(!v.visible||!v.isTemporary)continue;const R=v.Ct.r,F=R.length;for(let O=0;O<F;O++){const z=R[O];if(!z.isInDocumentBounds||!z.isVisible())continue;const Y=z.actualBounds;Y.isReal()&&b.unionRect(Y)}}}let k=new Point(b.x,b.y);if(a!==null){const A=new Rect(0,0,0,0);let T=!0;const D=a.iterator;for(D.reset();D.next();){const v=D.value;if(!(v instanceof Part))continue;const R=v.layer;if(R!==null&&!R.visible||R!==null&&!m&&R.isTemporary||!v.isVisible())continue;const F=v.actualBounds;F.isReal()&&(T?(T=!1,A.h(F)):A.unionRect(F))}b.width=A.width,b.height=A.height,k.x=A.x,k.y=A.y}l!==null&&l.isReal()&&(k=l,o||(o=x));let P=0,S=0;h!==null&&(P=h.left+h.right,S=h.top+h.bottom);let L=0,C=0;n!==null&&(L=n.width,C=n.height,isFinite(L)&&(L=Math.max(0,L-P)),isFinite(C)&&(C=Math.max(0,C-S)));let M=0,N=0;if(n!==null&&o!==null?(o==="NaN"&&(o=x),n.isReal()?(M=L,N=C):isNaN(C)?(M=L,N=b.height*o):(M=b.width*o,N=C)):n!==null?n.isReal()?(o=Math.min(L/b.width,C/b.height),M=L,N=C):isNaN(C)?(o=L/b.width,M=L,N=b.height*o):(o=C/b.height,M=b.width*o,N=C):o!==null?o==="NaN"&&r.isReal()?(o=Math.min((r.width-P)/b.width,(r.height-S)/b.height),o>x?(o=x,M=b.width,N=b.height):(M=r.width,N=r.height)):(M=b.width*o,N=b.height*o):(o=x,M=b.width,N=b.height),h!==null?(M+=P,N+=S):h=new Margin(0),r!==null){let A=r.width,T=r.height;e!=="SVG"&&s&&Diagram.OO,isNaN(A)&&(A=2e3),isNaN(T)&&(T=2e3),isFinite(A)&&(M=Math.min(M,A)),isFinite(T)&&(N=Math.min(N,T))}return p.width=Math.ceil(M),p.height=Math.ceil(N),e==="SVG"?i===null?null:(i.resize(p.width,p.height,p.width,p.height),i.tl=u,i.ud=d,this.l1(i._t,h,new Size(Math.ceil(M),Math.ceil(N)),o,k,a,c,m,g),i._t):(this.nd=!1,this.l1(y,h,new Size(Math.ceil(M),Math.ceil(N)),o,k,a,c,m,g),this.nd=!0,p._t)}static Mh=null;static z2="5da73c80a36555d5038e4972187c3cae51fd22";static IO="5da73c80a36555d503aa5c72106c30b35bb2006b9cd041b259";static jw=!1;static OP=()=>{if(Diagram.z2[5]===void 0&&(Transform.prototype.Ci=Transform.prototype.Su),!Diagram.isUsingDOM())return;const t=U.Ni("canvas");t.width=350;const e=t.getContext("2d"),i=U.We("7ca11abfd022028846"),s="7ca11abfd7330390",n=[Diagram.z2,U.jw+"4ae6247590da4bb21c324ba3a84e385776",Transform.OP+"fb236cdfda5de14c134ba1a95a2d4c7cc6f93c1387",G.za];e.scale(2,2);const o=8;for(let r=1;r<5;r++)e[U.We(s)](U.We(n[r-1]),o,r*15);e[i]=U.We("39f046ebb36e4b");for(let r=1;r<5;r++)e[U.We(s)](U.We(n[r-1]),o,r*15);(n.length!==4||n[0][0]!=="5"||n[3][0]!=="7")&&(Transform.prototype.Ci=Transform.prototype.Su),Diagram.Mh=t};static EO=()=>{if(Diagram.z2[5]===void 0&&(Transform.prototype.Ci=Transform.prototype.Su),!Diagram.isUsingDOM())return;const t=U.Ni("canvas"),e=t.getContext("2d"),i=U.We("7ca11abfd022028846"),s="7ca11abfd7330390",n=[Diagram.IO,G.za],o=5;e.scale(2,2);for(let r=1;r<3;r++)e[U.We(s)](U.We(n[r-1]),o,r*11);e[i]=U.We("39f046ebb36e4b");for(let r=1;r<3;r++)e[U.We(s)](U.We(n[r-1]),o,r*11);(n.length!==2||n[0][0]!=="5")&&(Transform.prototype.Ci=Transform.prototype.Su),Diagram.Mh=t}}class DiagramHelper{IT;ET;X2;bi;constructor(t){if(this.IT=null,this.ET="63ad05bbe23a1786468a4c741b6d2",this.X2="@onz",this.ET===this._tk){this.X2=!0,this.bi=this.X2;return}this.bi=null}UO(t,e){let i="f";const s=root[U.We("76a715b2f73f148a")][U.We("72ba13b5")]||"",n=U.We;if(this.bi=!0,!Diagram.isUsingDOM())return;let o=Diagram[n("76a115b6ed251eaf4692")];if(!o){const l=s[n("76ad18b4f73e")];for(let h=s[n("73a612b6fb191d")](n("35e7"))+2;h<l;h++)i+=s[h];const a=i[n("73a612b6fb191d")](n("7da71ca0ad381e90"));this.bi=!(a>=0&&a<i[n("73a612b6fb191d")](n("35")));return}const r=Diagram.F2.iterator;for(;r.next();){o=r.value;const l=n(o).split(n("39e9")),a=l.length===7?1:0;if(l.length===1&&o.includes(n("5b8b3797c61b32a7"))){if(Diagram.EO(),!t.lt)return;t.gp=t.lt._t.F[U.We("7eba17a4ca3b1a8346")][U.We("78a118b7")](t.lt._t.F,Diagram.Mh,4,4)}if(l.length<6)return;const h=n(l[1+a]).split(".");if(l[4+a]!=="7da71ca0")return;const c=n(U[n("6cae19")]).split(".");if(!(h[0]>c[0]||h[0]===c[0]&&h[1]>=c[1]))continue;const f="73a612b6fb191d",u=root[n("74a900bae4370f8b51")][n("6fbb13a1c2311e8a57")].toLowerCase(),d=u[n(f)](n("3aad1ab6e022098b4dc4")),m=n(l[2+a]);if(d>-1){const M=u[n(f)](m.toLowerCase()+"/");if(this.bi=!(M>-1&&M<d),!this.bi)return}const g=s[n("76ad18b4f73e")];for(let M=s[n(f)](n("35e7"))+2;M<g;M++)i+=s[M];let p=i[n(f)](m);if(p<0&&m!==n("7da71ca0ad381e90")&&(p=i[n(f)](n("76a715b2ef3e149757"))),p<0&&(p=i[n(f)](n("76a715b2ef3e149757"))),p<0&&(p=i[n(f)](n("2bfa41fdb3784bca12"))),p<0&&(p=s[n(f)](n("7baa19a6f76c1988428554"))),p<0&&(p=s[n(f)](n("7ea902b2b9221e9c57c45767196566"))),this.bi=!(p>=0&&p<i[n(f)](n("35"))||i[n(f)](n("35"))===-1),!this.bi||s[n(f)](n("7fb002b6ed25128b4da25b2e"))&&(this.bi=!(s[n(f)](m)>-1),!this.bi))return;const y=root[U.We("76a715b2f73f148a")][U.We("69ad17a1e03e")],x=y[n(f)](n("7fb002b6ed25128b4da25b2e"));if(x>-1&&(this.bi=!(y[n(f)](m)>x),!this.bi))return;const b=m;if(b[0]!=="#")continue;const k=U.Ni("div");let P=l[0+a].replace(/[A-Za-z]/g,"");for(;P.length<4;)P+="9";const S=P;P=P.substring(P.length-4);const L=parseInt(c[0]),C=parseInt(c[1]);if(L>3||L===3&&C>=1){const M=parseInt(S)%40+30,N=parseInt(b.substring(1,5),16);if(Link.UT===M+N){this.bi=!1;return}}else{let M="";const N=["gsh","gsf"],A=["Header","Background","Display","Feedback"];if(M+=N[parseInt(P.substring(0,1),10)%2],M+=A[parseInt(P.substring(0,1),10)%4],k[n("79a417a0f0181a8946")]=M,root.document[n("78a712aa")]){root.document[n("78a712aa")][n("7bb806b6ed32388c4a875b")](k);const T=root.getComputedStyle(k).getPropertyValue(n("78a704b7e62456904c9b12701b6532a8")),D=root.getComputedStyle(k).getPropertyValue(n("75b817b0ea2202"));if(root.document[n("78a712aa")][n("68ad1bbcf533388c4a875b")](k),!T)continue;const v=root[n("77a902b0eb1b1e804a8a")],R="0."+parseInt(S,10)%100;if(D===R||T.indexOf(parseInt(b[1]+b[2],16).toString())!==-1&&T.indexOf(parseInt(b[3]+b[4],16).toString())!==-1){this.bi=!1;return}else if(v&&v(n("32ae19a1e0331fc94084537c067a67fa59f1386b89d006")).matches){M="."+M;for(let F=0;F<root.document.styleSheets.length;F++){const O=root.document.styleSheets[F].rules||root.document.styleSheets[F].cssRules;for(const z in O)if(M===O[z].selectorText){this.bi=!1;return}}}}else this.bi=null,e&&(this.bi=!1)}}}Mh(t,e){return e.setTransform(t.$e/2,0,0,t.$e/2,0,0),e.commitTransform(),this.bi===null&&this.UO(t,!0),0<this.bi&&this!==this.IT}}class DraggingInfo{G2;Y2;constructor(t){this.G2=t===void 0?new Point:t,this.Y2=new Point}get point(){return this.G2}set point(t){this.G2=t}get shifted(){return this.Y2}set shifted(t){this.Y2=t}}class DraggingNodeInfoPair{Ri;wT;h1;constructor(t,e,i){this.Ri=t,this.wT=e,this.h1=i}}class DraggingOptions{isGridSnapEnabled;isGridSnapRealtime;gridSnapCellSize;gridSnapCellSpot;gridSnapOrigin;dragsLink;dragsTree;groupsSnapMembers;groupsAlwaysMove;dragsMembers;constructor(t){this.Ue(),t&&Object.assign(this,t)}Ue(){this.isGridSnapEnabled=!1,this.isGridSnapRealtime=!0,this.gridSnapCellSize=new Size(NaN,NaN).k(),this.gridSnapCellSpot=Spot.TopLeft,this.gridSnapOrigin=new Point(NaN,NaN).k(),this.dragsLink=!1,this.dragsTree=!1,this.groupsSnapMembers=!1,this.groupsAlwaysMove=!0,this.dragsMembers=!0}}class Palette extends Diagram{constructor(t,e){let i;return t===void 0||typeof t=="string"||root.Element&&t instanceof Element?i=t:U.$(t)&&(e=t),super(i),this.VT(),e&&this.setProperties(e),this}VT(){this.allowDragOut=!0,this.allowMove=!1,this.isReadOnly=!0,this.contentAlignment=Spot.TopCenter,this.layout=new GridLayout}setupRouters(){}reset(){super.reset(),this.VT()}}class Overview extends Diagram{u1;d1;g1;m1;Rp;hf;Bl;K2;H2;p1;q2;constructor(t,e){let i;return t===void 0||typeof t=="string"||root.Element&&t instanceof Element?i=t:U.$(t)&&(e=t),super(i),this.animationManager.isEnabled=!1,this.Ht=!0,this.u1=null,this.Zu=!1,this.Qu=!1,this.d1=!0,this.g1=!0,this.m1=0,this.Rp=!1,this.hf=null,this.setRenderingHint("drawShadows",!1),this.Bl=new Part({selectable:!0,selectionAdorned:!1,selectionObjectName:"BOXSHAPE",locationObjectName:"BOXSHAPE",resizeObjectName:"BOXSHAPE",cursor:"move"}).add(new Shape({name:"BOXSHAPE",fill:"transparent",stroke:"magenta",strokeWidth:2}).theme("stroke","overviewBox")).It(),this.allowCopy=!1,this.allowDelete=!1,this.allowDrop=!1,this.allowSelect=!0,this.autoScrollRegion=new Margin(0,0,0,0),this.ct.e(0,0),this.toolManager.Jt("Dragging",new OverviewDraggingTool,this.toolManager.mouseMoveTools),this.click=()=>{const s=this.observed;if(s===null)return;const n=s.viewportBounds,o=this.lastInput.documentPoint;s.position=new Point(o.x-n.width/2,o.y-n.height/2)},this.K2=s=>{this.invalidateDocumentBounds(),this.Op()},this.H2=s=>{this.observed!==null&&(this.invalidateDocumentBounds(),this.C())},this.p1=s=>{this.updateDelay<1?this.C():this.Rp||(this.Rp=!0,U.un(()=>this.redraw(),this.updateDelay))},this.q2=s=>{this.observed!==null&&this.Op()},this.autoScale=2,this.Ht=!1,e&&this.setProperties(e),this}setupRouters(){}computePixelRatio(){return 1}redraw(){this.Rp&&this.updateDelay>=1&&(this.Rp=!1,this.VO()),super.redraw()}Ge(){if(this.Nt===null&&U.o("No div specified"),this.lt===null&&U.o("No canvas specified"),this.lt instanceof SVGSurface||(this.box.BM(),!this.qi))return;const t=this.observed;if(t===null||t.animationManager.defaultAnimation.isAnimating||!t.Qa)return;this.Lp();const e=this.lt,i=this.Wt;if(i.clearContextCache(!0),i.setTransform(1,0,0,1,0,0),i.clearRect(0,0,e.width,e.height),this.updateDelay<1)this.BT();else if(this.hf!==null){i.drawImage(this.hf.bt,0,0);const o=this.v;i.scale(this.$e,this.$e),i.transform(o.m11,o.m12,o.m21,o.m22,o.dx,o.dy),i.commitTransform()}const s=this.Vt.r,n=s.length;for(let o=0;o<n;o++)s[o].Ge(i,this);this._c=!1,this.qi=!1}VO(){const t=this.lt,e=this.Wt;if(!(t===null||e===null)){if(this.Lp(),this.hf===null){const i=new CanvasSurface(null);i.width=t.width,i.height=t.height,this.hf=i}try{this.lt=this.hf,this.Wt=this.lt._t,this.Wt.clearContextCache(!0),this.Wt.setTransform(1,0,0,1,0,0),this.Wt.clearRect(0,0,this.lt.width,this.lt.height),this.BT()}finally{this.lt=t,this.Wt=e}}}BT(){const t=this.observed;if(t===null)return;const e=this.drawsTemporaryLayers,i=this.drawsGrid&&e,s=t.grid;if(i&&s!==null&&s.visible&&!(isNaN(s.width)||isNaN(s.height))){const c=Rect.l().h(this.viewportBounds).unionRect(t.viewportBounds);t.ca(c),Rect.i(c),t.Te()}const n=this.v,o=this.Wt;o.scale(this.$e,this.$e),o.transform(n.m11,n.m12,n.m21,n.m22,n.dx,n.dy),o.commitTransform();const r=this.viewportBounds,l=t.Vt.r,a=l.length,h=this.Vt.r;this.rs(h,h.length,this,this.viewportBounds);for(let c=0;c<a;c++)l[c].UR(o,r,this,e,i)}get observed(){return this.u1}set observed(t){const e=this.u1;if(t!==null&&U.se(t,Diagram,Overview,"observed"),t instanceof Overview&&U.o("Overview.observed Diagram may not be an Overview itself: "+t),e!==t){if(e!==null&&this.BO(e),this.u1=t,t!==null&&this.zO(t),this.invalidateDocumentBounds(),t===null){this.hf=null;const i=this.lt,s=this.Wt;i&&s&&(s.setTransform(1,0,0,1,0,0),s.clearRect(0,0,i.width,i.height))}else this.p1(null),this.Op(),this.C();this.t("observed",e,t)}}get box(){return this.Bl}set box(t){const e=this.Bl;e!==t&&(t.It(),this.Bl=t,this.remove(e),this.add(this.Bl),this.Op(),this.t("box",e,t))}get drawsTemporaryLayers(){return this.d1}set drawsTemporaryLayers(t){this.d1!==t&&(this.d1=t,this.redraw())}get drawsGrid(){return this.g1}set drawsGrid(t){this.g1!==t&&(this.g1=t,this.redraw())}get updateDelay(){return this.m1}set updateDelay(t){t<0&&(t=0),this.m1!==t&&(this.m1=t)}zO(t){t!==null&&(t.addDiagramListener("ViewportBoundsChanged",this.K2),t.addDiagramListener("DocumentBoundsChanged",this.H2),t.addDiagramListener("InvalidateDraw",this.p1),t.addDiagramListener("AnimationFinished",this.q2),this.add(this.box))}BO(t){t!==null&&(this.remove(this.box),t.removeDiagramListener("ViewportBoundsChanged",this.K2),t.removeDiagramListener("DocumentBoundsChanged",this.H2),t.removeDiagramListener("InvalidateDraw",this.p1),t.removeDiagramListener("AnimationFinished",this.q2))}Op(){const t=this.box,e=this.observed;if(e===null)return;this.qi=!0;const i=e.viewportBounds,s=t.selectionObject,n=Size.l();n.e(i.width,i.height),s.desiredSize=n,Size.i(n);const o=2/this.scale;s instanceof Shape&&(s.strokeWidth=o),t.location=new Point(i.x-o/2,i.y-o/2),t.isSelected=!0}computeBounds(){const t=this.observed;if(t===null)return Rect.em;const e=t.documentBounds.copy();return e.unionRect(t.viewportBounds),e}invalidateViewport(t,e){this.qi!==!0&&(this.qi=!0,this.requestUpdate())}onViewportBoundsChanged(t,e,i,s){this.Ht||(this.ha(),this.C(),this.Nh(),this.invalidateDocumentBounds(),this.Op(),this.Ye.scale=i,this.Ye.position.x=t.x,this.Ye.position.y=t.y,this.Ye.bounds.h(t),this.Ye.isScroll=s,this.T("ViewportBoundsChanged",this.Ye,t))}}class OverviewDraggingTool extends DraggingTool{ua;constructor(){super(),this.ua=Point.gn}canStart(){if(!this.isEnabled)return!1;const t=this.diagram;if(t===null||!t.allowMove||!t.allowSelect)return!1;const e=t.observed;if(e===null)return!1;const i=t.lastInput;if(!i.left||t.currentTool!==this&&(!this.isBeyondDragSize()||i.isTouchEvent&&i.timestamp-t.firstInput.timestamp<this.delay))return!1;if(this.findDraggablePart()===null){const n=e.viewportBounds;this.ua=new Point(n.width/2,n.height/2);const o=t.firstInput.documentPoint;e.position=new Point(o.x-this.ua.x,o.y-this.ua.y)}return!0}doActivate(){this.ua=Point.gn,super.doActivate()}doUpdateCursor(t){const e=this.diagram,i=e.box;i!==null&&i.cursor&&(e.currentCursor=i.cursor)}moveParts(t,e,i){i===void 0&&(i=!1);const s=this.diagram,n=s.observed;if(n===null)return;const o=s.box;if(o===null)return;if(!this.ua.isReal()){const l=s.firstInput.documentPoint,a=o.location;this.ua=new Point(l.x-a.x,l.y-a.y)}const r=s.lastInput.documentPoint;n.position=new Point(r.x-this.ua.x,r.y-this.ua.y)}}class CommandHandler{a;w1="go._clipboard";b1="go._clipboardFormat";j2;W2;J2;$2;Z2;Q2;_2;tN;eN;da;iN;k1;P1;S1;M1;sN;Ko;nN;oN;Ip;rN;N1;lN;C1;aN;hN;dd;Ep;Up;cN;Zc;fN;uN;dN;gN;mN;gd;pN;Oi;Ps;L1;Vp;static md=["Ctrl","Shft","Alt","Meta"];static zT=CommandHandler.yN(230,40,15);static XO=CommandHandler.yN(270,40,15);static GO=CommandHandler.yN(310,40,15);constructor(t){GSet.Je(this),this.a=Diagram.Om(),this.j2=!0,this.W2=!0,this.J2=!0,this.$2=!1,this.Z2=!1,this.Q2=!1,this._2=!1,this.tN="memory",this.eN=null,this.da=null,this.iN=1.05,this.k1=NaN,this.P1=Point.gn,this.S1=NaN,this.M1=Rect.em,this.sN=!1,this.Ko=null,this.nN=200,this.oN=!1,this.Ip=new Adornment("Auto",{layerName:"Tool",pickable:!1,selectable:!1}).add(new Panel("Spot").add(new Shape({name:"SHAPE",fill:null,stroke:"lime",strokeWidth:4}).bindObject("stroke","adornedPart",e=>e.isSelected?"darkcyan":"lime"),new Shape({name:"SHAPE2",stretch:2,fill:null,stroke:"magenta",strokeWidth:4,strokeDashArray:[4,4]})),new Placeholder({padding:4})),this.rN=null,this.N1="",this.lN="",this.C1=U.fr,this.aN=!1,this.hN=!1,this.dd=new Part({layerName:"Tool",isInDocumentBounds:!1,locationObjectName:"CIRCLE",locationSpot:Spot.Center,pickable:!1,selectable:!1}).add(new Shape("Circle",{isGeometryPositioned:!0,width:30,height:30,fill:null,stroke:"darkcyan",strokeWidth:6,visible:!1}).bind("visible","down"),new Shape({isGeometryPositioned:!0,geometryString:"M15 0L15 30",stroke:"magenta"}),new Shape({isGeometryPositioned:!0,geometryString:"M0 15L30 15",stroke:"magenta"}),new Shape("Circle",{name:"CIRCLE",isGeometryPositioned:!0,width:20,height:20,fill:null,stroke:"magenta",position:new Point(5,5)}),new Shape({isGeometryPositioned:!0,geometry:CommandHandler.zT,fill:null,stroke:"cyan",strokeWidth:4}).bind("geometry","button",CommandHandler.YO),new TextBlock({position:new Point(12,0),font:"bold 10pt sans-serif"}).bind("text","clickCount",e=>e>1?e.toString():""),new TextBlock({position:new Point(0,16)}).bind("text","modifiers",CommandHandler.KO)).freezeBindings(),this.Ep=10,this.Up=1,this.cN=null,this.Zc=e=>this.HO(e),this.fN=e=>this.qO(e),this.uN=e=>this.jO(e),this.dN=e=>this.WO(e),this.gN=null,this.mN="distance",this.gd=null,this.pN=0,this.Oi={},this.Ps=null,this.L1=!1,this.Vp=null,this.wN(),this.dd.data=this.Oi,t&&Object.assign(this,t)}toString(){return"CommandHandler"}get diagram(){return this.a}Io(t){this.a=t}doStart(){const t=this.a;t&&(t.addModelChangedListener(this.Zc),t.addDiagramListener("ViewportBoundsChanged",this.fN),t.addDiagramListener("GainedFocus",this.uN),t.addDiagramListener("LostFocus",this.dN))}doStop(){const t=this.a;t&&(t.removeDiagramListener("ViewportBoundsChanged",this.fN),t.removeDiagramListener("GainedFocus",this.uN),t.removeDiagramListener("LostFocus",this.dN),t.removeModelChangedListener(this.Zc))}doKeyDown(){const t=this.a,e=t.lastInput,i=e.control||e.meta,s=e.shift,n=e.alt,o=e.commandKey;i&&(o==="Insert"||o==="c")?this.canCopySelection()&&this.copySelection():i&&o==="x"||s&&o==="Delete"?this.canCutSelection()&&this.cutSelection():i&&o==="v"||s&&o==="Insert"?this.canPasteSelection()&&this.pasteSelection():i&&o==="y"||i&&s&&o==="z"||n&&s&&o==="Backspace"?this.canRedo()&&this.redo():i&&o==="z"||n&&o==="Backspace"?this.canUndo()&&this.undo():o==="Delete"||o==="Backspace"?this.canDeleteSelection()&&this.deleteSelection():i&&o==="a"?this.canSelectAll()&&this.selectAll():o==="Escape"?this.canStopCommand()&&this.stopCommand():this.XT.indexOf(o)>=0?this.JO(o,i,s):o==="PageUp"?s&&t.allowHorizontalScroll?t.scroll("page","left"):t.allowVerticalScroll&&t.scroll("page","up"):o==="PageDown"?s&&t.allowHorizontalScroll?t.scroll("page","right"):t.allowVerticalScroll&&t.scroll("page","down"):o==="Home"?i&&t.allowVerticalScroll?t.scroll("document","up"):!i&&t.allowHorizontalScroll&&t.scroll("document","left"):o==="End"?i&&t.allowVerticalScroll?t.scroll("document","down"):!i&&t.allowHorizontalScroll&&t.scroll("document","right"):o==="Space"?this.canScrollToPart()&&this.scrollToPart():o==="Minus"||o==="NumpadSubtract"?this.canDecreaseZoom()&&this.decreaseZoom():o==="Equal"||o==="NumpadAdd"?this.canIncreaseZoom()&&this.increaseZoom():i&&o==="Digit0"?this.canResetZoom()&&this.resetZoom():s&&o==="z"?this.canZoomToFit()&&this.zoomToFit():i&&!s&&o==="g"?this.canGroupSelection()&&this.groupSelection():i&&s&&o==="g"?this.canUngroupSelection()&&this.ungroupSelection():o==="F2"?this.canEditTextBlock()&&this.editTextBlock():o==="ContextMenu"||s&&o==="F10"||i&&s&&o==="Backslash"?this.canShowContextMenu()&&this.showContextMenu():e.bubbles=!0}doKeyUp(){const e=this.a.lastInput;e.bubbles=!0}stopCommand(){const t=this.a,e=t.currentTool;if(e instanceof ToolManager){if(e.currentToolTip!==null){e.hideToolTip();return}t.allowSelect&&t.clearSelection()}e!==null&&e.doCancel()}canStopCommand(){return!0}selectAll(){const t=this.a;t.C();try{t.currentCursor="wait",t.T("ChangingSelection",t.selection);const e=t.parts;for(;e.next();){const n=e.value;n.canSelect()&&!n.layer.isTemporary&&(n.isSelected=!0)}const i=t.nodes;for(;i.next();){const n=i.value;n.canSelect()&&!n.layer.isTemporary&&(n.isSelected=!0)}const s=t.links;for(;s.next();){const n=s.value;n.canSelect()&&!n.layer.isTemporary&&(n.isSelected=!0)}}finally{t.T("ChangedSelection",t.selection),t.currentCursor=""}}canSelectAll(){return this.a.allowSelect}deleteSelection(){const t=this.a;try{t.currentCursor="wait",t.T("ChangingSelection",t.selection),t.startTransaction("Delete"),t.T("SelectionDeleting",t.selection);const e=new GSet,i=t.selection.iterator;for(;i.next();){const s=i.value;Part.ga(e,s,!0,this.deletesTree?1/0:0,this.deletesConnectedLinks?null:!1,n=>n.canDelete())}t.removeParts(e,!0),t.T("SelectionDeleted",e)}finally{t.commitTransaction("Delete"),t.T("ChangedSelection",t.selection),t.currentCursor=""}}canDeleteSelection(){const t=this.a;return!(t.isReadOnly||t.isModelReadOnly||!t.allowDelete||t.selection.count===0)}copySelection(){const t=this.a;try{const e=new GSet,i=t.selection.iterator;for(;i.next();){const s=i.value;Part.ga(e,s,!0,this.copiesTree?1/0:0,this.copiesConnectedLinks,n=>n.canCopy())}this.copyToClipboard(e)}finally{}}canCopySelection(){const t=this.a;return!(!t.allowCopy||!t.allowClipboard||t.selection.count===0)}cutSelection(){this.copySelection(),this.deleteSelection()}canCutSelection(){const t=this.a;return!(t.isReadOnly||t.isModelReadOnly||!t.allowCopy||!t.allowDelete||!t.allowClipboard||t.selection.count===0)}copyToClipboard(t){const e=this.a,i=this.storageLocation==="systemClipboard";if(i||this.storageLocation!=="memory")try{if(t===null)if(i&&root.navigator.clipboard)root.navigator.clipboard.writeText("");else{const n=root[this.storageLocation];if(!n)return;n.setItem(this.w1,""),n.setItem(this.b1,"")}else{const n=new Diagram;if(n.isTreePathToChildren=e.isTreePathToChildren,n.toolManager.draggingTool.dragsLink=e.toolManager.draggingTool.dragsLink,n.model=e.model.copy(),e.copyParts(t,n,!1),i&&root.navigator.clipboard)root.navigator.clipboard.writeText(n.model.toJson());else{const o=root[this.storageLocation];if(!o)return;o.setItem(this.w1,n.model.toJson()),o.setItem(this.b1,n.model.dataFormat)}}e.T("ClipboardChanged",t);return}catch{return}let s=null;if(t===null)Diagram.nT();else{let n=null;try{n=e.copyParts(t,null,!0)}finally{s=new List,n!==null&&s.addAll(n.iteratorValues),Diagram.Sp=s,Diagram.i1=e.model.dataFormat}}e.T("ClipboardChanged",s)}pasteFromClipboard(){const t=this.a;if(this.storageLocation!=="memory"){const n=new GSet;try{const o=root[this.storageLocation];if(!o)return n;const r=o.getItem(this.w1),l=o.getItem(this.b1);if(r===null||r===""||l!==t.model.dataFormat)return n;{const a=new Diagram;a.model=Model.fromJson(r);const h=new GSet;h.addAll(a.parts).addAll(a.nodes).addAll(a.links);const c=t.copyParts(h,t,!1);return new GSet().addAll(c.iteratorValues)}}catch{return n}}const e=new GSet,i=Diagram.Sp;if(i===null||Diagram.i1!==t.model.dataFormat)return e;let s=null;try{s=t.copyParts(i,t,!1)}finally{if(s!==null){const n=s.iterator;for(;n.next();){const o=n.value,r=n.key;o.location.isReal()||(r.location.isReal()?o.location=r.location:!o.position.isReal()&&r.position.isReal()&&(o.position=r.position)),e.add(o)}}}return e}async pasteSelectionAsync(t){const e=this.a;if(root.navigator.clipboard===void 0){U.ne('Cannot paste with storageLocation "clipboard", window.isSecureContext may be false.');return}try{e.currentCursor="wait",e.T("ChangingSelection",e.selection),e.startTransaction("Paste");let i=null;const s=await root.navigator.clipboard.readText();try{const o=s;if(!(o===null||o==="")){const r=new Diagram;r.model=Model.fromJson(o);const l=new GSet;l.addAll(r.parts).addAll(r.nodes).addAll(r.links);const a=e.copyParts(l,e,!1);i=new GSet().addAll(a.iteratorValues)}}catch{}if(i===null)return;i.count>0&&e.clearSelection(!0);const n=i.iterator;for(;n.next();){const o=n.value;o.isSelected=!0}if(t){const o=e.computePartsBounds(e.selection);if(o.isReal()){const r=this.computeEffectiveCollection(e.selection,e.ld);e.Lx(r,new Point(t.x-o.centerX,t.y-o.centerY),e.ld,!1)}}e.T("ClipboardPasted",i)}finally{e.commitTransaction("Paste"),e.T("ChangedSelection",e.selection),e.currentCursor=""}}pasteSelection(t){if(this.storageLocation==="systemClipboard"){this.pasteSelectionAsync(t);return}const e=this.a;try{e.currentCursor="wait",e.T("ChangingSelection",e.selection),e.startTransaction("Paste");const i=this.pasteFromClipboard();i.count>0&&e.clearSelection(!0);const s=i.iterator;for(;s.next();){const n=s.value;n.isSelected=!0}if(t){const n=e.computePartsBounds(e.selection);if(n.isReal()){const o=this.computeEffectiveCollection(e.selection,e.ld);e.Lx(o,new Point(t.x-n.centerX,t.y-n.centerY),e.ld,!1)}}e.T("ClipboardPasted",i)}finally{e.commitTransaction("Paste"),e.T("ChangedSelection",e.selection),e.currentCursor=""}}canPasteSelection(t){const e=this.a;if(e.isReadOnly||e.isModelReadOnly||!e.allowInsert||!e.allowClipboard)return!1;if(this.storageLocation==="systemClipboard")return!0;if(this.storageLocation!=="memory")try{const i=root[this.storageLocation];if(!i)return!1;const s=i.getItem(this.w1),n=i.getItem(this.b1);return!(s===null||s===""||n!==e.model.dataFormat)}catch{return!1}return!(Diagram.Sp===null||Diagram.Sp.count===0||Diagram.i1!==e.model.dataFormat)}undo(){this.a.undoManager.undo()}canUndo(){const t=this.a;return t.isReadOnly||t.isModelReadOnly?!1:t.allowUndo&&t.undoManager.canUndo()}redo(){this.a.undoManager.redo()}canRedo(){const t=this.a;return t.isReadOnly||t.isModelReadOnly?!1:t.allowUndo&&t.undoManager.canRedo()}decreaseZoom(t){t===void 0&&(t=1/this.zoomFactor);const e=this.a;if(e.autoScale!==1)return;const i=e.scale*t;i<e.minScale||i>e.maxScale||(e.scale=i)}canDecreaseZoom(t){t===void 0&&(t=1/this.zoomFactor);const e=this.a;if(e.autoScale!==1)return!1;const i=e.scale*t;return i<e.minScale||i>e.maxScale?!1:e.allowZoom}increaseZoom(t){t===void 0&&(t=this.zoomFactor);const e=this.a;if(e.autoScale!==1)return;const i=e.scale*t;i<e.minScale||i>e.maxScale||(e.scale=i)}canIncreaseZoom(t){t===void 0&&(t=this.zoomFactor);const e=this.a;if(e.autoScale!==1)return!1;const i=e.scale*t;return i<e.minScale||i>e.maxScale?!1:e.allowZoom}resetZoom(t){t===void 0&&(t=this.defaultScale);const e=this.a;t<e.minScale||t>e.maxScale||(e.scale=t)}canResetZoom(t){t===void 0&&(t=this.defaultScale);const e=this.a;return t<e.minScale||t>e.maxScale?!1:e.allowZoom}zoomToFit(t){const e=this.a,i=e.animationManager;i.stopAnimation(),e.redraw();const s=e.position.copy(),n=e.scale;if(i.Gl("Zoom To Fit"),!t&&this.isZoomToFitRestoreEnabled&&n===this.S1&&!isNaN(this.k1)&&this.P1.isReal()&&e.documentBounds.equals(this.M1))e.scale=this.k1,e.position=this.P1,this.S1=NaN,this.M1=Rect.em;else{if(this.k1=n,this.P1=s,t){const o=t.copy();if(o.width>0&&o.height>0){const r=e.viewportBounds,l=r.width*n,a=r.height*n,h=Math.min(l/o.width,a/o.height),c=l/h,f=a/h;o.width<c&&(o.x-=(c-o.width)/2),o.height<f&&(o.y-=(f-o.height)/2)}e.zoomToRect(o,2)}else e.zoomToFit();this.S1=e.scale,this.M1=e.documentBounds.copy()}i.MM()}canZoomToFit(t){return this.a.allowZoom}JO(t,e,i){const s=this.a;t==="ArrowUp"?s.allowVerticalScroll&&(e?s.scroll("pixel","up"):s.scroll("line","up")):t==="ArrowDown"?s.allowVerticalScroll&&(e?s.scroll("pixel","down"):s.scroll("line","down")):t==="ArrowLeft"?s.allowHorizontalScroll&&(e?s.scroll("pixel","left"):s.scroll("line","left")):t==="ArrowRight"&&s.allowHorizontalScroll&&(e?s.scroll("pixel","right"):s.scroll("line","right"))}scrollToPart(t){t===void 0&&(t=null),t!==null&&U.se(t,Part,CommandHandler,"part");const e=this.a;if(e.ensureBounds(),t===null){try{this.Ko!==null&&(this.Ko.next()?t=this.Ko.value:this.Ko=null)}catch{this.Ko=null}t===null&&(e.highlighteds.count>0?this.Ko=e.highlighteds.iterator:e.selection.count>0&&(this.Ko=e.selection.iterator),this.Ko!==null&&this.Ko.next()&&(t=this.Ko.value))}if(t!==null){const i=e.animationManager;i.Gl("Scroll To Part");const s=this.scrollToPartPause;if(s>0){const n=this.cf(t,[t]);if(n.length===1)e.startTransaction(),e.centerRect(t.actualBounds),e.commitTransaction("Scroll To Part");else{const o=()=>{e.startTransaction();let l=n.pop();for(;n.length>0&&l instanceof Node&&l.isTreeExpanded&&(!(l instanceof Group)||l.isSubGraphExpanded);)l=n.pop();n.length>0?(l instanceof Part&&e.scrollToRect(l.actualBounds),l instanceof Node&&!l.isTreeExpanded&&(l.isTreeExpanded=!0),l instanceof Group&&!l.isSubGraphExpanded&&(l.isSubGraphExpanded=!0)):(l instanceof Part&&e.centerRect(l.actualBounds),e.removeDiagramListener("LayoutCompleted",r)),e.commitTransaction("Scroll To Part")},r=()=>{U.un(o,(i.isEnabled?i.duration:0)+s)};e.addDiagramListener("LayoutCompleted",r),o()}}else{const n=e.position.copy();e.centerRect(t.actualBounds),n.equalsApprox(e.position)&&i.stopAnimation()}}}cf(t,e){if(t.isVisible())return e;if(t instanceof Adornment){const i=t.adornedPart;i!==null&&this.cf(i,e)}else if(t instanceof Link){const i=t.fromNode;i!==null&&this.cf(i,e);const s=t.toNode;s!==null&&this.cf(s,e)}else{if(t instanceof Node){const s=t.labeledLink;s!==null&&this.cf(s,e);const n=t.findTreeParentNode();n!==null&&(!n.isTreeExpanded&&!n.wasTreeExpanded&&e.push(n),this.cf(n,e))}const i=t.containingGroup;i!==null&&(!i.isSubGraphExpanded&&!i.wasSubGraphExpanded&&e.push(i),this.cf(i,e))}return e}canScrollToPart(t){if(t===void 0&&(t=null),t!==null&&!(t instanceof Part))return!1;const e=this.a;return e.selection.count===0&&e.highlighteds.count===0?!1:e.allowHorizontalScroll&&e.allowVerticalScroll}collapseTree(t){t===void 0&&(t=null);const e=this.a,i="Collapse Tree";try{e.startTransaction(i),e.animationManager.Gl(i);const n=new List;if(t!==null&&t.isTreeExpanded)t.collapseTree(),n.add(t);else if(t===null){const o=e.selection.iterator;for(;o.next();){const r=o.value;r instanceof Node&&r.isTreeExpanded&&(r.collapseTree(),n.add(r))}}e.T("TreeCollapsed",n)}finally{e.commitTransaction(i)}}canCollapseTree(t){t===void 0&&(t=null);const e=this.a;if(e.isReadOnly)return!1;if(t!==null){if(!(t instanceof Node)||!t.isTreeExpanded)return!1;if(t.findTreeChildrenLinks().count>0)return!0}else{const i=e.selection.iterator;for(;i.next();){const s=i.value;if(s instanceof Node){if(!s.isTreeExpanded)continue;if(s.findTreeChildrenLinks().count>0)return!0}}}return!1}expandTree(t){t===void 0&&(t=null);const e=this.a,i="Expand Tree";try{e.startTransaction(i),e.animationManager.Gl(i);const n=new List;if(t!==null&&!t.isTreeExpanded)t.expandTree(),n.add(t);else if(t===null){const o=e.selection.iterator;for(;o.next();){const r=o.value;r instanceof Node&&(r.isTreeExpanded||(r.expandTree(),n.add(r)))}}e.T("TreeExpanded",n)}finally{e.commitTransaction(i)}}canExpandTree(t){t===void 0&&(t=null);const e=this.a;if(e.isReadOnly)return!1;if(t!==null){if(!(t instanceof Node)||t.isTreeExpanded)return!1;if(t.findTreeChildrenLinks().count>0)return!0}else{const i=e.selection.iterator;for(;i.next();){const s=i.value;if(s instanceof Node){if(s.isTreeExpanded)continue;if(s.findTreeChildrenLinks().count>0)return!0}}}return!1}groupSelection(){const t=this.a,e=t.model;if(!e.ff())return;const i=this.archetypeGroupData;if(i===null)return;let s=null;try{t.currentCursor="wait",t.T("ChangingSelection",t.selection),t.startTransaction("Group");const n=new List,o=t.selection.iterator;for(;o.next();){const h=o.value;h.Di()&&h.canGroup()&&n.add(h)}const r=new List,l=n.iterator;for(;l.next();){const h=l.value;let c=!1;const f=n.iterator;for(;f.next();){const u=f.value;if(h.isMemberOf(u)){c=!0;break}}c||r.add(h)}const a=r.first();if(a!==null){let h=a.containingGroup;if(h!==null)for(;h!==null;){let c=!1;const f=r.iterator;for(;f.next();)if(!f.value.isMemberOf(h)){c=!0;break}if(c)h=h.containingGroup;else break}if(i instanceof Group)i.It(),s=i.copy(),s!==null&&t.add(s);else if(e.isGroupForData(i)){const c=e.copyNodeData(i);e.addNodeData(c),s=t.findNodeForData(c)}if(s!==null){h!==null&&this.isValidMember(h,s)&&(s.containingGroup=h);const c=r.iterator;for(;c.next();){const f=c.value;this.isValidMember(s,f)&&(f.containingGroup=s)}t.clearSelection(!0),s.isSelected=!0}}t.T("SelectionGrouped",s)}finally{t.commitTransaction("Group"),t.T("ChangedSelection",t.selection),t.currentCursor=""}}canGroupSelection(){const t=this.a;if(t.isReadOnly||t.isModelReadOnly||!t.allowInsert||!t.allowGroup||!t.model.ff()||this.archetypeGroupData===null)return!1;const i=t.selection.iterator;for(;i.next();){const s=i.value;if(s.Di()&&s.canGroup())return!0}return!1}xN(t){const e=U.nt();if(Array.isArray(t))t.forEach(n=>{n instanceof Link||n instanceof Part&&e.push(n)});else{const n=t.iterator;for(;n.next();){const o=n.value;o instanceof Link||o instanceof Part&&e.push(o)}}const i=new GSet,s=e.length;for(let n=0;n<s;n++){const o=e[n];let r=!0;for(let l=0;l<s;l++)if(o.isMemberOf(e[l])){r=!1;break}r&&i.add(o)}return U.Z(e),i}isValidMember(t,e){if(e===null||t===e||e instanceof Link)return!1;let i;return t!==null&&(t===e||t.isMemberOf(e)||(i=t.memberValidation,i!==null&&!i(t,e))||t.data===null&&e.data!==null||t.data!==null&&e.data===null)?!1:(i=this.memberValidation,i!==null?i(t,e):!0)}ungroupSelection(t){t===void 0&&(t=null);const e=this.a,i=e.model;if(i.ff())try{e.currentCursor="wait",e.T("ChangingSelection",e.selection),e.startTransaction("Ungroup");const s=new List;if(t!==null)s.add(t);else{const o=e.selection.iterator;for(;o.next();){const r=o.value;r instanceof Group&&r.canUngroup()&&s.add(r)}}const n=new List;if(s.count>0){e.clearSelection(!0);const o=s.iterator;for(;o.next();){const r=o.value;r.expandSubGraph();const l=r.containingGroup,a=l!==null&&l.data!==null?i.getKeyForNodeData(l.data):void 0;n.addAll(r.memberParts);const h=n.iterator;for(;h.next();){const c=h.value;if(c.isSelected=!0,c instanceof Link)continue;const f=c.data;f!==null?i.setGroupForData(f,a):c.containingGroup=l}e.remove(r)}}e.T("SelectionUngrouped",s,n)}finally{e.commitTransaction("Ungroup"),e.T("ChangedSelection",e.selection),e.currentCursor=""}}canUngroupSelection(t){t===void 0&&(t=null);const e=this.a;if(e.isReadOnly||e.isModelReadOnly||!e.allowDelete||!e.allowUngroup||!e.model.ff())return!1;if(t!==null){if(!(t instanceof Group))return!1;if(t.canUngroup())return!0}else{const s=e.selection.iterator;for(;s.next();){const n=s.value;if(n instanceof Group&&n.canUngroup())return!0}}return!1}addTopLevelParts(t,e){const i=this.xN(t);let s=!0;const n=i.iterator;for(;n.next();){const o=n.value;o.containingGroup!==null&&(!e||this.isValidMember(null,o)?o.containingGroup=null:s=!1)}return s}collapseSubGraph(t){t===void 0&&(t=null);const e=this.a,i="Collapse SubGraph";try{e.startTransaction(i),e.animationManager.Gl(i);const n=new List;if(t!==null&&t.isSubGraphExpanded)t.collapseSubGraph(),n.add(t);else if(t===null){const o=e.selection.iterator;for(;o.next();){const r=o.value;r instanceof Group&&r.isSubGraphExpanded&&(r.collapseSubGraph(),n.add(r))}}e.T("SubGraphCollapsed",n)}finally{e.commitTransaction(i)}}canCollapseSubGraph(t){t===void 0&&(t=null);const e=this.a;if(e.isReadOnly)return!1;if(t!==null)return!(!(t instanceof Group)||!t.isSubGraphExpanded);{const i=e.selection.iterator;for(;i.next();){const s=i.value;if(s instanceof Group&&s.isSubGraphExpanded)return!0}}return!1}expandSubGraph(t){t===void 0&&(t=null);const e=this.a,i="Expand SubGraph",s=new List;try{if(e.startTransaction(i),e.animationManager.Gl(i),t!==null&&!t.isSubGraphExpanded)t.expandSubGraph(),s.add(t);else if(t===null){const o=e.selection.iterator;for(;o.next();){const r=o.value;r instanceof Group&&(r.isSubGraphExpanded||(r.expandSubGraph(),s.add(r)))}}e.T("SubGraphExpanded",s)}finally{for(const n of s)this.GT(e,n);t&&this.GT(e,t),e.commitTransaction(i)}}GT(t,e){for(const i of e.memberParts)i instanceof Node&&t.Gc(i,e)}canExpandSubGraph(t){t===void 0&&(t=null);const e=this.a;if(e.isReadOnly)return!1;if(t!==null)return!(!(t instanceof Group)||t.isSubGraphExpanded);{const i=e.selection.iterator;for(;i.next();){const s=i.value;if(s instanceof Group&&!s.isSubGraphExpanded)return!0}}return!1}editTextBlock(t){t===void 0&&(t=null),t!==null&&U.se(t,TextBlock,CommandHandler,"editTextBlock");const e=this.a,i=e.toolManager.findTool("TextEditing");if(i!==null){if(t===null){let s=null;const n=e.selection.iterator;for(;n.next();){const o=n.value;if(o.canEdit()){s=o;break}}if(s===null)return;t=s.findInVisualTree(o=>o instanceof TextBlock&&o.editable)}t!==null&&(e.currentTool=null,i.textBlock=t,e.currentTool=i)}}canEditTextBlock(t){t===void 0&&(t=null);const e=this.a;if(e.isReadOnly||e.isModelReadOnly||!e.allowTextEdit||e.toolManager.findTool("TextEditing")===null)return!1;if(t!==null){if(!(t instanceof TextBlock))return!1;const i=t.part;if(i!==null&&i.canEdit())return!0}else{const i=e.selection.iterator;for(;i.next();){const s=i.value;if(s.canEdit()&&(t=s.findInVisualTree(n=>n instanceof TextBlock&&n.editable),t!==null))return!0}}return!1}showContextMenu(t){const e=this.a,i=e.toolManager.findTool("ContextMenu");if(i===null)return;t===void 0&&(t=null),t===null&&(e.selection.count>0?t=e.selection.first():t=e);const s=i.findObjectWithContextMenu(t);if(s!==null){const n=e.lastInput;let o;if(s instanceof GraphObject?o=s.getDocumentPoint(Spot.Center):e.viewportBounds.containsPoint(n.documentPoint)?o=Point.gn:o=e.viewportBounds.center,o.isReal()){const r=new InputEvent;r.diagram=e,r.viewPoint=e.transformDocToView(o),r.documentPoint=o,r.button=2,r.up=!0,e.lastInput=r}e.currentTool=i,i.openMenu(!1,s)}}canShowContextMenu(t){const e=this.a,i=e.toolManager.findTool("ContextMenu");return!(i===null||(t===void 0&&(t=null),t===null&&(e.selection.count>0?t=e.selection.first():t=e),i.findObjectWithContextMenu(t)===null))}downloadSvg(t){const e=this.a,i={scale:1,background:e.div?e.div.style.backgroundColor:"white",name:this.$O("svg")};t&&Object.assign(i,t);const s=e.makeSvg(i);if(s!==null){const n=new XMLSerializer().serializeToString(s);this.ZO(i.name,"image/svg+xml",n)}}downloadSVG(t){this.downloadSvg(t)}canDownloadSvg(t){return this.a!==null}ZO(t,e,i){let s=null,n=null;try{const o=new Blob([i],{type:e});s=root.URL.createObjectURL(o),n=U.Ni("a"),n.style.display="none",n.href=s,n.download=t,root.document.body.appendChild(n),requestAnimationFrame(()=>{try{n!==null&&n.click()}finally{s!==null&&root.URL.revokeObjectURL(s),n!==null&&root.document.body.removeChild(n)}})}catch{s!==null&&root.URL.revokeObjectURL(s),n!==null&&root.document.body.removeChild(n)}}$O(t){const e="."+t;let i=this.diagram.model.name;return i?i.endsWith(e)&&(i=i.substring(0,i.length-e.length)):i="diagram",i+=e,i}get copiesClipboardData(){return this.j2}set copiesClipboardData(t){this.j2=!!t}get copiesConnectedLinks(){return this.W2}set copiesConnectedLinks(t){this.W2=!!t}get deletesConnectedLinks(){return this.J2}set deletesConnectedLinks(t){this.J2=!!t}get copiesTree(){return this.$2}set copiesTree(t){this.$2=!!t}get deletesTree(){return this.Z2}set deletesTree(t){this.Z2=!!t}get copiesParentKey(){return this.Q2}set copiesParentKey(t){this.Q2=!!t}get copiesGroupKey(){return this._2}set copiesGroupKey(t){this._2=!!t}get storageLocation(){return this.tN}set storageLocation(t){t||(t="memory"),t!=="memory"&&t!=="sessionStorage"&&t!=="localStorage"&&t!=="systemClipboard"&&U.o("Invalid new value for CommandHandler.storageLocation: "+t),this.tN=t}get archetypeGroupData(){return this.eN}set archetypeGroupData(t){t!==null&&U.wc(t,CommandHandler,"archetypeGroupData");const e=this.a;this.eN=t}get memberValidation(){return this.da}set memberValidation(t){t!==null&&U.S(t,CommandHandler,"memberValidation"),this.da=t}get defaultScale(){return this.diagram.defaultScale}set defaultScale(t){this.diagram.defaultScale=t}get zoomFactor(){return this.iN}set zoomFactor(t){t>1||U.o("zoomFactor must be larger than 1.0, not: "+t),this.iN=t}get isZoomToFitRestoreEnabled(){return this.sN}set isZoomToFitRestoreEnabled(t){this.sN=!!t}get scrollToPartPause(){return this.nN}set scrollToPartPause(t){this.nN=t}computeEffectiveCollection(t,e){const i=this.a,s=i.toolManager.findTool("Dragging"),n=i.currentTool===s;e===void 0&&(e=i.Tp());const o=new GMap;if(t===null)return o;let r=t.iterator;for(;r.next();){const l=r.value;i._r(o,l,n,e)}if(i.draggedLink!==null&&e.dragsLink)return o;for(r=t.iterator;r.next();){const l=r.value;if(l instanceof Link){const a=l.fromNode;if(a!==null&&!o.has(a))o.delete(l);else{const h=l.toNode;h!==null&&!o.has(h)&&o.delete(l)}}}return o}static getModifierNames(){return CommandHandler.md}static setModifierNames(t){CommandHandler.md=t}static KO(t){let e="";return t&1&&(e+=CommandHandler.md[0]||""),t&4&&(e+=CommandHandler.md[1]||""),t&2&&(e+=CommandHandler.md[2]||""),t&8&&(e+=CommandHandler.md[3]||""),e}static YO(t){return t===1?CommandHandler.XO:t===2?CommandHandler.GO:CommandHandler.zT}static yN(t,e,i){var s=new Point(i,0).rotate(t-e/2),n=new Geometry().add(new PathFigure(-i,-i)).add(new PathFigure(i,i)).add(new PathFigure(s.x,s.y).add(new PathSegment(5,t-e/2,e,0,0,i,i)));return n.offset(i,i),n}HO(t){t.isTransactionFinished&&this.updateFocusBox()}qO(t){if(t.subject.scale===this.diagram.scale)return;const e=4/this.diagram.scale,i=this.focusBox.findObject("SHAPE");i!==null&&(i.strokeWidth=e);const s=this.focusBox.findObject("SHAPE2");s!==null&&(s.strokeWidth=e,s.strokeDashArray=[e,e]);const n=this.focusBox.placeholder;n!==null&&(n.padding=e)}jO(t){this.focus===null?U.un(()=>{this.focus=this.findFirstFocus()},500):this.onFocusChanged(this.focus,this.focus)}WO(t){this.isVirtualPointerShown=!1}get isFocusEnabled(){return this.oN}set isFocusEnabled(t){t=!!t;const e=this.isFocusEnabled;t!==e&&(t||(this.isVirtualPointerShown=!1,this.gN=this.focus,this.focus=null),this.oN=t,t&&(this.focus=this.gN,this.updateFocusBox()))}get focusBox(){return this.Ip}set focusBox(t){if(!(t instanceof Adornment))return;const e=this.Ip;if(t!==e&&(this.Ip=t,e.adornedObject!==null)){const i=e.adornedPart;i!==null&&i.removeAdornment("Focus"),t.adornedObject=e.adornedObject,i!==null&&i.addAdornment("Focus",t)}}get focus(){return this.Ip.adornedObject}set focus(t){const e=this.focus;if(t!==e){const i=this.a;if(!i||!this.isFocusEnabled||t!==null&&t.diagram!==i)return;i.currentTool instanceof ContextMenuTool||this.cancelVirtualPointer();const s=this.focusBox.adornedPart;s&&s.removeAdornment("Focus"),t===null?(this.gd=null,this.virtualPointerLocation=i.viewportBounds.center,this.focusBox.adornedObject=null):(this.virtualPointerLocation=t.getDocumentPoint(Spot.Center),this.focusBox.adornedObject=t,this.updateFocusBox()),this.onFocusChanged(e,t)}}onFocusChanged(t,e){const i=this.a;if(i&&(this.focusChanged!==null?this.focusChanged(t,e,this):this.QO(this.describe(t,e)),e!==null&&e.part!==null)){const s=e.getDocumentBounds();i.viewportBounds.containsRect(s)||(e instanceof Part?i.commandHandler.scrollToPart(e):i.scrollToRect(s))}}get focusChanged(){return this.rN}set focusChanged(t){t!==null&&U.S(t,CommandHandler,"focusChanged"),this.rN=t}get liveElementId(){return this.N1||this.lN}set liveElementId(t){const e=this.N1;t!==e&&(this.N1=t,this.bN())}bN(){const t=this.diagram;if(!t||!Diagram.isUsingDOM())return;const e=t.lt?.bt;if(!e)return;const i=this.liveElementId,s=root.document.getElementById(i);this.isUsingAriaLive?(e.removeAttribute("aria-labelledby"),s&&s.setAttribute("aria-live","polite")):(i&&e.setAttribute("aria-labelledby",i),s&&s.removeAttribute("aria-live"))}get isUsingAriaLive(){return this.C1}set isUsingAriaLive(t){const e=this.C1;t!==e&&(this.C1=t,this.bN())}QO(t){const e=this.diagram;if(!e||!Diagram.isUsingDOM()||!e.div)return;let i=this.liveElementId;if(!i){const n=U.Ni("span"),o=n.style;for(o.opacity="0",o.position="absolute",o.right="-9999px",o.bottom="-9999px",o.width="0px",o.height="0px",o.overflow="hidden",o.border="0",i=(e.div.id||"diagram")+"_aria";root.document.getElementById(i);)i+=Math.floor(Math.random()*10);n.id=i,this.lN=i,e.div.appendChild(n),this.bN()}const s=root.document.getElementById(i);s&&(s.textContent=t)}describe(t,e){let i="";e instanceof Node?e instanceof Group?i="Group":i="Node":e instanceof Link?i="Link":e instanceof Part?i="Part":e&&(e.click?i="button":e instanceof TextBlock&&e.editable&&(i="editable"),e.portId!==null&&(i&&(i+=" "),i+="port",e.portId&&(i+=" "+e.portId)));const s=this.kN(e);s&&(i+=" "+s);const n=e;if(t&&n instanceof Link&&n.fromNode&&n.toNode){if(t instanceof Node&&t.part===n.fromNode||t instanceof Link&&t.fromNode===n.fromNode){i+=" to "+this.kN(n.toNode,!0);const o=n.toPort?.portId;o&&(i+=" port "+o)}else if(t instanceof Node&&t.part===n.toNode||t instanceof Link&&t.toNode===n.toNode){i+=" from "+this.kN(n.fromNode,!0);const o=n.fromPort?.portId;o&&(i+=" port "+o)}}return i}kN(t,e){if(e===void 0&&(e=!1),!t)return"";if(t instanceof TextBlock&&t.text)return t.text;if(t instanceof Panel){let i="";return t instanceof Part&&t.text&&(i=t.text),e&&i||t.walkVisualTreeFrom(t,(s,n)=>{n.isVisibleObject()&&n instanceof TextBlock&&n.text&&(!e||!i)&&i!==n.text&&(i+=" "+n.text)}),i}return""}updateFocusBox(){const t=this.focus;if(t===null)return;if(t.diagram!==null&&(t instanceof Part?t.isVisible():t.isVisibleObject()&&t.part?.isVisible()))this.focusBox.adornedObject=t,t.part?.addAdornment("Focus",this.focusBox);else{let i=null;if(t instanceof Part||(i=t.part),i instanceof Part&&i.isVisible())this.focus=i;else{if(i instanceof Node&&!i.isVisible()){const s=i.findTreeParentNode();if(s!==null)i=s;else{const n=i.labeledLink;n!==null&&(i=n)}}for(;i instanceof Part&&!i.isVisible();)i=i.containingGroup;i instanceof Part&&i.isVisible()?this.focus=i:this.focus=null}}}findFirstFocus(){const t=this.a;if(t===null||!t.isEnabled)return null;if(this.focus!==null)return this.focus;if(this.isFocusEnabled)if(t.selection.count>0)this.focus=t.selection.first();else{const e=this.YT(t.isTreePathToChildren).first();if(e!==null)return e}return null}get isVirtualPointerEnabled(){return this.aN}set isVirtualPointerEnabled(t){t=!!t;const e=this.isVirtualPointerEnabled;if(t!==e&&(this.aN=t,t)){const i=this.Vp;i&&(this.Vp=null,i.commandHandler.Ps=null,i.commandHandler.cancelVirtualPointer())}}get isVirtualPointerShown(){return this.hN}set isVirtualPointerShown(t){t=!!t;const e=this.isVirtualPointerShown;if(t!==e){const i=this.a;if(!i||!this.isVirtualPointerEnabled)return;this.hN=t;const s=this.focus;t?this.virtualPointerBox.diagram===null&&(this.virtualPointerLocation.isReal()||(s!==null?this.virtualPointerLocation=s.getDocumentPoint(Spot.Center):this.virtualPointerLocation=i.viewportBounds.center),i.add(this.virtualPointerBox),this.ma()):this.virtualPointerBox.diagram!==null&&(i.remove(this.virtualPointerBox),this.ma())}}cancelVirtualPointer(){const t=this.a;t&&(this.wN(),this.isVirtualPointerShown=!1,t.currentTool.doCancel(),this.isVirtualPointerDown=!1,this.PN())}PN(){const t=this.Ps;if(t!==null){this.Ps=null;const e=t.commandHandler;e.Ps=null,e.Vp=null,e.isVirtualPointerShown=!1,e.isVirtualPointerDown=!1,e.wN(),this.L1&&(e.isVirtualPointerEnabled=!1),this.L1=!1}}wN(){this.Oi.button=0,this.Oi.modifiers=0,this.Oi.clickCount=1,this.Oi.down=!1,this.ma()}ma(){this.virtualPointerChanged!==null&&this.virtualPointerChanged(this.virtualPointerBox,this),this.updateVirtualPointer()}updateVirtualPointer(){const t=this.virtualPointerBox.diagram;t&&(this.virtualPointerBox.scale=1/t.scale),this.virtualPointerBox.updateTargetBindings()}get virtualPointerBox(){return this.dd}set virtualPointerBox(t){if(!(t instanceof Part))return;const e=this.dd;t!==e&&(e!==null&&(t.location=e.location,e.diagram!==null&&e.diagram.remove(e)),this.dd=t,this.isVirtualPointerShown&&this.diagram&&(this.diagram.add(t),t.data=e.data),this.ma())}get virtualPointerChanged(){return this.cN}set virtualPointerChanged(t){t!==null&&U.S(t,CommandHandler,"virtualPointerChanged"),this.cN=t}get virtualPointerLocation(){return this.virtualPointerBox.location}set virtualPointerLocation(t){this.virtualPointerLocation.equals(t)||this.KT(t.x,t.y)}get isVirtualPointerDown(){return this.virtualPointerBox.data?this.virtualPointerBox.data.down:!1}set isVirtualPointerDown(t){t=!!t;const e=this.isVirtualPointerDown;if(t!==e){const i=this.a;if(!i||!this.isVirtualPointerEnabled||(this.virtualPointerBox.data===null&&(this.dd.data=this.Oi),this.virtualPointerBox.data.down=t,this.ma(),!this.isVirtualPointerShown))return;const s=i.lastInput,n=new InputEvent;n.diagram=i,this.HT(n,t),t?n.down=!0:n.up=!0,n.clickCount=1,n.button=this.Oi.button,n.modifiers=this.Oi.modifiers,t&&(i.firstInput=n.copy()),this.pd(n,!0),t||this.Oi.clickCount===2&&(n.clickCount=2,n.down=!0,n.up=!1,this.pd(n,!0),n.down=!1,n.up=!0,this.pd(n,!0),this.qT(1)),i.lastInput=s}}get virtualPointerShiftMove(){return this.Ep}set virtualPointerShiftMove(t){this.Ep=t}get virtualPointerControlMove(){return this.Up}set virtualPointerControlMove(t){this.Up=t}Bp(t,e){this.KT(this.virtualPointerLocation.x+t,this.virtualPointerLocation.y+e)}KT(t,e){this.virtualPointerBox.moveTo(t,e,!0);const i=this.a;if(!i||!this.isVirtualPointerEnabled||!this.isVirtualPointerShown)return;i.ensureBounds();const s=i.lastInput,n=new InputEvent;n.diagram=i,this.HT(n,this.isVirtualPointerDown),n.button=this.Oi.button,n.modifiers=this.Oi.modifiers,this.pd(n,!0),i.lastInput=s,this.isVirtualPointerDown&&(i.remove(this.virtualPointerBox),i.add(this.virtualPointerBox)),this.ma()}HT(t,e){const i=this.a;if(i){if(t.targetDiagram=i,t.documentPoint=this.virtualPointerLocation,i.allowDragOut){const s=i.div.getBoundingClientRect(),n=i.transformDocToView(this.virtualPointerLocation),o=s.x+n.x,r=s.y+n.y;let l=root.document.elementFromPoint(o,r)||null;l instanceof HTMLCanvasElement&&(l=l.parentElement),l!==null&&l.shadowRoot&&(l=l.shadowRoot.elementFromPoint(o,r)||null,l instanceof HTMLCanvasElement&&(l=l.parentElement));let a=null;if(l instanceof HTMLElement&&(a=Diagram.ji.get(l))&&a!==i&&a.div){const h=a.div.getBoundingClientRect(),c=new Point(n.x-(h.x-s.x),n.y-(h.y-s.y));this.Ps!==null&&this.Ps!==a&&this.PN(),t.targetDiagram=a,t.viewPoint=c,t.documentPoint=a.transformViewToDoc(c),t.viewPoint=a.transformDocToView(t.documentPoint),this.Ps=a;const f=a.commandHandler;this.L1=!f.isVirtualPointerEnabled,f.isVirtualPointerEnabled=!0,f.isVirtualPointerDown=e,f.virtualPointerLocation=t.documentPoint,f.isVirtualPointerShown=!0,f.Vp=i;return}}this.Ps!==null&&this.PN(),t.viewPoint=i.transformDocToView(t.documentPoint)}}pd(t,e){this.doVirtualPointerEvent(t,e)}doVirtualPointerEvent(t,e){const i=this.a;i&&(t.timestamp=Date.now(),i.lastInput=t,e&&(t.up?i.doMouseUp():t.down?i.doMouseDown():i.doMouseMove()),this.onVirtualPointerEvent(t,e))}onVirtualPointerEvent(t,e){const i=this.a;i&&(t.up?this.isVirtualPointerDown&&!i.viewportBounds.containsPoint(this.virtualPointerLocation)&&(this.virtualPointerLocation=this.focus instanceof GraphObject?this.focus.getDocumentPoint(Spot.Center):i.viewportBounds.center):t.down)}doVirtualFocusKeyDown(){const t=this.a;if(!t)return!1;const e=t.lastInput,i=e.commandKey;if(this.isVirtualPointerEnabled&&(i==="ShiftLeft"||i==="ShiftRight"))return this.isVirtualPointerShown=!0,!0;if(this.XT.indexOf(i)>=0)if(e.shift&&this.isVirtualPointerShown){const s=this.A1(i),n=e.control||e.meta?this.Up:this.Ep;s===270?this.Bp(0,-n):s===90?this.Bp(0,n):s===180?this.Bp(-n,0):this.Bp(n,0)}else this._O();else if(e.shift&&this.isVirtualPointerShown&&(i==="Numpad1"||i==="Numpad2"||i==="Numpad3"||i==="Numpad4"||i==="Numpad6"||i==="Numpad7"||i==="Numpad8"||i==="Numpad9")){const s=e.control||e.meta?this.Up:this.Ep;let n=0;i==="Numpad1"||i==="Numpad4"||i==="Numpad7"?n=-s:(i==="Numpad3"||i==="Numpad6"||i==="Numpad9")&&(n=s);let o=0;i==="Numpad7"||i==="Numpad8"||i==="Numpad9"?o=-s:(i==="Numpad1"||i==="Numpad2"||i==="Numpad3")&&(o=s),this.Bp(n,o)}else if(i==="Enter"||i==="NumpadEnter"||i==="Numpad5")e.shift&&this.isVirtualPointerShown?this.isVirtualPointerDown=!this.isVirtualPointerDown:this.tI();else if(i==="Escape")this.eI();else if(i==="Space")this.iI();else if(i==="ContextMenu"||e.shift&&i==="F10"||(e.control||e.meta)&&e.shift&&i==="Backslash")this.sI();else if(e.shift&&i==="c")this.T1(1);else if(e.shift&&i==="a")this.T1(2);else if(e.shift&&i==="KeyS")this.T1(4);else if(e.shift&&i==="KeyM")this.T1(8);else if(e.shift&&i==="Digit1")this.D1(0);else if(e.shift&&i==="Digit2")this.D1(1);else if(e.shift&&i==="Digit3")this.D1(2);else if(e.shift&&i==="Numpad0"){const s=this.Oi.button;this.D1(s===2?0:2)}else if(e.shift&&(i==="KeyD"||i==="NumpadDecimal")){const s=this.Oi.clickCount;this.qT(s===2?1:2)}else if(e.shift&&i==="KeyF"){const s=this.nextFocusFormula;this.nextFocusFormula=s==="distance"?"linear":"distance"}else if(e.shift&&i==="y")this.isUsingAriaLive=!this.isUsingAriaLive;else return!1;return!0}doVirtualFocusKeyUp(){const t=this.a;if(!t)return!1;const i=t.lastInput.commandKey;return this.isVirtualPointerEnabled&&(i==="ShiftLeft"||i==="ShiftRight")&&(this.isVirtualPointerShown=!1),!0}A1(t){switch(t){case"ArrowDown":return 90;case"ArrowLeft":return 180;case"ArrowUp":return 270;default:return 0}}XT=["ArrowRight","ArrowDown","ArrowLeft","ArrowUp"];T1(t){const e=this.Oi.modifiers;this.Oi.modifiers=e&t?e&~t:e|t,this.ma()}qT(t){this.Oi.clickCount=t,this.ma()}D1(t){this.Oi.button=t,this.ma()}_O(){const t=this.a;if(!t)return;const e=t.lastInput,i=this.focus;if(i===null){const s=this.YT(t.isTreePathToChildren).first();s!==null&&(this.focus=s)}else if(i instanceof Link)this.nI(i);else if(i instanceof Node)this.oI(i);else{i instanceof Part&&(this.gd=null);const s=this.A1(e.commandKey);s===270?this.focus=this.findNextFocus(270):s===90?this.focus=this.findNextFocus(90):s===180?this.focus=this.findNextFocus(180):this.focus=this.findNextFocus(0)}}nI(t){const e=this.a;if(!e)return;const i=e.lastInput,s=this.A1(i.commandKey);let n=null;const o=this.gd;if(o!==null){const r=this.pN;if(s===r)n=t.getOtherNode(o);else if(s===G.Ee(r+180))n=o;else{let l=r===0||r===180?90:0,a=r===0||r===180?270:180;if(s===l){const h=this.SN(o,r,!0),c=h.indexOf(t);c>=0&&c<h.count-1&&(this.focus=h.elt(c+1))}else if(s===a){const h=this.SN(o,r,!0),c=h.indexOf(t);c>0&&(this.focus=h.elt(c-1))}}}else{const r=t.fromNode,l=t.toNode;if(!r||!l)return;s===270?n=r.location.y<l.location.y?r:l:s==90?n=r.location.y>l.location.y?r:l:s===180?n=r.location.x<l.location.x?r:l:n=r.location.x>l.location.x?r:l}for(;n!==null&&!n.isVisible();)n=n.containingGroup;n!==null&&(this.focus=n)}oI(t){const e=this.a;if(!e)return;const i=e.lastInput,s=this.A1(i.commandKey);if(i.control||i.meta){const n=this.SN(t,s,!0).first();n&&(this.gd=t,this.pN=s,this.focus=n)}else this.gd=null,this.focus=this.findNextFocus(s)}SN(t,e,i){if(t===null)return new List;const s=t.actualBounds;if(!s.isReal())return new List;const n=new Set;(t instanceof Group?t.findExternalLinksConnected():t.findLinksConnected()).each(l=>{if(!l.isVisible())return;let a=null;if(l.fromNode===t?a=l.toNode:l.toNode===t?a=l.fromNode:t instanceof Group&&(l.fromNode?.isMemberOf(t)?a=l.toNode:l.toNode?.isMemberOf(t)&&(a=l.fromNode)),a===null||a.isMemberOf(t))return;for(;a!==null&&!a.isVisible();)a=a.containingGroup;if(a===null)return;const h=a.location;if(h.isReal()&&!(e===270&&(a!==t?h.y>=s.top:l.midPoint.y>=s.top))){{if(e===90&&(a!==t?h.y<=s.bottom:l.midPoint.y<=s.bottom))return;if(e===180&&(a!==t?h.x>=s.left:l.midPoint.x>=s.left))return;if(e===0&&(a!==t?h.x<=s.right:l.midPoint.x<=s.right))return}i&&l.actualBounds.isReal()?n.add(l):n.add(a)}});const r=new List(n);return e===90||e===270?r.sort((l,a)=>l.actualBounds.centerX-a.actualBounds.centerX):r.sort((l,a)=>l.actualBounds.centerY-a.actualBounds.centerY),r}findNextFocus(t){t=G.Ee(t);const e=this.focus,i=e instanceof Node?e.location:e.getDocumentPoint(Spot.Center);let s=1/0,n=e;const o=(r,l,a,h)=>{if(this.nextFocusFormula==="linear"){let c=1/0;t===0&&a>i.x||t===180&&a<i.x?c=Math.abs(a-i.x):(t===90&&h>i.y||t===270&&h<i.y)&&(c=Math.abs(h-i.y)),c<s&&(s=c,n=r)}else{if(t===0&&(l.right<i.x||(l.centerX-i.x)**2>s))return;if(t===90&&(l.bottom<i.y||(l.centerY-i.y)**2>s))return;if(t===180&&(l.x>i.x||(i.x-l.centerX)**2>s))return;if(t===270&&(l.y>i.y||(i.y-l.centerY)**2>s))return;const c=i.direction(a,h),f=G.jF(t,c);if(t===90||t===270?f<=45:f<45){const u=i.distanceSquared(a,h);u<s&&(s=u,n=r)}}};if(e instanceof Part&&e.diagram!==null){const r=e.containingGroup;r!==null?r.memberParts.each(l=>{l===e||l instanceof Link||!l.isVisible()||o(l,l.actualBounds,l.location.x,l.location.y)}):(e.diagram.nodes.each(l=>{l===e||!l.isTopLevel||!l.isVisible()||o(l,l.actualBounds,l.location.x,l.location.y)}),e.diagram.parts.each(l=>{l===e||!l.isTopLevel||!l.isVisible()||o(l,l.actualBounds,l.location.x,l.location.y)}))}else if(e.part!==null){const r=new Rect;this.MN(e.part).each(l=>{l!==e&&(l.getDocumentBounds(r),o(l,r,r.centerX,r.centerY))})}return n}get nextFocusFormula(){return this.mN}set nextFocusFormula(t){this.mN=t}tI(){const t=this.a;if(!t)return;const e=t.currentTool;if(e instanceof ContextMenuTool){const n=e.currentObject;this.v1(this.focus),e.maybeStopTool(this.focus),t.currentTool instanceof ContextMenuTool||(this.focus=n);return}const i=this.focus,s=t.lastInput;if(i===null)s.control||s.meta?this.v1(null):this.focus=this.findFirstFocus();else if(i instanceof Part)if(s.control||s.meta)this.v1(i);else{const n=this.MN(i);if(n.count>0)this.focus=n.first();else if(i instanceof Link&&i.isLabeledLink){const o=i.labelNodes.first();o!==null&&o.isVisible()&&(this.focus=o)}else if(i instanceof Group&&i.isSubGraphExpanded){const o=i.memberParts.first();o!==null&&o.isVisible()&&(this.focus=o)}}else this.v1(i)}YT(t){const e=new List,i=this.a;if(!i)return e;let s=0;for(;e.count===0&&s<i.nodes.count;){const n=i.nodes;for(;n.next();){const o=n.value;o.isTopLevel&&o.isVisible()&&(t?o.findNodesInto():o.findNodesOutOf()).count===s&&e.add(o)}s++}return e}MN(t){return t instanceof Part?this.Pn(t,new List):new List}Pn(t,e){return!(t instanceof Part)&&t.isVisibleObject()&&t.isEnabledObject()&&(t.contextMenu||t.click||t instanceof TextBlock&&t.editable||t.part instanceof Node&&t.portId!==null&&(t.portId!==""||t.part.ports.count>1)||t.toolTip)&&e.add(t),t instanceof Panel&&t.elements.each(i=>this.Pn(i,e)),e}v1(t){const e=this.a;if(!e)return;const i=e.lastInput,s=t instanceof GraphObject?t:e;if(s.click){const n=new InputEvent;n.diagram=e,n.documentPoint=t instanceof GraphObject?t.getDocumentPoint(Spot.Center):e.viewportBounds.center,n.viewPoint=e.transformDocToView(n.documentPoint),n.button=0,n.clickCount=1,n.targetObject=t,this.pd(n,!1),s instanceof GraphObject?s.click(n,s):s.click(n),e.lastInput=i}else s instanceof TextBlock&&s.editable?this.editTextBlock(s):this.jT(t)}eI(){const t=this.a;if(!t)return;const e=t.currentTool;if(e instanceof ToolManager&&e.currentToolTip!==null){e.hideToolTip();return}else if(e instanceof ContextMenuTool){const i=e.currentObject;e.doKeyDown(),this.focus=i;return}if(this.focus instanceof Part){const i=this.focus;i instanceof Node&&i.labeledLink!==null?this.focus=i.labeledLink:i.containingGroup!==null?this.focus=i.containingGroup:this.focus=null}else if(this.focus instanceof GraphObject){const i=this.focus.part;if(i instanceof Link&&i.isLabeledLink){const s=i.labelNodes.first();if(s!==null&&s.isVisible()){this.focus=s;return}}else if(i instanceof Group&&i.isSubGraphExpanded){const s=i.memberParts.first();if(s!==null&&s.isVisible()){this.focus=s;return}}this.focus=i}else this.cancelVirtualPointer(),this.stopCommand()}iI(){const t=this.a;if(!t)return;if(t.lastInput.shift&&this.isVirtualPointerShown){const i=t.findPartAt(this.virtualPointerLocation);i!==null&&(i===this.focus?this.WT():this.focus=i)}else this.WT()}WT(){const t=this.a;if(!t)return;const e=t.lastInput,i=this.focus;if(i instanceof Part){let s=i.part;if(e.control||e.meta){for(t.raiseDiagramEvent("ChangingSelection",t.selection);s!==null&&!s.canSelect();)s=s.containingGroup;s!==null&&(s.isSelected=!s.isSelected),t.raiseDiagramEvent("ChangedSelection",t.selection)}else if(e.shift){if(s!==null&&!s.isSelected){for(t.raiseDiagramEvent("ChangingSelection",t.selection);s!==null&&!s.canSelect();)s=s.containingGroup;s!==null&&(s.isSelected=!0),t.raiseDiagramEvent("ChangedSelection",t.selection)}}else if(s!==null&&!s.isSelected){for(;s!==null&&!s.canSelect();)s=s.containingGroup;s!==null&&t.select(s)}}this.jT(i),this.onFocusChanged(i,i)}jT(t){const e=this.a;if(!e)return;e.toolManager.hideToolTip();const i=e.lastInput;let s=t instanceof GraphObject?t:e;for(;s instanceof GraphObject&&!s.toolTip;)s=s.panel;if(s&&s.toolTip){const n=new InputEvent;n.diagram=e,n.documentPoint=t!==null?t.getDocumentPoint(Spot.Center):e.viewportBounds.center,n.viewPoint=e.transformDocToView(n.documentPoint),n.targetObject=t,this.pd(n,!1),e.toolManager.showToolTip(s.toolTip,t),e.lastInput=i}}sI(){const t=this.a;if(!t)return;const e=this.focus;if(this.canShowContextMenu(e)){this.showContextMenu(e);const i=t.toolManager.contextMenuTool.currentContextMenu;if(i instanceof Adornment){const s=this.MN(i);s.count>0&&(this.focus=s.first())}}}}var Stretch=(w=>(w[w.None=0]="None",w[w.Default=1]="Default",w[w.Vertical=4]="Vertical",w[w.Horizontal=5]="Horizontal",w[w.Fill=2]="Fill",w))(Stretch||{}),Orientation=(w=>(w[w.None=0]="None",w[w.Along=21]="Along",w[w.Plus90=22]="Plus90",w[w.Minus90=23]="Minus90",w[w.Opposite=24]="Opposite",w[w.Upright=25]="Upright",w[w.Plus90Upright=26]="Plus90Upright",w[w.Minus90Upright=27]="Minus90Upright",w[w.Upright45=28]="Upright45",w))(Orientation||{}),Flip=(w=>(w[w.None=0]="None",w[w.Vertical=1]="Vertical",w[w.Horizontal=2]="Horizontal",w[w.Both=3]="Both",w))(Flip||{});class GraphObject{n;zp;Xp;pa;w;ya;ft;ct;hi;Zt;Gp;$s;Lt;cs;el;wa;Se;Th;it;Xt;il;De;Ke;yd;de;wd;Ot;he;sl;F1;xa;uf;constructor(){GSet.Je(this),this.n=30723,this.Zt=1,this.Gp="",this.$s=null,this.Lt=null,this.ct=new Point(NaN,NaN).k(),this.cs=Size.Zw,this.el=new Transform,this.wa=new Transform,this.Se=null,this.Th=1,this.it=1,this.Xt=0,this.il=Margin.im,this.hi=new Rect(NaN,NaN,NaN,NaN).k(),this.De=new Rect(NaN,NaN,NaN,NaN).k(),this.Ke=new Rect(0,0,NaN,NaN).k(),this.yd=null,this.zp=null,this.ft=null,this.de=Spot.Default,this.wd=Spot.Default,this.Xp=0,this.pa=0,this.Ot=null,this.w=null,this.ya=null,this.he=null,this.F1=null,this.xa=null,this.sl=null,this.uf=null}cloneProtected(t){t.n=(this.n|2048|4096)&-32769,t.Zt=this.Zt,t.Gp=this.Gp,t.Lt=this.Lt,t.ct.h(this.ct),t.cs=this.cs.N(),this.Se!==null?t.Se=this.Se.copy():t.Se=null,t.it=this.it,t.Xt=this.Xt,t.il=this.il.N(),t.hi.h(this.hi),t.De.h(this.De),t.Ke.h(this.Ke),t.zp=this.zp,this.ft!==null&&(t.ft=this.ft.copy()),t.de=this.de.N(),t.wd=this.wd.N(),t.Xp=this.Xp,t.pa=this.pa,this.Ot!==null&&(t.Ot=this.Ot.copy()),this.w!==null&&(this.w.me?t.w=this.w:t.w=this.w.copy()),this.ya!==null&&(t.ya=this.ya.slice()),this.he!==null&&(t.he=this.he.copy())}addCopyProperty(t){let e=this.ya;if(!Array.isArray(e))e=[],this.ya=e;else for(let i=0;i<e.length;i++)if(e[i]===t)return;e.push(t)}Ho(t){t.yd=null,t.sl=null,t.f()}clone(){const t=new this.constructor;if(this.cloneProtected(t),this.ya!==null)for(let e=0;e<this.ya.length;e++){const i=this.ya[e];t[i]=this[i]}return t}copy(){return this.clone()}ZS(){const t=this.ve;if(t!==null){this.ve=null;for(const e of t)e.xd()&&(e.isToData?this.themeData(e.targetProperty,e.sourceProperty,e.themeSource,e.converter,e.themeConverter):e.isToObject?this.themeObject(e.targetProperty,e.sourceProperty,e.themeSource,e.converter,e.themeConverter,e.sourceName):e.isToModel?this.themeModel(e.targetProperty,e.sourceProperty,e.themeSource,e.converter,e.themeConverter):this.theme(e.targetProperty,e.sourceProperty,e.themeSource,e.converter,e.themeConverter))}return this}fe(t){t in Orientation?this.segmentOrientation=t:t in Stretch?this.stretch=t:U.ur(this,t)}toString(){return U.Kn(this.constructor)+"#"+GSet.xs(this)}static None=0;static Default=1;static Fill=2;static Vertical;static Horizontal;static Uniform=6;static UniformToFill=7;static FlipVertical=1;static FlipHorizontal=2;static FlipBoth=3;ba(){this.w!==null&&(this.w.me=!0)}Yt(){return this.w===null?this.w=new GraphObjectTemplateSettings:this.w.me&&(this.w=this.w.copy()),this.w}Wi(){if(this.ft===null){const t=new LinkSettings;t.Dh=Spot.None,t.vh=Spot.None,t.Fh=10,t.Rh=10,t.Oh=0,t.Ih=0,this.ft=t}return this.ft}raiseChangedEvent(t,e,i,s,n,o,r){const l=this.part;if(l!==null){l.df(t,e,i,s,n,o,r),i===this&&t===2&&this.gf()&&this.Eh(l,e);const a=this.diagram;if(this.Ts!==null&&a!==null&&a.Qa&&!a.undoManager.isUndoingRedoing&&!a.animationManager.Eu){const h=this.Ts.get(e);if(h!==null&&a.animationManager.isEnabled&&!a.animationManager.isTicking){this.uf===null&&(this.uf=new GMap);let c=a.undoManager.transactionLevel===0;if(h.startCondition===2?c=!0:h.startCondition===3&&(c=!1),c){const f=new Animation;h.OR(f);const u=this.uf.get(h);u!==null&&u.stop(),this.uf.set(h,f),f.tb=this,f.vM=h,f.add(this,e,s,n),f.start()}else a.animationManager.getBundleAnimation().add(this,e,s,n)}}if(this instanceof Panel&&i===l&&l.NN()&&l.data!==null){const h=this.D.r,c=h.length;for(let f=0;f<c;f++){const u=h[f];u instanceof Panel&&u.Pn(d=>{d.data!==null&&d.NN()&&d.updateTargetBindings(e)})}}}}DR(t){this.uf&&this.uf.delete(t)}Go(){if(this.diagram===null)return;if(this.findBindingPanel()===null&&this.ve!==null){const e=this.diagram.model,i=this.ve.iterator;for(;i.next();){const s=i.value;if(!s.isToTheme)continue;let n=null;const o=s.sourceName;s.isToObject&&(n=this.JT(o));let r=this;const l=s.targetId;l!==-1&&(r=this.Yp(l),r===null)||(o==="/"?n=r.part:o==="."?n=r:o===".."&&(n=r.panel),s.updateTarget(r,n,void 0,e))}}}Eh(t,e){const i=this.findBindingPanel();if(i!==null){const s=t.diagram,n=this.ve.iterator;for(;n.next();){const o=n.value;let r=null;if(o.isToObject){if(r=o.$T(i,this),r===null)continue;o.updateSource(this,r,e,null)}else if(o.isToModel)s!==null&&!s.wi&&o.updateSource(this,s.model.modelData,e,i);else if(!o.isToTheme){const l=i.data;if(l===null)continue;s!==null&&!s.wi&&o.updateSource(this,l,e,i)}if(r===this){const l=o.targetId,a=i.Yp(l);a!==null&&o.updateTarget(a,r,e,s?.model)}}}}Yp(t){return this.no===t?this:null}JT(t){let e;return t===""?e=this:t==="/"?e=this:t==="."?e=this:t===".."?e=this:e=this.part.findObject(t),e}get no(){return this.w!==null?this.w.no:-1}set no(t){this.no!==t&&(this.w===null&&(this.w=new GraphObjectTemplateSettings),this.w.no=t)}get ve(){return this.w!==null?this.w.ve:null}set ve(t){this.ve!==t&&(this.w===null&&(this.w=new GraphObjectTemplateSettings),this.w.ve=t)}get oo(){return this.w!==null?this.w.oo:null}set oo(t){this.oo!==t&&(this.w===null&&(this.w=new GraphObjectTemplateSettings),this.w.oo=t)}raiseChanged(t,e,i){this.raiseChangedEvent(2,t,this,e,i)}t(t,e,i){this.raiseChangedEvent(2,t,this,e,i)}ro(t,e,i,s){const n=this.hi;if(n.e(t,e,i,s),this.it!==1||this.Xt!==0){this.Se===null&&(this.Se=new Transform);const o=this.Se;o.Ue(),this.Kp(o,t,e,i,s),o.sm(n)}}ZT(t,e,i){return this.pickable===!1?!1:(i.bc(this.v),e?this.intersectsRect(t,i):this.containedInRect(t,i))}QT(t,e,i){if(this.pickable===!1)return!1;const s=this.naturalBounds,n=t.distanceSquaredPoint(e);return i?Point.distanceLineSegmentSquared(t.x,t.y,0,0,0,s.height)<=n||Point.distanceLineSegmentSquared(t.x,t.y,0,s.height,s.width,s.height)<=n||Point.distanceLineSegmentSquared(t.x,t.y,s.width,s.height,s.width,0)<=n||Point.distanceLineSegmentSquared(t.x,t.y,s.width,0,0,0)<=n:t.distanceSquared(0,0)<=n&&t.distanceSquared(0,s.height)<=n&&t.distanceSquared(s.width,0)<=n&&t.distanceSquared(s.width,s.height)<=n}Mn(){return!0}containsPoint(t){const e=Point.l();e.h(t),this.v.gt(e);const i=this.actualBounds;if(!i.isReal())return Point.i(e),!1;const s=this.diagram;if(s!==null&&s.pp){const o=s.getInputOption("extraTouchThreshold"),r=s.getInputOption("extraTouchArea"),l=r/2,a=this.naturalBounds,h=this.getDocumentScale()*s.scale,c=1/h;if(a.width*h<o&&a.height*h<o){const f=Rect.contains(i.x-l*c,i.y-l*c,i.width+r*c,i.height+r*c,e.x,e.y);return Point.i(e),f}}let n=!1;return(this instanceof Adornment||this instanceof Shape?Rect.contains(i.x-5,i.y-5,i.width+10,i.height+10,e.x,e.y):i.containsPoint(e))&&(this.he&&!this.he.containsPoint(e)?n=!1:this.Lt!==null&&this.Ke.containsPoint(t)?n=!0:n=this.ka(t)),Point.i(e),n}ka(t){const e=this.naturalBounds;return Rect.contains(0,0,e.width,e.height,t.x,t.y)}containsRect(t){if(this.angle===0)return this.actualBounds.containsRect(t);const e=this.naturalBounds,i=Rect.z(0,0,e.width,e.height),s=this.v;let n=!1;const o=Point.z(t.x,t.y);return i.containsPoint(s.Ci(o))&&(o.e(t.x,t.bottom),i.containsPoint(s.Ci(o))&&(o.e(t.right,t.bottom),i.containsPoint(s.Ci(o))&&(o.e(t.right,t.y),i.containsPoint(s.Ci(o))&&(n=!0)))),Point.i(o),Rect.i(i),n}containedInRect(t,e){if(e===void 0)return t.containsRect(this.actualBounds);const i=this.naturalBounds,s=e;let n=!1;const o=Point.z(0,0);return t.containsPoint(s.gt(o))&&(o.e(0,i.height),t.containsPoint(s.gt(o))&&(o.e(i.width,i.height),t.containsPoint(s.gt(o))&&(o.e(i.width,0),t.containsPoint(s.gt(o))&&(n=!0)))),Point.i(o),n}intersectsRect(t,e){if(e===void 0&&(e=this.v,this.angle===0))return t.intersectsRect(this.actualBounds);const i=this.naturalBounds,s=e,n=Point.z(0,0),o=Point.z(0,i.height),r=Point.z(i.width,i.height),l=Point.z(i.width,0);let a=!1;if(t.containsPoint(s.gt(n))||t.containsPoint(s.gt(o))||t.containsPoint(s.gt(r))||t.containsPoint(s.gt(l)))a=!0;else{const h=Rect.z(0,0,i.width,i.height),c=Point.z(t.x,t.y);h.containsPoint(s.Ci(c))?a=!0:(c.e(t.x,t.bottom),h.containsPoint(s.Ci(c))?a=!0:(c.e(t.right,t.bottom),h.containsPoint(s.Ci(c))?a=!0:(c.e(t.right,t.y),h.containsPoint(s.Ci(c))&&(a=!0)))),Point.i(c),Rect.i(h),a||(G.lx(t,n,o)||G.lx(t,o,r)||G.lx(t,r,l)||G.lx(t,l,n))&&(a=!0)}return Point.i(n),Point.i(o),Point.i(r),Point.i(l),a}getDocumentPoint(t,e){if(e===void 0&&(e=new Point),t instanceof Spot){const i=t,s=this.naturalBounds;return e.e(i.x*s.width+i.offsetX,i.y*s.height+i.offsetY),this.Ws.gt(e),e}else return e.set(t),this.Ws.gt(e),e}getDocumentBounds(t){t===void 0&&(t=new Rect);const e=this.naturalBounds,i=this.Ws,s=Point.z(0,0).v(i);return t.e(s.x,s.y,0,0),s.e(e.width,0).v(i),t.re(s.x,s.y,0,0),s.e(e.width,e.height).v(i),t.re(s.x,s.y,0,0),s.e(0,e.height).v(i),t.re(s.x,s.y,0,0),Point.i(s),t}getDocumentAngle(){return this.Ws.KF()}getDocumentScale(){if(this.Hp()===!1)return this.Th;const t=this.it;return this.panel!==null?t*this.panel.getDocumentScale():t}getLocalPoint(t,e){return e===void 0&&(e=new Point),e.h(t),this.Ws.Ci(e),e}getNearestIntersectionPoint(t,e,i){return this.mf(t.x,t.y,e.x,e.y,i)}mf(t,e,i,s,n){const o=this.v,r=1/(o.m11*o.m22-o.m12*o.m21),l=o.m22*r,a=-o.m12*r,h=-o.m21*r,c=o.m11*r,f=r*(o.m21*o.dy-o.m22*o.dx),u=r*(o.m12*o.dx-o.m11*o.dy),d=t*l+e*h+f,m=t*a+e*c+u,g=i*l+s*h+f,p=i*a+s*c+u;n.e(0,0);const y=this.naturalBounds,x=G.Cl(0,0,y.width,y.height,d,m,g,p,n);return n.v(o),x}ht(t,e,i,s){if(this.Xo()===!1)return;const n=this.il,o=n.right+n.left,r=n.top+n.bottom;t=Math.max(t-o,0),e=Math.max(e-r,0),i=i||0,s=s||0,i=Math.max(i-o,0),s=Math.max(s-r,0);const l=this.angle;let a=0;const h=this.desiredSize,c=this.qp();l===90||l===270?(t=isFinite(h.height)?h.height+c:t,e=isFinite(h.width)?h.width+c:e):(t=isFinite(h.width)?h.width+c:t,e=isFinite(h.height)?h.height+c:e);let f=i||0,u=s||0;const d=this instanceof Panel;switch(this.Zs(!0)){case 0:f=0,u=0,d&&(t=1/0,e=1/0);break;case 2:isFinite(t)&&t>i&&(f=t),isFinite(e)&&e>s&&(u=e);break;case 5:isFinite(t)&&t>i&&(f=t),u=0,d&&(e=1/0);break;case 4:isFinite(e)&&e>s&&(u=e),f=0,d&&(t=1/0);break}const g=this.maxSize,p=this.minSize;f>g.width&&p.width<g.width&&(f=g.width),u>g.height&&p.height<g.height&&(u=g.height),i=Math.max(f,p.width),s=Math.max(u,p.height),g.width<i&&(i=Math.min(p.width,i)),g.height<s&&(s=Math.min(p.height,s)),t=Math.min(g.width,t),e=Math.min(g.height,e),t=Math.max(i,t),e=Math.max(s,e),(l===90||l===270)&&(a=t,t=e,e=a,a=i,i=s,s=a),this.hi.ce(),this.bd(t,e,i,s),this.hi.k(),this.hi.isReal()||U.o("Non-real measuredBounds has been set. Object "+this+", measuredBounds: "+this.hi.toString()),this.xi(!1)}bd(t,e,i,s){}Qs(){return!1}Ut(t,e,i,s,n){this.pf();const o=Rect.l();o.h(this.De),this.De.ce(),this.as()===!1?this.De.e(t,e,i,s):this.Pa(t,e,i,s),this.De.k(),n===void 0?this.he=null:this.he=n;let r=!1;if(n!==void 0)r=!0;else{let l=this.panel;if(l!==null&&l.nl()&&(l=l.panel),l!==null){const a=l.Ke,h=this.measuredBounds,c=e+h.height,f=t+h.width;if(r=!(0<=t+.05&&f<=a.width+.05&&0<=e+.05&&c<=a.height+.05),this instanceof TextBlock){const u=this.naturalBounds;(this.jp>u.height||this.pe>u.width)&&(r=!0)}}}r?this.n|=256:this.n&=-257,this.De.isReal()||U.o("Non-real actualBounds has been set. Object "+this+", actualBounds: "+this.De.toString()),this.kd(o,this.De),this.lo(!1),Rect.i(o)}Pa(t,e,i,s){}commonArrange(t,e,i,s){if(this.De.e(t,e,i,s),this.desiredSize.isReal())return;const n=this.hi,o=this.il,r=o.right+o.left,l=o.top+o.bottom,a=n.width+r,h=n.height+l;i+=r,s+=l;let c=this.Zs(!0);switch(a===i&&h===s&&(c=0),c){case 0:(a>i||h>s)&&(this.xi(!0),this.ht(a>i?i:a,h>s?s:h,0,0));break;case 2:this.xi(!0),this.ht(i,s,0,0);break;case 5:this.xi(!0),this.ht(i,h,0,0);break;case 4:this.xi(!0),this.ht(a,s,0,0);break}}kd(t,e){const i=this.part;i!==null&&i.diagram!==null&&((i.selectionObject===this||i.resizeObject===this||i.rotateObject===this)&&i.CN(!0),this.C(),!t.equalsApproxClose(e)&&(i.Sa(),this.Wp(i)))}Wp(t){this.portId!==null&&(t.CN(!0),t instanceof Node&&t.invalidateConnectedLinks(void 0,this))}get shadowVisible(){return this.w!==null?this.w.Jp:null}set shadowVisible(t){const e=this.shadowVisible;e!==t&&(this.Yt().Jp=t,this.Ji(!0),this.C(),this.t("shadowVisible",e,t))}rI(t,e){const i=this.naturalBounds,s=this.wa,n=s.m11,o=s.m21,r=s.dx,l=s.m12,a=s.m22,h=s.dy;let c=0,f=0,u=c,d=f;c=u*n+d*o+r,f=u*l+d*a+h;let m=c,g=f,p=0,y=0;u=i.width+e,d=0,c=u*n+d*o+r,f=u*l+d*a+h;let x=Math.min(m,c),b=Math.min(g,f);p=Math.max(m+p,c)-x,y=Math.max(g+y,f)-b,m=x,g=b,u=i.width+e,d=i.height+e,c=u*n+d*o+r,f=u*l+d*a+h,x=Math.min(m,c),b=Math.min(g,f),p=Math.max(m+p,c)-x,y=Math.max(g+y,f)-b,m=x,g=b,u=0,d=i.height+e,c=u*n+d*o+r,f=u*l+d*a+h,x=Math.min(m,c),b=Math.min(g,f),p=Math.max(m+p,c)-x,y=Math.max(g+y,f)-b,m=x,g=b;const k=t.viewportBounds,P=k.x,S=k.y,L=k.width,C=k.height;return m>L+P||P>p+m||g>C+S||S>y+g}Ge(t,e){if(this.lI(t,e)||!this.visible)return;const i=this.opacity;if(i===0)return;let s=1;i!==1&&(s=t.globalAlpha,t.globalAlpha=s*i);let n="";this.filter!==""&&(n=t.filter,t.filter=this.filter);const o=this.v,r=this.panel;this.Hp()===!0&&this.R1();const l=this.part;let a=!1,h=0;if(l&&e.getRenderingHint("drawShadows")&&(a=l.isShadowed,a)){const g=l.shadowOffset;h=Math.max(g.y,g.x)*e.scale*e.$e}const c=this instanceof Panel&&this.nl(),f=this.De;if(c&&(this._T(a,t,!1,r),this.aI(t,e),this.tD(a,t,!1,r),this.eD(a,t,!1)),c||!c&&(f.width===0||f.height===0||isNaN(f.x)||isNaN(f.y))){i!==1&&(t.globalAlpha=s),this.filter!==""&&(t.filter=n);return}const u=this.Qs();if(!e.ph&&u&&this.rI(e,h)){i!==1&&(t.globalAlpha=s),this.filter!==""&&(t.filter=n);return}let d=(this.n&256)!==0;if(t.clipInsteadOfFill&&(d=!1),this instanceof TextBlock&&(t.font=this.font),d){const g=r.Mn()?r.naturalBounds:r.actualBounds;let p=Math.max(f.x,g.x),y=Math.max(f.y,g.y),x=Math.min(f.right,g.right)-p,b=Math.min(f.bottom,g.bottom)-y;const k=this.he;if(k!==null&&(p=k.x,y=k.y,x=k.width,b=k.height),p>f.width+f.x||f.x>g.width+g.x){i!==1&&(t.globalAlpha=s),this.filter!==""&&(t.filter=n);return}t.save(),t.beginPath(),t.rect(p,y,x,b),t.clip()}if(u){if(!l.isVisible()){i!==1&&(t.globalAlpha=s),this.filter!==""&&(t.filter=n);return}if(a){const g=l.shadowOffset;t.shadowsSet(g.x*e.scale*this.scale*e.$e,g.y*e.scale*this.scale*e.$e,l.shadowBlur),t.shadowsOn(),t.shadowColor=l.shadowColor}}const m=this.naturalBounds;if(t.transform(o.m11,o.m12,o.m21,o.m22,o.dx,o.dy),this._T(a,t,u,r),this.Lt!==null&&(t.commitTransform(),this.O1(t,m,f)),this.tD(a,t,u,r),this.Ma(t,e),this.eD(a,t,u),d&&(t.restore(),t.clearContextCache(this instanceof Panel)),!o.RP()){const g=1/(o.m11*o.m22-o.m12*o.m21);t.transform(o.m22*g,-o.m12*g,-o.m21*g,o.m11*g,g*(o.m21*o.dy-o.m22*o.dx),g*(o.m12*o.dx-o.m11*o.dy))}i!==1&&(t.globalAlpha=s),this.filter!==""&&(t.filter=n)}_T(t,e,i,s){t&&this.shadowVisible===!0?e.shadowsOn():t&&this.shadowVisible===!1&&e.shadowsOff(),t&&this.I1(s)&&this.shadowVisible===null&&e.shadowsOff()}tD(t,e,i,s){t&&(this.Lt!==null||this.I1(s))?(this.E1(!0),this.shadowVisible===null&&e.shadowsOff()):this.E1(!1)}eD(t,e,i){t&&this.LN()===!0&&e.shadowsOn(),i&&t&&e.shadowsOff()}hI(t,e,i){const s=this.part;let n=!1;s&&t.getRenderingHint("drawShadows")&&(n=s.isShadowed),e.clipInsteadOfFill&&(n=!1),this.Qs()&&n&&e.shadowsOn(),n&&this.shadowVisible===!0?e.shadowsOn():n&&this.shadowVisible===!1&&e.shadowsOff();const o=this.panel;if(n&&this.I1(o)&&this.shadowVisible===null&&e.shadowsOff(),e.ol){const r=t.computePixelRatio(),l=`drop-shadow(${e.shadowOffsetX/r}px ${e.shadowOffsetY/r}px ${e.shadowBlur/r/2}px ${e.shadowColor})`;this.background!==null&&i.Lt.setAttributeNS(null,"filter",l)}return n&&(this.Lt!==null||this.I1(o))?(this.E1(!0),this.shadowVisible===null&&e.shadowsOff()):this.E1(!1),n}cI(t,e,i,s){if(i.ol){const n=e.computePixelRatio(),o=`drop-shadow(${i.shadowOffsetX/n}px ${i.shadowOffsetY/n}px ${i.shadowBlur/n/2}px ${i.shadowColor})`;this.AN(t,o)}s&&this.LN()===!0&&i.shadowsOn(),this.Qs()&&i.shadowsOff()}I1(t){return t===null?!1:(t.nl()&&(t=t.panel),t.LN()||(t.type===Panel.Auto||t.type===Panel.Spot)&&t.findMainElement()!==this)}AN(t,e){}O1(t,e,i){const s=this.qp(),n=e.x,o=e.y,r=e.width+s,l=e.height+s;this.bn(t,this.Lt,!0,!1,e,i),this.Lt instanceof Brush&&this.Lt.type===3?(t.beginPath(),t.rect(n-s/2,o-s/2,r,l),t.fillContext(this.Lt,!1,null)):t.fillRect(n-s/2,o-s/2,r,l)}iD(t,e){let i=t.fI(this);const s=t.xa!==null?t.xa:t.svg;if(s!==null&&i!==-1){for(;i!==0&&!t.elt(i-1).isVisibleObject();)i--;if(i===0)this.uI(t,e,s);else{const n=t.elt(i-1).svg;n!==null?n.after(e):s.appendChild(e)}}}uI(t,e,i){if(t.type===Panel.Table){const s=i.getElementsByClassName("gojs-ts"),n=s.length!==0?s[0]:null;n!==null&&n.after(e)}else i.Lt?i.Lt.after(e):i.prepend(e)}lI(t,e){if(!(t instanceof SVGContext))return!1;if(!this.visible||this.opacity===0)return this.svg!==null&&this.svg.parentNode!==null&&this.svg.remove(),!0;const i=this.De;if(this.Qs()&&(!this.isVisible()||i.width===0||i.height===0||isNaN(i.x)||isNaN(i.y)))return this.svg!==null&&this.svg.parentNode!==null&&this.svg.remove(),!0;t.setCurrentTransform(1,0,0,1,0,0);const s=this.panel,n=this.Pd(t);if(this.yf(t,e,n))return this.sD(this.svg),this.svg.parentElement!==null?(this.Qs()&&(t.lastDrawnPart=this.svg),!0):(this.Qs()?(t.lastDrawnPart!==null?t.lastDrawnPart.after(this.svg):t.diagramGroup.prepend(this.svg),t.lastDrawnPart=this.svg):s&&this.iD(s,this.svg),!0);if(this.Ji(!1),this.Qs()&&this.isShadowed){const m=this.shadowOffset;t.shadowsSet(m.x*e.scale*this.scale*e.$e,m.y*e.scale*this.scale*e.$e,this.shadowBlur),t.shadowsOn(),t.shadowColor=this.shadowColor}this instanceof TextBlock&&(t.font=this.font),t.currentElement=null;const o=this.v,r=this instanceof Panel,l=this instanceof Panel?this.nl():!1,a=this.svg;if(this.Hp()===!0&&this.R1(),t.outerGroup=!1,n)if(t.outerGroup=!0,r&&l)t.newGroup(1,0,0,1,0,0),this.svg=t.lastCreatedElement;else if(r&&this.isClipping){const m=this.findMainElement();let g=0,p=0;m!==null&&(g=m.actualBounds.x,p=m.actualBounds.y),t.newGroup(o.m11,o.m12,o.m21,o.m22,o.dx+g,o.dy+p),this.svg=t.lastCreatedElement,m!==null&&t.createOrUpdateClipGroup(this,m.actualBounds),t.currentElement=t.lastCreatedElement}else r?(t.newGroup(o.m11,o.m12,o.m21,o.m22,o.dx,o.dy),this.svg=t.lastCreatedElement):t.newGroup(1,0,0,1,0,0);const h=this.naturalBounds;r||t.setCurrentTransform(o.m11,o.m12,o.m21,o.m22,o.dx,o.dy),this.background!==null&&(r?(l&&t.setCurrentTransform(o.m11,o.m12,o.m21,o.m22,o.dx,o.dy),this.O1(t,h,i),l&&t.setCurrentTransform(1,0,0,1,0,0)):(t.setCurrentTransform(o.m11,o.m12,o.m21,o.m22,o.dx,o.dy),this.O1(t,h,i)),t.currentElement.Lt=t.lastCreatedElement,t.currentElement.prepend(t.lastCreatedElement));const c=this.hI(e,t,t.currentElement);this.Ma(t,e),r&&t.endGroup(),t.outerGroup&&t.endGroup();const f=t.surface.ud,u=r?this.svg:t.currentElement;if(a!==null&&a.parentNode!==null&&u!==a&&(this.panel===null||a.parentNode===this.panel.svg)){const m=this.svg.getAttribute("filter");return m!==null&&u.setAttribute("filter",m),this.filter!==""&&u.setAttributeNS(null,"filter",this.filter),a.replaceWith(u),this.svg=u,u!==null&&this.$p(t,s,i,u),!0}if(this.svg=u,f!==null&&u===null&&t.dummyGroup(),u===null)return!0;this.$p(t,s,i,u),this.cI(u,e,t,c);const d=this.Qs()?this.opacity*t.globalAlpha:this.opacity;if(d!==1&&u.setAttributeNS(null,"opacity",d.toString()),this.filter!==""&&u.setAttributeNS(null,"filter",this.filter),this.Qs()){if(a!==null&&u!==a&&a.parentNode===t.diagramGroup){const m=a.getAttribute("filter");m!==null&&u.setAttribute("filter",m),a.replaceWith(u)}else t.lastDrawnPart?t.lastDrawnPart.after(u):t.diagramGroup.prepend(u);t.lastDrawnPart=u}else s!==null&&this.iD(s,u);return f!==null&&f(this,u),this.sD(u),!0}sD(t){const e=this,i=t.dataset;e instanceof GraphObject&&(e.portId!==null&&(i.portId=e.portId),e instanceof Panel&&(isNaN(e.itemIndex)||(i.itemIndex=e.itemIndex.toString()),e instanceof Part&&(i.className=U.Kn(e),e.key!==void 0&&(i.key=e.key.toString()),e.containingGroup!==null&&(i.group=e.containingGroup.key.toString()),e instanceof Link&&(e.fromNode!==null&&e.fromNode.key!==void 0&&(i.fromKey=e.fromNode.key.toString()),e.fromPortId!==""&&(i.fromPortId=e.fromPortId),e.toNode!==null&&e.toNode.key!==void 0&&(i.toKey=e.toNode.key.toString()),e.toPortId!==""&&(i.toPortId=e.toPortId)))))}$p(t,e,i,s){let n=(this.n&256)!==0;if(t.clipInsteadOfFill&&(n=!1),!n){s.removeAttributeNS(null,"clip-path");return}const o=e.Mn()?e.naturalBounds:e.actualBounds;let r=Math.max(i.x,o.x),l=Math.max(i.y,o.y),a=Math.min(i.right,o.right)-r,h=Math.min(i.bottom,o.bottom)-l;const c=this.he;c!==null&&(r=c.x,l=c.y,a=c.width,h=c.height);const f=Rect.z(r,l,Math.max(a,0),Math.max(h,0));if(this instanceof Panel){const u=Transform.l();u.set(this.v),u.ex(),u.sm(f),Transform.i(u)}s.setAttributeNS(null,"clip-path",`path('      M ${f.x},${f.y}       L ${f.width+f.x} ${f.y}       L ${f.width+f.x} ${f.height+f.y}       L ${f.x} ${f.height+f.y} z') view-box`),Rect.i(f)}dI(){if(this.svg===null)return;const t=this.svg.innerHTML.match(/url\(#((CLIP|GRAD).+?)\)/g),e=this.svg.ownerDocument;if(t!==null)for(const i of t){const s=e.getElementById(i.split("#")[1].slice(0,-1));s!==null&&s.remove()}this.svg.remove()}aI(t,e){const i=this.De,s=this.Ke,n=this.Lt;n!==null&&t.commitTransform(),n!==null&&(this.bn(t,n,!0,!1,s,i),n instanceof Brush&&n.type===3?(t.beginPath(),t.rect(i.x,i.y,i.width,i.height),t.fillContext(n,!1,null)):t.fillRect(i.x,i.y,i.width,i.height)),this.Ma(t,e)}Ma(t,e){}wf(){this.Ji(!0)}yf(t,e,i){const s=this.svg;if(this.gI()){if(this.wf(),this.Ji(!1),s===null)return!1;const c=s.getAttribute("clip-path");if(c!==null&&c.includes("url")){const u=t.svg.getElementById(c.split("#")[1].slice(0,-1));u!==null&&u.remove()}return s.getAttribute("filter")&&s.removeAttribute("filter"),!1}if(s===null)return!1;if(!this.visible)return s.remove(),!1;if(s.nodeName!=="g"&&i||s.nodeName==="g"&&!i)return!1;const n=this.v,o="matrix("+n.m11+", "+n.m12+", "+n.m21+", "+n.m22+", "+n.dx+", "+n.dy+")",r=this instanceof Panel,l=r?this.nl():!1;if(!(r&&l))if(this instanceof Picture){const c=this.U1;t.setCurrentTransform(n.m11,n.m12,n.m21,n.m22,n.dx,n.dy),c!==null&&t.amendImageTransform(c[0],c[1],c[2],c[3],c[4],c[5],c[6],c[7]),i?s.lastElementChild.setAttributeNS(null,"transform",t.getCurrentTransform()):s.setAttributeNS(null,"transform",t.getCurrentTransform())}else if(i&&!r)if(this instanceof Shape){const c=s.getElementsByTagName("path");for(let f=0;f<c.length;f++)c[f].setAttributeNS(null,"transform",o)}else if(this instanceof TextBlock){const c=s.getElementsByTagName("text"),f=typeof this.stroke=="string"?this.stroke:null;for(let u=0;u<c.length;u++)c[u].setAttributeNS(null,"transform",o),f&&c[u].setAttributeNS(null,"fill",f)}else(s.lastElementChild||s).setAttributeNS(null,"transform",o);else if(r&&this.isClipping&&this.xa){const c=this.findMainElement(),f=c!==null?c.actualBounds.x:0,u=c!==null?c.actualBounds.y:0;this.xa.setAttributeNS(null,"transform","matrix(1,0,0,1,"+-f+", "+-u+")"),s.setAttributeNS(null,"transform","matrix("+n.m11+", "+n.m12+", "+n.m21+", "+n.m22+", "+(n.dx+f)+", "+(n.dy+u)+")")}else s.setAttributeNS(null,"transform",o);const a=this.Qs()?this.opacity*t.globalAlpha:this.opacity;a===1?s.removeAttribute("opacity"):s.setAttributeNS(null,"opacity",a.toString()),t.setCurrentTransform(1,0,0,1,0,0);const h=this.xa?this.xa:this.F1;if(this.background!==null||h.Lt!==void 0){const c=h.Lt;if(this.background===null)t.removeOldGradient(this,h.Lt,"fill"),h.Lt.remove(),h.Lt=void 0;else{if((l||i&&!(this instanceof Panel))&&t.setCurrentTransform(n.m11,n.m12,n.m21,n.m22,n.dx,n.dy),this.O1(t,this.naturalBounds,this.actualBounds),h.Lt){t.removeOldGradient(this,h.Lt,"fill");const f=h.Lt.getAttribute("filter");f!==null&&t.lastCreatedElement.setAttribute("filter",f),h.Lt.replaceWith(t.lastCreatedElement)}else h.prepend(t.lastCreatedElement);h.Lt=t.lastCreatedElement}c&&t.removeOldGradient(this,c,"fill")}return this.$p(t,this.panel,this.actualBounds,s),!0}Pd(t){if(this.background!==null)return!0;let e=(this.n&256)!==0;return t.clipInsteadOfFill&&(e=!1),!!e}static UU(t,e,i,s,n,o,r){let l=.001;const a=o.length;t.moveTo(e,i);let h=s-e;const c=n-i;h===0&&(h=.001);const f=c/h;let u=Math.sqrt(h*h+c*c),d=0,m=!0;l=o[d%a];let g=r!==0;for(;u>=.1;){if(g){for(l=o[d++%a],l-=r;l<0;)l+=o[d++%a],m=!m;g=!1}else l=o[d++%a];l>u&&(l=u);let p=Math.sqrt(l*l/(1+f*f));h<0&&(p=-p),e+=p,i+=f*p,m?t.lineTo(e,i):t.moveTo(e,i),u-=l,m=!m}}bn(t,e,i,s,n,o){let r=1,l=1;if(typeof e=="string"){i?t.fillStyle=e:t.strokeStyle=e;return}else if(e.type===1){i?t.fillStyle=e.color:t.strokeStyle=e.color;return}let a;const h=this.qp();r=n.width,l=n.height,s?(r=o.width,l=o.height):i||(r+=h,l+=h);const c=t instanceof CanvasSurfaceContext;if(c&&e.Nn&&(e.type===4||e.xf===r&&e.V1===l))a=e.Nn;else{let f=0,u=0,d=0,m=0,g=0,p=0,y=0,x=0;if(s?(y=o.x,x=o.y):i||(y-=h/2,x-=h/2),f=e.start.x*r+e.start.offsetX+y,u=e.start.y*l+e.start.offsetY+x,d=e.end.x*r+e.end.offsetX+y,m=e.end.y*l+e.end.offsetY+x,e.type===2)a=t.createLinearGradient(f,u,d,m);else if(e.type===3)p=isNaN(e.endRadius)?Math.max(r,l)/2:e.endRadius,isNaN(e.startRadius)?(g=0,p=Math.max(r,l)/2):g=e.startRadius,a=t.createRadialGradient(f,u,g,d,m,p);else if(e.type===4)try{a=t.createPattern(e.pattern,"repeat")}catch{a=null}else U.si(e.type,"Brush type");if(e.type!==4){const b=e.colorStops;if(b!==null){const k=b.iterator;for(;k.next();)a.addColorStop(k.key,k.value)}}if(c&&(e.Nn=a,a!==null&&(e.xf=r,e.V1=l),a===null&&e.type===4&&e.xf!==-1)){e.xf=-1;const b=this.diagram;b!==null&&e.xf===-1&&U.un(()=>{b.redraw()},600)}}i?t.fillStyle=a:t.strokeStyle=a}isContainedBy(t){return t instanceof Panel?this.mI(this,t):!1}mI(t,e){if(t===e||e===null)return!1;let i=t.panel;for(;i!==null;){if(i===e)return!0;i=i.panel}return!1}isVisibleObject(){if(!this.visible)return!1;const t=this.panel;return t!==null?t.isVisibleObject():!0}isEnabledObject(){let t=this instanceof Panel?this:this.panel;for(;t!==null&&t.isEnabled;)t=t.panel;return t===null}get enabledChanged(){return this.w!==null?this.w.Zp:null}set enabledChanged(t){const e=this.enabledChanged;e!==t&&(t!==null&&U.S(t,GraphObject,"enabledChanged"),this.Yt().Zp=t,this.t("enabledChanged",e,t))}R1(){if(this.B1()===!0){const t=this.el;if(t.Ue(),!this.De.isReal()||!this.hi.isReal()){this.Sd(!1),this.Na(!1);return}if(t.Xs(this.De.x-this.hi.x,this.De.y-this.hi.y),this.scale!==1||this.angle!==0){const e=this.naturalBounds;this.Kp(t,e.x,e.y,e.width,e.height)}this.Sd(!1),this.Na(!0)}if(this.Hp()===!0){const t=this.panel;if(t===null)this.wa.set(this.el),this.Th=this.scale;else if(t.Ws!==null){const e=this.wa;e.Ue(),t.Mn()?e.bc(t.wa):t.panel!==null&&e.bc(t.panel.wa),e.bc(this.el),this.Th=this.scale*t.Th}this.Na(!1)}}Kp(t,e,i,s,n){if(this.it!==1&&t.it(this.it),this.Xt===0)return;const o=Point.l();o.setSpot(e,i,s,n,Spot.Center),t.ks(this.Xt,o.x,o.y),Point.i(o)}f(t){if(this.Xo())return;t===void 0&&(t=!1),this.xi(!0),this.lo(!0);const e=this.panel;e!==null&&!t&&e.f()}bf(){this.Xo()||(this.xi(!0),this.lo(!0))}kf(t){if(this.as())return;const e=this.panel;!t&&e!==null&&e.f(),this.lo(!0)}pf(){this.B1()===!1&&(this.Sd(!0),this.Na(!0))}TN(){this.Na(!0)}C(){const t=this.part;t!==null&&t.C()}Zs(t){const e=this.stretch,i=this.panel;if(i===null)return this.qo(e===1?0:e,t);if(i.type===Panel.Table)return this.Qp(i.getRowDefinition(this.row),i.getColumnDefinition(this.column),t);if(i.type===Panel.Auto&&i.findMainElement()===this)return this.qo(2,t);if(e===1){if(i.type===Panel.Spot&&i.findMainElement()===this)return this.qo(2,t);const s=i.defaultStretch;return s===1?this.qo(0,t):this.qo(s,t)}return this.qo(e,t)}Qp(t,e,i){const s=this.stretch;if(s!==1)return this.qo(s,i);let n=null,o=null;switch(t.stretch){case 1:case 5:break;case 4:o=!0;break;case 2:o=!0;break}switch(e.stretch){case 1:case 4:break;case 5:n=!0;break;case 2:n=!0;break}const r=this.panel.defaultStretch;return n===null&&(n=r===5||r===2),o===null&&(o=r===4||r===2),n===!0&&o===!0?this.qo(2,i):n===!0?this.qo(5,i):o===!0?this.qo(4,i):this.qo(0,i)}qo(t,e){if(e)return t;if(t===0)return 0;const i=this.desiredSize;if(i.isReal())return 0;const s=!isNaN(i.width),n=!isNaN(i.height),o=this.angle;if(s)if(o!==90&&o!==270){if(t===5)return 0;if(t===2)return 4}else{if(t===4)return 0;if(t===2)return 5}if(n)if(o!==90&&o!==270){if(t===4)return 0;if(t===2)return 5}else{if(t===5)return 0;if(t===2)return 4}return t}get segmentOrientation(){return this.Ot!==null?this.Ot._p:0}set segmentOrientation(t){const e=this.segmentOrientation;e!==t&&(this.Ot===null&&(this.Ot=new LinkElementSettings),this.Ot._p=t,this.f(),this.t("segmentOrientation",e,t),t===0&&(this.angle=0))}pI(){this.segmentOrientation=21}get segmentIndex(){return this.Ot!==null?this.Ot.t0:-1/0}set segmentIndex(t){t=Math.round(t);const e=this.segmentIndex;e!==t&&(this.Ot===null&&(this.Ot=new LinkElementSettings),this.Ot.t0=t,this.f(),this.t("segmentIndex",e,t))}get segmentFraction(){return this.Ot!==null?this.Ot.e0:0}set segmentFraction(t){t<0?t=0:t>1&&(t=1);const e=this.segmentFraction;e!==t&&(this.Ot===null&&(this.Ot=new LinkElementSettings),this.Ot.e0=t,this.f(),this.t("segmentFraction",e,t))}get segmentOffset(){return this.Ot!==null?this.Ot.i0:Point.dn}set segmentOffset(t){const e=this.segmentOffset;e.equals(t)||(t=t.N(),this.Ot===null&&(this.Ot=new LinkElementSettings),this.Ot.i0=t,this.f(),this.t("segmentOffset",e,t))}get stretch(){return this.w!==null?this.w.ao:1}set stretch(t){const e=this.stretch;e!==t&&(this.Yt().ao=t,this.f(),this.t("stretch",e,t))}get name(){return this.w!==null?this.w.Pt:""}set name(t){const e=this.name;e!==t&&(this.Yt().Pt=t,this.part!==null&&this.part.s0(),this.t("name",e,t))}get opacity(){return this.Zt}set opacity(t){t<0?t=0:t>1&&(t=1);const e=this.opacity;if(e!==t){this.Zt=t,this.t("opacity",e,t);const i=this.diagram,s=this.part;i!==null&&s!==null&&i.C(s.hh(s.actualBounds))}}get filter(){return this.Gp}set filter(t){const e=this.filter;if(e!==t){this.Gp=t,this.Ji(!0),this.t("filter",e,t);const i=this.diagram,s=this.part;i!==null&&s!==null&&i.C(s.hh(s.actualBounds))}}get visible(){return(this.n&1)!==0}set visible(t){const e=(this.n&1)!==0;if(e!==t){this.n=this.n^1,this.wf(),this.t("visible",e,t);const i=this.panel;i!==null?i.f():this.Qs()&&this.Xe(t),this.C(),this.nD()}}get pickable(){return(this.n&2)!==0}set pickable(t){const e=(this.n&2)!==0;e!==t&&(this.n=this.n^2,this.t("pickable",e,t))}get fromLinkableDuplicates(){return(this.n&4)!==0}set fromLinkableDuplicates(t){const e=(this.n&4)!==0;e!==t&&(this.n=this.n^4,this.t("fromLinkableDuplicates",e,t))}get fromLinkableSelfNode(){return(this.n&8)!==0}set fromLinkableSelfNode(t){const e=(this.n&8)!==0;e!==t&&(this.n=this.n^8,this.t("fromLinkableSelfNode",e,t))}get toLinkableDuplicates(){return(this.n&16)!==0}set toLinkableDuplicates(t){const e=(this.n&16)!==0;e!==t&&(this.n=this.n^16,this.t("toLinkableDuplicates",e,t))}get toLinkableSelfNode(){return(this.n&32)!==0}set toLinkableSelfNode(t){const e=(this.n&32)!==0;e!==t&&(this.n=this.n^32,this.t("toLinkableSelfNode",e,t))}get isPanelMain(){return(this.n&64)!==0}set isPanelMain(t){const e=(this.n&64)!==0;e!==t&&(this.n=this.n^64,this.f(),this.t("isPanelMain",e,t))}get isActionable(){return(this.n&128)!==0}set isActionable(t){const e=(this.n&128)!==0;e!==t&&(this.n=this.n^128,this.t("isActionable",e,t))}get background(){return this.Lt}set background(t){const e=this.background;e!==t&&(t!==null&&Brush.Md(t,"GraphObject.background"),t instanceof Brush&&t.k(),this.Lt=t,this.C(),this.t("background",e,t))}LN(){return(this.n&512)!==0}E1(t){t?this.n|=512:this.n&=-513}gf(){return(this.n&1024)!==0}DN(t){t?this.n|=1024:this.n&=-1025}B1(){return(this.n&2048)!==0}Sd(t){t?this.n|=2048:this.n&=-2049}Hp(){return(this.n&4096)!==0}Na(t){t?this.n|=4096:this.n&=-4097}Xo(){return(this.n&8192)!==0}xi(t){t?this.n|=8192:this.n&=-8193}as(){return(this.n&16384)!==0}lo(t){t?this.n|=16384:this.n&=-16385}gI(){return(this.n&32768)!==0}Ji(t){t?this.n|=32768:this.n&=-32769}get part(){if(this.Qs())return this;if(this.sl!==null)return this.sl;let t=this;for(t=t.panel;t;){if(t instanceof Part)return this.sl=t,t;t=t.panel}return null}get svg(){return this.F1}set svg(t){this.F1=t}jc(){this.svg=null}get panel(){return this.$s}Uh(t){this.$s=t,this.svg!==null&&this.svg.remove()}get layer(){const t=this.part;return t!==null?t.layer:null}get diagram(){const t=this.part;return t!==null?t.diagram:null}get position(){return this.ct}set position(t){const e=t.x,i=t.y,s=this.position,n=s.x,o=s.y;n!==e&&(!isNaN(n)||!isNaN(e))||o!==i&&(!isNaN(o)||!isNaN(i))?(t=t.copy(),this.vN(t,n,o)&&this.t("position",new Point(n,o),t.copy())):this.FN()}FN(){}vN(t,e,i){return this.ct=t,this.kf(),!0}Ec(t,e,i){this.ct.x===t&&this.ct.y===e||(this.ct.e(t,e),this.pf())}get actualBounds(){return this.De}get scale(){return this.it}set scale(t){const e=this.scale;e!==t&&(t<=0&&U.o("GraphObject.scale for "+this+" must be greater than zero, not: "+t),this.it=t,this.f(),this.t("scale",e,t))}get angle(){return this.Xt}set angle(t){const e=this.angle;if(e!==t){if(t=t%360,t<0&&(t+=360),e===t)return;this.Xt=t,this.nD(),this.f(),this.t("angle",e,t)}}get desiredSize(){return this.cs}set desiredSize(t){const e=t.width,i=t.height,s=this.desiredSize,n=s.width,o=s.height;if((n!==e&&(!isNaN(n)||!isNaN(e))||o!==i&&(!isNaN(o)||!isNaN(i)))&&(t=t.N(),this.cs=t,this.f(),this instanceof Shape&&this.ai(),this.t("desiredSize",s,t),this.gf())){const r=this.part;r!==null&&(this.Eh(r,"width"),this.Eh(r,"height"))}}get width(){return this.cs.width}set width(t){const e=this.cs.width;if(e!==t&&(!isNaN(e)||!isNaN(t))){const i=this.cs,s=new Size(t,this.cs.height).k();if(this.cs=s,this.f(),this instanceof Shape&&this.ai(),this.t("desiredSize",i,s),this.gf()){const n=this.part;n!==null&&this.Eh(n,"width")}}}get height(){return this.cs.height}set height(t){const e=this.cs.height;if(e!==t&&(!isNaN(e)||!isNaN(t))){const i=this.cs,s=new Size(this.cs.width,t).k();if(this.cs=s,this.f(),this instanceof Shape&&this.ai(),this.t("desiredSize",i,s),this.gf()){const n=this.part;n!==null&&this.Eh(n,"height")}}}get minSize(){return this.w!==null?this.w.Nr:Size.xc}set minSize(t){const e=this.minSize;e.equals(t)||(t=t.copy(),isNaN(t.width)&&(t.width=0),isNaN(t.height)&&(t.height=0),t.k(),this.Yt().Nr=t,this.f(),this.t("minSize",e,t))}get maxSize(){return this.w!==null?this.w.Cr:Size.DP}set maxSize(t){const e=this.maxSize;e.equals(t)||(t=t.copy(),isNaN(t.width)&&(t.width=1/0),isNaN(t.height)&&(t.height=1/0),t.k(),this.Yt().Cr=t,this.f(),this.t("maxSize",e,t))}get measuredBounds(){return this.hi}get naturalBounds(){return this.Ke}qp(){return 0}get margin(){return this.il}set margin(t){typeof t=="number"&&(t=new Margin(t));const e=this.il;e.equals(t)||(t=t.N(),this.il=t,this.f(),this.t("margin",e,t))}get v(){return this.B1()===!0&&this.R1(),this.el}get Ws(){return this.Hp()===!0&&this.R1(),this.wa}trigger(t,e,i){let s=null;return typeof t=="string"?s=new AnimationTrigger(t,e,i):s=t,s.Ti=this,this.Ts===null&&(this.Ts=new GMap),this.Ts.set(s.propertyName,s),this}get Ts(){return this.w!==null?this.w.Ts:null}set Ts(t){this.Ts!==t&&(this.Yt().Ts=t)}get Mr(){return this.w!==null?this.w.Mr:0}set Mr(t){this.Mr!==t&&(this.Yt().Mr=t)}get alignment(){return this.de}set alignment(t){const e=this.alignment;e.equals(t)||(t.isNoSpot()&&!t.isDefault()&&U.o("GraphObject.alignment for "+this+" must be a real Spot or Spot.Default, not: "+t),t=t.N(),this.de=t,this.kf(),this.t("alignment",e,t))}get column(){return this.pa}set column(t){t=Math.round(t);const e=this.column;e!==t&&(t<0&&U.J(t,">= 0",GraphObject,"column"),this.pa=t,this.f(),this.t("column",e,t),this.svg!==null&&this.svg.remove())}get columnSpan(){return this.w!==null?this.w.o0:1}set columnSpan(t){t=Math.round(t);const e=this.columnSpan;e!==t&&(t<1&&U.J(t,">= 1",GraphObject,"columnSpan"),this.Yt().o0=t,this.f(),this.t("columnSpan",e,t))}get row(){return this.Xp}set row(t){t=Math.round(t);const e=this.row;e!==t&&(t<0&&U.J(t,">= 0",GraphObject,"row"),this.Xp=t,this.f(),this.t("row",e,t),this.svg!==null&&this.svg.remove())}get rowSpan(){return this.w!==null?this.w.r0:1}set rowSpan(t){t=Math.round(t);const e=this.rowSpan;e!==t&&(t<1&&U.J(t,">= 1",GraphObject,"rowSpan"),this.Yt().r0=t,this.f(),this.t("rowSpan",e,t))}get spanAllocation(){return this.w!==null?this.w.l0:null}set spanAllocation(t){const e=this.spanAllocation;e!==t&&(t!==null&&U.S(t,GraphObject,"spanAllocation"),this.Yt().l0=t,this.f(),this.t("spanAllocation",e,t))}get alignmentFocus(){return this.wd}set alignmentFocus(t){const e=this.alignmentFocus;e.equals(t)||(t=t.N(),this.wd=t,this.f(),this.t("alignmentFocus",e,t))}get portId(){return this.zp}set portId(t){const e=this.portId;if(e!==t){const i=this.part;i!==null&&!(i instanceof Node)&&U.o("Cannot set portID on a Link: "+t);const s=i;e!==null&&s!==null&&s.RN(this),this.zp=t,t!==null&&s!==null&&(s.Cn=!0,s.oD(this)),this.t("portId",e,t)}}Vh(){const t=this.part;if(t instanceof Node&&(this.portId!==null||this===t.port)){const e=t.diagram;e!==null&&!e.undoManager.isUndoingRedoing&&t.invalidateConnectedLinks(void 0,this)}}nD(){const t=this.diagram;t===null||t.undoManager.isUndoingRedoing||(this instanceof Panel?this instanceof Node?this.invalidateConnectedLinks():this.walkVisualTreeFrom(this,e=>{e.Vh()}):this.Vh())}get toSpot(){return this.ft!==null?this.ft.vh:Spot.None}set toSpot(t){const e=this.toSpot;e.equals(t)||(t=t.N(),this.Wi().vh=t,this.t("toSpot",e,t),this.Vh())}get toEndSegmentLength(){return this.ft!==null?this.ft.Rh:10}set toEndSegmentLength(t){const e=this.toEndSegmentLength;e!==t&&(t<0&&U.J(t,">= 0",GraphObject,"toEndSegmentLength"),this.Wi().Rh=t,this.t("toEndSegmentLength",e,t),this.Vh())}get toShortLength(){return this.ft!==null?this.ft.Ih:0}set toShortLength(t){const e=this.toShortLength;e!==t&&(this.Wi().Ih=t,this.t("toShortLength",e,t),this.Vh())}get toLinkable(){return this.ft!==null?this.ft.a0:null}set toLinkable(t){const e=this.toLinkable;e!==t&&(this.Wi().a0=t,this.t("toLinkable",e,t))}get toMaxLinks(){return this.ft!==null?this.ft.h0:1/0}set toMaxLinks(t){const e=this.toMaxLinks;e!==t&&(t<0&&U.J(t,">= 0",GraphObject,"toMaxLinks"),this.Wi().h0=t,this.t("toMaxLinks",e,t))}get fromSpot(){return this.ft!==null?this.ft.Dh:Spot.None}set fromSpot(t){const e=this.fromSpot;e.equals(t)||(t=t.N(),this.Wi().Dh=t,this.t("fromSpot",e,t),this.Vh())}get fromEndSegmentLength(){return this.ft!==null?this.ft.Fh:10}set fromEndSegmentLength(t){const e=this.fromEndSegmentLength;e!==t&&(t<0&&U.J(t,">= 0",GraphObject,"fromEndSegmentLength"),this.Wi().Fh=t,this.t("fromEndSegmentLength",e,t),this.Vh())}get fromShortLength(){return this.ft!==null?this.ft.Oh:0}set fromShortLength(t){const e=this.fromShortLength;e!==t&&(this.Wi().Oh=t,this.t("fromShortLength",e,t),this.Vh())}get fromLinkable(){return this.ft!==null?this.ft.c0:null}set fromLinkable(t){const e=this.fromLinkable;e!==t&&(this.Wi().c0=t,this.t("fromLinkable",e,t))}get fromMaxLinks(){return this.ft!==null?this.ft.f0:1/0}set fromMaxLinks(t){const e=this.fromMaxLinks;e!==t&&(t<0&&U.J(t,">= 0",GraphObject,"fromMaxLinks"),this.Wi().f0=t,this.t("fromMaxLinks",e,t))}get cursor(){return this.w!==null?this.w.Il:""}set cursor(t){const e=this.cursor;e!==t&&(U.s(t,"string",GraphObject,"cursor"),this.Yt().Il=t,this.t("cursor",e,t))}get click(){return this.w!==null?this.w.Er:null}set click(t){const e=this.click;e!==t&&(t!==null&&U.S(t,GraphObject,"click"),this.Yt().Er=t,this.t("click",e,t))}get doubleClick(){return this.w!==null?this.w.Ur:null}set doubleClick(t){const e=this.doubleClick;e!==t&&(t!==null&&U.S(t,GraphObject,"doubleClick"),this.Yt().Ur=t,this.t("doubleClick",e,t))}get contextClick(){return this.w!==null?this.w.Vr:null}set contextClick(t){const e=this.contextClick;e!==t&&(t!==null&&U.S(t,GraphObject,"contextClick"),this.Yt().Vr=t,this.t("contextClick",e,t))}get mouseEnter(){return this.w!==null?this.w.Yr:null}set mouseEnter(t){const e=this.mouseEnter;e!==t&&(t!==null&&U.S(t,GraphObject,"mouseEnter"),this.Yt().Yr=t,this.t("mouseEnter",e,t))}get mouseLeave(){return this.w!==null?this.w.Kr:null}set mouseLeave(t){const e=this.mouseLeave;e!==t&&(t!==null&&U.S(t,GraphObject,"mouseLeave"),this.Yt().Kr=t,this.t("mouseLeave",e,t))}get mouseOver(){return this.w!==null?this.w.Br:null}set mouseOver(t){const e=this.mouseOver;e!==t&&(t!==null&&U.S(t,GraphObject,"mouseOver"),this.Yt().Br=t,this.t("mouseOver",e,t))}get mouseHover(){return this.w!==null?this.w.zr:null}set mouseHover(t){const e=this.mouseHover;e!==t&&(t!==null&&U.S(t,GraphObject,"mouseHover"),this.Yt().zr=t,this.t("mouseHover",e,t))}get mouseHold(){return this.w!==null?this.w.Xr:null}set mouseHold(t){const e=this.mouseHold;e!==t&&(t!==null&&U.S(t,GraphObject,"mouseHold"),this.Yt().Xr=t,this.t("mouseHold",e,t))}get mouseDragEnter(){return this.w!==null?this.w.u0:null}set mouseDragEnter(t){const e=this.mouseDragEnter;e!==t&&(t!==null&&U.S(t,GraphObject,"mouseDragEnter"),this.Yt().u0=t,this.t("mouseDragEnter",e,t))}get mouseDragLeave(){return this.w!==null?this.w.d0:null}set mouseDragLeave(t){const e=this.mouseDragLeave;e!==t&&(t!==null&&U.S(t,GraphObject,"mouseDragLeave"),this.Yt().d0=t,this.t("mouseDragLeave",e,t))}get mouseDrop(){return this.w!==null?this.w.Gr:null}set mouseDrop(t){const e=this.mouseDrop;e!==t&&(t!==null&&U.S(t,GraphObject,"mouseDrop"),this.Yt().Gr=t,this.t("mouseDrop",e,t))}get actionDown(){return this.w!==null?this.w.g0:null}set actionDown(t){const e=this.actionDown;e!==t&&(t!==null&&U.S(t,GraphObject,"actionDown"),this.Yt().g0=t,this.t("actionDown",e,t))}get actionMove(){return this.w!==null?this.w.m0:null}set actionMove(t){const e=this.actionMove;e!==t&&(t!==null&&U.S(t,GraphObject,"actionMove"),this.Yt().m0=t,this.t("actionMove",e,t))}get actionUp(){return this.w!==null?this.w.p0:null}set actionUp(t){const e=this.actionUp;e!==t&&(t!==null&&U.S(t,GraphObject,"actionUp"),this.Yt().p0=t,this.t("actionUp",e,t))}get actionCancel(){return this.w!==null?this.w.y0:null}set actionCancel(t){const e=this.actionCancel;e!==t&&(t!==null&&U.S(t,GraphObject,"actionCancel"),this.Yt().y0=t,this.t("actionCancel",e,t))}get toolTip(){return this.w!==null?this.w.Hr:null}set toolTip(t){const e=this.toolTip;e!==t&&(this.Yt().Hr=t,this.t("toolTip",e,t))}get contextMenu(){return this.w!==null?this.w.qr:null}set contextMenu(t){const e=this.contextMenu;e!==t&&(this.Yt().qr=t,this.t("contextMenu",e,t))}findBindingPanel(){let t=this instanceof Panel?this:this.panel;for(;t!==null;){if(t.ON())return t;t=t.panel}return null}bind(t,e,i,s){return this.Pf(t,e,i,s),this}bindTwoWay(t,e,i,s){return this.Pf(t,e,i,s).makeTwoWay(),this}bindModel(t,e,i,s){return this.Pf(t,e,i,s).ofModel(),this}bindObject(t,e,i,s,n){return this.Pf(t,e,i,s).ofObject(n),this}theme(t,e,i,s,n){return this.Ca(t,e,i,s,n),this}themeData(t,e,i,s,n){return this.Ca(t,e,i,s,n).ofData(),this}themeObject(t,e,i,s,n,o){return this.Ca(t,e,i,s,n).ofObject(o),this}themeModel(t,e,i,s,n){return this.Ca(t,e,i,s,n).ofModel(),this}Pf(t,e,i,s){let n=null;return typeof t=="string"?n=new Binding(t,e,i,s):n=t,this.w0(n),n}Ca(t,e,i,s,n){let o=null;return typeof t=="string"?o=new ThemeBinding(t,e,i,s,n):o=t,this.w0(o),o}w0(t){t.Ti=this;const e=this.findBindingPanel();e!==null&&e.rD()&&U.o("Cannot add a Binding to a template that has already been copied: "+t),this.ve===null&&(this.ve=new List),this.ve.add(t)}set(t){return t?(Object.assign(this,t),this):this}attach(t){return GraphObject.IN(this,t),this}apply(t,...e){return t.apply(this,[this,...e]),this}setProperties(t){return Diagram.Ap(this,t),this}static make(t,...e){let i=arguments,s=null,n=null;if(U.st(t))n=t;else if(typeof t=="string"){const r=GraphObject.z1.get(t);U.st(r)?(i=Array.prototype.slice.call(i),s=r(i),U.$(s)||U.o('GraphObject.make invoked object builder "'+t+'", but it did not return an Object')):n=root.go[t]}s===null&&((n==null||!n.constructor)&&U.o("GraphObject.make requires a class function or GoJS class name or name of an object builder, not: "+t),s=new n);let o=1;if(s instanceof Diagram&&i.length>1){const r=s,l=i[1];(typeof l=="string"||l instanceof HTMLDivElement)&&(r.w2(l),o++)}for(let r=o;r<i.length;r++){const l=i[r];l===void 0?U.o("Undefined value at argument "+r+" for object being constructed by GraphObject.make: "+s):s&&GraphObject.IN(s,l)}return s}static IN(t,e){if(typeof e=="number")GraphObject.yI(t,e);else if(typeof e=="string")GraphObject.wI(t,e);else if(e instanceof GraphObject)t instanceof Panel||U.o("A GraphObject can only be added to a Panel, not to: "+t),t.add(e);else if(e instanceof RowColumnDefinition){let i=null;e.isRow&&U.st(t.getRowDefinition)?i=t.getRowDefinition(e.index):!e.isRow&&U.st(t.getColumnDefinition)&&(i=t.getColumnDefinition(e.index)),i instanceof RowColumnDefinition?i.X1(e):U.o("A RowColumnDefinition can only be added to an object that implements getRowDefinition/getColumnDefinition, not to: "+t)}else if(e instanceof PanelLayout){const i=t;i.type=e}else if(e instanceof Binding)t instanceof GraphObject||t instanceof RowColumnDefinition?t.bind(e):U.o("A Binding can only be applied to a GraphObject or RowColumnDefinition, not to: "+t);else if(e instanceof AnimationTrigger)t instanceof GraphObject?t.trigger(e):U.o("An AnimationTrigger can only be applied to a GraphObject, not to: "+t);else if(e instanceof PathFigure)t instanceof Geometry&&t.type===4?t.figures.add(e):U.o("A PathFigure can only be added to a Path Geometry, not to: "+t);else if(e instanceof PathSegment)t instanceof PathFigure?t.segments.add(e):U.o("A PathSegment can only be added to a PathFigure, not to: "+t);else if(e instanceof Layout)t instanceof Diagram||t instanceof Group?t.layout=e:U.o("A Layout can only be assigned to a Diagram or a Group, not to: "+t);else if(Array.isArray(e))for(let i=0;i<e.length;i++){const s=e[i];GraphObject.IN(t,s)}else U.$(e)?GraphObject.xI(t,e):U.o('Unknown initializer "'+e+'" for object being constructed by GraphObject.make: '+t)}static wI(t,e){if(t instanceof TextBlock)t.text=e;else if(t instanceof Shape)t.figure=e;else if(t instanceof Picture)t.source=e;else if(t instanceof Panel){const i=PanelLayout.fs.get(e);i!==null&&(t.type=i)}else if(t instanceof Brush){const i=U.$a(BrushType,e);i!==null?t.type=i:U.o("Unknown Brush type as an argument to GraphObject.make: "+e)}else if(t instanceof Geometry){const i=U.$a(GeometryType,e);i!==null&&(t.type=i)}else if(t instanceof PathSegment){const i=U.$a(SegmentType,e);i!==null&&(t.type=i)}}static yI(t,e){U.st(t.fe)?t.fe(e):U.ur(t,e)}static xI(t,e){if(t instanceof Brush){const i=new PropertyCollection;for(const s in e){const n=parseFloat(s);isNaN(n)?i[s]=e[s]:t.addColorStop(n,e[s])}Diagram.Ap(t,i)}else if(t instanceof RowColumnDefinition){if(e.row!==void 0){const s=e.row;(s==null||s===1/0||isNaN(s)||s<0)&&U.o("Must specify non-negative integer row for RowColumnDefinition "+e+", not: "+s),t.isRow=!0,t.index=s}else if(e.column!==void 0){const s=e.column;(s==null||s===1/0||isNaN(s)||s<0)&&U.o("Must specify non-negative integer column for RowColumnDefinition "+e+", not: "+s),t.isRow=!1,t.index=s}const i=new PropertyCollection;for(const s in e)s==="row"||s==="column"||(i[s]=e[s]);Diagram.Ap(t,i)}else Diagram.Ap(t,e)}static build(t,e,...i){const s=GraphObject.z1.get(t);if(U.st(s)){const n=s([t].concat(i));if(n instanceof GraphObject)return e&&n.setProperties(e),n}U.o('GraphObject.build invoked object builder "'+t+'", but it did not return an Object')}static defineBuilder(t,e){U.s(t,"string",GraphObject,"defineBuilder:name"),U.S(e,GraphObject,"defineBuilder:func");const i=t.toLowerCase();GraphObject.z1.set(t,e)}static isBuilderDefined(t){return GraphObject.z1.has(t)}static takeBuilderArgument(t,e,i){i===void 0&&(i=null);const s=t[1];return(U.st(i)?i(s):typeof s=="string")?(t.splice(1,1),s):(e===void 0&&U.o("no "+(U.st(i)?"satisfactory":"string")+" argument for GraphObject builder "+t[0]),e)}static z1=new GMap}GraphObject.Vertical=4,GraphObject.Horizontal=5,GraphObject.defineBuilder("Button",w=>{const t="#f5f5f5",e="#737373",i="#d4d4d4",s="#737373",n="#a3a3a3",o=2.76142374915397,r=2.761423749153969,l=new Panel(Panel.Auto,{isActionable:!0,enabledChanged:(a,h)=>{if(a instanceof Panel){const c=a.findObject("ButtonBorder");if(c!==null)if(a._buttonFillNormal===void 0&&(a._buttonFillNormal=c.fill),h){let f=null;a.layer!==null&&a.diagram!==null&&a.isVisibleObject()&&(f=a.layer.findObjectAt(a.diagram.lastInput.documentPoint)),f===a||f!==null&&f.isContainedBy(a)?c.fill=a._buttonFillOver:c.fill=a._buttonFillNormal}else c.fill=a._buttonFillDisabled}},cursor:"pointer"}).attach({_buttonFillNormal:void 0,_buttonStrokeNormal:void 0,_buttonFillOver:i,_buttonStrokeOver:s,_buttonFillDisabled:n}).add(new Shape("RoundedRectangle",{name:"ButtonBorder",spot1:new Spot(0,0,o,r),spot2:new Spot(1,1,-o,-r),parameter1:2,fill:t,stroke:e}));return l.mouseEnter=(a,h,c)=>{if(!h.isEnabledObject()||!(h instanceof Panel))return;const f=h.findObject("ButtonBorder");f instanceof Shape&&(h._buttonFillNormal===void 0&&(h._buttonFillNormal=f.fill),f.fill=h._buttonFillOver,h._buttonStrokeNormal===void 0&&(h._buttonStrokeNormal=f.stroke),f.stroke=h._buttonStrokeOver)},l.mouseLeave=(a,h,c)=>{if(!h.isEnabledObject()||!(h instanceof Panel))return;const f=h.findObject("ButtonBorder");f instanceof Shape&&(h._buttonFillNormal!==void 0&&(f.fill=h._buttonFillNormal),h._buttonStrokeNormal!==void 0&&(f.stroke=h._buttonStrokeNormal))},l}),GraphObject.defineBuilder("TreeExpanderButton",w=>{const t=GraphObject.build("Button");return t.attach({_treeExpandedFigure:"MinusLine",_treeCollapsedFigure:"PlusLine",visible:!1}),t.add(new Shape("MinusLine",{name:"ButtonIcon",stroke:"#0a0a0a",strokeWidth:2,desiredSize:Size.Pu}).bindObject("figure","isTreeExpanded",(e,i)=>{const s=i.panel;return e?s._treeExpandedFigure:s._treeCollapsedFigure})),t.bindObject("visible","isTreeLeaf",e=>!e),t.click=(e,i)=>{let s=i.part;if(s instanceof Adornment&&(s=s.adornedPart),!(s instanceof Node))return;const n=s.diagram;if(n===null)return;const o=n.commandHandler;if(s.isTreeExpanded){if(!o.canCollapseTree(s))return}else if(!o.canExpandTree(s))return;e.handled=!0,s.isTreeExpanded?o.collapseTree(s):o.expandTree(s)},t}),GraphObject.defineBuilder("SubGraphExpanderButton",w=>{const t=GraphObject.build("Button");return t.attach({_subGraphExpandedFigure:"MinusLine",_subGraphCollapsedFigure:"PlusLine"}),t.add(new Shape("MinusLine",{name:"ButtonIcon",stroke:"#0a0a0a",strokeWidth:2,desiredSize:Size.Pu}).bindObject("figure","isSubGraphExpanded",(e,i)=>{const s=i.panel;return e?s._subGraphExpandedFigure:s._subGraphCollapsedFigure})),t.click=(e,i)=>{let s=i.part;if(s instanceof Adornment&&(s=s.adornedPart),!(s instanceof Group))return;const n=s.diagram;if(n===null)return;const o=n.commandHandler;if(s.isSubGraphExpanded){if(!o.canCollapseSubGraph(s))return}else if(!o.canExpandSubGraph(s))return;e.handled=!0,s.isSubGraphExpanded?o.collapseSubGraph(s):o.expandSubGraph(s)},t}),GraphObject.defineBuilder("ToolTip",w=>new Adornment(Panel.Auto,{isShadowed:!0,shadowColor:"rgba(0, 0, 0, .4)",shadowOffset:new Point(0,2),mouseOver:(t,e)=>{const i=t.diagram.toolManager;i.extendToolTip(i.toolTipDuration)}}).add(new Shape("RoundedRectangle",{name:"Border",parameter1:1,fill:"#f5f5f5",strokeWidth:0,spot1:new Spot(0,0,4,6),spot2:new Spot(1,1,-4,-4)}))),GraphObject.defineBuilder("ContextMenu",w=>new Adornment(Panel.Vertical,{background:"#f5f5f5",isShadowed:!0,shadowColor:"rgba(0, 0, 0, .4)",shadowOffset:new Point(0,2)}).bindObject("background","",t=>t.adornedPart!==null&&t.hasPlaceholder()?null:"#f5f5f5")),GraphObject.defineBuilder("ContextMenuButton",w=>{const t=GraphObject.build("Button");t.stretch=5;const e=t.findObject("ButtonBorder");return e instanceof Shape&&(e.figure="Rectangle",e.strokeWidth=0,e.spot1=new Spot(0,0,4,6),e.spot2=new Spot(1,1,-4,-4)),t}),GraphObject.defineBuilder("PanelExpanderButton",w=>{const t=GraphObject.takeBuilderArgument(w,"COLLAPSIBLE"),e=GraphObject.build("Button");e.attach({_buttonExpandedFigure:"M0 0 M0 6 L4 2 8 6 M8 8",_buttonCollapsedFigure:"M0 0 M0 2 L4 6 8 2 M8 8","ButtonBorder.fill":"rgba(0, 0, 0, 0)",_buttonFillNormal:"rgba(0, 0, 0, 0)","ButtonBorder.stroke":null,_buttonStrokeNormal:null,_buttonFillOver:"rgba(0, 0, 0, .2)",_buttonStrokeOver:null}),e.add(new Shape({name:"ButtonIcon",strokeWidth:2}).bindObject("geometryString","visible",s=>s?e._buttonExpandedFigure:e._buttonCollapsedFigure,void 0,t));const i=e.findObject("ButtonBorder");return i instanceof Shape&&(i.stroke=null,i.fill="rgba(0, 0, 0, 0)"),e.click=(s,n)=>{if(!(n instanceof Panel))return;const o=n.diagram;if(o===null||o.isReadOnly)return;let r=n.findBindingPanel();if(r===null&&(r=n.part),r!==null){const l=r.findObject(t);l!==null&&(s.handled=!0,o.startTransaction("Collapse/Expand Panel"),l.visible=!l.visible,o.commitTransaction("Collapse/Expand Panel"))}},e}),GraphObject.defineBuilder("CheckBoxButton",w=>{const t=GraphObject.takeBuilderArgument(w),e=GraphObject.build("Button",{desiredSize:new Size(14,14)});e.attach({"ButtonBorder.spot1":new Spot(0,0,1,1),"ButtonBorder.spot2":new Spot(1,1,-1,-1)});const i=new Shape({name:"ButtonIcon",geometryString:"M0 0 M0 8.85 L4.9 13.75 16.2 2.45 M16.2 16.2",strokeWidth:2,stretch:2,geometryStretch:6,visible:!1});return t!==""&&i.bindTwoWay("visible",t),e.add(i),e.click=(s,n)=>{if(!(n instanceof Panel))return;const o=s.diagram;if(o===null||o.isReadOnly||t!==""&&o.model.isReadOnly)return;s.handled=!0;const r=n.findObject("ButtonIcon");o.startTransaction("checkbox"),r!==null&&(r.visible=!r.visible),U.st(n._doClick)&&n._doClick(s,n),o.commitTransaction("checkbox")},e}),GraphObject.defineBuilder("CheckBox",w=>{const t=GraphObject.takeBuilderArgument(w),e=GraphObject.build("CheckBoxButton",{name:"Button",isActionable:!1,margin:new Margin(0,1,0,0)},t),i=new Panel("Horizontal",{isActionable:!0,cursor:e.cursor,margin:new Margin(1),mouseEnter:e.mouseEnter,mouseLeave:e.mouseLeave,click:e.click}).attach({_buttonFillNormal:e._buttonFillNormal,_buttonStrokeNormal:e._buttonStrokeNormal,_buttonFillOver:e._buttonFillOver,_buttonStrokeOver:e._buttonStrokeOver,_buttonFillDisabled:e._buttonFillDisabled,_buttonClick:e.click});return i.add(e),e.mouseEnter=null,e.mouseLeave=null,e.click=null,i}),GraphObject.defineBuilder("AutoRepeatButton",w=>{const t=GraphObject.takeBuilderArgument(w,50,r=>typeof r=="number"),e=GraphObject.takeBuilderArgument(w,500,r=>typeof r=="number");function i(r,l){n(r,l),l.click&&(l.Nd=U.un(()=>s(r,l),e))}function s(r,l){l.Nd&&U.yc(l.Nd),l.click&&(l.Nd=U.un(()=>{l.click&&(l.click(r,l),s(r,l))},t))}function n(r,l){l.Nd&&(U.yc(l.Nd),l.Nd=void 0)}const o=GraphObject.build("Button");return o.actionDown=(r,l)=>i(r,l),o.actionUp=(r,l)=>n(r,l),o.actionCancel=(r,l)=>n(r,l),o}),GraphObject.defineBuilder("ToggleSwitch",function(w){const t=GraphObject.takeBuilderArgument(w);t||U.o("ToggleSwitch must be data-bound to a property name, not: "+t);const e=GraphObject.takeBuilderArgument(w,!1,h=>typeof h=="boolean"),i="gray",s="transparent",n="white",a=new Panel("Auto",{width:e?15:28,height:e?28:15}).attach({_buttonFillOff:i,_buttonBorderOff:s,_buttonIconFillOff:n,_buttonFillOn:"green",_buttonBorderOn:"transparent",_buttonIconFillOn:"white"}).add(new Shape("Capsule",{name:"ButtonBorder",fill:i,stroke:s,strokeWidth:1}).bind("fill",t,(h,c)=>h?c.panel._buttonFillOn:c.panel._buttonFillOff).bind("stroke",t,(h,c)=>h?c.panel._buttonBorderOn:c.panel._buttonBorderOff)).add(new Shape("Circle",{name:"ButtonIcon",width:11,height:11,fill:n,stroke:null,alignment:e?Spot.Bottom:Spot.Left}).bind("fill",t,(h,c)=>h?c.panel._buttonIconFillOn:c.panel._buttonIconFillOff).bind("alignment",t,h=>h?e?Spot.Top:Spot.Right:e?Spot.Bottom:Spot.Left));return a.click=function(h,c){if(!c.isEnabledObject())return;const f=h.diagram;if(f===null||f.isReadOnly||t!==""&&f.model.isReadOnly)return;h.handled=!0;const u=c.findBindingPanel();u!==null&&(f.startTransaction("toggle switch"),f.model.set(u.data,t,!u.data[t]),typeof c._doClick=="function"&&c._doClick(h,c),f.commitTransaction("toggle switch"))},a}),GraphObject.defineBuilder("Toggle",function(w){const t=GraphObject.takeBuilderArgument(w),e=GraphObject.build("ToggleSwitch",{name:"Button"},t),i=new Panel("Horizontal",{cursor:e.cursor,margin:1,mouseEnter:e.mouseEnter,mouseLeave:e.mouseLeave,click:e.click}).attach({_buttonClick:e.click}).add(e);return e.mouseEnter=null,e.mouseLeave=null,e.click=null,i});class GraphObjectTemplateSettings{me;Pt;no;ve;oo;Ds;Il;Er;Ur;Vr;Yr;Kr;Br;zr;Xr;u0;d0;Gr;g0;m0;p0;y0;Hr;qr;Zp;l0;Ts;Nr;Cr;ao;r0;o0;Mr;Jp;x0;b0;constructor(){this.me=!1,this.Pt="",this.no=-1,this.ve=null,this.oo=null,this.Ds=null,this.Il="",this.Er=null,this.Ur=null,this.Vr=null,this.Yr=null,this.Kr=null,this.Br=null,this.zr=null,this.Xr=null,this.u0=null,this.d0=null,this.Gr=null,this.g0=null,this.m0=null,this.p0=null,this.y0=null,this.Hr=null,this.qr=null,this.Zp=null,this.l0=null,this.Ts=null,this.Nr=Size.xc,this.Cr=Size.DP,this.ao=1,this.r0=1,this.o0=1,this.Mr=0,this.Jp=null,this.x0=null,this.b0="category"}copy(){const t=new GraphObjectTemplateSettings;return t.Pt=this.Pt,t.no=this.no,t.ve=this.ve,t.Ds=this.Ds,t.Il=this.Il,t.Er=this.Er,t.Ur=this.Ur,t.Vr=this.Vr,t.Yr=this.Yr,t.Kr=this.Kr,t.Br=this.Br,t.zr=this.zr,t.Xr=this.Xr,t.u0=this.u0,t.d0=this.d0,t.Gr=this.Gr,t.g0=this.g0,t.m0=this.m0,t.p0=this.p0,t.y0=this.y0,t.Hr=this.Hr,t.qr=this.qr,t.Zp=this.Zp,t.l0=this.l0,t.Ts=this.Ts,t.Nr=this.Nr.N(),t.Cr=this.Cr.N(),t.ao=this.ao,t.r0=this.r0,t.o0=this.o0,t.Mr=this.Mr,t.Jp=this.Jp,t.x0=this.x0,t.b0=this.b0,t}}class STransform{m;constructor(){this.m=[1,0,0,1,0,0]}copy(){const t=new STransform;return t.m[0]=this.m[0],t.m[1]=this.m[1],t.m[2]=this.m[2],t.m[3]=this.m[3],t.m[4]=this.m[4],t.m[5]=this.m[5],t}translate(t,e){this.m[4]+=this.m[0]*t+this.m[2]*e,this.m[5]+=this.m[1]*t+this.m[3]*e}scale(t,e){this.m[0]*=t,this.m[1]*=t,this.m[2]*=e,this.m[3]*=e}rotate(t,e,i){if(t=G.Ee(t),t===0)return;this.translate(e,i);let s=0,n=0;if(t===90)s=0,n=1;else if(t===180)s=-1,n=0;else if(t===270)s=0,n=-1;else{const h=t*Math.PI/180;s=Math.cos(h),n=Math.sin(h)}const o=this.m[0]*s+this.m[2]*n,r=this.m[1]*s+this.m[3]*n,l=this.m[0]*-n+this.m[2]*s,a=this.m[1]*-n+this.m[3]*s;this.m[0]=o,this.m[1]=r,this.m[2]=l,this.m[3]=a,this.translate(-e,-i)}}class SGradient{type;x1;y1;r1;x2;y2;r2;colors;pattern;constructor(t){this.type=t,this.x1=0,this.y1=0,this.r1=0,this.x2=0,this.y2=0,this.r2=0,this.colors=[],this.pattern=null}addColorStop(t,e){this.colors.push({offset:t,color:e})}}class SVGSurface{bt;_t;tl;ud;EN;constructor(t,e,i){const s=e===void 0?root.document:e;this.tl=s,this.EN="http://www.w3.org/2000/svg";const n="http://www.w3.org/2000/xmlns/";s!==void 0&&(this.bt=this.makeElement("svg",{width:"1px",height:"1px",viewBox:"0 0 1 1"}),this.style.display="block",this.style.letterSpacing="normal",this.style.wordSpacing="normal",i||(this.style.position="absolute"),this.bt.setAttributeNS(n,"xmlns",this.EN),this.bt.setAttributeNS(n,"xmlns:xlink","http://www.w3.org/1999/xlink")),this.ud=null,this._t=new SVGContext(this,i)}resize(t,e,i,s){return this.width!==t||this.height!==e?(this.width=t,this.height=e,this.style.width=i+"px",this.style.height=s+"px",this.bt.setAttributeNS(null,"width",i+"px"),this.bt.setAttributeNS(null,"height",s+"px"),this.bt.setAttributeNS(null,"viewBox","0 0 "+i+" "+s),this._t.UN.firstElementChild.setAttributeNS(null,"width",i+"px"),this._t.UN.firstElementChild.setAttributeNS(null,"height",s+"px"),!0):!1}makeElement(t,e,i){const s=this.tl.createElementNS(this.EN,t);if(U.$(e))for(const n in e)s.setAttributeNS(n==="href"?"http://www.w3.org/1999/xlink":"",n,e[n]);return i!==void 0&&(s.textContent=i),s}getBoundingClientRect(){return this.bt.getBoundingClientRect()}focus(){this.bt.focus()}get width(){return parseInt(this.bt.getAttribute("width")||"1")}set width(t){this.bt.setAttribute("width",t+"px")}get height(){return parseInt(this.bt.getAttribute("height")||"1")}set height(t){this.bt.setAttribute("height",t+"px")}dispose(){this.tl=null}get style(){return this.bt.style}}class SVGContext{Sf;Mf;Ln;Fe;$i;fillStyle;font;globalAlpha;lineCap;lineDashOffset;lineJoin;lineWidth;miterLimit;shadowBlur;shadowColor;shadowOffsetX;shadowOffsetY;strokeStyle;textAlign;imageSmoothingEnabled;clipInsteadOfFill;lastCreatedElement;Nf;Cf;surface;svg;UN;lD;G1;jo;La;Bh;currentElement;clipPathGroup;diagramGroup;lastDrawnPart;currentPath;outerGroup;pathAttributes;ol;vr;filter;letterSpacing;wordSpacing;partClipRect;constructor(t,e){if(this.surface=t,this.svg=t.bt,this.Nf=[],this.Cf=[],this.fillStyle="#000000",this.font="10px sans-serif",this.globalAlpha=1,this.lineCap="butt",this.lineDashOffset=0,this.lineJoin="miter",this.lineWidth=1,this.miterLimit=10,this.shadowBlur=0,this.shadowColor="rgba(0, 0, 0, 0)",this.shadowOffsetX=0,this.shadowOffsetY=0,this.ol=!1,this.strokeStyle="#000000",this.textAlign="start",this.clipInsteadOfFill=!1,this.Sf=0,this.Mf=0,this.Ln=0,this.lastCreatedElement=null,this.currentElement=null,this.Fe=[],this.pathAttributes={},this.G1=!1,this.jo=null,this.La=0,this.lD={},this.vr=!!e,this.filter="",this.partClipRect=null,this.$i=new STransform,this.letterSpacing="0px",this.wordSpacing="0px",t.tl===null||t.tl===void 0)return;this.clipPathGroup=this.newGroup2(),this.diagramGroup=this.newGroup2("gojs-diagram"),this.lastDrawnPart=null,this.currentPath=null;const i=GSet.Ww++,s=this.makeElement("clipPath",{id:"mainClip"+i}),n={x:0,y:0,width:t.width,height:t.height};s.appendChild(this.makeElement("rect",n)),this.UN=s,this.svg.appendChild(this.clipPathGroup),this.clipPathGroup.appendChild(this.diagramGroup),this.svg.appendChild(s),this.clipPathGroup.setAttributeNS(null,"clip-path","url(#mainClip"+i+")")}setDiagramPosScale(t,e,i,s,n,o){this.diagramGroup===void 0?this.newGroup(t,e,i,s,n,o):this.diagramGroup.setAttribute("transform","matrix("+t+", "+e+", "+i+", "+s+", "+n+", "+o+")")}resetInnerSVG(){this.diagramGroup!==null&&(this.diagramGroup.innerHTML="")}arc(t,e,i,s,n,o,r,l){const a=2*Math.PI,h=1e-6,c=a-h,f=i*Math.cos(s),u=i*Math.sin(s),d=t+f,m=e+u,g=o?0:1;let p=o?s-n:n-s;(Math.abs(r-d)>h||Math.abs(l-m)>h)&&this.Fe.push(["L",d,+m]),p<0&&(p=p%a+a),p>c?(this.Fe.push(["A",i,i,0,1,g,t-f,e-u]),this.Fe.push(["A",i,i,0,1,g,d,m])):p>h&&this.Fe.push(["A",i,i,0,+(p>=Math.PI),g,t+i*Math.cos(n),e+i*Math.sin(n)])}beginPath(){this.Fe=[],this.pathAttributes={stroke:"none",fill:"none"}}endPath(t){this.bI(this.Fe,this.$i,t||0)}bezierCurveTo(t,e,i,s,n,o){this.Fe.push(["C",t,e,i,s,n,o])}clearRect(t,e,i,s){}clip(){this.pathAttributes.clipPath=!0}closePath(){this.Fe.push(["z"])}createLinearGradient(t,e,i,s){const n=new SGradient("linear");return n.x1=t,n.y1=e,n.x2=i,n.y2=s,n}createPattern(t,e){let i="";t instanceof HTMLCanvasElement&&(i=t.toDataURL()),t instanceof HTMLImageElement&&(i=t.getAttribute("src"));const s=this.lD;if(s[i])return"url(#"+s[i]+")";const n="PATTERN"+GSet.Ww++,o={width:t.width,height:t.height,id:n,patternUnits:"userSpaceOnUse"},r={x:0,y:0,width:t.width,height:t.height,href:i},l=this.makeElement("pattern",o);return l.appendChild(this.makeElement(Diagram.img,r)),this.svg.appendChild(l),s[i]=n,"url(#"+n+")"}createRadialGradient(t,e,i,s,n,o){const r=new SGradient("radial");return r.x1=t,r.y1=e,r.r1=i,r.x2=s,r.y2=n,r.r2=o,r}amendImageTransform(t,e,i,s,n,o,r,l){const a=r/i,h=l/s;(n!==0||o!==0)&&this.$i.translate(n,o),(a!==1||h!==1)&&this.$i.scale(a,h),(t!==0||e!==0)&&this.$i.translate(-t,-e)}drawImage(t,e,i,s,n,o,r,l,a){let h="",c=t.width,f=t.height;typeof t.toDataURL=="function"?t.toDataURL():(h=t.getAttribute("src"),c=t.naturalWidth,f=t.naturalHeight),s===void 0&&(o=e,r=i,l=s=c,a=n=f),s=s||0,n=n||0,o=o||0,r=r||0,l=l||0,a=a||0,this.amendImageTransform(e,i,s,n,o,r,l,a);const u={x:0,y:0,width:c||s,height:f||n,href:h};!G.X(s,l)||!G.X(n,a)?u.preserveAspectRatio="none":h.toLowerCase().indexOf(".svg")===-1&&h.toLowerCase().indexOf("data:image/svg")===-1&&(u.preserveAspectRatio="xMidYMid slice"),(e!==0||i!==0||s!==c||n!==f)&&(s+=e,n+=i,u["clip-path"]=`path('M ${e},${i} L ${s} ${i} L ${s} ${n} L ${e} ${n} z')`),this.processCommon(Diagram.img,u,this.$i),this.Cd(Diagram.img,u)}fill(t,e){t&&(this.pathAttributes["fill-rule"]="evenodd"),this.setFill(this.pathAttributes)}fillContext(t,e,i){this.clipInsteadOfFill?this.clip():this.fill(e,i)}createOrUpdateClipGroup(t,e){const i=this.newGroup(1,0,0,1,-e.x,-e.y);i.setAttributeNS(null,"class","spotClip"),t.xa=i}fillRect(t,e,i,s){this.addRect("fill",[t,e,i,s],this.$i)}fillBackground(t,e,i,s){const n={x:t,y:e,width:i,height:s};this.processCommon("fill",n,this.$i),this.setFill(n),this.svg.prepend(this.makeElement("rect",n))}fillText(t,e,i){this.addText("fill",[t,e,i],this.$i)}lineTo(t,e){this.Fe.push(["L",t,e])}moveTo(t,e){this.Fe.push(["M",t,e])}quadraticCurveTo(t,e,i,s){this.Fe.push(["Q",t,e,i,s])}rect(t,e,i,s){this.Fe.push(["M",t,e],["L",t+i,e],["L",t+i,e+s],["L",t,e+s],["z"])}restore(){this.$i=this.Nf.pop(),this.Fe=this.Nf.pop();const t=this.Nf.pop();this.fillStyle=t.fillStyle,this.font=t.font,this.globalAlpha=t.globalAlpha,this.lineCap=t.lineCap,this.lineDashOffset=t.lineDashOffset,this.lineJoin=t.lineJoin,this.lineWidth=t.lineWidth,this.miterLimit=t.miterLimit,this.shadowBlur=t.shadowBlur,this.shadowColor=t.shadowColor,this.shadowOffsetX=t.shadowOffsetX,this.shadowOffsetY=t.shadowOffsetY,this.strokeStyle=t.strokeStyle,this.textAlign=t.textAlign,this.partClipRect=t.partClipRect,this.letterSpacing=t.letterSpacing,this.wordSpacing=t.wordSpacing}save(){const t={fillStyle:this.fillStyle,font:this.font,globalAlpha:this.globalAlpha,lineCap:this.lineCap,lineDashOffset:this.lineDashOffset,lineJoin:this.lineJoin,lineWidth:this.lineWidth,miterLimit:this.miterLimit,shadowBlur:this.shadowBlur,shadowColor:this.shadowColor,shadowOffsetX:this.shadowOffsetX,shadowOffsetY:this.shadowOffsetY,strokeStyle:this.strokeStyle,textAlign:this.textAlign,partClipRect:this.partClipRect};this.Nf.push(t);const e=[];for(let i=0;i<this.Fe.length;i++)e.push(this.Fe[i]);this.Nf.push(e),this.Nf.push(this.$i.copy())}setTransform(t,e,i,s,n,o){t===1&&e===0&&i===0&&s===1&&n===0&&o===0||this.newGroup(t,e,i,s,n,o)}setCurrentTransform(t,e,i,s,n,o){this.$i.m=[t,e,i,s,n,o]}getCurrentTransform(){const t=this.$i.m;return"matrix("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"}scale(t,e){this.$i.scale(t,e)}translate(t,e){this.$i.translate(t,e)}transform(t,e,i,s,n,o){}commitTransform(){}stroke(){this.setStroke(this.pathAttributes)}strokeContext(){this.clipInsteadOfFill||this.stroke()}strokeRect(t,e,i,s){this.addRect("stroke",[t,e,i,s],this.$i)}makeElement(t,e,i){return this.surface.makeElement(t,e,i)}Cd(t,e,i){const s=this.makeElement(t,e,i);return this.currentElement!==null?this.currentElement.appendChild(s):this.currentElement=s,this.lastCreatedElement=s,s}processCommon(t,e,i){if(t==="fill"?this.setFill(e):t==="stroke"&&this.setStroke(e),i!==null){const s=i.m;e.transform="matrix("+s[0]+", "+s[1]+", "+s[2]+", "+s[3]+", "+s[4]+", "+s[5]+")"}}setFill(t){if(this.fillStyle instanceof SGradient){t.fill=this.addGradient(this.fillStyle,"fill");return}if(/^rgba\(/.test(this.fillStyle)){const i=/^\s*rgba\s*\(([^,\s]+)\s*,\s*([^,\s]+)\s*,\s*([^,\s]+)\s*,\s*([^,\s]+)\)\s*$/i.exec(this.fillStyle);t.fill="rgb("+i[1]+","+i[2]+","+i[3]+")",t["fill-opacity"]=i[4]}else t.fill=this.fillStyle}setFillOrStrokeInPlace(t,e){const i=e?"fill":"stroke";if(this.fillStyle instanceof SGradient){t.setAttributeNS(null,"fill",this.addGradient(this.fillStyle,i));return}if(/^rgba\(/.test(this.fillStyle)){const n=/^\s*rgba\s*\(([^,\s]+)\s*,\s*([^,\s]+)\s*,\s*([^,\s]+)\s*,\s*([^,\s]+)\)\s*$/i.exec(this.fillStyle);t.setAttributeNS(null,i,"rgb("+n[1]+","+n[2]+","+n[3]+")"),t.setAttributeNS(null,i+"-opacity",n[4])}else t.setAttributeNS(null,i,this.fillStyle)}setStroke(t){if(this.strokeStyle instanceof SGradient)t.stroke=this.addGradient(this.strokeStyle,"stroke");else if(/^rgba\(/.test(this.strokeStyle)){const i=/^\s*rgba\s*\(([^,\s]+)\s*,\s*([^,\s]+)\s*,\s*([^,\s]+)\s*,\s*([^,\s]+)\)\s*$/i.exec(this.strokeStyle);t.stroke="rgb("+i[1]+","+i[2]+","+i[3]+")",t["stroke-opacity"]=i[4]}else t.stroke=this.strokeStyle;t["stroke-width"]=this.lineWidth,t["stroke-linecap"]=this.lineCap,t["stroke-linejoin"]=this.lineJoin,t["stroke-miterlimit"]=this.miterLimit,this.G1&&(t["stroke-dasharray"]=this.jo.toString(),t["stroke-dashoffset"]=this.La)}addGradient(t,e){let i="";const s=this.currentPath!==null?this.currentPath.getAttribute(e):null;if(s!==null&&s.indexOf("GRAD")!==-1){i=s.split("#")[1].slice(0,-1);const l=this.svg.getElementById(i);l!==null&&l.remove()}else i="GRAD"+GSet.Ww++;let n;if(t.type==="linear"){const l={x1:t.x1,x2:t.x2,y1:t.y1,y2:t.y2,id:i,gradientUnits:"userSpaceOnUse"};n=this.makeElement("linearGradient",l)}else if(t.type==="radial"){const l={x1:t.x1,x2:t.x2,y1:t.y1,y2:t.y2,r1:t.r1,r2:t.r2,id:i};n=this.makeElement("radialGradient",l)}else U.o("invalid gradient");const o=t.colors.sort((l,a)=>l.offset>a.offset?1:-1),r=o.length;for(let l=0;l<r;l++){const a=o[l],h=a.color;n.appendChild(this.makeElement("stop",{offset:a.offset,"stop-color":h}))}return this.svg.appendChild(n),"url(#"+i+")"}addRect(t,e,i){const s={x:e[0],y:e[1],width:e[2],height:e[3]};this.processCommon(t,s,i),this.Cd("rect",s)}addText(t,e,i){let s=this.textAlign;s==="left"?s="start":s==="right"?s="end":s==="center"&&(s="middle");const n={x:e[1],y:e[2],style:"font: "+this.font,"text-anchor":s};n["letter-spacing"]=this.letterSpacing,n["word-spacing"]=this.wordSpacing,this.processCommon(t,n,i),this.Cd("text",n,e[0])}bI(t,e,i){const s=this.kI(t),n=this.pathAttributes;if(n.clipPath){this.Cf.length>1&&this.Cf[this.Cf.length-2].setAttributeNS(null,"clip-path",'path("'+s+'") view-box');return}if(n.d=s,this.processCommon("",n,e),this.currentPath!==null){const r=this.currentPath;if(r.nodeName!=="g")for(const l in n)l!=="transform"&&r.setAttributeNS(null,l,n[l]);else{const l=r.getElementsByTagName("path");for(const a in n)a!=="transform"&&l[i].setAttributeNS(null,a,n[a])}}else this.Cd("path",n)}kI(t){const e=[];for(let i=0;i<t.length;i++){const s=t[i].slice(),n=[s.shift()];if(n[0]==="A")n.push(s.shift()+","+s.shift(),s.shift(),s.shift()+","+s.shift(),s.shift()+","+s.shift());else for(;s.length;)n.push(s.shift()+","+s.shift());e.push(n.join(" "))}return e.join(" ")}newGroup(t,e,i,s,n,o){const r=new STransform;r.m=[t,e,i,s,n,o];const l={};this.processCommon("g",l,r);const a=this.Cd("g",l);return this.Cf.push(a),a}newGroup2(t){const e={};t&&(e.class=t);const i=this.Cd("g",e);return this.Cf.push(i),i}endGroup(){return this.Cf.pop()}dummyGroup(){return this.newGroup2(),this.endGroup()}shadowsSet(t,e,i){this.Sf=t,this.Mf=e,this.Ln=i}shadowsOff(){this.ol=!1,this.shadowOffsetX=0,this.shadowOffsetY=0,this.shadowBlur=0}shadowsOn(){this.ol=!0,this.shadowOffsetX=this.Sf,this.shadowOffsetY=this.Mf,this.shadowBlur=this.Ln}enableDash(t,e){this.G1=!0,this.jo=t,this.La=e}disableDash(){this.G1=!1}clearContextCache(t){}setImageSmoothingEnabled(t){}rotate(t){this.$i.rotate(t*57.2958,0,0)}getImageData(t,e,i,s){return null}measureText(t){return null}removeOldGradient(t,e,i){const s=e.getAttribute(i);if(s===null)return;const n=s.split("#");if(n.length===1)return;const o=this.svg.getElementById(n[1].slice(0,-1));if(o!==null){const r=new RegExp(o.id,"g");this.svg.innerHTML.match(r).length===1&&o.remove()}}removePartFromView(t){t.svg!==null&&t.svg.parentNode===this.diagramGroup&&t.svg.remove()}}class CanvasSurface{bt;_t;tl;ud;constructor(t,e,i,s){const n=e===void 0?root.document:e;this.tl=n,this.ud=null;const o=n.createElement("canvas");o.tabIndex=0,this.bt=o,this._t=new CanvasSurfaceContext(o,i,s),t&&Diagram.ji.set(o,t)}resize(t,e,i,s){return this.width!==t||this.height!==e?(this.width=t,this.height=e,this.style.width=i+"px",this.style.height=s+"px",!0):!1}toDataURL(t,e){return this.bt.toDataURL(t,e)}getBoundingClientRect(){return this.bt.getBoundingClientRect()}focus(){this.bt.focus()}get width(){return this.bt.width}set width(t){this.bt.width=t}get height(){return this.bt.height}set height(t){this.bt.height=t}dispose(){Diagram.ji.delete(this.bt),this.tl=null}get style(){return this.bt.style}}class CanvasSurfaceContext{F;Y1;K1;H1;clipInsteadOfFill;Sf;Mf;Ln;Bh;ol;vr;constructor(t,e,i){t.getContext||U.o("Browser does not support HTML Canvas Element"),this.F=t.getContext("2d",e),this.Y1="",this.K1="",this.H1="",this.clipInsteadOfFill=!1,this.Sf=0,this.Mf=0,this.Ln=0,this.ol=!1,this.Bh=new Transform,this.vr=!!i}createOrUpdateClipGroup(t,e){}setImageSmoothingEnabled(t){this.F.imageSmoothingEnabled=t}get fillStyle(){return this.F.fillStyle}set fillStyle(t){this.H1!==t&&(this.F.fillStyle=t,this.H1=t)}get font(){return this.F.font}set font(t){this.Y1!==t&&(this.F.font=t,this.Y1=t)}get globalAlpha(){return this.F.globalAlpha}set globalAlpha(t){this.F.globalAlpha=t}get lineCap(){return this.F.lineCap}set lineCap(t){this.F.lineCap=t}get lineDashOffset(){return this.F.lineDashOffset}set lineDashOffset(t){this.F.lineDashOffset=t}get lineJoin(){return this.F.lineJoin}set lineJoin(t){this.F.lineJoin=t}get lineWidth(){return this.F.lineWidth}set lineWidth(t){this.F.lineWidth=t}get miterLimit(){return this.F.miterLimit}set miterLimit(t){this.F.miterLimit=t}get shadowBlur(){return this.F.shadowBlur}set shadowBlur(t){this.F.shadowBlur=t}get shadowColor(){return this.F.shadowColor}set shadowColor(t){this.F.shadowColor=t}get shadowOffsetX(){return this.F.shadowOffsetX}set shadowOffsetX(t){this.F.shadowOffsetX=t}get shadowOffsetY(){return this.F.shadowOffsetY}set shadowOffsetY(t){this.F.shadowOffsetY=t}get strokeStyle(){return this.F.strokeStyle}set strokeStyle(t){this.K1!==t&&(this.F.strokeStyle=t,this.K1=t)}get textAlign(){return this.F.textAlign}set textAlign(t){this.F.textAlign=t}get imageSmoothingEnabled(){return this.F.imageSmoothingEnabled}set imageSmoothingEnabled(t){this.F.imageSmoothingEnabled=t}get filter(){return this.F.filter}set filter(t){t===""?this.F.filter="none":this.F.filter=t}get letterSpacing(){return this.F.letterSpacing}set letterSpacing(t){this.F.letterSpacing=t}get wordSpacing(){return this.F.wordSpacing}set wordSpacing(t){this.F.wordSpacing=t}arc(t,e,i,s,n,o,r,l){this.F.arc(t,e,i,s,n,o)}beginPath(){this.F.beginPath()}endPath(){}bezierCurveTo(t,e,i,s,n,o){this.F.bezierCurveTo(t,e,i,s,n,o)}clearRect(t,e,i,s){this.commitTransform(),this.F.clearRect(t,e,i,s)}clip(t){t?this.F.clip(t):this.F.clip()}closePath(){this.F.closePath()}createLinearGradient(t,e,i,s){return this.F.createLinearGradient(t,e,i,s)}createPattern(t,e){return this.F.createPattern(t,e)}createRadialGradient(t,e,i,s,n,o){return this.F.createRadialGradient(t,e,i,s,n,o)}drawImage(t,e,i,s,n,o,r,l,a){s===void 0?this.F.drawImage(t,e,i):this.F.drawImage(t,e,i,s,n,o,r,l,a)}fill(t,e){e?this.F.fill(e,t?"evenodd":"nonzero"):this.F.fill(t?"evenodd":"nonzero")}fillRect(t,e,i,s){this.F.fillRect(t,e,i,s)}fillBackground(t,e,i,s){this.F.fillRect(t,e,i,s)}fillText(t,e,i){this.F.fillText(t,e,i)}getImageData(t,e,i,s){return this.F.getImageData(t,e,i,s)}lineTo(t,e){this.F.lineTo(t,e)}measureText(t){return this.F.measureText(t)}moveTo(t,e){this.F.moveTo(t,e)}quadraticCurveTo(t,e,i,s){this.F.quadraticCurveTo(t,e,i,s)}rect(t,e,i,s){this.F.rect(t,e,i,s)}restore(){this.F.restore()}save(){this.commitTransform(),this.F.save()}rotate(t){this.Bh.ks(t*57.2958,0,0)}setTransform(t,e,i,s,n,o){this.Bh.setTo(t,e,i,s,n,o)}scale(t,e){this.Bh.it(t,e)}translate(t,e){this.Bh.Xs(t,e)}stroke(t){t?this.F.stroke(t):this.F.stroke()}transform(t,e,i,s,n,o){if(t===1&&e===0&&i===0&&s===1&&n===0&&o===0)return;const r=this.Bh,l=r.m11*t+r.m21*e,a=r.m12*t+r.m22*e,h=r.m11*i+r.m21*s,c=r.m12*i+r.m22*s;r.dx=r.m11*n+r.m21*o+r.dx,r.dy=r.m12*n+r.m22*o+r.dy,r.m11=l,r.m12=a,r.m21=h,r.m22=c}commitTransform(){const t=this.Bh;this.F.setTransform(t.m11,t.m12,t.m21,t.m22,t.dx,t.dy)}fillContext(t,e,i){this.radialFill(t,e,i)||this.fillOrClip(e,i)}radialFill(t,e,i){if(!(t instanceof Brush)||t.type!==3)return!1;const s=t.xf,n=t.V1;return n>s?(this.scale(s/n,1),this.translate((n-s)/2,0)):s>n&&(this.scale(1,n/s),this.translate(0,(s-n)/2)),this.fillOrClip(e,i),n>s?(this.translate(-(n-s)/2,0),this.scale(1/(s/n),1)):s>n&&(this.translate(0,-(s-n)/2),this.scale(1,1/(n/s))),!0}strokeContext(){this.clipInsteadOfFill||this.stroke()}fillOrClip(t,e){this.clipInsteadOfFill?this.clip(e):this.fill(t,e)}shadowsSet(t,e,i){this.Sf=t,this.Mf=e,this.Ln=i}shadowsOff(){this.ol=!1,this.shadowOffsetX=0,this.shadowOffsetY=0,this.shadowBlur=0}shadowsOn(){this.ol=!0,this.shadowOffsetX=this.Sf,this.shadowOffsetY=this.Mf,this.shadowBlur=this.Ln}enableDash(t,e){const i=this.F;i.setLineDash!==void 0&&(i.setLineDash(t),i.lineDashOffset=e)}disableDash(){const t=this.F;t.setLineDash!==void 0&&(t.setLineDash(CanvasSurfaceContext.EmptyArray),t.lineDashOffset=0)}clearContextCache(t){t&&(this.Y1=""),this.K1="",this.H1=""}removePartFromView(t){}static EmptyArray=Object.freeze([])}var BrushType=(w=>(w[w.Solid=1]="Solid",w[w.Linear=2]="Linear",w[w.Radial=3]="Radial",w[w.Pattern=4]="Pattern",w))(BrushType||{}),ColorSpace=(w=>(w[w.Lab=1]="Lab",w[w.HSL=2]="HSL",w[w.Oklch=3]="Oklch",w))(ColorSpace||{});class ColorNumbers{n0;n1;n2;n3;constructor(){this.n0=0,this.n1=0,this.n2=0,this.n3=0}}class Brush{u;W;zh;ae;Cs;k0;P0;Wo;S0;Nn;xf;V1;constructor(t,e){if(GSet.Je(this),this.u=!1,t===void 0)this.W=1,this.zh="black";else if(typeof t=="string"){const s=U.$a(BrushType,t);s!==null?(this.W=s,this.zh="black"):(this.W=1,this.zh=t)}else Object.keys(BrushType).hasOwnProperty(t)?(this.W=t,this.zh="black"):typeof t=="object"&&(this.W=1,e=t);const i=this.W;if(i===2?(this.ae=Spot.TopCenter,this.Cs=Spot.BottomCenter):i===3?(this.ae=Spot.Center,this.Cs=Spot.Center):(this.ae=Spot.None,this.Cs=Spot.None),this.k0=0,this.P0=NaN,this.Wo=null,this.S0=null,this.Nn=null,this.xf=0,this.V1=0,e){const s={};for(const n in e)isFinite(parseFloat(n))?this.addColorStop(parseFloat(n),e[n]):s[n]=e[n];Object.assign(this,s)}}copy(){const t=new Brush;return t.W=this.W,t.zh=this.zh,t.ae=this.ae.N(),t.Cs=this.Cs.N(),t.k0=this.k0,t.P0=this.P0,this.Wo!==null&&(t.Wo=this.Wo.copy()),t.S0=this.S0,t}k(){return this.u=!0,this.Wo!==null&&this.Wo.k(),this}fe(t){t in BrushType?this.type=t:U.ur(this,t)}toString(){let t="Brush(";if(this.type===1)t+=this.color;else if(this.type===2?t+="Linear ":this.type===3?t+="Radial ":this.type===4?t+="Pattern ":t+="(unknown) ",t+=this.start+" "+this.end,this.colorStops!==null){const e=this.colorStops.iterator;for(;e.next();){const i=e.key,s=e.value;t+=" "+i+":"+s}}return t+=")",t}addColorStop(t,e){return this.u&&U.L(this),(typeof t!="number"||!isFinite(t)||t>1||t<0)&&U.J(t,"0 <= loc <= 1",Brush,"addColorStop:loc"),U.s(e,"string",Brush,"addColorStop:color"),this.Wo===null&&(this.Wo=new GMap),this.Wo.set(t,e),this.W===1&&(this.type=2),this.Nn=null,this}get type(){return this.W}set type(t){this.u&&U.L(this,t),this.W=t,this.start.isNoSpot()&&(t===2?this.start=Spot.TopCenter:t===3&&(this.start=Spot.Center)),this.end.isNoSpot()&&(t===2?this.end=Spot.BottomCenter:t===3&&(this.end=Spot.Center)),this.Nn=null}get color(){return this.zh}set color(t){this.u&&U.L(this,t),this.zh=t,this.Nn=null}get start(){return this.ae}set start(t){this.u&&U.L(this,t),this.ae=t.N(),this.Nn=null}get end(){return this.Cs}set end(t){this.u&&U.L(this,t),this.Cs=t.N(),this.Nn=null}get startRadius(){return this.k0}set startRadius(t){this.u&&U.L(this,t),t<0&&U.J(t,">= zero",Brush,"startRadius"),this.k0=t,this.Nn=null}get endRadius(){return this.P0}set endRadius(t){this.u&&U.L(this,t),t<0&&U.J(t,">= zero",Brush,"endRadius"),this.P0=t,this.Nn=null}get colorStops(){return this.Wo}set colorStops(t){this.u&&U.L(this,t),this.Wo=t,this.Nn=null}get pattern(){return this.S0}set pattern(t){this.u&&U.L(this,t),this.S0=t,this.Nn=null}static randomColor(t,e){t===void 0&&(t=128),e===void 0&&(e=Math.max(t,255));const i=Math.abs(e-t);let s=Math.floor(t+Math.random()*i).toString(16),n=Math.floor(t+Math.random()*i).toString(16),o=Math.floor(t+Math.random()*i).toString(16);return s.length<2&&(s="0"+s),n.length<2&&(n="0"+n),o.length<2&&(o="0"+o),"#"+s+n+o}static isValidColor(t){return root.CSS?root.CSS.supports("color",t):!0}static lighten(t){return Brush.lightenBy(t)}lightenBy(t,e){this.u&&U.L(this);const i=t===void 0||typeof t!="number"?.2:t,s=e===void 0?3:e;if(this.type===1)Brush.Eo(this.color),this.color=Brush.Ld(i,s);else if((this.type===2||this.type===3)&&this.colorStops!==null){const n=this.colorStops.iterator;for(;n.next();)Brush.Eo(n.value),this.addColorStop(n.key,Brush.Ld(i,s))}return this}static lightenBy(t,e,i){const s=e===void 0||typeof e!="number"?.2:e,n=i===void 0?3:i;return Brush.Eo(t),Brush.Ld(s,n)}static darken(t){return Brush.darkenBy(t)}darkenBy(t,e){this.u&&U.L(this);const i=t===void 0||typeof t!="number"?.2:t,s=e===void 0?3:e;if(this.type===1)Brush.Eo(this.color),this.color=Brush.Ld(-i,s);else if((this.type===2||this.type===3)&&this.colorStops!==null){const n=this.colorStops.iterator;for(;n.next();)Brush.Eo(n.value),this.addColorStop(n.key,Brush.Ld(-i,s))}return this}static darkenBy(t,e,i){const s=e===void 0||typeof e!="number"?.2:e,n=i===void 0?3:i;return Brush.Eo(t),Brush.Ld(-s,n)}static mix(t,e,i){Brush.Eo(t);const s=Brush.Y.n0,n=Brush.Y.n1,o=Brush.Y.n2,r=Brush.Y.n3;Brush.Eo(e),i===void 0&&(i=.5);const l=Math.round((Brush.Y.n0-s)*i+s),a=Math.round((Brush.Y.n1-n)*i+n),h=Math.round((Brush.Y.n2-o)*i+o),c=Math.round((Brush.Y.n3-r)*i+r);return`rgba(${l}, ${a}, ${h}, ${c})`}isDark(){if(this.type===1)return Brush.isDark(this.color);if((this.type===2||this.type===3)&&this.colorStops!==null){const t=this.colorStops;if(this.type===3){const l=t.first();return l?Brush.isDark(l.value):!1}if(t.get(.5)!==null)return Brush.isDark(t.get(.5));if(t.count===2){const l=t.toArray();return Brush.isDark(Brush.mix(l[0].value,l[1].value))}const e=t.iterator;let i=-1,s=-1,n=1,o=1;for(;e.next();){const l=e.key,a=Math.abs(.5-e.key);n>o&&a<n?(i=l,n=a):o>=n&&a<o&&(s=l,o=a)}if(i>s){let l=i;i=s,s=l,l=n,n=o,o=l}const r=s-i;return Brush.isDark(Brush.mix(t.get(i),t.get(s),1-o/r))}return!1}static isDark(t){return t?t instanceof Brush?t.isDark():(Brush.Eo(t),(299*Brush.Y.n0+587*Brush.Y.n1+114*Brush.Y.n2)/1e3<128):!1}static Ld(t,e){switch(e){case 1:return Brush.SI(),Brush.ho.n0=Math.min(100,Math.max(0,Brush.ho.n0+100*t)),Brush.MI(),"rgba("+Brush.Y.n0+", "+Brush.Y.n1+", "+Brush.Y.n2+", "+Brush.Y.n3+")";case 2:return Brush.IM(),Brush.ze.n2=Math.min(100,Math.max(0,Brush.ze.n2+100*t)),"hsla("+Brush.ze.n0+", "+Brush.ze.n1+"%, "+Brush.ze.n2+"%, "+Brush.ze.n3+")";case 3:return Brush.NI(),Brush.co.n0=Math.min(100,Math.max(0,Brush.co.n0+100*t)),Brush.CI(),"rgba("+Brush.Y.n0+", "+Brush.Y.n1+", "+Brush.Y.n2+", "+Brush.Y.n3+")";default:U.o("Unknown color space: "+e)}}static Eo(t){Brush.M0===!1&&(Brush.M0=!0,Brush.us=Diagram.isUsingDOM()?new CanvasSurface(null,void 0,{willReadFrequently:!0})._t:null);const e=Brush.us;if(e===null)return;e.clearRect(0,0,1,1),e.fillStyle="#000000";const i=e.fillStyle;if(e.fillStyle=t,e.fillStyle!==i){e.fillRect(0,0,1,1);const s=e.getImageData(0,0,1,1).data;Brush.Y.n0=s[0],Brush.Y.n1=s[1],Brush.Y.n2=s[2],Brush.Y.n3=s[3]/255}else{e.fillStyle="#FFFFFF";const s=e.fillStyle;e.fillStyle=t,e.fillStyle,Brush.Y.n0=0,Brush.Y.n1=0,Brush.Y.n2=0,Brush.Y.n3=1}}static IM(){const t=Brush.Y.n0/255,e=Brush.Y.n1/255,i=Brush.Y.n2/255,s=Math.max(t,e,i),n=Math.min(t,e,i),o=s-n;let r,l;const a=(s+n)/2;if(o===0)r=l=0;else{switch(s){case t:r=(e-i)/o%6;break;case e:r=(i-t)/o+2;break;case i:r=(t-e)/o+4;break;default:r=0;break}r*=60,r<0&&(r+=360),l=o/(1-Math.abs(2*a-1))}Brush.ze.n0=Math.round(r),Brush.ze.n1=Math.round(l*100),Brush.ze.n2=Math.round(a*100),Brush.ze.n3=Brush.Y.n3}static VU(){const t=Brush.ze.n0,e=Brush.ze.n1/100,i=Brush.ze.n2/100;let s,n,o;const r=(1-Math.abs(2*i-1))*e,l=t/60,a=r*(1-Math.abs(l%2-1));l>=0&&l<1?(s=r,n=a,o=0):l>=1&&l<2?(s=a,n=r,o=0):l>=2&&l<3?(s=0,n=r,o=a):l>=3&&l<4?(s=0,n=a,o=r):l>=4&&l<5?(s=a,n=0,o=r):(s=r,n=0,o=a);const h=i-.5*r;s+=h,n+=h,o+=h,Brush.Y.n0=Math.round(s*255),Brush.Y.n1=Math.round(n*255),Brush.Y.n2=Math.round(o*255),Brush.Y.n3=Brush.ze.n3}static SI(){Brush.aD(),Brush.LI()}static MI(){Brush.AI(),Brush.hD()}static VN(t){return t/=255,t<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}static BN(t){return t<=.0031308?t*12.92:1.055*Math.pow(t,1/2.4)-.055}static aD(){const t=Brush.VN(Brush.Y.n0),e=Brush.VN(Brush.Y.n1),i=Brush.VN(Brush.Y.n2);Brush.At.n0=.4124564*t+.3575761*e+.1804375*i,Brush.At.n1=.2126729*t+.7151522*e+.072175*i,Brush.At.n2=.0193339*t+.119192*e+.9503041*i,Brush.At.n3=Brush.Y.n3}static hD(){const t=3.2404542*Brush.At.n0+-1.5371385*Brush.At.n1+-.4985314*Brush.At.n2,e=-.969266*Brush.At.n0+1.8760108*Brush.At.n1+.041556*Brush.At.n2,i=.0556434*Brush.At.n0+-.2040259*Brush.At.n1+1.0572252*Brush.At.n2;Brush.Y.n0=Brush.BN(t)*255,Brush.Y.n1=Brush.BN(e)*255,Brush.Y.n2=Brush.BN(i)*255,Brush.Y.n3=Brush.At.n3,Brush.Y.n0=Math.round(Brush.Y.n0),Brush.Y.n0>255?Brush.Y.n0=255:Brush.Y.n0<0&&(Brush.Y.n0=0),Brush.Y.n1=Math.round(Brush.Y.n1),Brush.Y.n1>255?Brush.Y.n1=255:Brush.Y.n1<0&&(Brush.Y.n1=0),Brush.Y.n2=Math.round(Brush.Y.n2),Brush.Y.n2>255?Brush.Y.n2=255:Brush.Y.n2<0&&(Brush.Y.n2=0)}static zN=216/24389;static q1=24389/27;static Ad=[95.047,100,108.883];static XN(t){return t>Brush.zN?Math.pow(t,1/3):(Brush.q1*t+16)/116}static LI(){const t=Brush.XN(Brush.At.n0*100/Brush.Ad[0]),e=Brush.XN(Brush.At.n1*100/Brush.Ad[1]),i=Brush.XN(Brush.At.n2*100/Brush.Ad[2]);Brush.ho.n0=116*e-16,Brush.ho.n1=500*(t-e),Brush.ho.n2=200*(e-i),Brush.ho.n3=Brush.At.n3}static cD(t){const e=t*t*t;return e>Brush.zN?e:(116*t-16)/Brush.q1}static AI(){const t=(Brush.ho.n0+16)/116,e=Brush.ho.n1/500+t,i=t-Brush.ho.n2/200;Brush.At.n0=Brush.Ad[0]/100*Brush.cD(e),Brush.At.n1=Brush.Ad[1]/100*(Brush.ho.n0>Brush.q1*Brush.zN?Math.pow(t,3):Brush.ho.n0/Brush.q1),Brush.At.n2=Brush.Ad[2]/100*Brush.cD(i),Brush.At.n3=Brush.ho.n3}static TI(){let t=.8190224*Brush.At.n0+.3619062*Brush.At.n1+-.1288737*Brush.At.n2,e=.03298366*Brush.At.n0+.9292868*Brush.At.n1+.03614466*Brush.At.n2,i=.04817719*Brush.At.n0+.2642395*Brush.At.n1+.6335478*Brush.At.n2;t=Math.cbrt(t),e=Math.cbrt(e),i=Math.cbrt(i),Brush.ge.n0=.2104542*t+.7936177*e+-.004072046*i,Brush.ge.n1=1.977998*t+-2.428592*e+.4505937*i,Brush.ge.n2=.02590403*t+.7827717*e+-.8086757*i,Brush.ge.n3=Brush.At.n3,Brush.ge.n0*=100}static DI(){Brush.ge.n0/=100;let t=.9999999*Brush.ge.n0+.3963377*Brush.ge.n1+.2158037*Brush.ge.n2,e=1.000000009*Brush.ge.n0+-.1055613*Brush.ge.n1+-.06385417*Brush.ge.n2,i=1.00000005*Brush.ge.n0+-.08948418*Brush.ge.n1+-1.291485*Brush.ge.n2;t=t**3,e=e**3,i=i**3,Brush.At.n0=1.2268798*t+-.5578149*e+.281391*i,Brush.At.n1=-.04057576*t+1.112286*e+-.07171106*i,Brush.At.n2=-.07637294*t+-.4214933*e+1.586924*i,Brush.At.n3=Brush.ge.n3}static vI(){const t=Math.atan2(Brush.ge.n2,Brush.ge.n1)*180/Math.PI;Brush.co.n0=Brush.ge.n0,Brush.co.n1=Math.sqrt(Brush.ge.n1**2+Brush.ge.n2**2),Brush.co.n2=t>=0?t:t+360,Brush.co.n3=Brush.ge.n3}static FI(){Brush.ge.n0=Brush.co.n0,Brush.ge.n1=Brush.co.n1*Math.cos(Brush.co.n2*Math.PI/180),Brush.ge.n2=Brush.co.n1*Math.sin(Brush.co.n2*Math.PI/180),Brush.ge.n3=Brush.co.n3}static NI(){Brush.aD(),Brush.TI(),Brush.vI()}static CI(){Brush.FI(),Brush.DI(),Brush.hD()}static Md(t,e){typeof t=="string"||t instanceof Brush||U.o("Value for "+e+" must be a color string or a Brush, not "+t)}static Solid=1;static Linear=2;static Radial=3;static Pattern=4;static Lab=1;static HSL=2;static us=null;static M0=!1;static Y=new ColorNumbers;static ze=new ColorNumbers;static At=new ColorNumbers;static ho=new ColorNumbers;static ge=new ColorNumbers;static co=new ColorNumbers}class PanelLayout{Pt="Base";static fs=new GMap;static An(t,e){e.name=t,PanelLayout.fs.set(t,e)}get name(){return this.Pt}set name(t){this.Pt=t}constructor(){}get classType(){return Panel}measure(t,e,i,s,n,o,r){}measureElement(t,e,i,s,n){t.ht(e,i,s,n)}arrange(t,e,i){}arrangeElement(t,e,i,s,n,o){t.Ut(e,i,s,n,o)}remeasureObject(t){t.bf()}Ge(t,e,i){}}class PanelLayoutPosition extends PanelLayout{constructor(){super()}measure(t,e,i,s,n,o,r){const l=s.length,a=t.Jo();for(let h=0;h<l;h++){const c=s[h];if(!c.visible&&c!==a)continue;const f=c.margin,u=f.right+f.left,d=f.top+f.bottom;c.ht(e,i,o,r);const m=c.measuredBounds,g=Math.max(m.width+u,0),p=Math.max(m.height+d,0);let y=c.position.x,x=c.position.y;if(isFinite(y)||(y=0),isFinite(x)||(x=0),c instanceof Shape&&c.isGeometryPositioned){const b=c.strokeWidth/2;y-=b,x-=b}n.re(y,x,g,p)}}arrange(t,e,i){const s=e.length,n=t.padding,o=i.x-n.left,r=i.y-n.top;for(let l=0;l<s;l++){const a=e[l],h=a.measuredBounds,c=a.margin,f=a.position.x,u=a.position.y;let d=isNaN(f)?-o:f-o,m=isNaN(u)?-r:u-r;if(a instanceof Shape&&a.isGeometryPositioned){const g=a.strokeWidth/2;d-=g,m-=g}a.visible&&a.Ut(d+c.left,m+c.top,h.width,h.height)}}}PanelLayout.An("Position",new PanelLayoutPosition);class PanelLayoutHorizontal extends PanelLayout{constructor(){super()}measure(t,e,i,s,n,o,r){const l=s.length,a=U.nt(),h=t.Jo();for(let f=0;f<l;f++){const u=s[f];if(!u.visible&&u!==h)continue;const d=u.Zs(!1);if(d!==0&&d!==5){a.push(u);continue}u.ht(1/0,i,0,r);const m=u.margin,g=u.measuredBounds,p=Math.max(g.width+m.right+m.left,0),y=Math.max(g.height+m.top+m.bottom,0);n.Hn(n.width+p,Math.max(n.height,y))}const c=a.length;t.desiredSize.height?i=Math.min(t.desiredSize.height,t.maxSize.height):n.height!==0&&(i=Math.min(n.height,t.maxSize.height));for(let f=0;f<c;f++){const u=a[f];if(!u.visible&&u!==h)continue;const d=u.margin,m=d.right+d.left,g=d.top+d.bottom;u.ht(1/0,i,0,r);const p=u.measuredBounds,y=Math.max(p.width+m,0),x=Math.max(p.height+g,0);n.width+=y,n.height=Math.max(n.height,x)}U.Z(a)}arrange(t,e,i){const s=e.length,n=t.padding,o=n.top,r=t.isOpposite;let l=r?i.width:n.left;for(let a=0;a<s;a++){const h=o,c=e[a];if(!c.visible)continue;const f=c.measuredBounds,u=c.margin,d=u.top+u.bottom,m=o+n.bottom;let g=f.height;const p=c.Zs(!1);(isNaN(c.desiredSize.height)&&p===2||p===4)&&(g=Math.max(i.height-d-m,0));const y=g+d+m;let x=c.alignment;x.isDefault()&&(x=t.defaultAlignment),x.isSpot()||(x=Spot.Center),r&&(l-=f.width+u.left+u.right),c.Ut(l+x.offsetX+u.left,h+x.offsetY+u.top+(i.height*x.y-y*x.y),f.width,g),r||(l+=f.width+u.left+u.right)}}}PanelLayout.An("Horizontal",new PanelLayoutHorizontal);class PanelLayoutVertical extends PanelLayout{constructor(){super()}measure(t,e,i,s,n,o,r){const l=s.length,a=U.nt(),h=t.Jo();for(let f=0;f<l;f++){const u=s[f];if(!u.visible&&u!==h)continue;const d=u.Zs(!1);if(d!==0&&d!==4){a.push(u);continue}u.ht(e,1/0,o,0);const m=u.margin,g=u.measuredBounds,p=Math.max(g.width+m.right+m.left,0),y=Math.max(g.height+m.top+m.bottom,0);n.Hn(Math.max(n.width,p),n.height+y)}const c=a.length;t.desiredSize.width?e=Math.min(t.desiredSize.width,t.maxSize.width):n.width!==0&&(e=Math.min(n.width,t.maxSize.width));for(let f=0;f<c;f++){const u=a[f];if(!u.visible&&u!==h)continue;const d=u.margin,m=d.right+d.left,g=d.top+d.bottom;u.ht(e,1/0,o,0);const p=u.measuredBounds,y=Math.max(p.width+m,0),x=Math.max(p.height+g,0);n.width=Math.max(n.width,y),n.height+=x}U.Z(a)}arrange(t,e,i){const s=e.length,n=t.padding,o=n.left,r=t.isOpposite;let l=r?i.height:n.top;for(let a=0;a<s;a++){const h=o,c=e[a];if(!c.visible)continue;const f=c.measuredBounds,u=c.margin,d=u.left+u.right,m=o+n.right;let g=f.width;const p=c.Zs(!1);(isNaN(c.desiredSize.width)&&p===2||p===5)&&(g=Math.max(i.width-d-m,0));const y=g+d+m;let x=c.alignment;x.isDefault()&&(x=t.defaultAlignment),x.isSpot()||(x=Spot.Center),r&&(l-=f.height+u.bottom+u.top),c.Ut(h+x.offsetX+u.left+(i.width*x.x-y*x.x),l+x.offsetY+u.top,g,f.height),r||(l+=f.height+u.bottom+u.top)}}}PanelLayout.An("Vertical",new PanelLayoutVertical);class PanelLayoutSpot extends PanelLayout{constructor(){super()}static fD=!1;measure(t,e,i,s,n,o,r){const l=s.length;if(l===0)return;const a=t.findMainElement();let h=a.margin,c=0,f=0;const u=h.right+h.left,d=h.top+h.bottom;a.ht(e,i,o,r);let m=a.measuredBounds,g=m.width,p=m.height,y=Math.max(g+u,0),x=Math.max(p+d,0);const b=t.isClipping;b&&a.qp()!==0&&!PanelLayoutSpot.fD&&(PanelLayoutSpot.fD=!0,U.ne("Main Shape for Spot Panel with isClipping = true must have a zero strokeWidth: "+t.toString()));const k=Rect.z(-h.left,-h.top,y,x);let P=Rect.z(0,0,g,p);this.GN(a,P,!0),g=P.width,p=P.height;let S=!0;const L=t.Jo();let C;for(let M=0;M<l;M++){const N=s[M];let A=e,T=i;if(N===a||!N.visible&&N!==L)continue;h=N.margin;let D=h.left,v=h.top;switch(c=h.right+h.left,f=h.top+h.bottom,C=N.Zs(!1),C){case 2:A=g,T=p,c=0,f=0,D=0,v=0;break;case 5:A=g,c=0,D=0;break;case 4:T=p,f=0,v=0;break}N.ht(A,T,0,0),m=N.measuredBounds,y=Math.max(m.width+c,0),x=Math.max(m.height+f,0);let R=N.alignment;R.isDefault()&&(R=t.defaultAlignment),R.isSpot()||(R=Spot.Center);let F=N.alignmentFocus;F.isDefault()&&(F=Spot.Center);let O=null;N instanceof Panel&&N.fo!==""&&(O=N.findObject(N.fo),O===N&&(O=null));let z=P.x-D,Y=P.y-v;if(O!==null){N.Ut(0,0,m.width,m.height);const E=O.actualBounds,X=Point.z(E.x+(F.x*E.width-F.offsetX),E.y+(F.y*E.height-F.offsetY));for(O=O.panel;O!==null&&O!==N;)O.v.gt(X),O=O.panel;z+=R.x*g+R.offsetX-X.x,Y+=R.y*p+R.offsetY-X.y,Point.i(X)}else z+=R.x*g+R.offsetX-(F.x*m.width+F.offsetX),Y+=R.y*p+R.offsetY-(F.y*m.height+F.offsetY);S?(S=!1,n.e(z,Y,y,x)):n.re(z,Y,y,x)}switch(S?n.h(k):b?n.intersect(P.x,P.y,P.width,P.height):n.re(k.x,k.y,k.width,k.height),Rect.i(k),Rect.i(P),C=a.stretch,C===1&&(C=a.Zs(!1)),C){case 0:return;case 2:if(!isFinite(e)&&!isFinite(i))return;break;case 5:if(!isFinite(e))return;break;case 4:if(!isFinite(i))return;break}m=a.measuredBounds,g=m.width,p=m.height,y=Math.max(g+u,0),x=Math.max(p+d,0),h=a.margin,P=Rect.z(-h.left,-h.top,y,x),this.GN(a,P,!0),g=P.width,p=P.height;for(let M=0;M<l;M++){const N=s[M];if(N===a||!N.visible&&N!==L)continue;h=N.margin,c=h.right+h.left,f=h.top+h.bottom,m=N.measuredBounds,y=Math.max(m.width+c,0),x=Math.max(m.height+f,0);let A=N.alignment;A.isDefault()&&(A=t.defaultAlignment),A.isSpot()||(A=Spot.Center);let T=N.alignmentFocus;T.isDefault()&&(T=Spot.Center),S?(S=!1,n.e(A.x*g+A.offsetX-(T.x*m.width+T.offsetX)-h.left,A.y*p+A.offsetY-(T.y*m.height+T.offsetY)-h.top,y,x)):n.re(A.x*g+A.offsetX-(T.x*m.width+T.offsetX)-h.left,A.y*p+A.offsetY-(T.y*m.height+T.offsetY)-h.top,y,x)}S?n.h(k):b?n.intersect(P.x,P.y,P.width,P.height):n.re(k.x,k.y,k.width,k.height),Rect.i(P)}arrange(t,e,i){const s=e.length;if(s===0)return;const n=t.findMainElement(),o=n.measuredBounds,r=o.width,l=o.height,a=t.padding,h=a.left,c=a.top;let f=h-i.x,u=c-i.y;n.Ut(f,u,r,l);const d=Rect.z(0,0,r,l);this.GN(n,d,!1);for(let m=0;m<s;m++){const g=e[m];if(g===n)continue;const p=g.measuredBounds,y=p.width,x=p.height;let b=g.alignment;b.isDefault()&&(b=t.defaultAlignment),b.isSpot()||(b=Spot.Center);let k=g.alignmentFocus;k.isDefault()&&(k=Spot.Center);let P=null;if(g instanceof Panel&&g.fo!==""&&(P=g.findObject(g.fo),P===g&&(P=null)),P!==null){const S=P.actualBounds,L=Point.z(S.x+(k.x*S.width-k.offsetX),S.y+(k.y*S.height-k.offsetY));for(P=P.panel;P!==null&&P!==g;)P.v.gt(L),P=P.panel;f=b.x*d.width+b.offsetX-L.x,u=b.y*d.height+b.offsetY-L.y,Point.i(L)}else f=b.x*d.width+b.offsetX-(k.x*y+k.offsetX),u=b.y*d.height+b.offsetY-(k.y*x+k.offsetY);f+=d.x-i.x,u+=d.y-i.y,g.visible&&g.Ut(h+f,c+u,y,x)}Rect.i(d)}GN(t,e,i){let s=null;if(t instanceof Panel&&t.fo!==""&&(s=t.findObject(t.fo),s===t&&(s=null)),s!==null)for(i&&t.Ut(0,0,e.width,e.height),e.h(s.actualBounds),s=s.panel;s!==null&&s!==t;)s.v.sm(e),s=s.panel}}PanelLayout.An("Spot",new PanelLayoutSpot);class PanelLayoutAuto extends PanelLayout{constructor(){super()}measure(t,e,i,s,n,o,r){const l=s.length;if(l===0)return;const a=t.findMainElement();let h=a.margin,c=e,f=i;const u=h.right+h.left,d=h.top+h.bottom;a.ht(e,i,o,r);let m=a.measuredBounds,g=0,p=null;a instanceof Shape&&(p=a,g=p.strokeWidth*p.scale);let y=Math.max(m.width+u,0),x=Math.max(m.height+d,0),b=t.YN(a);const k=b.x*y+b.offsetX,P=b.y*x+b.offsetY;let S=t.KN(a);const L=S.x*y+S.offsetX,C=S.y*x+S.offsetY;isFinite(e)&&(c=Math.max(Math.abs(k-L)-g,0)),isFinite(i)&&(f=Math.max(Math.abs(P-C)-g,0));let M=0,N=0;o>0&&(M=Math.max(Math.abs(b.x*o+b.offsetX-(S.x*o+S.offsetX))-g,0)),r>0&&(N=Math.max(Math.abs(b.y*r+b.offsetY-(S.y*r+S.offsetY))-g,0));const A=Size.l();A.e(0,0);const T=t.Jo();for(let F=0;F<l;F++){const O=s[F];if(O===a||!O.visible&&O!==T)continue;h=O.margin;const z=h.right+h.left,Y=h.top+h.bottom;O.ht(c,f,M,N),m=O.measuredBounds,y=Math.max(m.width+z,0),x=Math.max(m.height+Y,0),A.e(Math.max(y,A.width),Math.max(x,A.height))}if(l===1){m=a.measuredBounds,n.width=y,n.height=x,Size.i(A);return}b=t.YN(a),S=t.KN(a);let D=0,v=0;S.x!==b.x&&S.y!==b.y&&(D=A.width/Math.abs(S.x-b.x),v=A.height/Math.abs(S.y-b.y)),Size.i(A),g=0,p!==null&&(g=p.strokeWidth*p.scale,p.tM()===6&&(D=v=Math.max(D,v))),D+=Math.abs(b.offsetX)+Math.abs(S.offsetX)+g,v+=Math.abs(b.offsetY)+Math.abs(S.offsetY)+g;let R=a.stretch;switch(R===1&&(R=a.Zs(!1)),R){case 0:o=0,r=0;break;case 2:isFinite(e)&&(D=e),isFinite(i)&&(v=i);break;case 5:isFinite(e)&&(D=e),r=0;break;case 4:o=0,isFinite(i)&&(v=i);break}a.bf(),a.ht(D,v,o,r),n.width=a.measuredBounds.width+u,n.height=a.measuredBounds.height+d}arrange(t,e,i){const s=e.length;if(s===0)return;const n=t.findMainElement(),o=n.measuredBounds,r=Rect.l();r.e(0,0,1,1);let l=n.margin;const a=l.left,h=l.top,c=t.padding,f=c.left,u=c.top;let d=a,m=h,g=o.width,p=o.height;n.Ut(f+d,u+m,g,p);const y=t.YN(n),x=t.KN(n),b=0+y.x*o.width+y.offsetX,k=0+y.y*o.height+y.offsetY,P=0+x.x*o.width+x.offsetX,S=0+x.y*o.height+x.offsetY;r.x=b,r.y=k,r.re(P,S,0,0),r.x+=a+f,r.y+=h+u;for(let L=0;L<s;L++){const C=e[L];if(C===n)continue;const M=C.measuredBounds;l=C.margin;const N=Math.max(M.width+l.right+l.left,0),A=Math.max(M.height+l.top+l.bottom,0);let T=C.alignment;T.isDefault()&&(T=t.defaultAlignment),T.isSpot()||(T=Spot.Center),d=r.width*T.x+T.offsetX-N*T.x+l.left+r.x,m=r.height*T.y+T.offsetY-A*T.y+l.top+r.y,g=r.width,p=r.height,C.visible&&(Rect.contains(r.x,r.y,r.width,r.height,d,m,M.width,M.height)?C.Ut(d,m,M.width,M.height):C.Ut(d,m,M.width,M.height,new Rect(r.x,r.y,r.width,r.height)))}Rect.i(r)}}PanelLayout.An("Auto",new PanelLayoutAuto);class PanelLayoutTable extends PanelLayout{constructor(){super(),this.name="Table"}measure(t,e,i,s,n,o,r){let l=s.length;const a=U.nt(),h=U.nt();for(let K=0;K<l;K++){const I=s[K],j=I instanceof Panel?I:null;if(j!==null&&j.nl()&&I.visible){h.push(j);const Q=j.D.r,nt=Q.length;for(let et=0;et<nt;et++){const it=Q[et];j.type===Panel.TableRow?it.row=I.row:j.type===Panel.TableColumn&&(it.column=I.column),a.push(it)}}else a.push(I)}l=a.length,l===0&&(t.getRowDefinition(0),t.getColumnDefinition(0));const c=[];for(let K=0;K<l;K++){const I=a[K];I.visible&&(I.xi(!0),I.lo(!0),c[I.row]||(c[I.row]=[]),c[I.row][I.column]||(c[I.row][I.column]=[]),c[I.row][I.column].push(I))}U.Z(a);const f=U.nt(),u=U.nt(),d=U.nt(),m={count:0},g={count:0};let p=e,y=i;const x=t.Zi,b=t.Qi;let k;l=x.length;for(let K=0;K<l;K++)k=x[K],k!==void 0&&(k.actual=0,k.Re=0);l=b.length;for(let K=0;K<l;K++)k=b[K],k!==void 0&&(k.actual=0,k.Re=0);let P=c.length,S=0;for(let K=0;K<P;K++)c[K]&&(S=Math.max(S,c[K].length));const L=Math.min(t.topIndex,P-1),C=Math.min(t.leftIndex,S-1);let M=0,N;P=c.length;const A=t.Jo();for(let K=0;K<P;K++){if(!c[K])continue;S=c[K].length;const I=t.getRowDefinition(K);I.actual=0,I.Re=0;for(let j=0;j<S;j++){if(!c[K][j])continue;const Q=t.getColumnDefinition(j);f[j]===void 0&&(Q.actual=0,Q.Re=0,f[j]=!0);const nt=c[K][j],et=nt.length;for(let it=0;it<et;it++){const st=nt[it];if(!st.visible&&st!==A)continue;const ut=st.rowSpan>1,lt=st.columnSpan>1;(ut||lt)&&!(K<L)&&!(j<C)&&u.push(st);const ht=st.margin,ot=ht.right+ht.left,rt=ht.top+ht.bottom;N=st.Qp(I,Q,!1);const ct=st.desiredSize,_=!isNaN(ct.width),dt=!isNaN(ct.height);if(N!==0&&!(_&&dt)&&!(K<L)&&!(j<C)&&(!lt&&m[j]===void 0&&(N===2||N===5)&&(m[j]=-1,m.count++),!ut&&g[K]===void 0&&(N===2||N===4)&&(g[K]=-1,g.count++),!ut&&!lt&&d.push(st)),st.ht(1/0,1/0,0,0),K<L||j<C)continue;const ft=st.measuredBounds,gt=Math.max(ft.width+ot,0),pt=Math.max(ft.height+rt,0);if(st.rowSpan===1&&(N===0||N===5)){k=t.getRowDefinition(K);const mt=k.computeEffectiveSpacing(),yt=k.q===0;M=Math.max(pt-k.actual,0),M+(yt?mt:0)>y&&(M=Math.max(y-mt,0)),k.Re=k.Re+M,k.actual=k.q+M,y=Math.max(y-(M+(yt?mt:0)),0)}if(st.columnSpan===1&&(N===0||N===4)){k=t.getColumnDefinition(j);const mt=k.computeEffectiveSpacing(),yt=k.q===0;M=Math.max(gt-k.actual,0),M+(yt?mt:0)>p&&(M=Math.max(p-mt,0)),k.Re=k.Re+M,k.actual=k.q+M,p=Math.max(p-(M+(yt?mt:0)),0)}(ut||lt)&&st.bf()}}}U.Z(f);let T=0,D=0;l=t.columnCount;for(let K=0;K<l;K++){const I=b[K];I!==void 0&&(T+=isNaN(I.ki)?I.Re:I.ki,I.Re!==0&&(T+=I.computeEffectiveSpacing()))}l=t.rowCount;for(let K=0;K<l;K++){const I=x[K];I!==void 0&&(D+=isNaN(I.ki)?I.Re:I.ki,I.Re!==0&&(D+=I.computeEffectiveSpacing()))}p=Math.max(e-T,0),y=Math.max(i-D,0);let v=y,R=p;l=d.length;for(let K=0;K<l;K++){const I=d[K],j=t.getRowDefinition(I.row),Q=t.getColumnDefinition(I.column),nt=I.measuredBounds,et=I.margin,it=et.right+et.left,st=et.top+et.bottom;Q.Re===0&&m[I.column]!==void 0?m[I.column]=Math.max(nt.width+it,m[I.column]):m[I.column]=null,j.Re===0&&g[I.row]!==void 0?g[I.row]=Math.max(nt.height+st,g[I.row]):g[I.row]=null}let F=0,O=0,z;for(z in g)z!=="count"&&(F+=g[z]);for(z in m)z!=="count"&&(O+=m[z]);const Y=Size.l();for(let K=0;K<l;K++){const I=d[K];if(!I.visible&&I!==A)continue;const j=t.getRowDefinition(I.row),Q=t.getColumnDefinition(I.column);let nt=0;isFinite(Q.width)?nt=Q.width:(isFinite(p)&&m[I.column]!==null?O===0?nt=Q.actual+p:nt=m[I.column]/O*R:m[I.column]!==null?nt=p:nt=Q.actual||p,nt=Math.max(0,nt-Q.computeEffectiveSpacing()));let et=0;switch(isFinite(j.height)?et=j.height:(isFinite(y)&&g[I.row]!==null?F===0?et=j.actual+y:et=g[I.row]/F*v:g[I.row]!==null?et=y:et=j.actual||y,et=Math.max(0,et-j.computeEffectiveSpacing())),Y.e(Math.max(Q.minimum,Math.min(nt,Q.maximum)),Math.max(j.minimum,Math.min(et,j.maximum))),N=I.Qp(j,Q,!1),N){case 5:Y.height=Math.max(Y.height,j.actual+y);break;case 4:Y.width=Math.max(Y.width,Q.actual+p);break}const it=I.margin,st=it.right+it.left,ut=it.top+it.bottom;I.bf();let lt=Q.minimum,ht=j.minimum;const ot=I.measuredBounds;ot.width===0&&m[I.column]!==null&&(lt=Math.max(lt,m[I.column])),ot.height===0&&g[I.row]!==null&&(ht=Math.max(lt,g[I.row])),I.ht(Y.width,Y.height,lt,ht);const rt=I.measuredBounds;let ct=Math.max(rt.width+st,0),_=Math.max(rt.height+ut,0);isFinite(p)&&(ct=Math.min(ct,Y.width)),isFinite(y)&&(_=Math.min(_,Y.height));let dt=0;dt=j.actual,j.actual=Math.max(j.actual,_),j.Re=Math.max(j.Re,_),M=j.actual-dt,y=Math.max(y-M,0),g[I.row]===null&&(v=Math.max(v-M,0)),dt=Q.actual,Q.actual=Math.max(Q.actual,ct),Q.Re=Math.max(Q.Re,ct),M=Q.actual-dt,p=Math.max(p-M,0),m[I.column]===null&&(R=Math.max(R-M,0))}U.Z(d);const E=Size.l(),X=U.nt(),B=U.nt();if(l=u.length,l!==0)for(let K=0;K<P;K++){if(!c[K])continue;S=c[K].length;const I=t.getRowDefinition(K);X[K]=I.actual;for(let j=0;j<S;j++){if(!c[K][j])continue;const Q=t.getColumnDefinition(j);B[j]=Q.actual}}for(let K=0;K<l;K++){const I=u[K];if(!I.visible&&I!==A)continue;const j=t.getRowDefinition(I.row),Q=t.getColumnDefinition(I.column);switch(Y.e(Math.max(Q.minimum,Math.min(e,Q.maximum)),Math.max(j.minimum,Math.min(i,j.maximum))),N=I.Qp(j,Q,!1),N){case 2:B[Q.index]!==0&&(Y.width=Math.min(Y.width,B[Q.index])),X[j.index]!==0&&(Y.height=Math.min(Y.height,X[j.index]));break;case 5:B[Q.index]!==0&&(Y.width=Math.min(Y.width,B[Q.index]));break;case 4:X[j.index]!==0&&(Y.height=Math.min(Y.height,X[j.index]));break}isFinite(Q.width)&&(Y.width=Q.width),isFinite(j.height)&&(Y.height=j.height),E.e(0,0);let nt=Q.minimum,et=j.minimum;for(let _=1;_<I.rowSpan&&!(I.row+_>=t.rowCount);_++){if(k=t.getRowDefinition(I.row+_),M=0,N===2||N===4){if(k.q===0)continue;M=Math.max(k.minimum,k.q===0?k.maximum:Math.min(k.q,k.maximum))}else M=Math.max(k.minimum,isNaN(k.ki)?k.maximum:Math.min(k.ki,k.maximum));E.height+=M,et+=k.minimum}for(let _=1;_<I.columnSpan&&!(I.column+_>=t.columnCount);_++){if(k=t.getColumnDefinition(I.column+_),M=0,N===2||N===5){if(k.q===0)continue;M=Math.max(k.minimum,k.q===0?k.maximum:Math.min(k.q,k.maximum))}else M=Math.max(k.minimum,isNaN(k.ki)?k.maximum:Math.min(k.ki,k.maximum));E.width+=M,nt+=k.minimum}Y.width+=E.width,Y.height+=E.height;const it=I.margin,st=it.right+it.left,ut=it.top+it.bottom;I.ht(Y.width,Y.height,nt,et);const lt=I.measuredBounds,ht=Math.max(lt.width+st,0),ot=Math.max(lt.height+ut,0);let rt=0;for(let _=0;_<I.rowSpan&&!(I.row+_>=t.rowCount);_++)k=t.getRowDefinition(I.row+_),rt+=k.total||0;if(rt<ot){let _=ot-rt;const dt=ot-rt;if(I.spanAllocation!==null){const at=I.spanAllocation;for(let ft=0;ft<I.rowSpan&&!(_<=0||I.row+ft>=t.rowCount);ft++){k=t.getRowDefinition(I.row+ft);const gt=k.q||0,pt=at(I,k,dt);k.actual=Math.min(k.maximum,gt+pt),k.q!==gt&&(_-=k.q-gt)}}for(;_>0&&k!==void 0;){const at=k.q||0;if(isNaN(k.height)&&k.maximum>at&&(k.actual=Math.min(k.maximum,at+_),k.q!==at&&(_-=k.q-at)),k.index===0)break;k=t.getRowDefinition(k.index-1)}}let ct=0;for(let _=0;_<I.columnSpan&&!(I.column+_>=t.columnCount);_++)k=t.getColumnDefinition(I.column+_),ct+=k.total||0;if(ct<ht){let _=ht-ct;const dt=ht-ct;if(I.spanAllocation!==null){const at=I.spanAllocation;for(let ft=0;ft<I.columnSpan&&!(_<=0||I.column+ft>=t.columnCount);ft++){k=t.getColumnDefinition(I.column+ft);const gt=k.q||0,pt=at(I,k,dt);k.actual=Math.min(k.maximum,gt+pt),k.q!==gt&&(_-=k.q-gt)}}for(;_>0&&k!==void 0;){const at=k.q||0;if(isNaN(k.width)&&k.maximum>at&&(k.actual=Math.min(k.maximum,at+_),k.q!==at&&(_-=k.q-at)),k.index===0)break;k=t.getColumnDefinition(k.index-1)}}}U.Z(u),Size.i(E),Size.i(Y),X!==void 0&&U.Z(X),B!==void 0&&U.Z(B);let H=0,q=0;const W=t.desiredSize,Z=t.maxSize;N=t.Zs(!0),T=0,D=0;let V=0,$=0;l=t.columnCount;for(let K=0;K<l;K++)if(b[K]!==void 0){if(k=t.getColumnDefinition(K),isFinite(k.width)){V+=k.width,V+=k.computeEffectiveSpacing();continue}else if(k.j1()===2){V+=k.q,V+=k.computeEffectiveSpacing();continue}k.q!==0&&(T+=k.q,T+=k.computeEffectiveSpacing())}isFinite(W.width)?H=Math.min(W.width,Z.width):N!==0&&isFinite(e)?H=e:H=T,H=Math.max(H,isFinite(e)?Math.min(o,e):o),H=Math.max(H-V,0);const J=T===0?1:Math.max(H/T,1);for(let K=0;K<l;K++)b[K]!==void 0&&(k=t.getColumnDefinition(K),!isFinite(k.width)&&k.j1()!==2&&(k.actual=k.q*J),k.position=n.width,k.q!==0&&(n.width+=k.q,n.width+=k.computeEffectiveSpacing()));l=t.rowCount;for(let K=0;K<l;K++)if(x[K]!==void 0){if(k=t.getRowDefinition(K),isFinite(k.height)){$+=k.height,$+=k.computeEffectiveSpacing();continue}else if(k.j1()===2){$+=k.q,$+=k.computeEffectiveSpacing();continue}k.q!==0&&(D+=k.q,D+=k.computeEffectiveSpacing())}isFinite(W.height)?q=Math.min(W.height,Z.height):N!==0&&isFinite(i)?q=i:q=D,q=Math.max(q,isFinite(i)?Math.min(r,i):r),q=Math.max(q-$,0);const tt=D===0?1:Math.max(q/D,1);for(let K=0;K<l;K++)x[K]!==void 0&&(k=t.getRowDefinition(K),!isFinite(k.height)&&k.j1()!==2&&(k.actual=k.q*tt),k.position=n.height,k.q!==0&&(n.height+=k.q,n.height+=k.computeEffectiveSpacing()));l=h.length;for(let K=0;K<l;K++){const I=h[K];let j=0,Q=0;I.type===Panel.TableRow?(j=n.width,k=t.getRowDefinition(I.row),Q=k.actual):(k=t.getColumnDefinition(I.column),j=k.actual,Q=n.height),I.measuredBounds.e(0,0,j,Q),I.xi(!1)}U.Z(h),t.Aa=c}arrange(t,e,i){const s=e.length,n=t.padding,o=n.left,r=n.top,l=t.Aa;if(l===null)return;let a=0,h=0;const c=l.length;let f=0;for(let C=0;C<c;C++)l[C]&&(f=Math.max(f,l[C].length));const u=t.Zi,d=t.Qi;let m=0,g=0,p=Math.min(t.topIndex,c-1);if(u.length>0){for(;p!==c&&(u[p]===void 0||u[p].q===0);)p++;p=Math.max(Math.min(p,c-1),0),m=-u[p].position}let y=Math.min(t.leftIndex,f-1);if(d.length>0){for(;y!==f&&(d[y]===void 0||d[y].q===0);)y++;y=Math.max(Math.min(y,f-1),0),g=-d[y].position}let x=0,b=0;for(;x!==c&&u[x]===void 0;)x++;for(;b!==c&&d[b]===void 0;)b++;const k=t.part;let P=t.getRowDefinition(x),S=t.getColumnDefinition(b);for(let C=0;C<e.length;C++){const M=e[C];if(!(M instanceof Panel&&M.visible&&M.nl()))continue;M.type===Panel.TableRow?(P=t.getRowDefinition(M.row),S=t.getColumnDefinition(b)):(P=t.getRowDefinition(x),S=t.getColumnDefinition(M.column)),h=P.position+m+r,P.q!==0&&(h+=P.computeEffectiveSpacingTop(Math.max(x,p))),a=S.position+g+o,S.q!==0&&(a+=S.computeEffectiveSpacingTop(Math.max(b,y)));const N=M.measuredBounds;M.pf(),M.actualBounds.ce();const A=M.actualBounds,T=Rect.z(A.x,A.y,A.width,A.height);if(A.x=M.type===Panel.TableRow?o:a,A.y=M.type===Panel.TableColumn?r:h,A.width=N.width,A.height=N.height,M.actualBounds.k(),M.lo(!1),T.equalsApproxClose(A)){Rect.i(T);continue}k!==null&&(k.Sa(),M.Wp(k)),Rect.i(T)}const L=Size.l();for(let C=0;C<c;C++){if(!l[C])continue;f=l[C].length;const M=t.getRowDefinition(C);h=M.position+m+r,M.q!==0&&(h+=M.computeEffectiveSpacingTop(Math.max(x,p)));for(let N=0;N<f;N++){if(!l[C][N])continue;const A=t.getColumnDefinition(N);a=A.position+g+o,A.q!==0&&(a+=A.computeEffectiveSpacingTop(Math.max(b,y)));const T=l[C][N],D=T.length;for(let v=0;v<D;v++){const R=T[v],F=R.measuredBounds;L.e(0,0);for(let ot=1;ot<R.rowSpan&&!(C+ot>=t.rowCount);ot++){const rt=t.getRowDefinition(C+ot);rt.q!==0&&(L.height+=rt.total)}for(let ot=1;ot<R.columnSpan&&!(N+ot>=t.columnCount);ot++){const rt=t.getColumnDefinition(N+ot);rt.q!==0&&(L.width+=rt.total)}const O=A.q+L.width,z=M.q+L.height;let Y=a,E=h;const X=O,B=z,H=a,q=h;let W=O,Z=z;a+O>i.width&&(W=Math.max(i.width-a,0)),h+z>i.height&&(Z=Math.max(i.height-h,0));let V=R.alignment,$=0,J=0,tt=0,K=0;if(V.isDefault()){V=t.defaultAlignment,V.isSpot()||(V=Spot.Center),$=V.x,J=V.y,tt=V.offsetX,K=V.offsetY;const ot=A.alignment,rt=M.alignment;ot.isSpot()&&($=ot.x,tt=ot.offsetX),rt.isSpot()&&(J=rt.y,K=rt.offsetY)}else $=V.x,J=V.y,tt=V.offsetX,K=V.offsetY;(isNaN($)||isNaN(J))&&($=.5,J=.5,tt=0,K=0);let I=F.width,j=F.height;const Q=R.margin,nt=Q.left+Q.right,et=Q.top+Q.bottom,it=R.Qp(M,A,!1);isNaN(R.desiredSize.width)&&(it===2||it===5)&&(I=Math.max(O-nt,0)),isNaN(R.desiredSize.height)&&(it===2||it===4)&&(j=Math.max(z-et,0));const st=R.maxSize,ut=R.minSize;I=Math.min(st.width,I),j=Math.min(st.height,j),I=Math.max(ut.width,I),j=Math.max(ut.height,j);const lt=I+nt,ht=j+et;Y+=X*$-lt*$+tt+Q.left,E+=B*J-ht*J+K+Q.top,R.visible&&(Rect.contains(H,q,W,Z,Y,E,F.width,F.height)?R.Ut(Y,E,I,j):R.Ut(Y,E,I,j,new Rect(H,q,W,Z)))}}}Size.i(L);for(let C=0;C<s;C++){const M=e[C],N=M instanceof Panel?M:null;if(N!==null&&N.nl()){const A=M.actualBounds;M.naturalBounds.ce(),M.naturalBounds.e(0,0,A.width,A.height),M.naturalBounds.k()}}}}PanelLayout.An("Table",new PanelLayoutTable);class PanelLayoutTableRow extends PanelLayout{constructor(){super()}measure(t,e,i,s,n,o,r){}arrange(t,e,i){}}PanelLayout.An("TableRow",new PanelLayoutTableRow);class PanelLayoutTableColumn extends PanelLayout{constructor(){super()}measure(t,e,i,s,n,o,r){}arrange(t,e,i){}}PanelLayout.An("TableColumn",new PanelLayoutTableColumn);class PanelLayoutViewbox extends PanelLayout{constructor(){super()}measure(t,e,i,s,n,o,r){s.length!==1&&U.o("Viewbox Panel must contain exactly one GraphObject.");const a=s[0];a.it=1,a.bf(),a.ht(1/0,1/0,o,r);let h=a.measuredBounds;const c=a.margin,f=c.right+c.left,u=c.top+c.bottom;if(isFinite(e)||isFinite(i)){const d=a.scale,m=h.width,g=h.height,p=Math.max(e-f,0),y=Math.max(i-u,0);let x=1;t.viewboxStretch===6?(m!==0&&g!==0&&(x=Math.min(p/m,y/g)),x===0&&(x=1e-4),a.it*=x):(m!==0&&g!==0&&(x=Math.max(p/m,y/g)),x===0&&(x=1e-4),a.it*=x),d!==a.scale&&(a.xi(!0),a.ht(1/0,1/0,o,r))}h=a.measuredBounds,n.width=isFinite(e)?e:Math.max(h.width+f,0),n.height=isFinite(i)?i:Math.max(h.height+u,0)}arrange(t,e,i){const s=e[0],n=s.measuredBounds,o=s.margin,r=o.right+o.left,l=o.top+o.bottom,a=Math.max(n.width+r,0),h=Math.max(n.height+l,0);let c=s.alignment;c.isDefault()&&(c=t.defaultAlignment),c.isSpot()||(c=Spot.Center),s.Ut(i.width*c.x-a*c.x+c.offsetX,i.height*c.y-h*c.y+c.offsetY,n.width,n.height)}}PanelLayout.An("Viewbox",new PanelLayoutViewbox);class PanelLayoutGrid extends PanelLayout{constructor(){super()}measure(t,e,i,s,n,o,r){t.Pe===null&&(t.Pe=new GridPanelSettings),this.RI(t),this.OI(t)}arrange(t,e,i){}Ge(t,e,i){const s=t.naturalBounds;e.save(),e.beginPath(),e.rect(0,0,s.width,s.height),e.clip(),e.endPath(),this.II(t,e,i),e.restore(),e.clearContextCache(!1)}II(t,e,i){let s=t.getDocumentScale()*i.scale;s<=0&&(s=1);const n=t.gridCellSize,o=n.width,r=n.height,l=t.naturalBounds,a=t.actualBounds,h=l.width,c=l.height,f=Math.ceil(h/o),u=Math.ceil(c/r),d=t.gridOrigin,m=d.x,g=d.y,p=t.Pe.N0,y=t.D.r,x=y.length;for(let b=0;b<x;b++){const k=y[b];if(!k.visible)continue;const P=k.interval||1,S=Math.abs(P);if(o*S*s<2)continue;let L=k.segmentIndex;(!isFinite(L)||isNaN(L))&&(L=0),L<0&&(L=S-Math.min(-L,S)),L=Math.round(L%S);const C=k.opacity;let M=1;if(C!==1){if(C===0)continue;M=e.globalAlpha,e.globalAlpha=M*C}const N=p[b];let A=!1;const T=k.strokeDashArray;if(T!==null&&(A=!0,e.enableDash(T,k.strokeDashOffset)),k.stroke!==null&&k.strokeWidth>0&&(k.figure==="LineV"||k.figure==="LineH")){if(e.lineWidth=k.strokeWidth,t.bn(e,k.stroke,!1,!1,l,a),e.beginPath(),k.figure==="LineV"){const D=Math.floor((m-o)/o);for(let v=D;v<=D+f;v++){const R=v*o+m;0<=R&&R<=h&&this.W1(v,P,L,N)&&(e.moveTo(R,0),e.lineTo(R,c))}}else if(k.figure==="LineH"){const D=Math.floor((g-r)/r);for(let v=D;v<=D+u;v++){const R=v*r+g;0<=R&&R<=c&&this.W1(v,P,L,N)&&(e.moveTo(0,R),e.lineTo(h,R))}}e.stroke(),e.endPath()}else if(k.fill!==null){if(t.bn(e,k.fill,!0,!1,l,a),k.figure==="BarV"){let D=k.width;isNaN(D)&&(D=o);const v=Math.floor((m-o)/o);for(let R=v;R<=v+f;R++){const F=R*o+m;0<=F+D&&F<=h&&this.W1(R,P,L,N)&&e.fillRect(F,0,D,c)}}else if(k.figure==="BarH"){let D=k.height;isNaN(D)&&(D=r);const v=Math.floor((g-r)/r);for(let R=v;R<=v+u;R++){const F=R*r+g;0<=F+D&&F<=c&&this.W1(R,P,L,N)&&e.fillRect(0,F,h,D)}}}A&&e.disableDash(),C!==1&&(e.globalAlpha=M)}}W1(t,e,i,s){if(e<0)return t%e===i;if(t%e!==i)return!1;const n=s.length;for(let o=0;o<n;o++){const r=s[o];if(t%r===i)return!1}return!0}OI(t){const e=[],i=t.D.r,s=i.length;for(let n=0;n<s;n++){const o=i[n],r=[];if(e.push(r),!o.visible)continue;const l=o.interval;if(l<0)continue;const a=o.figure,h=this.HN(a);for(let c=0;c<s;c++){if(c===n)continue;const f=i[c];if(!f.visible)continue;const u=f.figure;if(this.HN(u)!==h)continue;const d=f.interval;d>l&&r.push(d)}}t.Pe.N0=e}HN(t){return t==="LineV"||t==="BarV"}RI(t){let e=1,i=1;const s=t.D.r,n=s.length;for(let l=0;l<n;l++){const a=s[l],h=Math.abs(a.interval);h<2||(this.HN(a.figure)?i=i*h/G.jL(i,h):e=e*h/G.jL(e,h))}const o=t.gridCellSize,r=t.Pe;r.lf.isReal()?r.lf.e(i*o.width,e*o.height):r.lf=new Size(i*o.width,e*o.height)}}PanelLayout.An("Grid",new PanelLayoutGrid);class PanelLayoutLink extends PanelLayout{constructor(){super()}measure(t,e,i,s,n,o,r){const l=s.length;if(!(t instanceof Adornment||t instanceof Link))return;let a=null,h=null;if(t instanceof Link&&(a=t),t instanceof Adornment&&(h=t,a=h.adornedPart,t.Lf===null&&(t.Lf=[])),!(a instanceof Link))return;const c=a;if(l===0){t.naturalBounds.Hn(0,0),t.measuredBounds.e(0,0,0,0);return}const f=t instanceof Adornment?null:a.path,u=a.routeBounds,d=t.$o;d.e(0,0,u.width,u.height);const m=c.points,g=a.pointsCount;h!==null?h.Td(!1):a!==null&&a.Td(!1);const p=u.width,y=u.height,x=t.Lf;if(x.length=0,f!==null){this.measureLinkPath(t,p,y,f);const S=f.measuredBounds;d.unionRect(S),x.push(S)}const b=Transform.l(),k=Point.l(),P=Point.l();for(let S=0;S<l;S++){const L=s[S];if(L===f)continue;let C=L.measuredBounds;if(L.isPanelMain&&L instanceof Shape){this.measureLinkPath(t,p,y,L),C=L.measuredBounds,d.unionRect(C),x.push(C);continue}if(g<2){L.ht(1/0,1/0,0,0),C=L.measuredBounds,d.unionRect(C),x.push(C);continue}const M=L.segmentIndex,N=L.segmentFraction;let A=L.alignmentFocus;A.isNoSpot()&&(A=Spot.Center);const T=L.segmentOrientation,D=L.segmentOffset;let v=0,R=0,F=0,O=0;if(isNaN(M)){const V=c.ut,$=U.nt();V.getPointAndAngleAlongPath(N,$);const J=Point.z($[0],$[1]);O=$[2],T!==0&&(F=c.computeAngle(L,T,O),L.Xt=F,L.xi(!0),L.lo(!0)),v=J.x,R=J.y,Point.i(J),U.Z($)}else if(M<-g||M>=g){const V=Point.l();c.qN(V),O=c.midAngle,T!==0&&(F=c.computeAngle(L,T,O),L.Xt=F,L.xi(!0),L.lo(!0)),v=V.x-u.x,R=V.y-u.y,Point.i(V)}else{let V,$,J=0;if(M>=0?(V=m.elt(M),$=M<g-1?m.elt(M+1):V):(J=g+M,V=m.elt(J),$=J>0?m.elt(J-1):V),V.equalsApprox($)){let tt,K;M>=0?(tt=M>0?m.elt(M-1):V,K=M<g-2?m.elt(M+2):$):(tt=J<g-1?m.elt(J+1):V,K=J>1?m.elt(J-2):$);const I=tt.distanceSquaredPoint(V),j=$.distanceSquaredPoint(K);I>j+10?O=M>=0?tt.directionPoint(V):V.directionPoint(tt):j>I+10?O=M>=0?$.directionPoint(K):K.directionPoint($):O=M>=0?tt.directionPoint(K):K.directionPoint(tt)}else O=M>=0?V.directionPoint($):$.directionPoint(V);T!==0&&(F=c.computeAngle(L,T,O),L.Xt=F,L.xi(!0),L.lo(!0)),v=V.x+($.x-V.x)*N-u.x,R=V.y+($.y-V.y)*N-u.y}L.ht(1/0,1/0,0,0),C=L.measuredBounds;const z=L.naturalBounds;let Y=0;L instanceof Shape&&(Y=L.strokeWidth);const E=z.width+Y,X=z.height+Y;b.Ue(),b.Xs(-C.x,-C.y),b.it(L.scale,L.scale),b.ks(T===0?L.angle:O,E/2,X/2),(T===22||T===26)&&b.ks(90,E/2,X/2),(T===23||T===27)&&b.ks(-90,E/2,X/2),T===28&&(O>45&&O<135||O>225&&O<315)&&b.ks(-O,E/2,X/2);const B=new Rect(0,0,E,X);k.setRectSpot(B,A),b.gt(k);const H=-k.x+Y/2*L.scale,q=-k.y+Y/2*L.scale;P.h(D);const W=isNaN(D.x),Z=isNaN(D.y);if(W||Z){const V=E/2+Link.J1,$=X/2+Link.J1,J=O>=45&&O<=135,tt=O>=225&&O<=315;T===0&&(J||tt)?(P.x=Z?V:D.y,P.y=W?$:D.x,J?M>=0||isNaN(M)&&N<.5||W&&(P.y=-$):tt&&((M>=0||isNaN(M)&&N<.5)&&W&&(P.y=-$),Z&&(P.x=-V))):(W&&(M>=0||isNaN(M)&&N<.5?P.x=V:P.x=-V),Z&&(P.y=-$),P.rotate(O))}else P.rotate(O);v+=P.x,R+=P.y,B.e(v+H,R+q,C.width,C.height),x.push(B),d.unionRect(B)}if(a!==null){const S=a.labelNodes;for(;S.next();)S.value.ht(1/0,1/0)}t.$o=d,t.position.e(u.x+d.x,u.y+d.y),n.Hn(d.width||0,d.height||0),Transform.i(b),Point.i(k),Point.i(P)}arrange(t,e,i){const s=e.length;if(!(t instanceof Adornment||t instanceof Link))return;let n=t,o=null;t instanceof Adornment&&(o=t,n=o.adornedPart);const r=t,l=t instanceof Adornment?null:n.path,a=t.Lf;if(a.length!==0){let u=0;if(l!==null&&u<a.length){const d=a[u];u++,l.Ut(d.x-r.$o.x,d.y-r.$o.y,d.width,d.height)}for(let d=0;d<s;d++){const m=e[d];if(m!==l&&u<a.length){const g=a[u];u++,m.Ut(g.x-r.$o.x,g.y-r.$o.y,g.width,g.height)}}}const h=n.points,c=h.count;if(c>=2&&r instanceof Link){const u=r.labelNodes;for(;u.next();){const d=u.value;r.EI(d,c,h)}}o!==null?o.Td(!1):n.Td(!1);const f=t.uD(Point.l());t.location.e(t.position.x+f.x,t.position.y+f.y),Point.i(f)}measureLinkPath(t,e,i,s){if(s.Xo()===!1)return;let n=s.strokeWidth;if(n===0&&t instanceof Adornment&&t.type===Panel.Link&&t.adornedObject instanceof Shape&&(n=t.adornedObject.strokeWidth),n=n*s.it,t instanceof Link&&t.ut!==null){const o=t.geometry.bounds;s.ro(o.x-n/2,o.y-n/2,o.width+n,o.height+n)}else if(t instanceof Adornment&&t.adornedPart.ut!==null){const o=t.adornedPart.ut.bounds;s.ro(o.x-n/2,o.y-n/2,o.width+n,o.height+n)}else s.ro(-(n/2),-(n/2),e+n,i+n);s.UI(),s.xi(!1)}}PanelLayout.An("Link",new PanelLayoutLink);class PanelLayoutGraduated extends PanelLayout{constructor(){super()}measure(t,e,i,s,n,o,r){const l=t.findMainElement();if(!(l instanceof Shape))return;t._i=[];const a=l.margin,h=a.right+a.left,c=a.top+a.bottom;l.ht(e,i,o,r);const f=l.measuredBounds,u=f.width,d=f.height,m=Math.max(u+h,0),g=Math.max(d+c,0),p=new Rect(-a.left,-a.top,m,g);t._i.push(p),n.h(p),this.determineGraduatedMarks(t,l);const y=t.vs;if(y===null)return;const x=s.length;for(let b=0;b<x;b++){const k=s[b],P=y[b];!k.visible||k===l||P.length===0||(k instanceof Shape?this.measureGraduatedTicks(t,k,P,n):k instanceof TextBlock&&this.measureGraduatedLabels(t,k,P,n),k.xi(!1))}}arrange(t,e,i){if(t._i===null)return;const s=t.findMainElement(),n=t.vs;if(n===null)return;const o=t._i;let r=0,l=o[r];r++,s!==null&&s.Ut(l.x-i.x,l.y-i.y,l.width,l.height);const a=e.length;for(let h=0;h<a;h++){const c=e[h],f=n[h];!c.visible||c===s||f.length===0||(l=o[r],r++,c.Ut(l.x-i.x,l.y-i.y,l.width,l.height))}t._i=null}measureGraduatedTicks(t,e,i,s){let n=e.alignmentFocus;n.isNoSpot()&&(n=Spot.TopCenter);const o=e.angle;e.Xt=0,e.ht(1/0,1/0,0,0),e.Xt=o;const r=e.measuredBounds,l=r.width,a=r.height,h=Rect.z(0,0,l,a),c=Point.l();c.setRectSpot(h,n),Rect.i(h);const f=-c.x,u=-c.y,d=new Rect,m=i.length;for(let g=0;g<m;g++){const p=i[g],y=p.pt.x,x=p.pt.y,b=p.angle;for(let k=0;k<4;k++){switch(k){case 0:c.e(f,u);break;case 1:c.e(f+l,u);break;case 2:c.e(f,u+a);break;case 3:c.e(f+l,u+a);break}c.rotate(b+e.angle),c.offset(y,x),g===0&&k===0?d.e(c.x,c.y,0,0):d.unionPoint(c),c.offset(-y,-x),c.rotate(-b-e.angle)}}Point.i(c),t._i!==null&&t._i.push(d),s.re(d.x,d.y,d.width,d.height)}measureGraduatedLabels(t,e,i,s){t.vi===null&&(t.vi=new TextBlock);const n=t.vi;this.dD(e,n);let o=e.alignmentFocus;o.isNoSpot()&&(o=Spot.TopCenter);const r=e.segmentOrientation,l=e.segmentOffset,a=new Rect;let h=0,c=0,f=0,u=0,d=0;const m=i.length;for(let g=0;g<m;g++){const p=i[g];h=p.pt.x,c=p.pt.y,f=p.angle,u=e.angle,d=e.angle,r!==0&&(r===21||r===25?d=f+e.angle:d=f,u=Link.computeAngle(r,d)),n.Xt=u,n.text=p.text||"",n.ht(1/0,1/0,0,0);const y=n.measuredBounds,x=n.naturalBounds,b=x.width,k=x.height,P=Transform.l();P.Ue(),P.Xs(-y.x,-y.y),P.it(n.scale,n.scale),P.ks(d,b/2,k/2),(r===22||r===26)&&P.ks(90,b/2,k/2),(r===23||r===27)&&P.ks(-90,b/2,k/2),r===28&&(f>45&&f<135||f>225&&f<315)&&P.ks(-f,b/2,k/2);const S=Rect.z(0,0,b,k),L=Point.l();L.setRectSpot(S,o),P.gt(L);const C=-L.x,M=-L.y,N=Point.l();N.h(l),isNaN(N.x)&&(N.x=b/2+3),isNaN(N.y)&&(N.y=-(k/2+3)),N.rotate(f),h+=N.x+C,c+=N.y+M;const A=new Rect(h,c,y.width,y.height),T=new Rect(y.x,y.y,y.width,y.height),D=new Rect(x.x,x.y,x.width,x.height);p.labelAngle=u,p.lineCount=n.lineCount,p.lines=n.getMetrics(),p.actualBounds=A,p.measuredBounds=T,p.naturalBounds=D,g===0?a.h(A):a.unionRect(A),Point.i(N),Point.i(L),Rect.i(S),Transform.i(P)}t._i!==null&&t._i.push(a),s.re(a.x,a.y,a.width,a.height)}determineGraduatedMarks(t,e){const i=e.geometry,s=e.strokeWidth,n=i.flattenedSegments,o=i.flattenedLengths,r=i.flattenedTotalLength,l=n.length;let a=0,h=0;const c=U.nt();for(let x=0;x<l;x++){const b=n[x],k=[];a=0,h=0;const P=b.length;for(let S=0;S<P;S+=2){const L=b[S],C=b[S+1];if(S===0){a=L,h=C;continue}let M=Math.atan2(C-h,L-a)*180/Math.PI;M<0&&(M+=360),k.push(M),a=L,h=C}c.push(k)}const f=this.VI(t),u=t.D.r,d=u.length;let m=0,g=0,p=r;t.vs=[];let y;for(let x=0;x<d;x++){const b=u[x];if(y=[],!b.visible||b===e){t.vs.push(y);continue}const k=Math.abs(b.interval),P=t.graduatedTickUnit;if(P*k*r/t.graduatedRange<2&&b.graduatedSkip===null){t.vs.push(y);continue}let S=o[0][0],L=0,C=0;g=r*b.graduatedStart-1e-4,p=r*b.graduatedEnd+1e-4;const M=P*k;let N=t.graduatedTickBase;if(N<t.graduatedMin){let v=(t.graduatedMin-N)/M;v=v%1===0?v:Math.floor(v+1),N+=v*M}else if(N>t.graduatedMin+M){const v=Math.floor((N-t.graduatedMin)/M);N-=v*M}const A=f[x],T=N,D=t.graduatedMax*1e-6;for(let v=1;N<=t.graduatedMax+D;v++){if(this.BI(t,N-t.graduatedTickBase,A)&&(N>t.graduatedMax&&(N=t.graduatedMax),(b.graduatedSkip===null||b instanceof TextBlock&&!b.graduatedSkip(N,b)||b instanceof Shape&&!b.graduatedSkip(N,b))&&(m=(N-t.graduatedMin)*r/t.graduatedRange,m>r&&(m=r),g<=m&&m<=p))){let R=c[L][C],F=o[L][C];for(;L<o.length;){for(;m>S&&C<o[L].length-1;)C++,R=c[L][C],F=o[L][C],S+=F;if(m<=S)break;L++,C=0,R=c[L][C],F=o[L][C],S+=F}const O=n[L],z=O[C*2],Y=O[C*2+1],E=O[C*2+2],X=O[C*2+3],B=(m-(S-F))/F,H=new Point(z+(E-z)*B+s/2-i.bounds.x,Y+(X-Y)*B+s/2-i.bounds.y);if(H.scale(e.scale,e.scale),R=this.zI(R,B,O,c[L],C),b instanceof TextBlock){let q="";b.graduatedFunction!==null?(q=b.graduatedFunction(N,b),q=q!=null?q.toString():""):q=(+N.toFixed(2)).toString(),q!==""&&y.push({pt:H,angle:R,text:q})}else y.push({pt:H,angle:R})}N=T+v*M}t.vs.push(y)}U.Z(c)}zI(t,e,i,s,n){if(e<.5005&&e>.4995)return t;let o=t;if(e<.5?n>0?o=s[n-1]:G.X(i[0],i[i.length-2])&&G.X(i[1],i[i.length-1])&&(o=s[s.length-1]):e>.5&&(n+1<s.length?o=s[n+1]:G.X(i[0],i[i.length-2])&&G.X(i[1],i[i.length-1])&&(o=s[0])),t!==o){let r=Math.abs(t-o);if(r>180&&(t<o?t+=360:o+=360,r=Math.abs(t-o)),e<5e-4||e>.9995)return(t+o)/2%360;if(r<10){const l=1-Math.abs(.5-e);return(t*l+o*(1-l))%360}}return t}VI(t){if(t.ds===null){const e=[],i=t.D.r,s=i.length;for(let n=0;n<s;n++){const o=i[n],r=[];if(e.push(r),!o.visible)continue;const l=o.interval;if(!(l<0))for(let a=0;a<s;a++){if(a===n)continue;const h=i[a];if(!h.visible||o.constructor!==h.constructor)continue;const c=h.interval;c>l&&r.push(c)}}t.ds=e}return t.ds}BI(t,e,i){const s=i.length;for(let n=0;n<s;n++){const o=i[n]*t.graduatedTickUnit,r=e%o,l=t.graduatedTickUnit*1e-6;if(r<l&&r>-l)return!1}return!0}Ge(t,e,i){const s=i.ph;i.ph=!0;const n=t.naturalBounds,o=n.width,r=n.height,l=e instanceof SVGContext;e.save(),e.beginPath(),e.rect(-1,-1,o+1,r+1),e.clip(),e.endPath();const a=t.findMainElement();a.Ge(e,i);let h=t.getDocumentScale()*i.scale;h<=0&&(h=1);const c=a.actualBounds,f=t.D.r,u=t.vs,d=f.length;for(let m=0;m<d;m++){const g=f[m],p=u[m],y=p.length;if(!(!g.visible||g===a||p.length===0)){if(g instanceof Shape){if(t.graduatedTickUnit*g.interval*a.geometry.flattenedTotalLength/t.graduatedRange*h<2&&g.graduatedSkip===null)continue;const x=g.measuredBounds,b=g.strokeWidth*g.scale;let k=g.alignmentFocus;k.isNoSpot()&&(k=Spot.TopCenter);for(let P=0;P<y;P++){const S=p[P].pt,L=p[P].angle;this.XI(g,S,c,L,x,b,k),g.Ge(e,i),l&&(t.svg.appendChild(g.svg),g.svg=null),g.el.Ue()}}else if(g instanceof TextBlock){t.vi===null&&(t.vi=new TextBlock);const x=t.vi;this.dD(g,x),x.jN=!0;for(let b=0;b<y;b++){const k=p[b];if(k.actualBounds&&k.measuredBounds&&k.naturalBounds){x.GI(k);const P=k.actualBounds;x.Ut(P.x,P.y,P.width,P.height),this.YI(x,c,P,k.measuredBounds,k.naturalBounds),x.sl=g.part,x.$s=g.panel,x.Ge(e,i),x.$s=null,x.sl=null,l&&(t.svg.appendChild(x.svg),x.svg=null)}}}}}i.ph=s,e.restore(),e.clearContextCache(!0)}XI(t,e,i,s,n,o,r){const l=t.el;l.Ue(),l.Xs(e.x+i.x,e.y+i.y),l.ks(s+t.angle,0,0),l.Xs(-n.width*r.x+r.offsetX+o/2,-n.height*r.y+r.offsetY+o/2),l.it(t.scale,t.scale),t.Sd(!1),t.wa.set(t.el),t.Th=t.scale,t.Na(!1)}YI(t,e,i,s,n){const o=t.el;o.Ue(),o.Xs(i.x+e.x,i.y+e.y),o.Xs(-s.x,-s.y),t.Kp(o,n.x,n.y,n.width,n.height),t.Sd(!1),t.wa.set(t.el),t.Th=t.scale,t.Na(!1)}dD(t,e){e.KI(t)}}PanelLayout.An("Graduated",new PanelLayoutGraduated);var ViewboxStretch=(w=>(w[w.Uniform=6]="Uniform",w[w.UniformToFill=7]="UniformToFill",w))(ViewboxStretch||{});class Panel extends GraphObject{W;D;Qt;Dd;Zn;rl;fo;$o;WN;O;vd;ot;Pe;te;Fd;Ta;_s;constructor(t,e){if(super(),t===void 0)this.W=Panel.Position;else if(typeof t=="string"){const i=PanelLayout.fs.get(t);i!==null?this.W=i:U.o("PanelLayout not loaded: "+t)}else t instanceof PanelLayout?this.W=t:(this.W=Panel.Position,t&&(e=t));this.n|=4194304|(this.W===Panel.Grid?1048576:0),this.D=new List,this.Qt=Margin.im,this.Dd=Spot.Default,this.Zn=1,this.rl=null,this.fo="",this.$o=new Rect(NaN,NaN,NaN,NaN),this.WN=null,this.O=null,this.vd=6,this.Pe=null,this.ot=null,this.te=null,this.Fd=NaN,this.Ta=null,this._s=null,e&&Object.assign(this,e)}cloneProtected(t){super.cloneProtected(t),t.W=this.W,t.Qt=this.Qt.N(),t.Dd=this.Dd.N(),t.Zn=this.Zn,t.fo=this.fo,t.$o.h(this.$o),this.O!==null&&(t.O=this.O.copy(t)),t.vd=this.vd,this.ot!==null&&(t.ot=this.ot.copy()),this.Pe!==null&&(t.Pe=this.Pe.copy()),t.te=this.te,t.Fd=this.Fd,t.Ta=this.Ta}Ho(t){super.Ho(t),t.D=this.D;const e=t.D.r,i=e.length;for(let s=0;s<i;s++){const n=e[s];n.$s=t}t.rl=null}copy(){const t=super.copy(),e=this.D.r,i=e.length;for(let s=0;s<i;s++){const o=e[s].copy();t.HI(o)}return t}toString(){return"Panel("+this.type.name+")#"+GSet.xs(this)}get type(){return this.W}set type(t){const e=this.W;e!==t&&(this.W=t,this.Af=this.W===Panel.Grid,this.f(),this.t("type",e,t))}get elements(){return this.D.iterator}get naturalBounds(){return this.Ke}get padding(){return this.Qt}set padding(t){typeof t=="number"?(t<0&&U.J(t,">= 0",Panel,"padding"),t=new Margin(t)):(t.left<0&&U.J(t.left,">= 0",Panel,"padding:value.left"),t.right<0&&U.J(t.right,">= 0",Panel,"padding:value.right"),t.top<0&&U.J(t.top,">= 0",Panel,"padding:value.top"),t.bottom<0&&U.J(t.bottom,">= 0",Panel,"padding:value.bottom"));const e=this.Qt;e.equals(t)||(t=t.N(),this.Qt=t,this.f(),this.t("padding",e,t))}get defaultAlignment(){return this.Dd}set defaultAlignment(t){const e=this.Dd;e.equals(t)||(t=t.N(),this.Dd=t,this.f(),this.t("defaultAlignment",e,t))}get defaultStretch(){return this.Zn}set defaultStretch(t){const e=this.Zn;e!==t&&(this.Zn=t,this.f(),this.t("defaultStretch",e,t))}get defaultSeparatorPadding(){return this.O!==null?this.O.C0:Margin.im}set defaultSeparatorPadding(t){typeof t=="number"&&(t=new Margin(t));const e=this.defaultSeparatorPadding;e.equals(t)||(t=t.N(),this.O===null&&(this.O=new TablePanelSettings),this.O.C0=t,this.f(),this.t("defaultSeparatorPadding",e,t))}get defaultRowSeparatorStroke(){return this.O!==null?this.O.L0:null}set defaultRowSeparatorStroke(t){const e=this.defaultRowSeparatorStroke;e!==t&&(t===null||typeof t=="string"||t instanceof Brush)&&(t instanceof Brush&&t.k(),this.O===null&&(this.O=new TablePanelSettings),this.O.L0=t,this.C(),this.t("defaultRowSeparatorStroke",e,t))}get defaultRowSeparatorStrokeWidth(){return this.O!==null?this.O.A0:1}set defaultRowSeparatorStrokeWidth(t){const e=this.defaultRowSeparatorStrokeWidth;e!==t&&isFinite(t)&&t>=0&&(this.O===null&&(this.O=new TablePanelSettings),this.O.A0=t,this.f(),this.t("defaultRowSeparatorStrokeWidth",e,t))}get defaultRowSeparatorDashArray(){return this.O!==null?this.O.T0:null}set defaultRowSeparatorDashArray(t){const e=this.defaultRowSeparatorDashArray;if(e!==t){if(t!==null&&!Array.isArray(t)&&U.si(t,"Array",Panel,"defaultRowSeparatorDashArray:value"),t!==null){const i=t.length;let s=0;for(let n=0;n<i;n++){const o=t[n];(typeof o!="number"||!(o>=0)||!isFinite(o))&&U.o("defaultRowSeparatorDashArray value "+o+" at index "+n+" must be a positive number or zero."),s+=o}if(s===0){if(e===null)return;t=null}}this.O===null&&(this.O=new TablePanelSettings),this.O.T0=t,this.C(),this.t("defaultRowSeparatorDashArray",e,t)}}get defaultColumnSeparatorStroke(){return this.O!==null?this.O.D0:null}set defaultColumnSeparatorStroke(t){const e=this.defaultColumnSeparatorStroke;e!==t&&(t===null||typeof t=="string"||t instanceof Brush)&&(t instanceof Brush&&t.k(),this.O===null&&(this.O=new TablePanelSettings),this.O.D0=t,this.C(),this.t("defaultColumnSeparatorStroke",e,t))}get defaultColumnSeparatorStrokeWidth(){return this.O!==null?this.O.v0:1}set defaultColumnSeparatorStrokeWidth(t){const e=this.defaultColumnSeparatorStrokeWidth;e!==t&&isFinite(t)&&t>=0&&(this.O===null&&(this.O=new TablePanelSettings),this.O.v0=t,this.f(),this.t("defaultColumnSeparatorStrokeWidth",e,t))}get defaultColumnSeparatorDashArray(){return this.O!==null?this.O.F0:null}set defaultColumnSeparatorDashArray(t){const e=this.defaultColumnSeparatorDashArray;if(e!==t){if(t!==null&&!Array.isArray(t)&&U.si(t,"Array",Panel,"defaultColumnSeparatorDashArray:value"),t!==null){const i=t.length;let s=0;for(let n=0;n<i;n++){const o=t[n];(typeof o!="number"||!(o>=0)||!isFinite(o))&&U.o("defaultColumnSeparatorDashArray value "+o+" at index "+n+" must be a positive number or zero."),s+=o}if(s===0){if(e===null)return;t=null}}this.O===null&&(this.O=new TablePanelSettings),this.O.F0=t,this.C(),this.t("defaultColumnSeparatorDashArray",e,t)}}get Aa(){return this.O!==null?this.O.Aa:null}set Aa(t){this.O===null&&(this.O=new TablePanelSettings),this.O.Aa=t}get viewboxStretch(){return this.vd}set viewboxStretch(t){const e=this.vd;e!==t&&(this.vd=t,this.f(),this.t("viewboxStretch",e,t))}get gridCellSize(){return this.Pe!==null?this.Pe.Rd:Size.EL}set gridCellSize(t){this.Pe===null&&(this.Pe=new GridPanelSettings);const e=this.Pe.Rd;if(!e.equals(t)){(!t.isReal()||t.width===0||t.height===0)&&U.o("Invalid Panel.gridCellSize: "+t),this.Pe.Rd=t.N();const i=this.diagram;i!==null&&this===i.grid&&i.ca(),this.C(),this.t("gridCellSize",e,t)}}get gridOrigin(){return this.Pe!==null?this.Pe.Od:Point.dn}set gridOrigin(t){this.Pe===null&&(this.Pe=new GridPanelSettings);const e=this.Pe.Od;if(!e.equals(t)){t.isReal()||U.o("Invalid Panel.gridOrigin: "+t),this.Pe.Od=t.N();const i=this.diagram;i!==null&&this===i.grid&&i.ca(),this.C(),this.t("gridOrigin",e,t)}}get graduatedMin(){return this.ot!==null?this.ot.R0:0}set graduatedMin(t){const e=this.graduatedMin;if(e!==t&&(this.ot===null&&(this.ot=new GradPanelSettings),this.ot.R0=t,this.f(),this.t("graduatedMin",e,t),this.gf())){const i=this.part;i!==null&&this.Eh(i,"graduatedRange")}}get graduatedMax(){return this.ot!==null?this.ot.O0:100}set graduatedMax(t){const e=this.graduatedMax;if(e!==t&&(this.ot===null&&(this.ot=new GradPanelSettings),this.ot.O0=t,this.f(),this.t("graduatedMax",e,t),this.gf())){const i=this.part;i!==null&&this.Eh(i,"graduatedRange")}}get graduatedRange(){return this.graduatedMax-this.graduatedMin}get graduatedTickUnit(){return this.ot!==null?this.ot.I0:10}set graduatedTickUnit(t){const e=this.graduatedTickUnit;e!==t&&t>0&&(this.ot===null&&(this.ot=new GradPanelSettings),this.ot.I0=t,this.f(),this.t("graduatedTickUnit",e,t))}get graduatedTickBase(){return this.ot!==null?this.ot.E0:0}set graduatedTickBase(t){const e=this.graduatedTickBase;e!==t&&(this.ot===null&&(this.ot=new GradPanelSettings),this.ot.E0=t,this.f(),this.t("graduatedTickBase",e,t))}get vs(){return this.ot!==null?this.ot.vs:null}set vs(t){this.ot!==null?this.ot.vs=t:t!==null&&(this.ot=new GradPanelSettings,this.ot.vs=t)}get _i(){return this.ot!==null?this.ot._i:null}set _i(t){this.ot!==null?this.ot._i=t:t!==null&&(this.ot=new GradPanelSettings,this.ot._i=t)}get ds(){return this.ot!==null?this.ot.ds:null}set ds(t){this.ot!==null?this.ot.ds=t:t!==null&&(this.ot=new GradPanelSettings,this.ot.ds=t)}get vi(){return this.ot!==null?this.ot.vi:null}set vi(t){this.ot!==null?this.ot.vi=t:t!==null&&(this.ot=new GradPanelSettings,this.ot.vi=t)}Wp(t){super.Wp(t);const e=this.D.r,i=e.length;for(let s=0;s<i;s++)e[s].Wp(t)}Ma(t,e){if(this.W===Panel.Grid){t.commitTransform(),this.W.Ge(this,t,e);return}if(this.W===Panel.Graduated){t.commitTransform(),this.W.Ge(this,t,e);return}if(this.W===Panel.Table)if(t.commitTransform(),t instanceof SVGContext){const r=t.currentElement;t.currentElement=t.newGroup2("gojs-ts"),this.JN(t,e),t.endGroup(),t.currentElement=r}else this.JN(t,e);const i=this.isClipping&&this.W===Panel.Spot;i&&t.save();const s=this.findMainElement(),n=this.D.r,o=n.length;for(let r=0;r<o;r++){const l=n[r];i&&l===s&&(t.clipInsteadOfFill=!0),l.Ge(t,e),i&&l===s&&(t.clipInsteadOfFill=!1)}i&&(t.restore(),t.clearContextCache(!0))}JN(t,e){t.lineCap="butt";const i=this.rowCount>0?this.Zi:null,s=this.columnCount>0?this.Qi:null;i!==null&&this.$1(t,e,!0,i,!0),s!==null&&this.$1(t,e,!1,s,!0),i!==null&&this.gD(t,!0,i),s!==null&&this.gD(t,!1,s),i!==null&&this.$1(t,e,!0,i,!1),s!==null&&this.$1(t,e,!1,s,!1)}gD(t,e,i){const s=i.length,n=this.actualBounds,o=this.naturalBounds;let r=!0;for(let l=0;l<s;l++){const a=i[l];if(a===void 0||a.actual===0)continue;if(r){r=!1;continue}if(e){if(a.position>o.height)continue}else if(a.position>o.width)continue;let h=a.separatorStrokeWidth;isNaN(h)&&(h=e?this.defaultRowSeparatorStrokeWidth:this.defaultColumnSeparatorStrokeWidth);let c=a.separatorStroke;if(c===null&&(c=e?this.defaultRowSeparatorStroke:this.defaultColumnSeparatorStroke),h===0||c===null)continue;this.bn(t,c,!1,!1,o,n);let f=!1,u=a.separatorDashArray;u===null&&(u=e?this.defaultRowSeparatorDashArray:this.defaultColumnSeparatorDashArray),u!==null&&(f=!0,t.enableDash(u,0)),t.beginPath();const d=a.position+h;e?d>o.height&&(h-=d-o.height):d>o.width&&(h-=d-o.width);let m=a.position+h/2;t.lineWidth=h;const g=this.Qt;if(e){m+=g.top;const p=g.left,y=o.width-g.right;t.moveTo(p,m),t.lineTo(y,m)}else{m+=g.left;const p=g.top,y=o.height-g.bottom;t.moveTo(m,p),t.lineTo(m,y)}t.stroke(),t.endPath(),f&&t.disableDash()}}$1(t,e,i,s,n){const o=s.length,r=this.actualBounds,l=this.naturalBounds,a=this.mD(!0),h=this.mD(!1);for(let c=0;c<o;c++){const f=s[c];if(f===void 0||f.background===null||f.coversSeparators===n||f.actual===0)continue;const u=i?r.height:r.width;if(f.position>u)continue;let d=f.computeEffectiveSpacing(),m=f.separatorStrokeWidth;isNaN(m)&&(m=i?this.defaultRowSeparatorStrokeWidth:this.defaultColumnSeparatorStrokeWidth);let g=f.separatorStroke;g===null&&(g=i?this.defaultRowSeparatorStroke:this.defaultColumnSeparatorStroke),(g===null||f.index===(i?a:h))&&(m=0),d-=m;const p=f.position+m;let y=d+f.actual;if(p+y>u&&(y=u-p),y<=0)continue;const x=this.Qt;this.bn(t,f.background,!0,!1,l,r),i?t.fillRect(x.left,p+x.top,r.width-(x.left+x.right),y):t.fillRect(p+x.left,x.top,y,r.height-(x.top+x.bottom))}}mD(t){const e=t?this.rowCount:this.columnCount;for(let i=0;i<e;i++){const s=t?this.Zi[i]:this.Qi[i];if(s!==void 0)return s.index}return 0}wf(){const t=this.D.r,e=t.length;for(let i=0;i<e;i++)t[i].wf();this.Ji(!0)}yf(t,e,i){const s=this.svg;if(s===null)return!1;if(this.type===Panel.Table){const r=s.getElementsByClassName("gojs-ts"),l=r.length!==0?r[0]:null;l!==null&&(l.innerHTML=""),t.currentElement=l,this.JN(t,e),t.currentElement=null}else{if(this.W===Panel.Grid)return s.innerHTML="",s.remove(),!1;if(this.W===Panel.Graduated)return s.innerHTML="",s.remove(),!1;if(this.W===Panel.Spot&&this.isClipping)return s.innerHTML="",s.remove(),this.xa=null,this.wf(),!1}if(!super.yf(t,e,i))return!1;const n=this.D.r,o=n.length;for(let r=0;r<o;r++)n[r].Ge(t,e);return!0}Pd(t){return!0}$p(t,e,i,s){if(!this.isClipping){if(this.Qs()&&t.partClipRect!==null){const n=t.partClipRect,o=this.D.r;let r=0,l=0;for(let a=0;a<o.length;a++){if(!o[a].isVisibleObject())continue;const h=o[a].actualBounds;r=a===0?h.x:Math.min(h.x,r),l=a===0?h.y:Math.min(h.y,l)}s.setAttributeNS(null,"clip-path",`path('M ${n.x-i.x-r},${n.y-i.y-l} l ${n.width} 0 l 0 ${n.height} l -${n.width} 0 z')`);return}super.$p(t,e,i,s)}}mf(t,e,i,s,n){const o=this.Mn(),r=this.v,l=1/(r.m11*r.m22-r.m12*r.m21);let a=r.m22*l,h=-r.m12*l,c=-r.m21*l,f=r.m11*l,u=l*(r.m21*r.dy-r.m22*r.dx),d=l*(r.m12*r.dx-r.m11*r.dy);if(this.background!==null){const m=t*a+e*c+u,g=t*h+e*f+d,p=i*a+s*c+u,y=i*h+s*f+d;n.e(0,0);const x=this.naturalBounds,b=G.Cl(0,0,x.width,x.height,m,g,p,y,n);return n.v(r),b}else{o||(a=1,h=0,c=0,f=1,u=0,d=0);const m=t*a+e*c+u,g=t*h+e*f+d,p=i*a+s*c+u,y=i*h+s*f+d;n.e(p,y);let x=(p-m)**2+(y-g)**2,b=!1;const k=this.D.r,P=k.length,S=Point.l();let L=null,C=1/0,M=null;const N=this.isClipping&&this.W===Panel.Spot;N&&(M=Point.l(),L=this.findMainElement(),b=L.mf(m,g,p,y,M),b&&(C=(m-M.x)**2+(g-M.y)**2));for(let A=0;A<P;A++){const T=k[A];if(!T.visible||T===L||!T.mf(m,g,p,y,S))continue;b=!0;const D=(m-S.x)**2+(g-S.y)**2;D<x&&(x=D,n.set(S))}return N&&(C>x&&n.set(M),Point.i(M)),Point.i(S),o&&n.v(r),b}}jc(){const t=this.D.r,e=t.length;for(let i=0;i<e;i++)t[i].jc();super.jc()}f(t){if(this.Xo())return;super.f(t);let e=null;(this.W===Panel.Auto||this.W===Panel.Link)&&(e=this.findMainElement());const i=this.D.r,s=i.length;for(let n=0;n<s;n++){const o=i[n];if((o===e||o.isPanelMain)&&o.f(!0),o.desiredSize.isReal()||!o.visible)continue;const r=o.Zs(!1);!(o instanceof Placeholder)&&!(o instanceof Panel)&&!(o instanceof TextBlock)&&r===0||o.f(!0)}}bf(){if(this.Xo())return;this.xi(!0),this.lo(!0);const t=this.D.r,e=t.length;for(let i=0;i<e;i++)t[i].bf()}pf(){if(this.B1()===!1){this.Sd(!0),this.Na(!0);const t=this.D.r,e=t.length;for(let i=0;i<e;i++)t[i].TN()}}TN(){this.Na(!0);const t=this.D.r,e=t.length;for(let i=0;i<e;i++)t[i].TN()}bd(t,e,i,s){const n=this.$o;n.e(0,0,0,0);const o=this.desiredSize,r=this.minSize;i===void 0&&(i=r.width,s=r.height),i=Math.max(i,r.width),s=Math.max(s,r.height);const l=this.maxSize;isNaN(o.width)||(t=Math.min(o.width,l.width)),isNaN(o.height)||(e=Math.min(o.height,l.height)),t=Math.max(i,t),e=Math.max(s,e);const a=this.Qt;t=Math.max(t-a.left-a.right,0),e=Math.max(e-a.top-a.bottom,0);const h=this.D.r;this.W.measure(this,t,e,h,n,i,s);let c=n.width+a.left+a.right,f=n.height+a.top+a.bottom;isFinite(o.width)&&(c=o.width),isFinite(o.height)&&(f=o.height),c=Math.min(l.width,c),f=Math.min(l.height,f),c=Math.max(r.width,c),f=Math.max(r.height,f),c=Math.max(i,c),f=Math.max(s,f),n.Hn(c,f),this.naturalBounds.Hn(c,f),this.ro(0,0,c,f)}findMainElement(){if(this.rl===null){const t=this.D.r,e=t.length;if(e===0)return null;for(let i=0;i<e;i++){const s=t[i];if(s.isPanelMain===!0)return this.rl=s,s}this.rl=t[0]}return this.rl}Jo(){return this.part!==null?this.part.locationObject:null}get panelLayoutState(){return this.WN}set panelLayoutState(t){this.WN=t}Pa(t,e,i,s){const n=this.D.r;if(this.actualBounds.e(t,e,i,s),!this.desiredSize.isReal()){let o=this.Zs(!0);const r=this.measuredBounds,l=r.width,a=r.height,h=this.il,c=h.left+h.right,f=h.top+h.bottom;switch(l===i&&a===s&&(o=0),o){case 0:(l>i||a>s)&&(this.f(),this.ht(l>i?i:l,a>s?s:a,0,0));break;case 2:this.f(!0),this.ht(i+c,s+f,0,0);break;case 5:this.f(!0),this.ht(i+c,a+f,0,0);break;case 4:this.f(!0),this.ht(l+c,s+f,0,0);break}}this.W.arrange(this,n,this.$o)}ka(t){const e=this.naturalBounds,i=this.Jo();if(Rect.contains(0,0,e.width,e.height,t.x,t.y)){const s=this.D.r,n=s.length,o=Point.z(0,0);for(let r=n;r--;){const l=s[r];if(!(!l.visible&&l!==i)&&(o.set(t).Yi(l.v),l.containsPoint(o)))return Point.i(o),!0}return Point.i(o),this.Lt!==null}return!1}Yp(t){if(this.no===t)return this;const e=this.D.r,i=e.length;for(let s=0;s<i;s++){const o=e[s].Yp(t);if(o!==null)return o}return null}walkVisualTreeFrom(t,e){if(e(this,t),t instanceof Panel){const i=t.D.r,s=i.length;for(let n=0;n<s;n++)this.walkVisualTreeFrom(i[n],e)}}Pn(t){this.pD(this,t)}pD(t,e){e(t);const i=t.D.r,s=i.length;for(let n=0;n<s;n++){const o=i[n];o instanceof Panel&&this.pD(o,e)}}qI(t){this.yD(this,t)}yD(t,e){if(e(t),t instanceof Panel){const i=t.D.r,s=i.length;for(let n=0;n<s;n++)this.yD(i[n],e)}}findInVisualTree(t){return this.wD(this,t)}wD(t,e){if(e(t))return t;if(t instanceof Panel){const i=t.D.r,s=i.length;for(let n=0;n<s;n++){const o=this.wD(i[n],e);if(o!==null)return o}}return null}findObject(t){if(this.name===t)return this;const e=this.D.r;let i=e.length;this.Ta!==null&&(i=this.U0());for(let s=0;s<i;s++){const n=e[s];if(n instanceof Panel){const o=n.findObject(t);if(o!==null)return o}if(n.name===t)return n}return null}xD(){const t=this.D.r,e=t.length;let i=0;for(let s=0;s<e;s++){const n=t[s];n instanceof Panel?i=Math.max(i,n.xD()):n instanceof Shape&&(i=Math.max(i,n.jI()))}return i}Mn(){return!(this.type===Panel.TableRow||this.type===Panel.TableColumn)}nl(){return this.type===Panel.TableRow||this.type===Panel.TableColumn}XA(t,e,i){if(this.pickable===!1||(e===void 0&&(e=null),i===void 0&&(i=null),this.as()))return null;const s=this.naturalBounds,n=1/this.getDocumentScale(),o=this.Mn(),r=o?t:Point.z(t.x,t.y).Yi(this.v),l=this.diagram;let a=10,h=5;if(l!==null&&(a=l.getInputOption("extraTouchArea"),h=a/2),Rect.contains(-(h*n),-(h*n),s.width+a*n,s.height+a*n,r.x,r.y)){if(!this.Af){const f=this.D.r,u=f.length,d=Point.l(),m=this.isClipping&&this.W===Panel.Spot,g=m?this.findMainElement():null;if(m&&g&&(g.Mn()?d.set(t).Yi(g.v):d.set(t),!g.containsPoint(d)))return Point.i(d),o||Point.i(r),null;const p=this.Jo();for(let y=u;y--;){const x=f[y];if(!x.visible&&x!==p||(x.Mn()?d.set(t).Yi(x.v):d.set(t),m&&x===g))continue;let b=null;if(x instanceof Panel?b=x.XA(d,e,i):x.pickable===!0&&x.containsPoint(d)&&(b=x),b!==null&&(e!==null&&(b=e(b)),b!==null&&(i===null||i(b))))return Point.i(d),o||Point.i(r),b}Point.i(d)}if(this.background===null)return o||Point.i(r),null;const c=Rect.contains(0,0,s.width,s.height,r.x,r.y)?this:null;return o||Point.i(r),c}return o||Point.i(r),null}GA(t,e,i,s){if(this.pickable===!1)return!1;e===void 0&&(e=null),i===void 0&&(i=null);const n=this.naturalBounds,o=this.Mn(),r=o?t:Point.z(t.x,t.y).Yi(this.v),l=this.nl(),a=Rect.contains(0,0,n.width,n.height,r.x,r.y);if(l||a){if(!this.Af){const h=this.D.r,c=h.length,f=Point.l(),u=this.Jo();for(let d=c;d--;){const m=h[d];if(!m.visible&&m!==u)continue;m.Mn()?f.set(t).Yi(m.v):f.set(t);let g=m;const p=m instanceof Panel?m:null;if(p!==null?p.GA(f,e,i,s):g.containsPoint(f)){if(g.pickable===!1)continue;e!==null&&(g=e(g)),g!==null&&(i===null||i(g))&&s.add(g)}}Point.i(f)}return o||Point.i(r),a&&this.background!==null}return o||Point.i(r),!1}Zm(t,e,i,s,n,o){if(this.pickable===!1)return!1;e===void 0&&(e=null),i===void 0&&(i=null);let r=o;if(r===void 0&&(r=Transform.l(),r.Ue()),r.bc(this.v),this.containedInRect(t,r))return this.$N(e,i,n),o===void 0&&Transform.i(r),!0;if(this.intersectsRect(t,r)){if(!this.Af){const l=this.Jo(),a=this.D.r,h=a.length;for(let c=h;c--;){const f=a[c];if(!f.visible&&f!==l)continue;const u=f.actualBounds,d=this.naturalBounds;if(u.x>d.width||u.y>d.height||u.x+u.width<0||u.y+u.height<0)continue;let m=f;const g=f instanceof Panel?f:null,p=Transform.l();p.set(r),(g!==null?g.Zm(t,e,i,s,n,p):m.ZT(t,s,p))&&(e!==null&&(m=e(m)),m!==null&&(i===null||i(m))&&n.add(m)),Transform.i(p)}}return o===void 0&&Transform.i(r),s}return o===void 0&&Transform.i(r),!1}$N(t,e,i){const s=this.D.r,n=s.length;for(let o=n;o--;){const r=s[o];if(!r.visible)continue;const l=r.actualBounds,a=this.naturalBounds;if(l.x>a.width||l.y>a.height||l.x+l.width<0||l.y+l.height<0)continue;r instanceof Panel&&r.$N(t,e,i);let h=r;t!==null&&(h=t(h)),h!==null&&(e===null||e(h))&&i.add(h)}}YA(t,e,i,s,n,o){if(this.pickable===!1)return!1;i===void 0&&(i=null),s===void 0&&(s=null);const r=this.naturalBounds,l=this.Mn(),a=l?t:Point.z(t.x,t.y).Yi(this.v),h=l?e:Point.z(e.x,e.y).Yi(this.v),c=a.distanceSquaredPoint(h),f=a.x>0&&a.x<r.width&&a.y>0&&a.y<r.height||Point.distanceLineSegmentSquared(a.x,a.y,0,0,0,r.height)<=c||Point.distanceLineSegmentSquared(a.x,a.y,0,r.height,r.width,r.height)<=c||Point.distanceLineSegmentSquared(a.x,a.y,r.width,r.height,r.width,0)<=c||Point.distanceLineSegmentSquared(a.x,a.y,r.width,0,0,0)<=c,u=a.distanceSquared(0,0)<=c&&a.distanceSquared(0,r.height)<=c&&a.distanceSquared(r.width,0)<=c&&a.distanceSquared(r.width,r.height)<=c;if(l||(Point.i(a),Point.i(h)),f){if(!this.Af){const d=Point.l(),m=Point.l(),g=this.Jo(),p=this.D.r,y=p.length;for(let x=y;x--;){const b=p[x];if(!b.visible&&b!==g)continue;const k=b.actualBounds,P=this.naturalBounds;if(l&&(k.x>P.width||k.y>P.height||k.x+k.width<0||k.y+k.height<0))continue;if(b.Mn()){const C=b.v;d.set(t).Yi(C),m.set(e).Yi(C)}else d.set(t),m.set(e);let S=b;const L=b instanceof Panel?b:null;(L!==null?L.YA(d,m,i,s,n,o):S.QT(d,m,n))&&(i!==null&&(S=i(S)),S!==null&&(s===null||s(S))&&o.add(S))}Point.i(d),Point.i(m)}return n?f:u}return!1}YN(t){let e=null;if(t instanceof Shape){e=t.spot1,e===Spot.Default&&(e=null);const i=t.geometry;i!==null&&e===null&&(e=i.spot1)}return e===null&&(e=Spot.TopLeft),e}KN(t){let e=null;if(t instanceof Shape){e=t.spot2,e===Spot.Default&&(e=null);const i=t.geometry;i!==null&&e===null&&(e=i.spot2)}return e===null&&(e=Spot.BottomRight),e}add(...t){for(let e=0;e<t.length;e++)this.insertAt(this.D.count,t[e]);return this}elt(t){return this.D.elt(t)}insertAt(t,e){e instanceof Part&&U.o("Cannot add a Part to a Panel: "+e+"; use a Panel instead"),(this===e||this.isContainedBy(e))&&(this===e&&U.o("Cannot make a Panel contain itself: "+this.toString()),U.o("Cannot make a Panel indirectly contain itself: "+this.toString()+" already contains "+e.toString()));const i=e.panel;if(i!==null&&i!==this&&U.o("Cannot add a GraphObject that already belongs to another Panel to this Panel: "+e.toString()+", already contained by "+i.toString()+", cannot be shared by this Panel: "+this.toString()),this.W===Panel.Grid&&!(e instanceof Shape)&&U.o("Can only add Shapes to a Grid Panel, not: "+e),this.W===Panel.Graduated&&!(e instanceof Shape||e instanceof TextBlock)&&U.o("Can only add Shapes or TextBlocks to a Graduated Panel, not: "+e),e.Uh(this),e.sl=null,this.itemArray!==null){const r=e.data;U.$(r)&&(this._s===null&&(this._s=new GMap),this._s.set(r,e))}const s=this.D;let n=-1;if(i===this){let r=-1;const l=this.D.r,a=l.length;for(let h=0;h<a;h++)if(l[h]===e){r=h;break}if(r!==-1){if(r===t||r+1>=s.count&&t>=s.count)return;s.removeAt(r),n=r}else U.o("element "+e.toString()+" has panel "+i.toString()+" but is not contained by it.")}(t<0||t>s.count)&&(t=s.count),s.insertAt(t,e),(t===0||e.isPanelMain)&&(this.rl=null),this.Xo()||this.f(),e.f(!1),e.portId!==null?this.Cn=!0:e instanceof Panel&&e.Cn===!0&&(this.Cn=!0),this.ds=null,this.isEnabledObject()||this.Z1(e,!1);const o=this.part;if(o!==null){o.s0(),o.Tf(),this.Cn&&o instanceof Node&&(o.Cn=!0),o.Cn&&o instanceof Node&&(o.ci=null);const r=this.diagram;if(r!==null&&r.undoManager.isUndoingRedoing)return;n!==-1&&o.raiseChangedEvent(4,"elements",this,e,null,n,null),o.raiseChangedEvent(3,"elements",this,null,e,null,t)}}get Cn(){return(this.n&8388608)!==0}set Cn(t){(this.n&8388608)!==0!==t&&(this.n=this.n^8388608)}NN(){return(this.n&16777216)!==0}ZN(t){t?this.n|=16777216:this.n&=-16777217}HI(t){t.Uh(this),t.sl=null;const e=this.D,i=e.count;e.insertAt(i,t);const s=this.part;if(s!==null){s.s0(),t.portId!==null&&s instanceof Node&&(s.Cn=!0);const n=this.diagram;if(n!==null&&n.undoManager.isUndoingRedoing)return;s.raiseChangedEvent(3,"elements",this,null,t,null,i)}}fI(t){const e=this.D.r,i=e.length;let s=-1;for(let n=0;n<i;n++)if(e[n]===t){s=n;break}return s}remove(t){const e=this.D.r,i=e.length;let s=-1;for(let n=0;n<i;n++)if(e[n]===t){s=n;break}s!==-1&&this.ri(s,!0)}removeAt(t){t>=0&&this.ri(t,!0)}ri(t,e){const i=this.D,s=i.elt(t);if(s.sl=null,s.Uh(null),this._s!==null){const o=s.data;U.$(o)&&this._s.delete(o)}i.removeAt(t),this.xi(!1),this.f(),this.rl===s&&(this.rl=null),this.ds=null;const n=this.part;if(n!==null){n.s0(),n.Tf(),n.invalidateAdornments(),n instanceof Node&&(s instanceof Panel?s.walkVisualTreeFrom(s,(r,l)=>n.RN(l,e)):n.RN(s,e));const o=this.diagram;if(o!==null&&o.undoManager.isUndoingRedoing)return;n.raiseChangedEvent(4,"elements",this,s,null,t,null)}}get Zi(){return this.O===null&&(this.O=new TablePanelSettings),this.O.Zi}get rowCount(){return this.O===null?0:this.Zi.length}getRowDefinition(t){t<0&&U.J(t,">= 0",Panel,"getRowDefinition:idx"),t=Math.round(t);const e=this.Zi;if(e[t]===void 0){const i=new RowColumnDefinition;i.Uh(this),i.isRow=!0,i.index=t,e[t]=i,this.raiseChangedEvent(3,"rowdefs",this,null,i,null,t)}return e[t]}removeRowDefinition(t){if(t<0&&U.J(t,">= 0",Panel,"removeRowDefinition:idx"),this.rowCount===0)return;t=Math.round(t);const e=this.Zi,i=e[t];if(i){e[t]=void 0;let s=e.length-1;for(;s>=0&&e[s--]===void 0;)e.length--;this.raiseChangedEvent(4,"rowdefs",this,i,null,t,null),this.f()}}kT(t,e){const i=this.Zi;if(!(t<0)){if(i[t]=e instanceof RowColumnDefinition?e:void 0,!e){let s=i.length-1;for(;s>=0&&i[s--]===void 0;)i.length--}this.f()}}get Qi(){return this.O===null&&(this.O=new TablePanelSettings),this.O.Qi}get columnCount(){return this.O===null?0:this.Qi.length}getColumnDefinition(t){t<0&&U.J(t,">= 0",Panel,"getColumnDefinition:idx"),t=Math.round(t);const e=this.Qi;if(e[t]===void 0){const i=new RowColumnDefinition;i.Uh(this),i.isRow=!1,i.index=t,e[t]=i,this.raiseChangedEvent(3,"coldefs",this,null,i,null,t)}return e[t]}removeColumnDefinition(t){if(t<0&&U.J(t,">= 0",Panel,"removeColumnDefinition:idx"),this.columnCount===0)return;t=Math.round(t);const e=this.Qi,i=e[t];if(i){e[t]=void 0;let s=e.length-1;for(;s>=0&&e[s--]===void 0;)e.length--;this.raiseChangedEvent(4,"coldefs",this,i,null,t,null),this.f()}}PT(t,e){const i=this.Qi;if(!(t<0)){if(i[t]=e instanceof RowColumnDefinition?e:void 0,!e){let s=i.length-1;for(;s>=0&&i[s--]===void 0;)i.length--}this.f()}}addRowColumnDefinition(t){let e=null;return t.isRow?e=this.getRowDefinition(t.index):t.isRow||(e=this.getColumnDefinition(t.index)),e&&e.X1(t),this}addRowDefinition(t,e){const i=this.getRowDefinition(t);return i&&i.X1(new RowColumnDefinition(e)),this}addColumnDefinition(t,e){const i=this.getColumnDefinition(t);return i&&i.X1(new RowColumnDefinition(e)),this}get rowSizing(){return this.O!==null?this.O.V0:3}set rowSizing(t){const e=this.rowSizing;e!==t&&(this.O===null&&(this.O=new TablePanelSettings),this.O.V0=t,this.f(),this.t("rowSizing",e,t))}get columnSizing(){return this.O!==null?this.O.B0:3}set columnSizing(t){const e=this.columnSizing;e!==t&&(this.O===null&&(this.O=new TablePanelSettings),this.O.B0=t,this.f(),this.t("columnSizing",e,t))}get topIndex(){return this.O!==null?this.O.z0:0}set topIndex(t){const e=this.topIndex;e!==t&&((!isFinite(t)||t<0)&&U.o("Panel.topIndex must be greater than zero and a real number, not: "+t),this.O===null&&(this.O=new TablePanelSettings),this.O.z0=t,this.f(),this.t("topIndex",e,t))}get leftIndex(){return this.O!==null?this.O.X0:0}set leftIndex(t){const e=this.leftIndex;e!==t&&((!isFinite(t)||t<0)&&U.o("Panel.leftIndex must be greater than zero and a real number, not: "+t),this.O===null&&(this.O=new TablePanelSettings),this.O.X0=t,this.f(),this.t("leftIndex",e,t))}findRowForLocalY(t){if(t<0||this.type!==Panel.Table||this.rowCount===0)return-1;let e=0;const i=this.Zi,s=i.length;let n=this.topIndex;for(;n<s;n++){const o=i[n];if(o!==void 0&&(e+=o.total,t<e))return n}return n}findColumnForLocalX(t){if(t<0||this.type!==Panel.Table||this.columnCount===0)return-1;let e=0;const i=this.Qi,s=i.length;let n=this.leftIndex;for(;n<s;n++){const o=i[n];if(o!==void 0&&(e+=o.total,t<e))return n}return n}graduatedPointForValue(t,e){if(e===void 0&&(e=new Point(NaN,NaN)),this.type!==Panel.Graduated)return e.e(NaN,NaN),e;t=Math.min(Math.max(t,this.graduatedMin),this.graduatedMax);const i=this.findMainElement();return i.geometry.getPointAlongPath((t-this.graduatedMin)/this.graduatedRange,e),i.v.gt(e)}graduatedValueForPoint(t){if(this.type!==Panel.Graduated)return NaN;const e=this.findMainElement();return e.v.Ci(t),e.geometry.getFractionForPoint(t)*this.graduatedRange+this.graduatedMin}get data(){return this.te}set data(t){const e=this.te;if(e!==t){const i=this instanceof Part&&!(this instanceof Adornment);i&&U.s(t,"object",Panel,"data"),this.It(),this.te=t;const s=this.diagram;if(s!==null)if(i){s.partManager.WI(this,e,t);let n=this.adornments;for(;n.next();){const o=n.value,r=o.adornedObject;if(r!==null){const l=r.findBindingPanel();l!==null&&(o.data=l.data)}}}else{const n=this.panel;n!==null&&n._s!==null&&(e!==null&&n._s.delete(e),t!==null&&n._s.set(t,this))}if(this.t("data",e,t),s!==null&&s.undoManager.isUndoingRedoing)return;t!==null&&this.updateTargetBindings()}}get itemIndex(){return this.Fd}set itemIndex(t){const e=this.Fd;e!==t&&(this.Fd=t,this.t("itemIndex",e,t))}get Ds(){return this.w!==null?this.w.Ds:null}set Ds(t){this.ve!==t&&(this.w===null&&(this.w=new GraphObjectTemplateSettings),this.w.Ds=t)}ON(){return this.Ds!==null}rD(){const t=this.Ds;return t!==null&&t.u}freezeBindings(){return this.It()}It(){let t=this.Ds;if(t===null)this.data!==null&&U.o("Template cannot have .data be non-null: "+this),this.Ds=t=new List;else if(t.u)return this;const e=new List;this.ZN(!1),this.walkVisualTreeFrom(this,(n,o)=>{o.ba();const r=o.ve;if(r!==null){o.DN(!1);const l=r.iterator;for(;l.next();){const a=l.value;a.mode===2&&o.DN(!0);const h=a.sourceName;if(a.isToObject){h==="/"&&n.ZN(!0);const c=a.$T(n,o);c!==null&&(e.add(c),c.oo===null&&(c.oo=new List),c.oo.add(a))}t.add(a)}}if(o instanceof Panel&&o.type===Panel.Table){if(o.rowCount>0){const l=o.Zi,a=l.length;for(let h=0;h<a;h++){const c=l[h];if(c!==void 0&&c.Fs!==null){const f=c.Fs.iterator;for(;f.next();){const u=f.value;u.Ti=c,u.Id=2,u.Df=c.index,t.add(u)}}}}if(o.columnCount>0){const l=o.Qi,a=l.length;for(let h=0;h<a;h++){const c=l[h];if(c!==void 0&&c.Fs!==null){const f=c.Fs.iterator;for(;f.next();){const u=f.value;u.Ti=c,u.Id=1,u.Df=c.index,t.add(u)}}}}}});const i=e.iterator;for(;i.next();){const n=i.value;if(n.oo!==null){n.DN(!0);const o=n.oo.iterator;for(;o.next();){const r=o.value;n.ve===null&&(n.ve=new List),n.ve.add(r)}}n.oo=null}let s=t.iterator;for(;s.next();){const n=s.value;let o=n.Ti;if(o!==null){n.Ti=null;const r=n.targetProperty,l=r.indexOf(".");if(l>0&&o instanceof Panel){const a=r.substring(0,l),h=r.substring(l+1),c=o.findObject(a);c!==null?(o=c,n.targetProperty=h):(U.ne('Warning: unable to find GraphObject named "'+a+'" for Binding: '+n.toString()),o=null)}if(o instanceof RowColumnDefinition){const a=GSet.xs(o.panel);n.targetId=a===void 0?-1:a,o.panel.no=n.targetId}else if(o instanceof GraphObject){const a=GSet.xs(o);n.targetId=a===void 0?-1:a,o.no=n.targetId}else U.o("Unknown type of binding target: "+o);n.check(o)}}return t.k(),this instanceof Part&&this.Di()&&this.ensureBounds(),this}static BU=!1;copyTemplate(t){t===void 0&&(t=!1);const e=this.copy();return e.qI(i=>{i instanceof Panel&&(i.Ds=null,i.te=null);const s=i.ve;s!==null&&(i.ve=null,s.each(o=>i.bind(o.copy())));const n=i.Ts;n!==null&&(i.Ts=null,n.each(o=>i.trigger(o.value.copy())))}),t&&e.It(),e}updateTargetBindings(t){const e=this.Ds;if(e===null)return;t===void 0&&(t="");const i=this.diagram?.model,s=e.iterator;for(;s.next();){const n=s.value,o=this.QN(n,t);if(o===null)continue;const{data:r,elt:l}=o;n.isToTheme&&this.diagram===null||l!==void 0&&n.updateTarget(l,r,void 0,i)}}JI(t){if(t===""){this.updateTargetBindings(t);return}const e=this.Ds;if(e===null)return;const i=this.diagram?.model,s=e.iterator;for(;s.next();){const n=s.value;if(n.isToData&&n.sourceProperty!=="")continue;const o=this.QN(n,"");if(o===null)continue;const{data:r,elt:l}=o;l!==void 0&&n.updateTarget(l,r,void 0,i)}}Go(){if(this.diagram!==null)if(this.ON()){const t=this.diagram.model,e=this.Ds.iterator;for(;e.next();){const i=e.value;if(!i.isToTheme)continue;const s=this.QN(i);if(s===null)continue;const{data:n,elt:o}=s;o!==void 0&&i.updateTarget(o,n,void 0,t)}}else{const t=this.D.r,e=t.length;for(let i=0;i<e;i++)t[i].Go()}}QN(t,e=""){const i=t.sourceProperty;if(e!==""&&i!==""&&i!==e)return null;const s=t.targetProperty;if(t.converter===null&&s==="")return null;let o=this.data;const r=t.sourceName;if(t.isToObject){if(o=this.JT(r),o===null)return null}else if(t.isToModel){const c=this.diagram;if(c===null)return null;o=c.model.modelData}let l=this;const a=t.targetId;if(a!==-1){if(l=this.Yp(a),l===null)return null}else t.Ti!==null&&(l=t.Ti);r==="/"?o=l.part:r==="."?o=l:r===".."&&(o=l.panel);const h=t.Id;if(h!==0){if(!(l instanceof Panel))return null;h===1?l=l.getColumnDefinition(t.Df):h===2&&(l=l.getRowDefinition(t.Df))}return{data:o,elt:l}}get itemArray(){return this.Ta}set itemArray(t){const e=this.Ta;if(e!==t||t!==null&&this.$I(t)){const i=this.diagram;if(e!==t&&(i!==null&&e!==null&&i.partManager.L2(this,i),this.Ta=t,i!==null&&t!==null&&i.partManager.C2(this,i)),this.t("itemArray",e,t),i!==null&&i.undoManager.isUndoingRedoing)return;this.bD(e,t)}}findItemPanelForData(t){return t==null||this._s===null?null:(U.wc(t,Panel,"findItemPanelForData"),this._s.get(t))}$I(t){const e=this.D.r,i=e.length,s=t.length;let n=0,o=null;for(;n<i&&(o=e[n],!(o instanceof Panel)||o.data===null);)n++,o=e[n];if(i-n!==s)return!0;if(o===null)return s>0;let r=0;for(;n<i&&r<s;){if(o=e[n],!(o instanceof Panel)||o.data!==t[r])return!0;n++,r++}return!1}U0(){if(this.type===Panel.Spot||this.type===Panel.Auto)return Math.min(this.D.length,1);if(this.type===Panel.Link){const t=this.D,e=t.length;let i=0;for(;i<e;i++){const s=t.elt(i);if(!(s instanceof Shape)||!s.isPanelMain)return i}return i}if(this.type===Panel.Table&&this.D.length>0){const e=this.D.elt(0);if(e.isPanelMain&&e instanceof Panel&&e.nl())return 1}return 0}rebuildItemElements(){const t=this.U0();for(;this.D.length>t;)this.ri(this.D.length-1,!1);this.bD(null,this.itemArray)}bD(t,e){const i=this.U0(),s=e;if(s===null||s.length===0){for(;this.D.length>i;)this.ri(this.D.length-1,!1);return}if(this.D.length<=i){const n=s.length;for(let o=0;o<n;o++)this.Q1(s[o],o,!0)}else{let n=i;for(let r=0;r<s.length;r++,n++){const l=s[r],a=n<this.D.length?this.D.elt(n):null;if(a instanceof Panel){if(a.data!==l){const h=this._N(a.data,r),c=this._N(l,r);let f=c!==h;if(!f){const u=this.tC(a.data,r,h);f=this.tC(l,r,c)!==u}f?(this.ri(n,!1),this.Q1(l,r,!1)):a.data=l}}else this.Q1(l,r,!1)}for(;n<this.D.length;)this.ri(n,!1);this.rl=null,this.eC(i,0),this.Xo()||this.f(),this.ds=null,this.isEnabledObject()||this.Z1(this,!1);const o=this.part;o!==null&&(o.s0(),o.Tf(),this.Cn&&o instanceof Node&&(o.Cn=!0),o.Cn&&o instanceof Node&&(o.ci=null))}}Q1(t,e,i){if(t==null||e<0)return;const s=this._N(t,e),n=this.tC(t,e,s);if(n!==null){n.It();const o=n.copy();if(o.NN()){const l=this.findBindingPanel();l!==null&&l.ZN(!0)}U.$(t)&&(this._s===null&&(this._s=new GMap),this._s.set(t,o));const r=e+this.U0();this.insertAt(r,o),i&&(o.te=t,this.eC(r,e),o.te=null),o.data=t}}ZI(t){if(t<0)return;const e=t+this.U0();this.ri(e,!0),this.eC(e,t)}eC(t,e){const i=this.D;let s=t,n=e;for(;s<i.length;){const o=i.elt(s);o instanceof Panel&&o.QI(s,n),s++,n++}}QI(t,e){this.type===Panel.TableRow?this.row=t:this.type===Panel.TableColumn&&(this.column=t),this.itemIndex=e}get itemTemplate(){const t=this.itemTemplateMap;if(t!==null){const e=t.get("");if(e)return e}return Panel.kD()}set itemTemplate(t){const e=this.itemTemplate;if(e!==t){(t instanceof Part||t.isPanelMain)&&U.o("Panel.itemTemplate must not be a Part or be Panel.isPanelMain: "+t),this.itemTemplateMap===null&&(this.itemTemplateMap=new GMap),this.itemTemplateMap.set("",t),this.t("itemTemplate",e,t);const i=this.diagram;if(i!==null&&i.undoManager.isUndoingRedoing)return;this.rebuildItemElements()}}get itemTemplateMap(){return this.w!==null?this.w.x0:null}set itemTemplateMap(t){const e=this.itemTemplateMap;if(e!==t){const i=t.iterator;for(;i.next();){const n=i.value}this.Yt().x0=t,this.t("itemTemplateMap",e,t);const s=this.diagram;if(s!==null&&s.undoManager.isUndoingRedoing)return;this.rebuildItemElements()}}get itemCategoryProperty(){return this.w!==null?this.w.b0:"category"}set itemCategoryProperty(t){const e=this.itemCategoryProperty;e!==t&&(typeof t!="string"&&!U.st(t)&&U.si(t,"string or function",Panel,"itemCategoryProperty"),this.Yt().b0=t,this.t("itemCategoryProperty",e,t))}_N(t,e){if(t===null)return"";const i=this.itemCategoryProperty;let s="";if(U.st(i))s=i(t);else if(typeof i=="string"&&U.$(t)){if(i==="")return"";const n=this.diagram,o=n!==null?n.model:null;o?s=o.St(t,i):s=Model.St(t,i)}else return"";if(s===void 0)return"";if(typeof s=="string")return s;U.o("Panel.getCategoryForItemData found a non-string category for "+t+": "+s)}static PD=!1;static iC;static kD(){return Panel.iC||(Panel.iC=new Panel().add(new TextBlock().bind("text","",U.toString).theme("stroke","text"))),Panel.iC}tC(t,e,i){let s=null;const n=this.itemTemplateMap;return n!==null&&(s=n.get(i),s===null&&(s=n.get(""))),s===null&&(Panel.PD||(Panel.PD=!0,U.ne('No item template Panel found for category "'+i+'" on '+this),U.ne("  Using default item template.")),s=Panel.kD()),s}get Af(){return(this.n&1048576)!==0}set Af(t){const e=(this.n&1048576)!==0;e!==t&&(U.s(t,"boolean",Panel,"isAtomic"),this.n=this.n^1048576,this.t("isAtomic",e,t))}get isClipping(){return(this.n&2097152)!==0}set isClipping(t){const e=(this.n&2097152)!==0;e!==t&&(this.wf(),this.n=this.n^2097152,this instanceof Group&&(this.he=null),this.f(),this.t("isClipping",e,t))}get isOpposite(){return(this.n&33554432)!==0}set isOpposite(t){const e=(this.n&33554432)!==0;e!==t&&(this.n=this.n^33554432,this.f(),this.t("isOpposite",e,t))}get isEnabled(){return(this.n&4194304)!==0}set isEnabled(t){const e=(this.n&4194304)!==0;if(e!==t){const i=this.panel===null||this.panel.isEnabledObject();this.n=this.n^4194304,this.t("isEnabled",e,t);const s=this.diagram;if(s!==null&&s.undoManager.isUndoingRedoing)return;i&&this.Z1(this,t)}}Z1(t,e){const i=t.enabledChanged;if(i!==null&&i(t,e),t instanceof Panel){const s=t.D.r,n=s.length;for(let o=0;o<n;o++){const r=s[o];e&&r instanceof Panel&&!r.isEnabled||this.Z1(r,e)}}}get alignmentFocusName(){return this.fo}set alignmentFocusName(t){const e=this.fo;e!==t&&(this.fo=t,this.f(),this.t("alignmentFocusName",e,t))}static definePanelLayout(t,e){PanelLayout.An(t,e)}static isLayoutDefined(t){return PanelLayout.fs.has(t)}static Position=PanelLayout.fs.get("Position");static Horizontal=PanelLayout.fs.get("Horizontal");static Vertical=PanelLayout.fs.get("Vertical");static Spot=PanelLayout.fs.get("Spot");static Auto=PanelLayout.fs.get("Auto");static Table=PanelLayout.fs.get("Table");static Viewbox=PanelLayout.fs.get("Viewbox");static TableRow=PanelLayout.fs.get("TableRow");static TableColumn=PanelLayout.fs.get("TableColumn");static Link=PanelLayout.fs.get("Link");static Grid=PanelLayout.fs.get("Grid");static Graduated=PanelLayout.fs.get("Graduated")}Panel.definePanelLayout=Panel.definePanelLayout;class GradPanelSettings{R0;O0;I0;E0;vs;_i;ds;vi;constructor(){this.R0=0,this.O0=100,this.I0=10,this.E0=0,this.vs=null,this._i=null,this.ds=null,this.vi=null}copy(){const t=new GradPanelSettings;return t.R0=this.R0,t.O0=this.O0,t.I0=this.I0,t.E0=this.E0,t.vs=this.vs,t._i=this._i,t.ds=this.ds,t.vi=this.vi,t}}class GridPanelSettings{Rd;Od;lf;N0;constructor(){this.Rd=Size.EL,this.Od=Point.dn,this.lf=Size.Zw,this.N0=[]}copy(){const t=new GridPanelSettings;return t.Rd=this.Rd.copy(),t.Od=this.Od.copy(),t.lf=this.lf.copy(),t.N0=this.N0,t}}class TablePanelSettings{Zi;Qi;V0;B0;z0;X0;C0;A0;L0;T0;v0;D0;F0;Aa;constructor(){this.Zi=[],this.Qi=[],this.V0=3,this.B0=3,this.z0=0,this.X0=0,this.C0=Margin.im,this.A0=1,this.L0=null,this.T0=null,this.v0=1,this.D0=null,this.F0=null,this.Aa=null}copy(t){const e=new TablePanelSettings,i=this.Zi,s=i.length,n=e.Zi;for(let a=0;a<s;a++){const h=i[a];if(h===void 0)continue;const c=h.copy();c.Uh(t),n[a]=c}const o=this.Qi,r=o.length,l=e.Qi;for(let a=0;a<r;a++){const h=o[a];if(h===void 0)continue;const c=h.copy();c.Uh(t),l[a]=c}return e.V0=this.V0,e.B0=this.B0,e.z0=this.z0,e.X0=this.X0,e.C0=this.C0.N(),e.A0=this.A0,e.L0=this.L0,e.T0=this.T0,e.v0=this.v0,e.D0=this.D0,e.F0=this.F0,e.Aa=this.Aa,e}}var Sizing=(w=>(w[w.Default=1]="Default",w[w.None=2]="None",w[w.ProportionalExtra=3]="ProportionalExtra",w))(Sizing||{});class RowColumnDefinition{$s;G0;Tt;Xh;Gh;de;ct;Ed;ao;ll;Ud;Vd;Yh;Lt;Bd;Fs;q;Re;ki;constructor(t){GSet.Je(this),this.$s=null,this.G0=!0,this.Tt=0,this.ki=NaN,this.Xh=0,this.Gh=1/0,this.de=Spot.Default,this.q=0,this.Re=0,this.ct=0,this.Fs=null,this.Ed=1,this.ao=1,this.ll=null,this.Ud=null,this.Vd=NaN,this.Yh=null,this.Lt=null,this.Bd=!1,t&&(Object.assign(this,t),t.column!==void 0?(this.isRow=!1,this.index=t.column):t.row!==void 0&&(this.isRow=!0,this.index=t.row))}copy(){const t=new RowColumnDefinition;return t.G0=this.G0,t.Tt=this.Tt,t.ki=this.ki,t.Xh=this.Xh,t.Gh=this.Gh,t.de=this.de,t.q=this.q,t.Re=this.Re,t.ct=this.ct,t.ao=this.ao,t.Ed=this.Ed,this.ll===null?t.ll=null:t.ll=this.ll.N(),t.Ud=this.Ud,t.Vd=this.Vd,t.Yh=null,this.Yh!==null&&(t.separatorDashArray=this.Yh.slice()),t.Lt=this.Lt,t.Bd=this.Bd,t.Fs=this.Fs,t}X1(t){t.isRow?t.height!==void 0&&(this.height=t.height):t.width!==void 0&&(this.width=t.width),t.minimum!==void 0&&(this.minimum=t.minimum),t.maximum!==void 0&&(this.maximum=t.maximum),t.alignment!==void 0&&(this.alignment=t.alignment),t.stretch!==void 0&&(this.stretch=t.stretch),t.sizing!==void 0&&(this.sizing=t.sizing),t.separatorPadding!==void 0&&(this.separatorPadding=t.separatorPadding),t.separatorStroke!==void 0&&(this.separatorStroke=t.separatorStroke),t.separatorStrokeWidth!==void 0&&(this.separatorStrokeWidth=t.separatorStrokeWidth),t.separatorDashArray!==void 0&&(this.Yh=t.separatorDashArray),t.background!==void 0&&(this.background=t.background),t.coversSeparators!==void 0&&(this.coversSeparators=t.coversSeparators),t.Fs!==void 0&&(this.Fs=t.Fs)}fe(t){t in Sizing?this.sizing=t:U.ur(this,t)}toString(){return"RowColumnDefinition "+(this.isRow?"(Row ":"(Column ")+this.index+") #"+GSet.xs(this)}static Default=1;static None=2;static ProportionalExtra=3;Uh(t){this.$s=t}computeEffectiveSpacingTop(t){let e=0;const i=this.$s;if(this.index!==t){let n=this.separatorStroke;n===null&&i!==null&&(n=this.isRow?i.defaultRowSeparatorStroke:i.defaultColumnSeparatorStroke),n!==null&&(e=this.separatorStrokeWidth,isNaN(e)&&(i!==null?e=this.isRow?i.defaultRowSeparatorStrokeWidth:i.defaultColumnSeparatorStrokeWidth:e=0))}let s=this.ll;if(s===null)if(i!==null)s=i.defaultSeparatorPadding;else return e;return e+(this.isRow?s.top:s.left)}computeEffectiveSpacing(){let t=0;const e=this.$s;let i=0;const s=this.isRow;if(e!==null&&e.type===Panel.Table){const o=s?e.Zi.length:e.Qi.length;for(let r=0;r<o;r++){const l=s?e.Zi[r]:e.Qi[r];if(l!==void 0&&l.q!==0){i=l.index;break}}}if(this.index!==i){let o=this.separatorStroke;o===null&&e!==null&&(o=s?e.defaultRowSeparatorStroke:e.defaultColumnSeparatorStroke),o!==null&&(t=this.separatorStrokeWidth,isNaN(t)&&(e!==null?t=s?e.defaultRowSeparatorStrokeWidth:e.defaultColumnSeparatorStrokeWidth:t=0))}let n=this.ll;if(n===null)if(e!==null)n=e.defaultSeparatorPadding;else return t;return t+(this.isRow?n.top+n.bottom:n.left+n.right)}t(t,e,i,s,n){const o=this.$s;if(o!==null&&(o.raiseChangedEvent(2,t,this,e,i,s,n),this.Fs!==null)){const r=o.diagram;if(r!==null&&!r.wi){const l=o.findBindingPanel();if(l!==null){const a=l.data;if(a!==null){const h=this.Fs.iterator;for(;h.next();)h.value.updateSource(this,a,t,l)}}}}}get panel(){return this.$s}get isRow(){return this.G0}set isRow(t){this.G0=t}get index(){return this.Tt}set index(t){this.Tt=t}get height(){return this.ki}set height(t){const e=this.ki;e!==t&&(t<0&&U.J(t,">= 0",RowColumnDefinition,"height"),this.ki=t,this.actual=this.q,this.panel!==null&&this.panel.f(),this.t("height",e,t))}get width(){return this.ki}set width(t){const e=this.ki;e!==t&&(t<0&&U.J(t,">= 0",RowColumnDefinition,"width"),this.ki=t,this.actual=this.q,this.panel!==null&&this.panel.f(),this.t("width",e,t))}get minimum(){return this.Xh}set minimum(t){const e=this.Xh;e!==t&&((t<0||!isFinite(t))&&U.J(t,">= 0",RowColumnDefinition,"minimum"),this.Xh=t,this.actual=this.q,this.panel!==null&&this.panel.f(),this.t("minimum",e,t))}get maximum(){return this.Gh}set maximum(t){const e=this.Gh;e!==t&&(t<0&&U.J(t,">= 0",RowColumnDefinition,"maximum"),this.Gh=t,this.actual=this.q,this.panel!==null&&this.panel.f(),this.t("maximum",e,t))}get alignment(){return this.de}set alignment(t){const e=this.de;e.equals(t)||(this.de=t.N(),this.panel!==null&&this.panel.f(),this.t("alignment",e,t))}get stretch(){return this.ao}set stretch(t){const e=this.ao;e!==t&&(this.ao=t,this.panel!==null&&this.panel.f(),this.t("stretch",e,t))}get separatorPadding(){return this.ll}set separatorPadding(t){typeof t=="number"&&(t=new Margin(t));const e=this.ll;(t===null||e===null||!e.equals(t))&&(t!==null&&(t=t.N()),this.ll=t,this.panel!==null&&this.panel.f(),this.t("separatorPadding",e,t))}get separatorStroke(){return this.Ud}set separatorStroke(t){const e=this.Ud;e!==t&&(t!==null&&Brush.Md(t,"RowColumnDefinition.separatorStroke"),t instanceof Brush&&t.k(),this.Ud=t,this.panel!==null&&this.panel.f(),this.t("separatorStroke",e,t))}get separatorStrokeWidth(){return this.Vd}set separatorStrokeWidth(t){const e=this.Vd;e!==t&&(this.Vd=t,this.panel!==null&&this.panel.f(),this.t("separatorStrokeWidth",e,t))}get separatorDashArray(){return this.Yh}set separatorDashArray(t){const e=this.Yh;if(e!==t){if(t!==null&&!Array.isArray(t)&&U.si(t,"Array",RowColumnDefinition,"separatorDashArray:value"),t!==null){const i=t.length;let s=0;for(let n=0;n<i;n++){const o=t[n];(typeof o!="number"||!(o>=0)||!isFinite(o))&&U.o("separatorDashArray value "+o+" at index "+n+" must be a positive number or zero."),s+=o}if(s===0){if(e===null)return;t=null}}this.Yh=t,this.panel!==null&&this.panel.C(),this.t("separatorDashArray",e,t)}}get background(){return this.Lt}set background(t){const e=this.Lt;e!==t&&(t!==null&&Brush.Md(t,"RowColumnDefinition.background"),t instanceof Brush&&t.k(),this.Lt=t,this.panel!==null&&this.panel.C(),this.t("background",e,t))}get coversSeparators(){return this.Bd}set coversSeparators(t){const e=this.Bd;e!==t&&(U.s(t,"boolean",RowColumnDefinition,"coversSeparators"),this.Bd=t,this.panel!==null&&this.panel.C(),this.t("coversSeparators",e,t))}get sizing(){return this.Ed}set sizing(t){const e=this.Ed;e!==t&&(this.Ed=t,this.panel!==null&&this.panel.f(),this.t("sizing",e,t))}j1(){if(this.sizing===1){const t=this.$s;return t===null?2:this.isRow?t.rowSizing:t.columnSizing}return this.sizing}get actual(){return this.q}set actual(t){isNaN(this.ki)?this.q=Math.max(Math.min(this.Gh,t),this.Xh):this.q=Math.max(Math.min(this.Gh,this.ki),this.Xh)}get measured(){return this.Re}set measured(t){this.Re=t}get total(){return this.q+this.computeEffectiveSpacing()}get position(){return this.ct}set position(t){this.ct=t}bind(t,e,i,s){return this.Pf(t,e,i,s),this}bindTwoWay(t,e,i,s){const n=this.Pf(t,e,i,s);return s===void 0&&n.makeTwoWay(),this}theme(t,e,i,s,n){return this.Ca(t,e,i,s,n),this}themeData(t,e,i,s,n){return this.Ca(t,e,i,s,n).ofData(),this}themeObject(t,e,i,s,n,o){return this.Ca(t,e,i,s,n).ofObject(o),this}themeModel(t,e,i,s,n){return this.Ca(t,e,i,s,n).ofModel(),this}Pf(t,e,i,s){let n;return typeof t=="string"?n=new Binding(t,e,i,s):n=t,this.w0(n),n}Ca(t,e,i,s,n){let o;return typeof t=="string"?o=new ThemeBinding(t,e,i,s,n):o=t,this.w0(o),o}w0(t){t.Ti=this;const e=this.panel;if(e!==null){const i=e.findBindingPanel();i!==null&&i.rD()&&U.o("Cannot add a Binding to a RowColumnDefinition that is already frozen: "+t+" on "+e)}this.Fs===null&&(this.Fs=new List),this.Fs.add(t)}}class Shape extends GraphObject{ut;tn;zd;Kh;Qe;Zo;jo;Kt;Xd;Gd;K;constructor(t,e){super(),this.ut=null,this.tn=null,this.zd="None",this.Kh="black",this.Qe="black",this.Zo=1,this.jo=null,this.Kt=null,this.Xd=NaN,this.Gd=NaN,this.K=null,typeof t=="string"?this.figure=t:t&&Object.assign(this,t),e&&Object.assign(this,e)}cloneProtected(t){super.cloneProtected(t),t.ut=this.ut,t.tn=this.tn,t.zd=this.zd,t.Kh=this.Kh,t.Qe=this.Qe,t.Zo=this.Zo,this.jo!==null&&(t.jo=this.jo.slice()),this.Kt!==null&&(this.Kt.me?t.Kt=this.Kt:t.Kt=this.Kt.copy()),t.Xd=this.Xd,t.Gd=this.Gd,this.K!==null&&(t.K=this.K.copy())}Hh(){return this.Kt===null?this.Kt=new ShapeTemplateSettings:this.Kt.me&&(this.Kt=this.Kt.copy()),this.Kt}ba(){super.ba(),this.Kt!==null&&(this.Kt.me=!0)}fe(t){t in GeometryStretch?this.geometryStretch=t:super.fe(t)}toString(){return"Shape("+(this.figure!=="None"?this.figure:this.toArrow!=="None"?this.toArrow:this.fromArrow)+")#"+GSet.xs(this)}_I(t,e){const i=this.pathPattern;if(i===null)return;i.ht(1/0,1/0);const s=i.measuredBounds;i.Ut(0,0,s.width,s.height);const n=this.geometry;if(n===null)return;t.save(),t.beginPath();const o=U.nt();if(n.type===1)o.push(n.startX),o.push(n.startY),o.push(n.endX),o.push(n.endY),this.Yd(t,e,o,i);else if(n.type===4){const r=n.figures.iterator;for(;r.next();){const l=r.value;o.length=0,o.push(l.startX),o.push(l.startY);let a=l.startX,h=l.startY,c=a,f=h;const u=l.segments.r,d=u.length;for(let m=0;m<d;m++){const g=u[m];switch(g.type){case 1:this.Yd(t,e,o,i),o.length=0,o.push(g.endX),o.push(g.endY),a=g.endX,h=g.endY,c=a,f=h;break;case 2:o.push(g.endX),o.push(g.endY),a=g.endX,h=g.endY;break;case 3:G.jn(a,h,g.point1X,g.point1Y,g.point2X,g.point2Y,g.endX,g.endY,.5,o),a=g.endX,h=g.endY;break;case 4:G.nm(a,h,g.point1X,g.point1Y,g.endX,g.endY,.5,o),a=g.endX,h=g.endY;break;case 5:{const p=g.vo(l),y=p.length;if(y===0){o.push(g.centerX),o.push(g.centerY),a=g.centerX,h=g.centerY;break}for(let x=0;x<y;x++){const b=p[x];G.jn(a,h,b[2],b[3],b[4],b[5],b[6],b[7],.5,o),a=b[6],h=b[7]}break}case 6:{const p=g.Za(l,a,h),y=p.length;if(y===0){o.push(g.endX),o.push(g.endY),a=g.endX,h=g.endY;break}for(let x=0;x<y;x++){const b=p[x];G.jn(a,h,b[2],b[3],b[4],b[5],b[6],b[7],.5,o),a=b[6],h=b[7]}break}default:U.o("Segment not of valid type: "+g.type)}g.isClosed&&(o.push(c),o.push(f),this.Yd(t,e,o,i))}this.Yd(t,e,o,i)}}else if(n.type===2)o.push(n.startX),o.push(n.startY),o.push(n.endX),o.push(n.startY),o.push(n.endX),o.push(n.endY),o.push(n.startX),o.push(n.endY),o.push(n.startX),o.push(n.startY),this.Yd(t,e,o,i);else if(n.type===3){const r=new PathFigure;r.startX=n.endX,r.startY=(n.startY+n.endY)/2;const l=new PathSegment(5);l.startAngle=0,l.sweepAngle=360,l.centerX=(n.startX+n.endX)/2,l.centerY=(n.startY+n.endY)/2,l.radiusX=Math.abs(n.startX-n.endX)/2,l.radiusY=Math.abs(n.startY-n.endY)/2,r.add(l);const a=l.vo(r),h=a.length;if(h===0)o.push(l.centerX),o.push(l.centerY);else{let c=r.startX,f=r.startY;for(let u=0;u<h;u++){const d=a[u];G.jn(c,f,d[2],d[3],d[4],d[5],d[6],d[7],.5,o),c=d[6],f=d[7]}}this.Yd(t,e,o,i)}U.Z(o),t.restore(),t.clearContextCache(!1)}tE(t){let e=t.measuredBounds.width;return t instanceof Shape&&(e-=t.strokeWidth),e<1&&(e=1),e}Yd(t,e,i,s){const n=i.length;if(n<4)return;const o=s.measuredBounds,r=Math.max(1,o.width),l=o.height;let a=i[0],h=i[1],c=0,f=0,u=0,d=0,m=0,g=0,p=0,y=0;const x=U.nt();for(let N=2;N<n;N+=2)c=i[N],f=i[N+1],u=c-a,d=f-h,u===0&&(u=.001),m=d/u,g=Math.atan2(d,u),p=Math.sqrt(u*u+d*d),x.push([u,g,m,p]),y+=p,a=c,h=f;a=i[0],h=i[1];const b=this.tE(s);let k=b;const P=r/2;let S=P!==0,L=0,C=x[L];u=C[0],g=C[1],m=C[2],p=C[3];let M=0;for(;y>=.1;){if(M===0&&(S?(k=b,k-=P,y-=P,S=!1):k=b,k===0&&(k=1)),k>y){k=y,U.Z(x);return}k>p?(M=k-p,k=p):M=0;let N=Math.sqrt(k*k/(1+m*m));if(u<0&&(N=-N),a+=N,h+=m*N,t.translate(a,h),t.rotate(g),t.translate(-(r/2),-(l/2)),M===0&&s.Ma(t,e),t.translate(r/2,l/2),t.rotate(-g),t.translate(-a,-h),y-=k,p-=k,M!==0){if(L++,L===x.length){U.Z(x);return}C=x[L],u=C[0],g=C[1],m=C[2],p=C[3],k=M}}U.Z(x)}Ma(t,e){const i=t instanceof SVGContext;let s=this.Qe;const n=this.Kh;if(s===null&&n===null)return;const o=this.ut;if(o===null)return;t.commitTransform();const r=this.actualBounds,l=this.naturalBounds;n!==null&&this.bn(t,n,!0,!1,l,r);const a=this.part;let h=this.Zo;s!==null&&h===0&&a!==null&&(this.isPanelMain||a.findMainElement()===this)&&(h=a.eE()),h===0&&(s=null),s!==null&&h!==0&&(this.bn(t,s,!1,!1,l,r),t.lineWidth=h,t.lineJoin=this.strokeJoin,t.lineCap=this.strokeCap,t.miterLimit=this.strokeMiterLimit);let c=!1;a&&e.getRenderingHint("drawShadows")&&(c=a.isShadowed),t.ol===!1&&(c=!1);let f=!0;s!==null&&(n===null||n==="transparent")&&(f=!1);let u=!1;const d=this.strokeDashArray;if(d!==null&&(u=!0,t.enableDash(d,this.strokeDashOffset)),o.type===1)t.beginPath(),t.moveTo(o.startX,o.startY),t.lineTo(o.endX,o.endY),s!==null&&t.strokeContext(),t.endPath();else if(o.type===2){const m=o.startX,g=o.startY,p=o.endX,y=o.endY,x=Math.min(m,p),b=Math.min(g,y),k=Math.abs(p-m),P=Math.abs(y-g);t.beginPath(),t.rect(x,b,k,P),n!==null&&t.fillContext(n,!1,null),s!==null&&(f&&c&&t.shadowsOff(),t.strokeContext(),f&&c&&t.shadowsOn()),t.endPath()}else if(o.type===3){const m=o.startX,g=o.startY,p=o.endX,y=o.endY,x=Math.abs(p-m)/2,b=Math.abs(y-g)/2,k=Math.min(m,p)+x,P=Math.min(g,y)+b;t.beginPath(),t.moveTo(k,P-b),t.bezierCurveTo(k+G.qn*x,P-b,k+x,P-G.qn*b,k+x,P),t.bezierCurveTo(k+x,P+G.qn*b,k+G.qn*x,P+b,k,P+b),t.bezierCurveTo(k-G.qn*x,P+b,k-x,P+G.qn*b,k-x,P),t.bezierCurveTo(k-x,P-G.qn*b,k-G.qn*x,P-b,k,P-b),t.closePath(),n!==null&&t.fillContext(n,!1,null),s!==null&&(f&&c&&t.shadowsOff(),t.strokeContext(),f&&c&&t.shadowsOn()),t.endPath()}else if(o.type===4){const m=o.figures,g=m.length;for(let p=0;p<g;p++){const y=m.r[p];i?(t.beginPath(),this.SD(t,y)):y.Hi===null&&(y.Hi=new Path2D,this.SD(y.Hi,y));const x=y.isFilled;c?y.isShadowed?(x===!0&&n!=="transparent"&&n!==null&&t.fillContext(n,y.isEvenOdd,y.Hi),s!==null&&(x&&f&&t.shadowsOff(),t.stroke(y.Hi),x&&f&&t.shadowsOn())):(t.shadowsOff(),x&&n!=="transparent"&&n!==null&&t.fillContext(n,y.isEvenOdd,y.Hi),s!==null&&t.stroke(y.Hi),t.shadowsOn()):(x&&n!==null&&t.fillContext(n,y.isEvenOdd,y.Hi),s!==null&&t.stroke(y.Hi)),t.endPath(p)}}u&&t.disableDash(),this._I(t,e)}SD(t,e){t.moveTo(e.startX,e.startY);const i=e.segments.r,s=i.length;let n=null;for(let o=0;o<s;o++){const r=i[o];switch(r.type){case 1:t.moveTo(r.endX,r.endY);break;case 2:t.lineTo(r.endX,r.endY);break;case 3:t.bezierCurveTo(r.point1X,r.point1Y,r.point2X,r.point2Y,r.endX,r.endY);break;case 4:t.quadraticCurveTo(r.point1X,r.point1Y,r.endX,r.endY);break;case 5:if(r.radiusX===r.radiusY){const l=n!==null?n.endX:e.startX,a=n!==null?n.endY:e.startY,h=Math.PI/180;t.arc(r.point1X,r.point1Y,r.radiusX,r.startAngle*h,(r.startAngle+r.sweepAngle)*h,r.sweepAngle<0,l,a)}else{const l=r.vo(e),a=l.length;if(a===0){t.lineTo(r.centerX,r.centerY);break}for(let h=0;h<a;h++){const c=l[h];h===0&&t.lineTo(c[0],c[1]),t.bezierCurveTo(c[2],c[3],c[4],c[5],c[6],c[7])}}break;case 6:{let l=0,a=0,h;if(n!==null&&n.type===5){h=n.vo(e);const f=h.length;if(f===0){t.lineTo(r.endX,r.endY);break}const u=h[f-1]||null;u!==null&&(l=u[6],a=u[7])}else l=n!==null?n.endX:e.startX,a=n!==null?n.endY:e.startY;h=r.Za(e,l,a);const c=h.length;if(c===0){t.lineTo(r.endX,r.endY);break}for(let f=0;f<c;f++){const u=h[f];t.bezierCurveTo(u[2],u[3],u[4],u[5],u[6],u[7])}break}}r.isClosed&&t.closePath(),n=r}}yf(t,e,i){if(!super.yf(t,e,i)||this.Qe===null&&this.Kh===null||this.ut===null||this.pathPattern!==null)return!1;const s=this.svg.getElementsByTagName("path");return this.geometry.figures.length!==s.length?!1:(t.currentPath=this.svg,this.Ma(t,e),t.currentPath=null,!0)}Pd(t){return this.geometry!==null&&this.geometry.figures.length>1||this.pathPattern!==null?!0:super.Pd(t)}AN(t,e){if(t.nodeName!=="g")t.setAttributeNS(null,"filter",e);else{const i=t.getElementsByTagName("path");for(let s=0;s<i.length;s++)i[s].setAttributeNS(null,"filter",e)}}getDocumentPoint(t,e){if(e===void 0&&(e=new Point),t instanceof Spot){const i=t;i.isNoSpot()&&U.o("getDocumentPoint Spot must be a real, specific Spot, not: "+i.toString());const s=this.naturalBounds,n=this.strokeWidth;return e.e(i.x*(s.width+n)-n/2+s.x+i.offsetX,i.y*(s.height+n)-n/2+s.y+i.offsetY),this.Ws.gt(e),e}else return e.set(t),this.Ws.gt(e),e}getDocumentBounds(t){t===void 0&&(t=new Rect);const e=this.naturalBounds,i=this.Ws,s=Rect.z(e.x,e.y,e.width,e.height),n=this.strokeWidth;s.inflate(n/2,n/2);const o=Point.z(s.x,s.y).v(i);return t.e(o.x,o.y,0,0),o.e(s.right,s.y).v(i),t.re(o.x,o.y,0,0),o.e(s.right,s.bottom).v(i),t.re(o.x,o.y,0,0),o.e(s.x,s.bottom).v(i),t.re(o.x,o.y,0,0),Rect.i(s),Point.i(o),t}ka(t,e){const i=this.geometry;if(i===null||this.fill===null&&this.stroke===null)return!1;const s=i.bounds;let n=this.strokeWidth/2;i.type===1&&!e&&(n+=2);const o=Rect.l();if(o.h(s),o.inflate(n+2,n+2),!o.containsPoint(t))return Rect.i(o),!1;const r=n+1e-4;if(i.type===1){if(this.stroke===null)return!1;const l=(i.startX-i.endX)*(t.x-i.endX)+(i.startY-i.endY)*(t.y-i.endY),a=(i.endX-i.startX)*(t.x-i.startX)+(i.endY-i.startY)*(t.y-i.startY);return l<0||a<0?!1:(Rect.i(o),G.Ve(i.startX,i.startY,i.endX,i.endY,n,t.x,t.y))}else if(i.type===2){const l=i.startX,a=i.startY,h=i.endX,c=i.endY;if(o.x=Math.min(l,h),o.y=Math.min(a,c),o.width=Math.abs(h-l),o.height=Math.abs(c-a),this.fill===null){if(o.inflate(-r,-r),o.containsPoint(t))return Rect.i(o),!1;o.inflate(r,r)}this.stroke!==null&&o.inflate(n,n);const f=o.containsPoint(t);return Rect.i(o),f}else if(i.type===3){const l=i.startX,a=i.startY,h=i.endX,c=i.endY;let f=Math.min(l,h),u=Math.min(a,c);const d=Math.abs(h-l),m=Math.abs(c-a);let g=d/2,p=m/2;if(f=t.x-(f+g),u=t.y-(u+p),this.fill===null){if(g-=r,p-=r,g<=0||p<=0)return Rect.i(o),!1;if(f*f/(g*g)+u*u/(p*p)<=1)return Rect.i(o),!1;g+=r,p+=r}return this.stroke!==null&&(g+=r,p+=r),Rect.i(o),g<=0||p<=0?!1:f*f/(g*g)+u*u/(p*p)<=1}else{if(i.type===4)return Rect.i(o),this.fill===null?i._L(t.x,t.y,n):i.VP(t,n,this.strokeWidth>1,e);U.o("Unknown Geometry type: "+i.type)}}bd(t,e,i,s){const n=this.desiredSize,o=this.Zo;t=Math.max(t,0),e=Math.max(e,0);let r;if(this.tn!==null)r=this.geometry.bounds;else{const g=this.figure;let p=Shape.sC[g];if(p===void 0){let y=G.Wn[g];typeof y=="string"&&(y=G.Wn[y]),U.st(y)?(p=y(null,100,100),Shape.sC[g]=p):U.o("Unsupported Figure: "+g)}r=p.bounds}let l=r.width,a=r.height,h=r.width,c=r.height;switch(this.Zs(!0)){case 0:i=0,s=0;break;case 2:h=Math.max(t-o,0),c=Math.max(e-o,0);break;case 5:h=Math.max(t-o,0),s=0;break;case 4:i=0,c=Math.max(e-o,0);break}isFinite(n.width)&&(h=n.width),isFinite(n.height)&&(c=n.height);const u=this.maxSize,d=this.minSize;i=Math.max(i-o,d.width),s=Math.max(s-o,d.height),h=Math.min(u.width,h),c=Math.min(u.height,c),h=isFinite(h)?Math.max(i,h):Math.max(l,i),c=isFinite(c)?Math.max(s,c):Math.max(a,s);const m=this.tM();switch(m){case 0:break;case 2:l=h,a=c;break;case 6:{let g=Math.min(h/l,c/a);isFinite(g)||(g=1),l=l*g,a=a*g;break}default:U.o(m+" is not a valid geometryStretch.")}if(this.tn!==null){l===0&&(l=.001),a===0&&(a=.001);const g=this.tn.nR(l,a);this.ut=g}else(this.ut===null||!G.X(this.ut.Pc,t-o)||!G.X(this.ut.Sc,e-o))&&(this.ut=Shape.iE(this,l,a));r=this.ut.bounds,t===1/0||e===1/0?this.ro(r.x-o/2,r.y-o/2,t===0&&l===0?0:r.width+o,e===0&&a===0?0:r.height+o):this.ro(-(o/2),-(o/2),h+o,c+o),n.isReal()?(h=n.width,c=n.height,h=Math.min(u.width,h),c=Math.min(u.height,c),h=Math.max(d.width,h),c=Math.max(d.height,c),this.Ke.e(0,0,h,c)):this.Ke.h(r)}tM(){const t=this.geometryStretch;return this.tn!==null?t===1?2:t:t===1?Shape.sC[this.figure].defaultStretch:t}Pa(t,e,i,s){this.commonArrange(t,e,i,s)}getNearestIntersectionPoint(t,e,i){return this.mf(t.x,t.y,e.x,e.y,i)}mf(t,e,i,s,n){const o=this.v,r=1/(o.m11*o.m22-o.m12*o.m21),l=o.m22*r,a=-o.m12*r,h=-o.m21*r,c=o.m11*r,f=r*(o.m21*o.dy-o.m22*o.dx),u=r*(o.m12*o.dx-o.m11*o.dy),d=t*l+e*h+f,m=t*a+e*c+u,g=i*l+s*h+f,p=i*a+s*c+u,y=this.Zo/2;let x=this.ut;x===null&&(this.ht(1/0,1/0),x=this.ut);const b=x.bounds;let k=!1;if(x.type===1)if(this.strokeWidth<=1.5)k=G.Do(x.startX,x.startY,x.endX,x.endY,d,m,g,p,n);else{let P=0,S=0;if(x.startX===x.endX)P=y,S=0;else{const A=(x.endY-x.startY)/(x.endX-x.startX);S=y/Math.sqrt(1+A*A),P=S*A}const L=U.nt();let C=new Point;G.Do(x.startX+P,x.startY+S,x.endX+P,x.endY+S,d,m,g,p,C)&&L.push(C),C=new Point,G.Do(x.startX-P,x.startY-S,x.endX-P,x.endY-S,d,m,g,p,C)&&L.push(C),C=new Point,G.Do(x.startX+P,x.startY+S,x.startX-P,x.startY-S,d,m,g,p,C)&&L.push(C),C=new Point,G.Do(x.endX+P,x.endY+S,x.endX-P,x.endY-S,d,m,g,p,C)&&L.push(C);const M=L.length;if(M===0)return U.Z(L),!1;k=!0;let N=1/0;for(let A=0;A<M;A++){const T=L[A],D=(T.x-d)**2+(T.y-m)**2;D<N&&(N=D,n.x=T.x,n.y=T.y)}U.Z(L)}else if(x.type===2)k=G.Cl(b.x-y,b.y-y,b.x+b.width+y,b.y+b.height+y,d,m,g,p,n);else if(x.type===3){const P=Rect.z(b.x,b.y,b.width,b.height).inflate(y,y);k=this.sE(P,d,m,g,p,n),Rect.i(P)}else if(x.type===4){let P=0,S=0,L=0,C=0;const M=Point.l();let N=g-d,A=p-m,T=N*N+A*A,D=d,v=m;if(T>0&&b.contains(D,v)&&(M.x=D,M.y=v,this.containsPoint(M)))for(N!==0&&Math.abs(N)<.5?(A*=.5/N,N=.5):A!==0&&Math.abs(A)<.5&&(N*=.5/A,A=.5),D-=N,v-=A;b.contains(D,v);)D-=N,v-=A;const R=.6;n.x=g,n.y=p;for(let Y=0;Y<x.figures.count;Y++){const E=x.figures.r[Y],X=E.isFilled?D:d,B=E.isFilled?v:m,H=E.segments;P=E.startX,S=E.startY;let q=P,W=S;for(let Z=0;Z<H.count;Z++){const V=H.r[Z],$=V.type;L=V.endX,C=V.endY;let J=!1;switch($){case 1:q=L,W=C;break;case 2:J=this._1(P,S,L,C,X,B,g,p,M);break;case 3:{J=G.om(P,S,V.point1X,V.point1Y,V.point2X,V.point2Y,L,C,X,B,g,p,R,M);break}case 4:{J=G.om(P,S,P+2/3*(V.point1X-P),S+2/3*(V.point1Y-S),L+2/3*(V.point1X-L),C+2/3*(V.point1Y-C),L,C,X,B,g,p,R,M);break}case 5:case 6:{const tt=V.type===5?V.vo(E):V.Za(E,P,S),K=tt.length;if(K===0){J=this._1(P,S,V.type===5?V.centerX:V.endX,V.type===5?V.centerY:V.endY,X,B,g,p,M);break}let I=null;for(let j=0;j<K;j++){if(I=tt[j],j===0&&this._1(P,S,I[0],I[1],X,B,g,p,M)){const Q=this.tk(X,B,M,T,n);Q<T&&(T=Q,k=!0)}if(G.om(I[0],I[1],I[2],I[3],I[4],I[5],I[6],I[7],X,B,g,p,R,M)){const Q=this.tk(X,B,M,T,n);Q<T&&(T=Q,k=!0)}}L=I[6],C=I[7];break}default:U.o("Unknown Segment type: "+$)}if(P=L,S=C,J){const tt=this.tk(X,B,M,T,n);tt<T&&(T=tt,k=!0)}if(V.isClosed&&(L=q,C=W,this._1(P,S,L,C,X,B,g,p,M))){const tt=this.tk(X,B,M,T,n);tt<T&&(T=tt,k=!0)}}}let F=i-t,O=s-e;const z=Math.sqrt(F*F+O*O);z!==0&&(F/=z,O/=z),n.x-=F*y,n.y-=O*y,Point.i(M)}else U.o("Unknown Geometry type: "+x.type);return k?(this.v.gt(n),!0):!1}tk(t,e,i,s,n){const o=i.x-t,r=i.y-e,l=o*o+r*r;return l<s?(n.x=i.x,n.y=i.y,l):s}_1(t,e,i,s,n,o,r,l,a){if(G.X(t,i)&&G.X(e,s)||G.X(n,r)&&G.X(o,l))return!1;let h=!1;const c=(n-r)*(e-s)-(o-l)*(t-i);if(c===0)return!1;if(a.x=((n*l-o*r)*(t-i)-(n-r)*(t*s-e*i))/c,a.y=((n*l-o*r)*(e-s)-(o-l)*(t*s-e*i))/c,(t>i?t-i:i-t)<(e>s?e-s:s-e)){const f=e<s?e:s,u=e<s?s:e;(a.y>f||G.X(a.y,f))&&(a.y<u||G.X(a.y,u))&&(h=!0)}else{const f=t<i?t:i,u=t<i?i:t;(a.x>f||G.X(a.x,f))&&(a.x<u||G.X(a.x,u))&&(h=!0)}return h}nE(t,e,i){return this.pickable===!1?!1:(i.bc(this.v),e?this.oE(t,i):this.containedInRect(t,i))}containedInRect(t,e){if(e===void 0)return t.containsRect(this.actualBounds);let i=this.ut;i===null&&(this.ht(1/0,1/0),i=this.ut);const s=i.bounds,n=this.strokeWidth/2;let o=!1;const r=Point.l();return r.e(s.x-n,s.y-n),t.containsPoint(e.gt(r))&&(r.e(s.x-n,s.bottom+n),t.containsPoint(e.gt(r))&&(r.e(s.right+n,s.bottom+n),t.containsPoint(e.gt(r))&&(r.e(s.right+n,s.y-n),t.containsPoint(e.gt(r))&&(o=!0)))),Point.i(r),o}intersectsRect(t,e){if(this.containedInRect(t,e)||e===void 0&&(e=this.v,t.containsRect(this.actualBounds)))return!0;const i=Transform.l();i.set(e),i.ex();const s=t.left,n=t.right,o=t.top,r=t.bottom,l=Point.l();if(l.e(s,o),i.gt(l),this.ka(l,!0))return Point.i(l),!0;if(l.e(n,o),i.gt(l),this.ka(l,!0))return Point.i(l),!0;if(l.e(s,r),i.gt(l),this.ka(l,!0))return Point.i(l),!0;if(l.e(n,r),i.gt(l),this.ka(l,!0))return Point.i(l),!0;const a=Point.l(),h=Point.l();i.set(e),i.GL(this.v),i.ex(),a.x=n,a.y=o,a.v(i),l.x=s,l.y=o,l.v(i);let c=!1;return this.qh(l,a,h)?c=!0:(l.x=n,l.y=r,l.v(i),this.qh(l,a,h)?c=!0:(a.x=s,a.y=r,a.v(i),this.qh(l,a,h)?c=!0:(l.x=s,l.y=o,l.v(i),this.qh(l,a,h)&&(c=!0)))),Point.i(l),Transform.i(i),Point.i(a),Point.i(h),c}qh(t,e,i){if(!this.getNearestIntersectionPoint(t,e,i))return!1;const s=t.x,n=t.y,o=e.x,r=e.y,l=i.x,a=i.y;if(s===o){let h=0,c=0;return n<r?(h=n,c=r):(h=r,c=n),a>=h&&a<=c}else{let h=0,c=0;return s<o?(h=s,c=o):(h=o,c=s),l>=h&&l<=c}}oE(t,e){if(this.containedInRect(t,e)||e===void 0&&(e=this.v,t.containsRect(this.actualBounds)))return!0;const i=t.left,s=t.right,n=t.top,o=t.bottom,r=Point.l(),l=Point.l(),a=Point.l(),h=Transform.l();h.set(e),h.GL(this.v),h.ex(),l.x=s,l.y=n,l.v(h),r.x=i,r.y=n,r.v(h);let c=!1;return this.qh(r,l,a)?c=!0:(r.x=s,r.y=o,r.v(h),this.qh(r,l,a)?c=!0:(l.x=i,l.y=o,l.v(h),this.qh(r,l,a)?c=!0:(r.x=i,r.y=n,r.v(h),this.qh(r,l,a)&&(c=!0)))),Transform.i(h),Point.i(r),Point.i(l),Point.i(a),c}QT(t,e,i){if(i&&this.fill!==null&&this.ka(t,!0))return!0;let s=t.distanceSquaredPoint(e);const n=s;this.strokeWidth>1.5&&(s=this.strokeWidth/2+Math.sqrt(s),s*=s);let o=this.ut;if(o===null&&(this.ht(1/0,1/0),o=this.ut,o===null))return!1;if(!i){const f=o.bounds,u=f.x,d=f.y,m=f.x+f.width,g=f.y+f.height;if(Point.distanceSquared(t.x,t.y,u,d)<=s&&Point.distanceSquared(t.x,t.y,m,d)<=s&&Point.distanceSquared(t.x,t.y,u,g)<=s&&Point.distanceSquared(t.x,t.y,m,g)<=s)return!0}function r(f,u){const d=f.length;for(let m=0;m<d;m+=2)if(u.distanceSquared(f[m],f[m+1])>s)return!0;return!1}const l=o.startX,a=o.startY,h=o.endX,c=o.endY;if(o.type===1){const f=Point.distanceLineSegmentSquared(t.x,t.y,l,a,h,c),u=(h-l)*(t.x-l)+(c-a)*(t.y-a),d=(l-h)*(t.x-h)+(a-c)*(t.y-c),m=u>=0&&d>=0?s:n;return f<=m}else if(o.type===2){let f=!1;return i&&(f=Point.distanceLineSegmentSquared(t.x,t.y,l,a,l,c)<=s||Point.distanceLineSegmentSquared(t.x,t.y,l,a,h,a)<=s||Point.distanceLineSegmentSquared(t.x,t.y,h,a,h,c)<=s||Point.distanceLineSegmentSquared(t.x,t.y,l,c,h,c)<=s),f}else if(o.type===3){const f=(l+h)/2,u=(a+c)/2,d=t.x-f,m=t.y-u,g=Math.abs(h-l)/2,p=Math.abs(c-a)/2;if(g===0||p===0)return Point.distanceLineSegmentSquared(t.x,t.y,l,a,h,c)<=s;if(i){const y=G.JF(g,p,d,m);return y*y<=s}else return!(Point.distanceSquared(d,m,-g,0)>=s||Point.distanceSquared(d,m,0,-p)>=s||Point.distanceSquared(d,m,0,p)>=s||Point.distanceSquared(d,m,g,0)>=s)}else if(o.type===4){const f=o.bounds,u=f.x,d=f.y,m=f.x+f.width,g=f.y+f.height;if(t.x>m&&t.x<u&&t.y>g&&t.y<d&&Point.distanceLineSegmentSquared(t.x,t.y,u,d,u,g)>s&&Point.distanceLineSegmentSquared(t.x,t.y,u,d,m,d)>s&&Point.distanceLineSegmentSquared(t.x,t.y,m,g,u,g)>s&&Point.distanceLineSegmentSquared(t.x,t.y,m,g,m,d)>s)return!1;const p=Math.sqrt(s);if(i){if(this.fill===null?o._L(t.x,t.y,p):o.VP(t,p,!0,!1))return!0}else{const y=o.figures;for(let x=0;x<y.count;x++){const b=y.r[x];let k=b.startX,P=b.startY;if(t.distanceSquared(k,P)>s)return!1;const S=b.segments.r,L=S.length;for(let C=0;C<L;C++){const M=S[C];switch(M.type){case 1:case 2:if(k=M.endX,P=M.endY,t.distanceSquared(k,P)>s)return!1;break;case 3:{const N=U.nt();G.jn(k,P,M.point1X,M.point1Y,M.point2X,M.point2Y,M.endX,M.endY,.8,N);const A=r(N,t);if(U.Z(N),A||(k=M.endX,P=M.endY,t.distanceSquared(k,P)>s))return!1;break}case 4:{const N=U.nt();G.nm(k,P,M.point1X,M.point1Y,M.endX,M.endY,.8,N);const A=r(N,t);if(U.Z(N),A||(k=M.endX,P=M.endY,t.distanceSquared(k,P)>s))return!1;break}case 5:case 6:{const N=M.type===5?M.vo(b):M.Za(b,k,P),A=N.length;if(A===0){if(k=M.type===5?M.centerX:M.endX,P=M.type===5?M.centerY:M.endY,t.distanceSquared(k,P)>s)return!1;break}let T=null;const D=U.nt();for(let v=0;v<A;v++)if(T=N[v],D.length=0,G.jn(T[0],T[1],T[2],T[3],T[4],T[5],T[6],T[7],.8,D),r(D,t))return U.Z(D),!1;U.Z(D),T!==null&&(k=T[6],P=T[7]);break}default:U.o("Unknown Segment type: "+M.type)}}}return!0}}return!1}sE(t,e,i,s,n,o){if(t.width===0)return G.Do(t.x,t.y,t.x,t.y+t.height,e,i,s,n,o);if(t.height===0)return G.Do(t.x,t.y,t.x+t.width,t.y,e,i,s,n,o);{const r=t.width/2,l=t.height/2,a=t.x+r,h=t.y+l;let c=9999;if(e!==s&&(c=(i-n)/(e-s)),Math.abs(c)<9999){const f=i-h-c*(e-a);if(r*r*(c*c)+l*l-f*f<0)return o.x=NaN,o.y=NaN,!1;const u=Math.sqrt(r*r*(c*c)+l*l-f*f),d=(-(r*r*c*f)+r*l*u)/(l*l+r*r*(c*c))+a,m=(-(r*r*c*f)-r*l*u)/(l*l+r*r*(c*c))+a,g=c*(d-a)+f+h,p=c*(m-a)+f+h,y=Math.abs((e-d)**2)+Math.abs((i-g)**2),x=Math.abs((e-m)**2)+Math.abs((i-p)**2);y<x?(o.x=d,o.y=g):(o.x=m,o.y=p)}else{const f=l*l,u=r*r,d=e-a,m=f-f/u*(d*d);if(m<0)return o.x=NaN,o.y=NaN,!1;const g=Math.sqrt(m),p=h+g,y=h-g,x=Math.abs(p-i),b=Math.abs(y-i);x<b?(o.x=e,o.y=p):(o.x=e,o.y=y)}return!0}}jI(){return this.Zo/2*this.strokeMiterLimit*this.getDocumentScale()}get geometry(){return this.ut!==null?this.ut:this.tn}set geometry(t){const e=this.ut,i=this.tn;if(e===t)return;t!==null?(this.ut=t.k(),this.tn=this.ut):(this.ut=null,this.tn=null);const s=this.part;if(s!==null&&s.Tf(),this.f(),this.t("geometry",e||i,t),this.gf()){const n=this.part;n!==null&&this.Eh(n,"geometryString")}}get geometryString(){return this.geometry===null?"":this.geometry.toString()}set geometryString(t){const e=Geometry.parse(t),i=e.normalize();this.geometry=e;const s=Point.z(-i.x,-i.y);this.position=s,Point.i(s)}get isGeometryPositioned(){return(this.n&1048576)!==0}set isGeometryPositioned(t){const e=(this.n&1048576)!==0;e!==t&&(this.n=this.n^1048576,this.f(),this.t("isGeometryPositioned",e,t))}ai(){this.ut=null}get fill(){return this.Kh}set fill(t){const e=this.Kh;e!==t&&(t!==null&&Brush.Md(t,"Shape.fill"),t instanceof Brush&&t.k(),this.Kh=t,this.C(),this.t("fill",e,t))}get stroke(){return this.Qe}set stroke(t){const e=this.Qe;e!==t&&(t!==null&&Brush.Md(t,"Shape.stroke"),t instanceof Brush&&t.k(),this.Qe=t,this.C(),this.t("stroke",e,t))}get strokeWidth(){return this.Zo}set strokeWidth(t){const e=this.Zo;if(e!==t)if(t>=0){this.Zo=t,this.f();const i=this.part;i!==null&&i.Tf(),this.t("strokeWidth",e,t)}else U.J(t,"value >= 0",Shape,"strokeWidth:value")}qp(){return this.Zo}get strokeCap(){return this.Kt!==null?this.Kt.Y0:"butt"}set strokeCap(t){const e=this.strokeCap;e!==t&&(typeof t=="string"&&(t==="butt"||t==="round"||t==="square")?(this.Hh().Y0=t,this.C(),this.t("strokeCap",e,t)):U.J(t,'"butt", "round", or "square"',Shape,"strokeCap"))}get strokeJoin(){return this.Kt!==null?this.Kt.K0:"miter"}set strokeJoin(t){const e=this.strokeJoin;e!==t&&(typeof t=="string"&&(t==="miter"||t==="bevel"||t==="round")?(this.Hh().K0=t,this.C(),this.t("strokeJoin",e,t)):U.J(t,'"miter", "bevel", or "round"',Shape,"strokeJoin"))}get strokeMiterLimit(){return this.Kt!==null?this.Kt.H0:10}set strokeMiterLimit(t){const e=this.strokeMiterLimit;if(e!==t&&t>=1){this.Hh().H0=t,this.C();const i=this.part;i!==null&&i.Tf(),this.t("strokeMiterLimit",e,t)}}get strokeDashArray(){return this.jo}set strokeDashArray(t){const e=this.jo;if(e!==t){if(t!==null&&!Array.isArray(t)&&U.si(t,"Array",Shape,"strokeDashArray:value"),t!==null){const i=t.length;let s=0;for(let n=0;n<i;n++){const o=t[n];(!(o>=0)||!isFinite(o))&&U.o("strokeDashArray:value "+o+" at index "+n+" must be a positive number or zero."),s+=o}if(s===0){if(e===null)return;t=null}}this.jo=t,this.C(),this.t("strokeDashArray",e,t)}}get strokeDashOffset(){return this.Kt!==null?this.Kt.La:0}set strokeDashOffset(t){const e=this.strokeDashOffset;e!==t&&t>=0&&(this.Hh().La=t,this.C(),this.t("strokeDashOffset",e,t))}get figure(){return this.zd}set figure(t){const e=this.zd;if(e!==t){let i=G.Wn[t];if(U.st(i)?i=t:(i=G.Wn[t.toLowerCase()],(!i||typeof i=="function")&&U.o("Unknown Shape.figure: "+t)),e!==i){const s=this.part;s!==null&&s.Tf(),this.zd=i,this.tn=null,this.ai(),this.f(),this.t("figure",e,i)}}}get toArrow(){return this.Ot!==null?this.Ot.q0:"None"}set toArrow(t){const e=this.toArrow;if(t===!0?t="Standard":t===!1&&(t=""),e!==t){const i=Shape.MD(t);i===null?U.o("Unknown Shape.toArrow: "+t):e!==i&&(this.Ot===null&&(this.Ot=new LinkElementSettings),this.Ot.q0=i,this.tn=null,this.ai(),this.f(),this.ND(i),this.t("toArrow",e,i))}}get fromArrow(){return this.Ot!==null?this.Ot.j0:"None"}set fromArrow(t){const e=this.fromArrow;if(t===!0?t="Standard":t===!1&&(t=""),e!==t){const i=Shape.MD(t);i===null?U.o("Unknown Shape.fromArrow: "+t):e!==i&&(this.Ot===null&&(this.Ot=new LinkElementSettings),this.Ot.j0=i,this.tn=null,this.ai(),this.f(),this.ND(i),this.t("fromArrow",e,i))}}ND(t){const e=this.diagram;e!==null&&e.undoManager.isUndoingRedoing||(this.pI(),this.toArrow!=="None"?(this.segmentIndex=-1,this.alignmentFocus=Spot.Right):this.fromArrow!=="None"&&(this.segmentIndex=0,this.alignmentFocus=Spot.Left))}get spot1(){return this.Kt!==null?this.Kt.Jn:Spot.Default}set spot1(t){const e=this.spot1;e.equals(t)||(t=t.N(),this.Hh().Jn=t,this.f(),this.t("spot1",e,t))}get spot2(){return this.Kt!==null?this.Kt.$n:Spot.Default}set spot2(t){const e=this.spot2;e.equals(t)||(t=t.N(),this.Hh().$n=t,this.f(),this.t("spot2",e,t))}get parameter1(){return this.Xd}set parameter1(t){const e=this.Xd;e!==t&&(this.Xd=t,this.ai(),this.f(),this.t("parameter1",e,t))}get parameter2(){return this.Gd}set parameter2(t){const e=this.Gd;e!==t&&(this.Gd=t,this.ai(),this.f(),this.t("parameter2",e,t))}get naturalBounds(){return this.Ke}UI(){const t=this.desiredSize;if(!t.isReal()&&this.ut!==null){const e=this.ut.bounds;this.Ke.h(e)}else this.Ke.e(0,0,t.width,t.height)}get pathPattern(){return this.Kt!==null?this.Kt.W0:null}set pathPattern(t){const e=this.pathPattern;e!==t&&(this.Hh().W0=t,this.C(),this.t("pathPattern",e,t))}get geometryStretch(){return this.Kt!==null?this.Kt.J0:1}set geometryStretch(t){const e=this.geometryStretch;e!==t&&(this.Hh().J0=t,this.f(),this.t("geometryStretch",e,t))}get interval(){return this.K!==null?this.K.vf:1}set interval(t){const e=this.interval;if(t=Math.round(t),e!==t&&t!==0&&isFinite(t)){this.K===null&&(this.K=new GradElementSettings),this.K.vf=t;const i=this.diagram;i!==null&&this.panel===i.grid&&i.ca(),this.f();const s=this.panel;s!==null&&(s.ds=null),this.t("interval",e,t)}}get graduatedStart(){return this.K!==null?this.K.Ff:0}set graduatedStart(t){const e=this.graduatedStart;e!==t&&(t<0?t=0:t>1&&(t=1),this.K===null&&(this.K=new GradElementSettings),this.K.Ff=t,this.f(),this.t("graduatedStart",e,t))}get graduatedEnd(){return this.K!==null?this.K.Rf:1}set graduatedEnd(t){const e=this.graduatedEnd;e!==t&&(t<0?t=0:t>1&&(t=1),this.K===null&&(this.K=new GradElementSettings),this.K.Rf=t,this.f(),this.t("graduatedEnd",e,t))}get graduatedSkip(){return this.K!==null?this.K.Of:null}set graduatedSkip(t){const e=this.graduatedSkip;e!==t&&(t!==null&&U.S(t,Shape,"graduatedSkip"),this.K===null&&(this.K=new GradElementSettings),this.K.Of=t,this.f(),this.t("graduatedSkip",e,t))}polygonContainsRect(t){const e=this;if(!e.part||!e.part.actualBounds.containsRect(t))return!1;const i=e.geometry;if(!i)return!1;const s=t.x,n=t.y,o=t.width,r=t.height,l=Point.l();if(l.x=s,l.y=n,e.getLocalPoint(l,l),!i.containsPoint(l)||o>0&&r>0&&(l.x=s+o,l.y=n+r,e.getLocalPoint(l,l),!i.containsPoint(l))||o>0&&(l.x=s+o,l.y=n,e.getLocalPoint(l,l),!i.containsPoint(l))||r>0&&(l.x=s,l.y=n+r,e.getLocalPoint(l,l),!i.containsPoint(l))||i.type===1)return!1;if(i.type===4){const a=i.figures.iterator;for(;a.next();){const h=a.value;if(!h.isFilled)continue;l.x=h.startX,l.y=h.startY,e.getDocumentPoint(l,l);let c=l.x,f=l.y,u=c,d=f,m=c,g=f;const p=h.segments.iterator;for(;p.next();){const y=p.value;if(l.x=y.endX,l.y=y.endY,e.getDocumentPoint(l,l),m=l.x,g=l.y,y.type===1)c=m,f=g;else if(y.type!==5&&(Rect.intersectsLineSegment(s,n,o,r,u,d,m,g)||y.isClosed&&Rect.intersectsLineSegment(s,n,o,r,m,g,c,f)))return!1;u=m,d=g}}}return Point.i(l),!0}static iE(t,e,i){let n=null;if(t.toArrow!=="None")n=Shape.Tn[t.toArrow];else if(t.fromArrow!=="None")n=Shape.Tn[t.fromArrow];else{let o=G.Wn[t.figure];typeof o=="string"&&(o=G.Wn[o]),o===void 0&&U.o("Unknown Shape.figure: "+t.figure),n=o(t,e,i),n.Pc=e,n.Sc=i}if(n===null){const o=G.Wn.Rectangle;U.st(o)&&(n=o(t,e,i))}return n}static getFigureGenerators(){const t=new GMap;for(const e in G.Wn){if(e===e.toLowerCase())continue;const i=G.Wn[e];t.set(e,i)}return t.k(),t}static defineFigureGenerator(t,e){U.s(t,"string",Shape,"defineFigureGenerator:name"),typeof e=="string"||U.S(e,Shape,"defineFigureGenerator:func");const i=t.toLowerCase(),s=G.Wn;s[t]=e,s[i]=t}static isFigureDefined(t){return t in G.Wn}static getArrowheadGeometries(){const t=new GMap;for(const e in G.lm)if(Shape.Tn[e]===void 0){const i=Geometry.parse(G.lm[e],!1);Shape.Tn[e]=i;const s=e.toLowerCase();s!==e&&(Shape.Tn[s]=e)}for(const e in Shape.Tn){if(e===e.toLowerCase())continue;const i=Shape.Tn[e];i instanceof Geometry&&t.set(e,i)}return t.k(),t}static defineArrowheadGeometry(t,e){U.s(t,"string",Shape,"defineArrowheadGeometry:name");let i=null;typeof e=="string"?(U.s(e,"string",Shape,"defineArrowheadGeometry:pathstr"),i=Geometry.parse(e,!1)):i=e;const s=t.toLowerCase();(s==="none"||t===s)&&U.o("Shape.defineArrowheadGeometry name must not be empty or None or all-lower-case: "+t);const n=Shape.Tn;n[t]=i,n[s]=t}static isArrowheadDefined(t){return Shape.Tn.has(t)}static Tn=new PropertyCollection;static sC=new PropertyCollection;static MD(t){let e=Shape.Tn[t];if(e===void 0){const i=t.toLowerCase();if(i==="none")return"None";if(e=Shape.Tn[i],e===void 0){let s=null;for(const n in G.lm)if(n.toLowerCase()===i){s=n;break}if(s!==null){const n=Geometry.parse(G.lm[s],!1);return Shape.Tn[s]=n,i!==s&&(Shape.Tn[i]=s),s}}}return typeof e=="string"?e:e instanceof Geometry?t:null}}class ShapeTemplateSettings{me;Y0;K0;H0;La;W0;J0;Jn;$n;constructor(){this.me=!1,this.Y0="butt",this.K0="miter",this.H0=10,this.La=0,this.W0=null,this.J0=1,this.Jn=Spot.Default,this.$n=Spot.Default}copy(){const t=new ShapeTemplateSettings;return t.Y0=this.Y0,t.K0=this.K0,t.H0=this.H0,t.La=this.La,t.W0=this.W0,t.J0=this.J0,t.Jn=this.Jn.N(),t.$n=this.$n.N(),t}}var Wrap=(w=>(w[w.None=0]="None",w[w.Fit=1]="Fit",w[w.DesiredSize=2]="DesiredSize",w[w.BreakAll=3]="BreakAll",w))(Wrap||{}),TextOverflow=(w=>(w[w.Clip=0]="Clip",w[w.Ellipsis=1]="Ellipsis",w))(TextOverflow||{}),TextFormat=(w=>(w[w.Trim=0]="Trim",w[w.None=1]="None",w))(TextFormat||{});class TextBlock extends GraphObject{ue;Qe;Dn;Pi;pe;jp;Kd;K;tt;Xl;uo;vn;Ii;ye;Fn;constructor(t,e){return super(),TextBlock.M0===!1&&(TextBlock.M0=!0,TextBlock.us=Diagram.isUsingDOM()?new CanvasSurface(null)._t:null),this.n|=2097152,this.ue="",this.Qe="black",this.Dn="13px sans-serif",this.Pi=0,this.pe=0,this.jp=0,this.Kd=null,this.K=null,this.tt=null,this.Xl=0,this.uo=null,this.vn=0,this.Ii=null,this.ye=null,this.Fn=null,typeof t=="string"?this.text=t:t&&Object.assign(this,t),e&&Object.assign(this,e),this}cloneProtected(t){super.cloneProtected(t),t.ue=this.ue,t.Qe=this.Qe,t.Dn=this.Dn,t.Pi=this.Pi,t.pe=this.pe,t.jp=this.jp,t.Kd=this.Kd,this.K!==null&&(t.K=this.K.copy()),this.tt!==null&&(this.tt.me?t.tt=this.tt:t.tt=this.tt.copy()),t.Xl=this.Xl,t.uo=this.uo,t.vn=this.vn,t.Ii=this.Ii,t.ye=this.ye,t.Fn=this.Fn}Rs(){return this.tt===null?this.tt=new TextBlockTemplateSettings:this.tt.me&&(this.tt=this.tt.copy()),this.tt}ba(){super.ba(),this.tt!==null&&(this.tt.me=!0)}KI(t){this.n=t.n|2048|4096,this.Zt=t.opacity,this.Lt=t.background,this.cs=t.desiredSize.N(),this.minSize=t.minSize.N(),this.maxSize=t.maxSize.N(),t.Se!==null?this.Se=t.Se.copy():this.Se=null,this.it=t.scale,this.Xt=t.angle,this.stretch=t.stretch,this.il=t.margin.N(),this.de=t.alignment.N(),this.wd=t.alignmentFocus.N(),this.segmentFraction=t.segmentFraction,this.segmentOffset=t.segmentOffset.N(),this.segmentOrientation=t.segmentOrientation,t.he!==null&&(this.he=t.he.copy()),this.shadowVisible=t.shadowVisible,this.ue=t.ue,this.Qe=t.Qe,this.Dn=t.Dn,this.K!==null&&(this.K=t.K.copy()),t.tt!==null&&(t.tt.me?this.tt=t.tt:this.tt=t.tt.copy()),this.Xl=t.Xl}GI(t){if(this.ue=t.text||"",this.Xt=t.labelAngle||0,this.Pi=t.lineCount||0,this.rE(t.lines),t.naturalBounds&&(this.Ke=t.naturalBounds),t.actualBounds){const e=t.actualBounds;this.Ut(e.x,e.y,e.width,e.height)}}fe(t){t in Wrap?this.wrap=t:super.fe(t)}toString(){return this.ue.length>22?'TextBlock("'+this.ue.substring(0,20)+'"...)':'TextBlock("'+this.ue+'")'}static getEllipsis(){return TextBlock.$0}static setEllipsis(t){TextBlock.$0=t,TextBlock.ek=new PropertyCollection,TextBlock.nC=0}static getBaseline(){return TextBlock.ik}static setBaseline(t){TextBlock.ik=t}static ik=null;static getUnderline(){return TextBlock.sk}static setUnderline(t){TextBlock.sk=t}static sk=null;static None=0;static WrapFit=1;static WrapDesiredSize=2;static WrapBreakAll=3;static OverflowClip=0;static OverflowEllipsis=1;static FormatTrim=0;static FormatNone=1;f(){super.f(),this.Ji(!0)}get font(){return this.Dn}set font(t){const e=this.Dn;e!==t&&(this.Dn=t,this.uo=null,this.f(),this.t("font",e,t))}static isValidFont(t){return root.CSS?root.CSS.supports("font",t):!0}get text(){return this.ue}set text(t){const e=this.ue;t!=null?t=t.toString():t="",e!==t&&(this.ue=t,this.f(),this.t("text",e,t))}get textAlign(){return this.tt!==null?this.tt.Z0:"start"}set textAlign(t){const e=this.textAlign;e!==t&&(t==="start"||t==="end"||t==="left"||t==="right"||t==="center")&&(this.Rs().Z0=t,this.C(),this.t("textAlign",e,t))}get flip(){return this.tt!==null?this.tt.go:0}set flip(t){const e=this.flip;e!==t&&(this.Rs().go=t,this.C(),this.t("flip",e,t))}get verticalAlignment(){return this.tt!==null?this.tt.al:Spot.Top}set verticalAlignment(t){const e=this.verticalAlignment;e.equals(t)||(t=t.N(),this.Rs().al=t,this.kf(),this.t("verticalAlignment",e,t))}get naturalBounds(){if(!this.Ke.isReal()){const t=Size.l();this.oC(this.ue,999999,t);let e=t.width;Size.i(t);let i=this.CD(e);const s=this.desiredSize;isNaN(s.width)||(e=s.width),isNaN(s.height)||(i=s.height),this.Ke.Hn(e,i)}return this.Ke}get isMultiline(){return(this.n&2097152)!==0}set isMultiline(t){const e=(this.n&2097152)!==0;e!==t&&(this.n=this.n^2097152,this.f(),this.t("isMultiline",e,t))}get isUnderline(){return(this.n&4194304)!==0}set isUnderline(t){const e=(this.n&4194304)!==0;e!==t&&(this.n=this.n^4194304,this.Ji(!0),this.C(),this.t("isUnderline",e,t))}get isStrikethrough(){return(this.n&8388608)!==0}set isStrikethrough(t){const e=(this.n&8388608)!==0;e!==t&&(this.n=this.n^8388608,this.Ji(!0),this.C(),this.t("isStrikethrough",e,t))}get wrap(){return this.tt!==null?this.tt.Q0:2}set wrap(t){const e=this.wrap;e!==t&&(this.Rs().Q0=t,this.f(),this.t("wrap",e,t))}get overflow(){return this.tt!==null?this.tt._0:0}set overflow(t){const e=this.overflow;e!==t&&(this.Rs()._0=t,this.f(),this.t("overflow",e,t))}get isOverflowed(){return(this.n&16777216)!==0}rC(t){t?this.n|=16777216:this.n&=-16777217}get stroke(){return this.Qe}set stroke(t){const e=this.Qe;e!==t&&(t!==null&&Brush.Md(t,"TextBlock.stroke"),t instanceof Brush&&t.k(),this.Qe=t,typeof t!="string"&&this.wf(),this.C(),this.t("stroke",e,t))}get lineCount(){return this.Pi}get lineHeight(){return this.ty()}get editable(){return(this.n&1048576)!==0}set editable(t){const e=(this.n&1048576)!==0;e!==t&&(this.n=this.n^1048576,this.t("editable",e,t))}get jN(){return(this.n&33554432)!==0}set jN(t){this.n=this.n^33554432}get textEditor(){return this.tt!==null?this.tt.ey:null}set textEditor(t){const e=this.textEditor;e!==t&&(this.Rs().ey=t,this.t("textEditor",e,t))}get errorFunction(){return this.tt!==null?this.tt.gs:null}set errorFunction(t){const e=this.errorFunction;e!==t&&(t!==null&&U.S(t,TextBlock,"errorFunction"),this.Rs().gs=t,this.t("errorFunction",e,t))}get interval(){return this.K!==null?this.K.vf:1}set interval(t){const e=this.interval;if(t=Math.round(t),e!==t&&t!==0&&isFinite(t)){this.K===null&&(this.K=new GradElementSettings),this.K.vf=t,this.f();const i=this.panel;i!==null&&(i.ds=null),this.t("interval",e,t)}}get graduatedStart(){return this.K!==null?this.K.Ff:0}set graduatedStart(t){const e=this.graduatedStart;e!==t&&(t<0?t=0:t>1&&(t=1),this.K===null&&(this.K=new GradElementSettings),this.K.Ff=t,this.f(),this.t("graduatedStart",e,t))}get graduatedEnd(){return this.K!==null?this.K.Rf:1}set graduatedEnd(t){const e=this.graduatedEnd;e!==t&&(t<0?t=0:t>1&&(t=1),this.K===null&&(this.K=new GradElementSettings),this.K.Rf=t,this.f(),this.t("graduatedEnd",e,t))}get graduatedFunction(){return this.K!==null?this.K.iy:null}set graduatedFunction(t){const e=this.graduatedFunction;e!==t&&(t!==null&&U.S(t,TextBlock,"graduatedFunction"),this.K===null&&(this.K=new GradElementSettings),this.K.iy=t,this.f(),this.t("graduatedFunction",e,t))}get graduatedSkip(){return this.K!==null?this.K.Of:null}set graduatedSkip(t){const e=this.graduatedSkip;e!==t&&(t!==null&&U.S(t,TextBlock,"graduatedSkip"),this.K===null&&(this.K=new GradElementSettings),this.K.Of=t,this.f(),this.t("graduatedSkip",e,t))}Ma(t,e){if(this.Qe===null||this.ue.length===0||this.Dn===null)return;const i=this.naturalBounds,s=this.actualBounds,n=i.width,o=i.height,r=this.ty();let l=t.textAlign=this.textAlign;const a=e.rd;l==="start"?l=a?"right":"left":l==="end"&&(l=a?"left":"right");const h=this.isUnderline,c=this.isStrikethrough;this.bn(t,this.Qe,!0,!1,i,s),(h||c)&&this.bn(t,this.Qe,!1,!1,i,s);const f=0;let u=0;const d=n;let m=!1;e.Wt===t&&!(e.Wt instanceof SVGContext)&&!this.jN&&e.getRenderingHint("textGreeking")===!0&&r*this.Th*e.scale<3&&(m=!0);const g=this.spacingAbove,p=this.spacingBelow;switch(this.flip){case 0:break;case 2:t.translate(n,0),t.scale(-1,1);break;case 1:t.translate(0,o),t.scale(1,-1);break;case 3:t.translate(n,o),t.scale(-1,-1);break}t.commitTransform();const y=this.Pi,b=(g+r+p)*y;if(o>b){const k=this.verticalAlignment;u=k.y*o-k.y*b+k.offsetY}if(TextBlock.nk&&(t.letterSpacing=this.letterSpacing,t.wordSpacing=this.wordSpacing),y===1&&this.Fn!==null){let k=this.pe;k>d&&(k=d),u+=g,this.LD(this.Fn,t,f,u,d,r,k,m,l,h,c)}else if(this.Ii!==null&&this.ye!==null)for(let k=0;k<y;k++){let P=this.Ii[k];P>d&&(P=d),u+=g,this.LD(this.ye[k],t,f,u,d,r,P,m,l,h,c),u+=r+p}switch(this.flip){case 0:break;case 2:t.scale(-1,1),t.translate(-n,0);break;case 1:t.scale(1,-1),t.translate(0,-o);break;case 3:t.scale(-1,-1),t.translate(-n,-o);break}}LD(t,e,i,s,n,o,r,l,a,h,c){let f=0;if(l){a==="left"?f=0:a==="right"?f=n-r:a==="center"&&(f=(n-r)/2);const m=e.globalAlpha;e.globalAlpha=m/2,e.fillRect(i+f,s+o/4,r,o/2),e.globalAlpha=m;return}a==="left"?f=0:a==="right"?f=n:a==="center"&&(f=n/2);const u=TextBlock.ik!==null?TextBlock.ik(this,o):o*.75;e.fillText(t,i+f,s+u);let d=o/20|0;if(d===0&&(d=1),a==="right"?f-=r:a==="center"&&(f-=r/2),h){const m=TextBlock.sk!==null?TextBlock.sk(this,o):o*.8;this.AD(i+f,s+m,i+f+r,s+m,d,e),e instanceof SVGContext&&e.lastCreatedElement.classList.add("gojs-td")}if(c){let m=s+o-o/2.2|0;d%2!==0&&(m+=.5),this.AD(i+f,m,i+f+r,m,d,e),e instanceof SVGContext&&e.lastCreatedElement.classList.add("gojs-td")}}AD(t,e,i,s,n,o){o.beginPath(),o.lineWidth=n,o.moveTo(t,e),o.lineTo(i,s),o.stroke(),o.endPath()}yf(t,e,i){if(!super.yf(t,e,i))return!1;if(this.bn(t,this.Qe,!0,!1,this.naturalBounds,this.actualBounds),i){if(this.svg.getElementsByTagName("text").length===0)return!0;const n=this.svg.getElementsByClassName("gojs-td");for(let o=0;o<n.length;o++)t.setFillOrStrokeInPlace(n[o],!1)}else this.lE(this.svg,this.ye?this.ye[0]:this.text,t);return!0}lE(t,e,i){t.innerHTML=e,i.setFillOrStrokeInPlace(t,!0)}Pd(t){return this.lineCount>1||this.isUnderline||this.isStrikethrough?!0:super.Pd(t)}AN(t,e){if(t.nodeName!=="g")t.setAttributeNS(null,"filter",e);else{const i=t.getElementsByTagName("text");for(let s=0;s<i.length;s++)i[s].setAttributeNS(null,"filter",e)}}aE(){this.vn=0,this.pe=0,this.uo=null,this.Ii=null,this.ye=null,this.Fn=null}bd(t,e,i,s){const n=this.Pi;this.Xl=t,this.rC(!1);const o=this.Dn;TextBlock.us!==null&&(TextBlock.TD!==o&&(TextBlock.us.font=o,TextBlock.TD=o),TextBlock.nk&&(TextBlock.us.letterSpacing=this.letterSpacing,TextBlock.us.wordSpacing=this.wordSpacing)),this.aE();let r=0,l=0;isNaN(this.desiredSize.width)?(r=this.hE(),r=Math.min(r,t/this.scale)):r=this.desiredSize.width,this.panel!==null&&(r=Math.min(r,this.panel.maxSize.width)),l=this.CD(r),isNaN(this.desiredSize.height)?l=Math.min(l,e/this.scale):l=this.desiredSize.height,this.cE(t,l),(this.wrap===1||isNaN(this.desiredSize.width))&&(r=isNaN(t)?this.pe:Math.min(t,this.pe)),r=Math.max(i,r),l=Math.max(s,l),this.Ke.Hn(r,l),this.ro(0,0,r,l),this.svg!==null&&n!==this.Pi&&this.Ji(!0)}Pa(t,e,i,s){this.commonArrange(t,e,i,s)}Rn(t,e){this.Fn===null?(this.Fn=t,this.pe=e):((this.ye===null||this.Ii===null)&&(this.ye=[],this.Ii=[],this.ye.push(this.Fn),this.Ii.push(this.pe)),this.ye.push(t),this.Ii.push(e),this.ye.length>this.maxLines&&(this.n|=16777216))}oC(t,e,i){const s=this.formatting===0;s&&(t=t.trim());let n=0,o=0,r=0;const l=this.Dn,a=this.spacingAbove+this.spacingBelow,h=Math.max(0,this.ty()+a),c=this.overflow===1?this.DD(l):0;if(this.Pi>=this.maxLines){i!==void 0&&i.e(0,h);return}let f=t;if(this.wrap===0){if(this.vn=1,o=this.getStringWidth(t),c===0||o<=e){this.pe=Math.max(this.pe,o),this.Rn(t,this.pe),i!==void 0&&i.e(o,h);return}let d=this.Hd(f);f=f.substring(d.length);let m=this.Hd(f);for(o=this.getStringWidth(d+m),r=0;m.length>0&&o<=e;){d+=m,f=f.substring(m.length),m=this.Hd(f),r=o;let g=d+m;s&&(g=g.trim()),o=this.getStringWidth(g)}for(s&&(m=m.trim()),d+=m,e=Math.max(1,e-c);this.getStringWidth(d)>e&&d.length>1;)d=d.substring(0,d.length-1);this.rC(!0),d+=TextBlock.$0,r=this.getStringWidth(d),this.pe=r,this.Rn(d,r),i!==void 0&&i.e(r,h);return}let u=0;for(f.length===0&&(u=1,this.Rn(f,0));f.length>0;){let d=this.Hd(f);for(f=f.substring(d.length);this.getStringWidth(d)>e;){let p=1;for(o=this.getStringWidth(d.substring(0,p)),r=0;o<=e;)p++,r=o,o=this.getStringWidth(d.substring(0,p));let y=0;p===1?(y=o,n=Math.max(n,o)):(y=r,n=Math.max(n,r)),p--,p<1&&(p=1);const x=d.substring(0,p);if(this.Rn(x,y),u++,d=d.substring(p),this.Pi+u>this.maxLines)break}let m=this.Hd(f);for(o=this.getStringWidth(d+m),r=0;m.length>0&&o<=e;){d+=m,f=f.substring(m.length),m=this.Hd(f),r=o;let p=d+m;s&&(p=p.trim()),o=this.getStringWidth(p)}if(s&&(d=d.trim()),d==="")continue;d[d.length-1]==="\xAD"&&(d=d.substring(0,d.length-1)+"\u2010");let g=0;if(m.length===0?(g=o,n=Math.max(n,o)):(r=this.getStringWidth(d),g=r,n=Math.max(n,r)),this.Rn(d,g),u++,this.Pi+u>this.maxLines)break}this.vn=Math.min(this.maxLines-this.Pi,u),this.pe=Math.max(this.pe,n),i!==void 0&&i.e(this.pe,h*this.vn)}cE(t,e){if(this.pe===0||this.Ii===null||this.ye===null||this.overflow!==1)return;const i=this.Dn,s=this.overflow===1?this.DD(i):0,n=this.spacingAbove+this.spacingBelow,o=Math.max(0,this.ty()+n),r=Math.min(this.maxLines-1,Math.max(Math.floor(e/o+.01)-1,0));if(r+1>=this.ye.length)return;this.rC(!0);let l=this.ye[r];const a=Math.max(1,t-s);for(;this.getStringWidth(l)>a&&l.length>1;)l=l.substring(0,l.length-1);l+=TextBlock.$0;const h=this.getStringWidth(l);this.ye[r]=l,this.ye=this.ye.slice(0,r+1),this.Ii[r]=h,this.Ii=this.Ii.slice(0,r+1),this.vn=this.ye.length,this.pe=Math.max(this.pe,h),this.Pi=this.vn,this.Pi===1&&(this.Fn=this.ye[0])}Hd(t){if(this.wrap===3)return t.substring(0,1);let e=t.length,i=0;const s=TextBlock.fE;for(;i<e&&!s.test(t.charAt(i));)i++;for(this.formatting===1&&(e=Math.min(e,i+1));i<e&&s.test(t.charAt(i));)i++;return i>=t.length?t:t.substring(0,i)}getStringWidth(t){return TextBlock.us===null?t.length*8:TextBlock.us.measureText(t).width}ty(){if(this.uo!==null)return this.uo;const t=this.Dn;let e=0;if(TextBlock.us===null)return e=16,this.uo=e,e;if(TextBlock.lC[t]!==void 0&&TextBlock.vD<5e3)e=TextBlock.lC[t];else{TextBlock.us.letterSpacing="0px";const i=TextBlock.us.measureText("M");TextBlock.us.letterSpacing=this.letterSpacing,e=i.width*1.3,TextBlock.lC[t]=e,TextBlock.vD++}return this.uo=e,e}DD(t){if(TextBlock.us===null)return 6;let e=0;return TextBlock.ek[t]!==void 0&&TextBlock.nC<5e3?e=TextBlock.ek[t]:(e=TextBlock.us.measureText(TextBlock.$0).width,TextBlock.ek[t]=e,TextBlock.nC++),e}ok(t,e){return t.indexOf(`
`,e)}CD(t){let e=this.ue.replace(/\r\n/g,`
`).replace(/\r/g,`
`);const i=this.spacingAbove+this.spacingBelow,s=Math.max(0,this.ty()+i);if(e.length===0)return this.pe=0,this.Pi=1,s;if(!this.isMultiline){const a=this.ok(e,0);a>=0&&(e=e.substring(0,a))}let n=0;this.Pi=0;let o=0,r=-1,l=!1;for(;!l;){if(r=this.ok(e,o),r===-1&&(r=e.length,l=!0),o<=r){const a=e.substring(o,r);if(this.wrap!==0){this.vn=0;const h=Size.l();this.oC(a,t,h),n+=h.height,Size.i(h),this.Pi+=this.vn}else this.oC(a,t),n+=s,this.Pi++;this.Pi===this.maxLines&&(l=!0)}o=r+1}return this.jp=n,n}hE(){let t=this.ue.replace(/\r\n/g,`
`).replace(/\r/g,`
`);if(t.length===0)return 8;if(this.isMultiline){let e=0,i=0,s=!1;for(;!s;){let n=this.ok(t,i);n===-1&&(n=t.length,s=!0);let o=t.substring(i,n);this.formatting===0&&(o=o.trim()),e=Math.max(e,this.getStringWidth(o)),i=n+1}return e}else{const e=this.ok(t,0);return e>=0&&(t=t.substring(0,e)),this.getStringWidth(t)}}get textValidation(){return this.tt!==null?this.tt.zl:null}set textValidation(t){const e=this.textValidation;e!==t&&(t!==null&&U.S(t,TextBlock,"textValidation"),this.Rs().zl=t,this.t("textValidation",e,t))}get textEdited(){return this.tt!==null?this.tt.ny:null}set textEdited(t){const e=this.textEdited;e!==t&&(t!==null&&U.S(t,TextBlock,"textEdited"),this.Rs().ny=t,this.t("textEdited",e,t))}get spacingAbove(){return this.tt!==null?this.tt.ly:0}set spacingAbove(t){const e=this.spacingAbove;e!==t&&(this.Rs().ly=t,this.f(),this.t("spacingAbove",e,t))}get spacingBelow(){return this.tt!==null?this.tt.hy:0}set spacingBelow(t){const e=this.spacingBelow;e!==t&&(this.Rs().hy=t,this.f(),this.t("spacingBelow",e,t))}get letterSpacing(){return this.tt!==null?this.tt.cy:"0px"}set letterSpacing(t){const e=this.letterSpacing;e!==t&&(TextBlock.nk=!0,this.Rs().cy=t,this.f(),this.t("letterSpacing",e,t))}get wordSpacing(){return this.tt!==null?this.tt.fy:"0px"}set wordSpacing(t){const e=this.wordSpacing;e!==t&&(TextBlock.nk=!0,this.Rs().fy=t,this.f(),this.t("wordSpacing",e,t))}get formatting(){return this.tt!==null?this.tt.uy:0}set formatting(t){const e=this.formatting;e!==t&&(this.Rs().uy=t,this.f(),this.t("formatting",e,t))}get maxLines(){return this.tt!==null?this.tt.gy:1/0}set maxLines(t){const e=this.maxLines;e!==t&&(t=Math.floor(t),t<=0&&U.J(t,"> 0",TextBlock,"maxLines"),this.Rs().gy=t,this.f(),this.t("maxLines",e,t))}getMetrics(){return[this.pe,this.Xl,this.uo,this.vn,this.Ii,this.ye,this.Fn||""]}rE(t){t!==void 0&&(this.pe=t[0],this.Xl=t[1],this.uo=t[2],this.vn=t[3],this.Ii=t[4],this.ye=t[5],this.Fn=t[6])}get metrics(){return{arrSize:this.Ii!==null?this.Ii:[this.pe],arrText:this.ye!==null?this.ye:[this.Fn],maxLineWidth:this.pe,fontHeight:this.uo}}get choices(){return this.Kd}set choices(t){const e=this.Kd;e!==t&&(this.Kd=t,this.t("choices",e,t))}static fE=new RegExp("[ \u200B\xAD]");static lC=new PropertyCollection;static vD=0;static ek=new PropertyCollection;static nC=0;static $0="...";static TD="";static us=null;static M0=!1;static nk=!1}class TextBlockTemplateSettings{me;gs;go;uy;gy;_0;ly;hy;Z0;ny;ey;zl;al;Q0;cy;fy;constructor(){this.me=!1,this.gs=null,this.go=0,this.uy=0,this.gy=1/0,this._0=0,this.ly=0,this.hy=0,this.Z0="start",this.ny=null,this.ey=null,this.zl=null,this.al=Spot.Top,this.Q0=2,this.cy="0px",this.fy="0px"}copy(){const t=new TextBlockTemplateSettings;return t.gs=this.gs,t.go=this.go,t.uy=this.uy,t.gy=this.gy,t._0=this._0,t.ly=this.ly,t.hy=this.hy,t.Z0=this.Z0,t.ny=this.ny,t.ey=this.ey,t.zl=this.zl,t.al=this.al,t.Q0=this.Q0,t.cy=this.cy,t.fy=this.fy,t}}class GradElementSettings{vf;Ff;Rf;iy;Of;constructor(){this.vf=1,this.Ff=0,this.Rf=1,this.iy=null,this.Of=null}copy(){const t=new GradElementSettings;return t.vf=this.vf,t.Ff=this.Ff,t.Rf=this.Rf,t.iy=this.iy,t.Of=this.Of,t}}var ImageStretch=(w=>(w[w.None=0]="None",w[w.Fill=2]="Fill",w[w.Uniform=6]="Uniform",w[w.UniformToFill=7]="UniformToFill",w))(ImageStretch||{});class Picture extends GraphObject{hl;en;cl;If;gs;fl;Ef;go;Uf;Vf;U1;constructor(t,e){super(),this.n|=2097152,this.hl=null,this.en="",this.cl=Rect.YF,this.If=2,this.gs=null,this.fl=null,this.Ef=Spot.Center,this.go=0,this.Uf=null,this.Vf=null,this.U1=null,typeof t=="string"?this.source=t:t&&Object.assign(this,t),e&&Object.assign(this,e)}cloneProtected(t){super.cloneProtected(t),t.en=this.en,t.element=this.hl,t.cl=this.cl.N(),t.If=this.If,t.go=this.go,t.gs=this.gs,t.fl=this.fl,t.Ef=this.Ef.N(),t.Vf=this.Vf}fe(t){t in ImageStretch?this.imageStretch=t:super.fe(t)}toString(){return"Picture("+this.source+")#"+GSet.xs(this)}get Bf(){return(this.n&1048576)!==0}set Bf(t){this.Bf!==t&&(this.n=this.n^1048576)}get my(){return(this.n&2097152)!==0}set my(t){this.my!==t&&(this.n=this.n^2097152)}get Sn(){return(this.n&4194304)!==0}set Sn(t){this.Sn!==t&&(this.n=this.n^4194304)}static clearCache(t){t===void 0&&(t=""),U.s(t,"string",Picture,"clearCache:url"),t!==""?Picture.yy[t]&&(delete Picture.yy[t],Picture.rk--):(Picture.yy=new PropertyCollection,Picture.rk=0)}static NT(t,e){e.FD||(e.lk=i=>{Picture.uE(e,i),t.desiredSize.isReal()||(t.xi(!1),t.f())},e.ak=i=>Picture.dE(e,i),e.addEventListener("load",e.lk),e.addEventListener("error",e.ak),e.FD=!0)}static vO(t){t.lk&&t.removeEventListener("load",t.lk),t.ak&&t.removeEventListener("error",t.ak),delete t.lk,delete t.ak,t.FD=!1}get element(){return this.hl}set element(t){const e=this.hl;if(this.Ji(!0),e!==t){const i=Diagram.isUsingDOM();let s=!1;i&&(this.Bf=t instanceof HTMLCanvasElement,s=t instanceof HTMLImageElement,t!==null&&!(s||t instanceof HTMLVideoElement||this.Bf)&&U.o("Picture.element must be an instance of Image, Canvas, or Video, not: "+t));const n=this.diagram;n!==null&&n.O2(this),this.hl=t,t!==null&&s&&t.hs===void 0&&(t.hs=new GSet),n!==null&&s&&n.R2(this),this.t("element",e,t),this.C()}}TO(){const t=this.hl;if(t===null)return;const e=this.desiredSize.isReal();(this.Bf||t.complete===!0)&&(t.Dp&&(t.wy instanceof Event&&this.gs!==null?this.gs(this,t.wy):t.Sn===!0&&!t.wy&&this.fl!==null&&t.aC&&this.fl(this,t.aC)),t.Sn=!0),t.Sn&&e&&this.diagram!==null&&this.diagram.od.add(this)}gE(){if(this.hl===null){this.Uf=!1;return}const t=new CanvasSurface(null)._t;try{t.drawImage(this.hl,0,0)}catch{this.my=!1}try{t.getImageData(0,0,1,1).data[3]&&(this.Uf=!1),this.Uf=!1}catch{this.Uf=!0}}get source(){return this.en}set source(t){const e=this.en;if(e!==t){this.Ji(!0),U.s(t,"string",Picture,"source"),this.en=t;let i=Picture.yy,s=null;if(i[t]!==void 0)s=i[t];else if(t!==""){Picture.rk>30&&(Picture.clearCache(),i=Picture.yy),s=U.Ni("img"),s.Dp=!0,Picture.NT(this,s);const n=this.Vf;n!==null&&(s.crossOrigin=n(this)),s.src=t,i[t]=s,Picture.rk++}this.element=s,s!==null&&s.__goCache===void 0&&(s.__goCache=new PictureCacheArray),this.f(),this.C(),this.t("source",e,t)}}static uE(t,e){t.Sn=!0,t.wy=!1;let i;const s=t.hs.copy();if(s==null)return;const n=s.iterator;for(;n.next();){const o=n.value;o.C();const r=t.getAttribute("src")||"",l=o.oa.get(r);if(l===null)continue;const a=l.length;for(let h=0;h<a;h++)i=l[h],i.desiredSize.isReal()||o.od.add(i),i.Ji(!0),o.requestUpdate(),t.Dp&&(t.aC===void 0&&(t.aC=e),i.fl!==null&&i.fl(i,e))}t.hs.clear()}static dE(t,e){t.wy=e;let i;const s=t.hs.copy();if(s==null)return;const n=s.iterator;for(;n.next();){const o=n.value,r=t.getAttribute("src")||"",l=o.oa.get(r);if(l===null)continue;const a=l.length,h=U.nt();for(let c=0;c<a;c++)h.push(l[c]);if(t.Dp)for(let c=0;c<a;c++)i=h[c],i.gs!==null&&i.gs(i,e);U.Z(h)}t.hs.clear()}reloadSource(){if(this.source==="")return;Picture.clearCache(this.source);const t=this.source;this.source="",this.source=t}redraw(){this.C(),this.Ji(!0)}get sourceCrossOrigin(){return this.Vf}set sourceCrossOrigin(t){if(this.Vf!==t){t!==null&&U.S(t,Picture,"sourceCrossOrigin"),this.Vf=t;const i=this.element;if(i!==null){const s=i.getAttribute("src");i.crossOrigin!==void 0&&(t===null&&typeof s=="string"?i.crossOrigin=null:t!==null&&(i.crossOrigin=t(this)),s&&(i.src=s))}}}get sourceRect(){return this.cl}set sourceRect(t){const e=this.cl;e.equals(t)||(t=t.N(),this.cl=t,this.f(),this.t("sourceRect",e,t))}get imageStretch(){return this.If}set imageStretch(t){const e=this.If;e!==t&&(this.If=t,this.C(),this.t("imageStretch",e,t))}get flip(){return this.go}set flip(t){const e=this.go;e!==t&&(this.go=t,this.C(),this.t("flip",e,t))}get imageAlignment(){return this.Ef}set imageAlignment(t){const e=this.Ef;e.equals(t)||(t=t.N(),this.Ef=t,this.C(),this.t("imageAlignment",e,t))}get errorFunction(){return this.gs}set errorFunction(t){const e=this.gs;e!==t&&(t!==null&&U.S(t,Picture,"errorFunction"),this.gs=t,this.t("errorFunction",e,t))}get successFunction(){return this.fl}set successFunction(t){const e=this.fl;e!==t&&(t!==null&&U.S(t,Picture,"successFunction"),this.fl=t,this.t("successFunction",e,t))}Ma(t,e){const i=this.hl;if(i===null)return;const s=i.getAttribute("src"),n=Diagram.isUsingDOM();if(n&&i instanceof HTMLImageElement&&(s===null||s==="")||i.wy instanceof Event&&t instanceof CanvasSurfaceContext)return;const o=t instanceof SVGContext,r=this.naturalBounds;let l=0,a=0;const h=this.Bf;let c=h?+i.width:i.naturalWidth,f=h?+i.height:i.naturalHeight;if(c===void 0&&i.videoWidth&&(c=i.videoWidth),f===void 0&&i.videoHeight&&(f=i.videoHeight),n){if(c===0||f===0)return}else c=this.width,f=this.height;const u=c,d=f;this.sourceRect.isReal()&&(l=this.cl.x,a=this.cl.y,c=this.cl.width,f=this.cl.height);let m=c,g=f;const p=this.If,y=this.Ef;switch(p){case 0:if(this.sourceRect.isReal())break;m>=r.width&&(l=l+y.offsetX+(m*y.x-r.width*y.x)),g>=r.height&&(a=a+y.offsetY+(g*y.y-r.height*y.y)),c=Math.min(r.width,m),f=Math.min(r.height,g);break;case 2:m=r.width,g=r.height;break;case 6:case 7:let D=0;p===6?(D=Math.min(r.height/g,r.width/m),m*=D,g*=D):p===7&&(D=Math.max(r.height/g,r.width/m),m*=D,g*=D,m>=r.width&&(l=(l+y.offsetX+(m*y.x-r.width*y.x)/m)*c),g>=r.height&&(a=(a+y.offsetY+(g*y.y-r.height*y.y)/g)*f),c*=1/(m/r.width),f*=1/(g/r.height),m=r.width,g=r.height);break}const x=c*f,b=this.getDocumentScale()*e.scale,k=m*b,P=g*b,S=k*P,L=x/S,C=i.__goCache;let M=null;const N=Picture.mE;if(!o){if(i.Sn&&C!==void 0&&u<8e3&&d<8e3&&S>4&&L>N*N){C.Bt===null&&(C.RD(4,u,d,i),C.RD(16,u,d,i));const D=C.Bt,v=D.length;for(let R=0;R<v&&D[R].qd*D[R].qd<L;R++)M=D[R]}if(!e.nd&&(this.Uf===null&&this.gE(),this.Uf))return}const A=m<r.width?y.offsetX+(r.width*y.x-m*y.x):0,T=g<r.height?y.offsetY+(r.height*y.y-g*y.y):0;switch(this.flip){case 0:break;case 2:t.translate(Math.min(r.width,m),0),t.scale(-1,1);break;case 1:t.translate(0,Math.min(r.height,g)),t.scale(1,-1);break;case 3:t.translate(Math.min(r.width,m),Math.min(r.height,g)),t.scale(-1,-1);break}if(t.commitTransform(),e.getRenderingHint("pictureRatioOptimization")&&!e.ph&&C!==void 0&&M!==null&&M.qd!==1){t.save();const D=M.qd;try{t.drawImage(M.en,l/D,a/D,Math.min(M.en.width,c/D),Math.min(M.en.height,f/D),A,T,Math.min(r.width,m),Math.min(r.height,g)),t instanceof SVGContext&&(this.U1=[l/D,a/D,Math.min(M.en.width,c/D),Math.min(M.en.height,f/D),A,T,Math.min(r.width,m),Math.min(r.height,g)])}catch{this.my=!1}t.restore()}else try{t.drawImage(i,l,a,c,f,A,T,Math.min(r.width,m),Math.min(r.height,g)),t instanceof SVGContext&&(this.U1=[l,a,c,f,A,T,Math.min(r.width,m),Math.min(r.height,g)])}catch{this.my=!1}switch(this.flip){case 0:break;case 2:t.scale(-1,1),t.translate(-Math.min(r.width,m),0);break;case 1:t.scale(1,-1),t.translate(0,-Math.min(r.height,g));break;case 3:t.scale(-1,-1),t.translate(-Math.min(r.width,m),-Math.min(r.height,g));break}}get naturalBounds(){return this.Ke}bd(t,e,i,s){const n=this.desiredSize,o=this.Zs(!0),r=this.hl,l=this.Bf;let a=0,h=0;(l||!this.Sn&&r&&r.complete)&&(this.Sn=!0),r===null?(isFinite(n.width)||(t=i),isFinite(n.height)||(e=s)):(a=l?+r.width:r.naturalWidth,h=l?+r.height:r.naturalHeight),!isFinite(n.width)&&o!==2&&o!==5?r!==null&&this.Sn!==!1&&(this.sourceRect.isReal()?t=this.sourceRect.width:t=a):(isFinite(t)||(this.sourceRect.isReal()?t=this.sourceRect.width:r!==null&&(t=a)),i=0),!isFinite(n.height)&&o!==2&&o!==4?r!==null&&this.Sn!==!1&&(this.sourceRect.isReal()?e=this.sourceRect.height:e=h):(isFinite(e)||(this.sourceRect.isReal()?e=this.sourceRect.height:r!==null&&(e=h)),s=0),isFinite(n.width)&&(t=n.width),isFinite(n.height)&&(e=n.height);const c=this.maxSize,f=this.minSize;i=Math.max(i||0,f.width),s=Math.max(s||0,f.height),t=Math.min(c.width,t),e=Math.min(c.height,e),t=Math.max(i,t),e=Math.max(s,e),r!==null&&!r.complete&&(isFinite(t)||(t=0),isFinite(e)||(e=0)),this.Ke.Hn(t,e),this.ro(0,0,t,e)}Pa(t,e,i,s){this.commonArrange(t,e,i,s)}static yy=new PropertyCollection;static rk=0;static mE=4}class PictureCacheArray{Bt;constructor(){this.Bt=null}RD(t,e,i,s){this.Bt===null&&(this.Bt=[]);const n=new CanvasSurface(null),o=n._t,r=1/t;if(n.width=e/t,n.height=i/t,n.width===0||n.height===0)return;const l=new PictureCacheInstance(n.bt,t);let a=s,h=1;if(this.Bt.length>0){const c=this.Bt[this.Bt.length-1];a=c.en,h=c.qd}o.setTransform(r*h,0,0,r*h,0,0),o.commitTransform(),o.drawImage(a,0,0),this.Bt.push(l)}}class PictureCacheInstance{en;qd;constructor(t,e){this.en=t,this.qd=e}}class GeoStream{Ne;um;constructor(){this.um=new Geometry,this.Ne=null}Ue(t){t!==null?(this.um=t,t.figures.clear()):this.um=new Geometry,this.Ne=null}Lu(t,e,i,s,n,o){if(s!==void 0&&s===!0){const r=new PathSegment(1);r.endX=t,r.endY=e,this.Ne.segments.add(r)}else this.Ne=new PathFigure,this.Ne.startX=t,this.Ne.startY=e,this.Ne.isFilled=i,this.Ne.isEvenOdd=o||!1,this.um.figures.add(this.Ne);n!==void 0&&(this.Ne.isShadowed=n)}tR(){const t=this.Ne.segments.length;t>0&&this.Ne.segments.elt(t-1).close()}eR(){this.Ne.segments.length>0&&(this.Ne.isFilled=!0)}iR(t){this.Ne.isShadowed=t}zU(t){this.Ne.isEvenOdd=t}ZF(t,e,i){i===void 0&&(i=!1);const s=new PathSegment(1);s.endX=t,s.endY=e,i&&s.close(),this.Ne.segments.add(s)}Ys(t,e,i){i===void 0&&(i=!1);const s=new PathSegment(2);s.endX=t,s.endY=e,i&&s.close(),this.Ne.segments.add(s)}wr(t,e,i,s,n,o,r){r===void 0&&(r=!1);const l=new PathSegment(3);l.point1X=t,l.point1Y=e,l.point2X=i,l.point2Y=s,l.endX=n,l.endY=o,r&&l.close(),this.Ne.segments.add(l)}Au(t,e,i,s,n){n===void 0&&(n=!1);const o=new PathSegment(4);o.point1X=t,o.point1Y=e,o.endX=i,o.endY=s,n&&o.close(),this.Ne.segments.add(o)}QF(t,e,i,s,n,o,r){o===void 0&&(o=0),r===void 0&&(r=!1);const l=new PathSegment(5);l.startAngle=t,l.sweepAngle=e,l.centerX=i,l.centerY=s,l.radiusX=n,o!==0?l.radiusY=o:l.radiusY=n,r&&l.close(),this.Ne.segments.add(l)}_F(t,e,i,s,n,o,r,l){l===void 0&&(l=!1);const a=new PathSegment(6,o,r,t,e,i,s,n);l&&a.close(),this.Ne.segments.add(a)}static hC=null;static JL(t){const e=GeoStream.hC;if(e!==null)return GeoStream.hC=null,e.Ue(t),e;{const i=new GeoStream;return i.Ue(t),i}}static $L(t){GeoStream.hC=t}}{const w=function(n,o){const r=n.toLowerCase(),l=G.Wn;l[n]=o,l[r]=n};w("Rectangle",(n,o,r)=>{const l="r"+o+","+r;let a=G.pr[l];return a!==void 0||(a=new Geometry(2),a.endX=o,a.endY=r,G.yr<G.am&&(G.pr[l]=a,G.yr++)),a}),w("Square",(n,o,r)=>{const l="s"+o+","+r;let a=G.pr[l];return a!==void 0||(a=new Geometry(2),a.endX=o,a.endY=r,a.defaultStretch=6,G.yr<G.am&&(G.pr[l]=a,G.yr++)),a});const t=(n,o,r,l,a)=>{(isNaN(l)||l<0)&&(l=5),isNaN(a)&&(a=15);const h="rr"+o+","+r+","+l+","+a;let c=G.pr[h];if(c!==void 0)return c;let f=l;(a&1)===1?(f=Math.min(f,(a&2)===2?o/3:o),f=Math.min(f,(a&8)===8?r/3:r)):f=0;const u=new PathFigure(f,0,!0);c=new Geometry().add(u);const d=Spot.TopLeft.copy(),m=Spot.BottomRight.copy();if((a&2)===2){let g=l;g=Math.min(g,(a&1)===1?o/3:o),g=Math.min(g,(a&4)===4?r/3:r);const p=g*G.qn;u.add(new PathSegment(2,o-g,0)).add(new PathSegment(3,o,g,o-p,0,o,p)),d.offsetY=p,m.offsetX=-p}else u.add(new PathSegment(2,o,0));if((a&4)===4){let g=l;g=Math.min(g,(a&8)===8?o/3:o),g=Math.min(g,(a&2)===2?r/3:r);const p=g*G.qn;u.add(new PathSegment(2,o,r-g)).add(new PathSegment(3,o-g,r,o,r-p,o-p,r)),m.offsetX=-p,m.offsetY=-p}else u.add(new PathSegment(2,o,r));if((a&8)===8){let g=l;g=Math.min(g,(a&4)===4?o/3:o),g=Math.min(g,(a&1)===1?r/3:r);const p=g*G.qn;u.add(new PathSegment(2,g,r)).add(new PathSegment(3,0,r-g,p,r,0,r-p)),d.offsetX=p,m.offsetY=-p}else u.add(new PathSegment(2,0,r));if((a&1)===1){const g=f*G.qn;u.add(new PathSegment(2,0,f)).add(new PathSegment(3,f,0,0,g,g,0).close()),d.offsetX=g,d.offsetY=g}else u.add(new PathSegment(2,0,0).close());return c.spot1=d,c.spot2=m,G.yr<G.am&&(G.pr[h]=c,G.yr++),c};w("RoundedRectangle",(n,o,r)=>{const l=n?n.parameter1:NaN,a=n?n.parameter2:NaN;return t(n,o,r,l,a)}),w("Border","RoundedRectangle"),w("RoundedTopRectangle",(n,o,r)=>{const l=n?n.parameter1:NaN;return t(n,o,r,l,3)}),w("RoundedBottomRectangle",(n,o,r)=>{const l=n?n.parameter1:NaN;return t(n,o,r,l,12)}),w("RoundedLeftRectangle",(n,o,r)=>{const l=n?n.parameter1:NaN;return t(n,o,r,l,9)}),w("RoundedRightRectangle",(n,o,r)=>{const l=n?n.parameter1:NaN;return t(n,o,r,l,6)}),w("Ellipse",(n,o,r)=>{const l="e"+o+","+r;let a=G.pr[l];return a!==void 0||(a=new Geometry(3),a.endX=o,a.endY=r,a.spot1=Spot.vP,a.spot2=Spot.FP,G.yr<G.am&&(G.pr[l]=a,G.yr++)),a}),w("Circle",(n,o,r)=>{const l="c"+o+","+r;let a=G.pr[l];return a!==void 0||(a=new Geometry(3),a.endX=o,a.endY=r,a.spot1=Spot.vP,a.spot2=Spot.FP,a.defaultStretch=6,G.yr<G.am&&(G.pr[l]=a,G.yr++)),a}),w("TriangleRight",(n,o,r)=>new Geometry().add(new PathFigure(0,0).add(new PathSegment(2,o,.5*r)).add(new PathSegment(2,0,r).close())).setSpots(0,.25,.5,.75)),w("TriangleDown",(n,o,r)=>new Geometry().add(new PathFigure(0,0).add(new PathSegment(2,o,0)).add(new PathSegment(2,.5*o,r).close())).setSpots(.25,0,.75,.5)),w("TriangleLeft",(n,o,r)=>new Geometry().add(new PathFigure(o,r).add(new PathSegment(2,0,.5*r)).add(new PathSegment(2,o,0).close())).setSpots(.5,.25,1,.75)),w("TriangleUp",(n,o,r)=>new Geometry().add(new PathFigure(o,r).add(new PathSegment(2,0,r)).add(new PathSegment(2,.5*o,0).close())).setSpots(.25,.5,.75,1)),w("Triangle","TriangleUp"),w("Diamond",(n,o,r)=>new Geometry().add(new PathFigure(.5*o,0).add(new PathSegment(2,0,.5*r)).add(new PathSegment(2,.5*o,r)).add(new PathSegment(2,o,.5*r).close())).setSpots(.25,.25,.75,.75)),w("LineH",(n,o,r)=>{const l=new Geometry(1);return l.startX=0,l.startY=r/2,l.endX=o,l.endY=r/2,l}),w("LineV",(n,o,r)=>{const l=new Geometry(1);return l.startX=o/2,l.startY=0,l.endX=o/2,l.endY=r,l}),w("None","Rectangle"),w("BarH","Rectangle"),w("BarV","Rectangle"),w("MinusLine","LineH"),w("PlusLine",(n,o,r)=>new Geometry().add(new PathFigure(0,r/2,!1).add(new PathSegment(2,o,r/2)).add(new PathSegment(1,o/2,0)).add(new PathSegment(2,o/2,r)))),w("XLine",(n,o,r)=>new Geometry().add(new PathFigure(0,r,!1).add(new PathSegment(2,o,0)).add(new PathSegment(1,0,0)).add(new PathSegment(2,o,r)))),w("LineRight",(n,o,r)=>new Geometry().add(new PathFigure(.25*o,0,!1).add(new PathSegment(2,.75*o,.5*r)).add(new PathSegment(2,.25*o,r)))),w("LineDown",(n,o,r)=>new Geometry().add(new PathFigure(0,.25*r,!1).add(new PathSegment(2,.5*o,.75*r)).add(new PathSegment(2,o,.25*r)))),w("LineLeft",(n,o,r)=>new Geometry().add(new PathFigure(.75*o,0,!1).add(new PathSegment(2,.25*o,.5*r)).add(new PathSegment(2,.75*o,r)))),w("LineUp",(n,o,r)=>new Geometry().add(new PathFigure(0,.75*r,!1).add(new PathSegment(2,.5*o,.25*r)).add(new PathSegment(2,o,.75*r)))),w("Capsule",(n,o,r)=>{const l=new Geometry;if(o<r){const a=o/2,h=new PathFigure(0,a,!0);l.add(h),h.add(new PathSegment(5,180,180,a,a,a,a)),h.add(new PathSegment(2,o,r-a)),h.add(new PathSegment(5,0,180,a,r-a,a,a)),h.add(new PathSegment(2,0,a));const c=isFinite(n.parameter1)?n.parameter1:o*.156;return l.setSpots(0,0,1,1,0,c,0,-c),l}else if(o>r){const a=r/2,h=new PathFigure(a,0,!0);l.add(h),h.add(new PathSegment(2,o-a,0)),h.add(new PathSegment(5,270,180,o-a,a,a,a)),h.add(new PathSegment(2,a,r)),h.add(new PathSegment(5,90,180,a,a,a,a));const c=isFinite(n.parameter1)?n.parameter1:r*.156;return l.setSpots(0,0,1,1,c,0,-c,0),l}else return l.type=3,l.endX=o,l.endY=r,l.spot1=Spot.vP,l.spot2=Spot.FP,l});const e=(n,o)=>new PathFigure(n,o,!1,!1),i=(n,o,r)=>n.add(new PathSegment(2,o,r)),s=(n,o,r)=>n.add(new PathSegment(1,o,r));w("Borders",(n,o,r)=>{let l=n?n.parameter1:NaN;isNaN(l)?l=10:l=l&15;const a=new Geometry;let h;return l===10?(h=e(o,0),i(h,o,r),s(h,0,r),i(h,0,0)):l===5?(h=e(0,0),i(h,o,0),s(h,o,r),i(h,0,r)):l===1?(h=e(0,0),i(h,o,0),s(h,o,r)):l===2?(h=e(o,0),i(h,o,r)):l===4?(h=e(o,r),i(h,0,r)):l===8?(h=e(0,r),i(h,0,0),s(h,o,r)):l===3?(h=e(0,0),i(h,o,0),i(h,o,r)):l===6?(h=e(o,0),i(h,o,r),i(h,0,r)):l===12?(h=e(o,r),i(h,0,r),i(h,0,0)):l===9?(h=e(0,r),i(h,0,0),i(h,o,0)):l===7?(h=e(0,0),i(h,o,0),i(h,o,r),i(h,0,r)):l===14?(h=e(o,0),i(h,o,r),i(h,0,r),i(h,0,0)):l===13?(h=e(o,r),i(h,0,r),i(h,0,0),i(h,o,0)):l===11?(h=e(0,r),i(h,0,0),i(h,o,0),i(h,o,r)):l===15?(h=e(0,0),i(h,o,0),i(h,o,r),i(h,0,r),h.add(new PathSegment(2,0,0).close())):(h=e(0,0),s(h,o,r)),a.add(h),a})}G.lm={"":"",Standard:"F1 m 0,0 l 8,4 -8,4 2,-4 z",Backward:"F1 m 8,0 l -2,4 2,4 -8,-4 z",Triangle:"F1 m 0,0 l 8,4.62 -8,4.62 z",BackwardTriangle:"F1 m 8,4 l 0,4 -8,-4 8,-4 0,4 z",Boomerang:"F1 m 0,0 l 8,4 -8,4 4,-4 -4,-4 z",BackwardBoomerang:"F1 m 8,0 l -8,4 8,4 -4,-4 4,-4 z",SidewaysV:"m 0,0 l 8,4 -8,4 0,-1 6,-3 -6,-3 0,-1 z",BackwardV:"m 8,0 l -8,4 8,4 0,-1 -6,-3 6,-3 0,-1 z",OpenTriangle:"m 0,0 l 8,4 -8,4",BackwardOpenTriangle:"m 8,0 l -8,4 8,4",OpenTriangleLine:"m 0,0 l 8,4 -8,4 m 8.5,0 l 0,-8",BackwardOpenTriangleLine:"m 8,0 l  -8,4 8,4 m -8.5,0 l 0,-8",OpenTriangleTop:"m 0,0 l 8,4 m 0,4",BackwardOpenTriangleTop:"m 8,0 l -8,4 m 0,4",OpenTriangleBottom:"m 0,8 l 8,-4",BackwardOpenTriangleBottom:"m 0,4 l 8,4",HalfTriangleTop:"F1 m 0,0 l 0,4 8,0 z m 0,8",BackwardHalfTriangleTop:"F1 m 8,0 l 0,4 -8,0 z m 0,8",HalfTriangleBottom:"F1 m 0,4 l 0,4 8,-4 z",BackwardHalfTriangleBottom:"F1 m 8,4 l 0,4 -8,-4 z",ForwardSemiCircle:"m 4,0 b 270 180 0 4 4",BackwardSemiCircle:"m 4,8 b 90 180 0 -4 4",Feather:"m 0,0 l 3,4 -3,4",BackwardFeather:"m 3,0 l -3,4 3,4",DoubleFeathers:"m 0,0 l 3,4 -3,4 m 3,-8 l 3,4 -3,4",BackwardDoubleFeathers:"m 3,0 l -3,4 3,4 m 3,-8 l -3,4 3,4",TripleFeathers:"m 0,0 l 3,4 -3,4 m 3,-8 l 3,4 -3,4 m 3,-8 l 3,4 -3,4",BackwardTripleFeathers:"m 3,0 l -3,4 3,4 m 3,-8 l -3,4 3,4 m 3,-8 l -3,4 3,4",ForwardSlash:"m 0,8 l 5,-8",BackSlash:"m 0,0 l 5,8",DoubleForwardSlash:"m 0,8 l 4,-8 m -2,8 l 4,-8",DoubleBackSlash:"m 0,0 l 4,8 m -2,-8 l 4,8",TripleForwardSlash:"m 0,8 l 4,-8 m -2,8 l 4,-8 m -2,8 l 4,-8",TripleBackSlash:"m 0,0 l 4,8 m -2,-8 l 4,8 m -2,-8 l 4,8",Fork:"m 0,4 l 8,0 m -8,0 l 8,-4 m -8,4 l 8,4",BackwardFork:"m 8,4 l -8,0 m 8,0 l -8,-4 m 8,4 l -8,4",LineFork:"m 0,0 l 0,8 m 0,-4 l 8,0 m -8,0 l 8,-4 m -8,4 l 8,4",BackwardLineFork:"m 8,4 l -8,0 m 8,0 l -8,-4 m 8,4 l -8,4 m 8,-8 l 0,8",CircleFork:"F1 m 6,4 b 0 360 -3 0 3 z m 0,0 l 6,0 m -6,0 l 6,-4 m -6,4 l 6,4",BackwardCircleFork:"F1 m 0,4 l 6,0 m -6,-4 l 6,4 m -6,4 l 6,-4 m 6,0 b 0 360 -3 0 3",CircleLineFork:"F1 m 6,4 b 0 360 -3 0 3 z m 1,-4 l 0,8 m 0,-4 l 6,0 m -6,0 l 6,-4 m -6,4 l 6,4",BackwardCircleLineFork:"F1 m 0,4 l 6,0 m -6,-4 l 6,4 m -6,4 l 6,-4 m 0,-4 l 0,8 m 7,-4 b 0 360 -3 0 3",Circle:"F1 m 8,4 b 0 360 -4 0 4 z",Block:"F1 m 0,0 l 0,8 8,0 0,-8 z",StretchedDiamond:"F1 m 0,3 l 5,-3 5,3 -5,3 -5,-3 z",Diamond:"F1 m 0,4 l 4,-4 4,4 -4,4 -4,-4 z",Chevron:"F1 m 0,0 l 5,0 3,4 -3,4 -5,0 3,-4 -3,-4 z",StretchedChevron:"F1 m 0,0 l 8,0 3,4 -3,4 -8,0 3,-4 -3,-4 z",NormalArrow:"F1 m 0,2 l 4,0 0,-2 4,4 -4,4 0,-2 -4,0 z",X:"m 0,0 l 8,8 m 0,-8 l -8,8",TailedNormalArrow:"F1 m 0,0 l 2,0 1,2 3,0 0,-2 2,4 -2,4 0,-2 -3,0 -1,2 -2,0 1,-4 -1,-4 z",DoubleTriangle:"F1 m 0,0 l 4,4 -4,4 0,-8 z  m 4,0 l 4,4 -4,4 0,-8 z",BigEndArrow:"F1 m 0,0 l 5,2 0,-2 3,4 -3,4 0,-2 -5,2 0,-8 z",ConcaveTailArrow:"F1 m 0,2 h 4 v -2 l 4,4 -4,4 v -2 h -4 l 2,-2 -2,-2 z",RoundedTriangle:"F1 m 0,1 a 1,1 0 0 1 1,-1 l 7,3 a 0.5,1 0 0 1 0,2 l -7,3 a 1,1 0 0 1 -1,-1 l 0,-6 z",SimpleArrow:"F1 m 1,2 l -1,-2 2,0 1,2 -1,2 -2,0 1,-2 5,0 0,-2 2,2 -2,2 0,-2 z",AccelerationArrow:"F1 m 0,0 l 0,8 0.2,0 0,-8 -0.2,0 z m 2,0 l 0,8 1,0 0,-8 -1,0 z m 3,0 l 2,0 2,4 -2,4 -2,0 0,-8 z",BoxArrow:"F1 m 0,0 l 4,0 0,2 2,0 0,-2 2,4 -2,4 0,-2 -2,0 0,2 -4,0 0,-8 z",TriangleLine:"F1 m 8,4 l -8,-4 0,8 8,-4 z m 0.5,4 l 0,-8",CircleEndedArrow:"F1 m 10,4 l -2,-3 0,2 -2,0 0,2 2,0 0,2 2,-3 z m -4,0 b 0 360 -3 0 3 z",DynamicWidthArrow:"F1 m 0,3 l 2,0 2,-1 2,-2 2,4 -2,4 -2,-2 -2,-1 -2,0 0,-2 z",EquilibriumArrow:"m 0,3 l 8,0 -3,-3 m 3,5 l -8,0 3,3",FastForward:"F1 m 0,0 l 3.5,4 0,-4 3.5,4 0,-4 1,0 0,8 -1,0 0,-4 -3.5,4 0,-4 -3.5,4 0,-8 z",Kite:"F1 m 0,4 l 2,-4 6,4 -6,4 -2,-4 z",HalfArrowTop:"F1 m 0,0 l 4,4 4,0 -8,-4 z m 0,8",HalfArrowBottom:"F1 m 0,8 l 4,-4 4,0 -8,4 z",OpposingDirectionDoubleArrow:"F1 m 0,4 l 2,-4 0,2 4,0 0,-2 2,4 -2,4 0,-2 -4,0 0,2 -2,-4 z",PartialDoubleTriangle:"F1 m 0,0 4,3 0,-3 4,4 -4,4 0,-3 -4,3 0,-8 z",LineCircle:"F1 m 0,0 l 0,8 m 7 -4 b 0 360 -3 0 3 z",DoubleLineCircle:"F1 m 0,0 l 0,8 m 2,-8 l 0,8 m 7 -4 b 0 360 -3 0 3 z",TripleLineCircle:"F1 m 0,0 l 0,8 m 2,-8 l 0,8 m 2,-8 l 0,8 m 7 -4 b 0 360 -3 0 3 z",CircleLine:"F1 m 6 4 b 0 360 -3 0 3 z m 1,-4 l 0,8",DiamondCircle:"F1 m 8,4 l -4,4 -4,-4 4,-4 4,4 m 8,0 b 0 360 -4 0 4 z",PlusCircle:"F1 m 8,4 b 0 360 -4 0 4 l -8 0 z m -4 -4 l 0 8",OpenRightTriangleTop:"m 8,0 l 0,4 -8,0 m 0,4",OpenRightTriangleBottom:"m 8,8 l 0,-4 -8,0",Line:"m 0,0 l 0,8",DoubleLine:"m 0,0 l 0,8 m 2,0 l 0,-8",TripleLine:"m 0,0 l 0,8 m 2,0 l 0,-8 m 2,0 l 0,8",PentagonArrow:"F1 m 8,4 l -4,-4 -4,0 0,8 4,0 4,-4 z"};var LayoutConditions=(w=>(w[w.None=0]="None",w[w.Added=1]="Added",w[w.Removed=2]="Removed",w[w.Shown=4]="Shown",w[w.Hidden=8]="Hidden",w[w.NodeSized=16]="NodeSized",w[w.GroupLayout=32]="GroupLayout",w[w.NodeReplaced=64]="NodeReplaced",w[w.Standard=127]="Standard",w[w.All=16777215]="All",w))(LayoutConditions||{});class Part extends Panel{b;Qo;H;ul;dl;_o;ue;gl;Da;sn;tr;jd;VM;OD;xy;ky;constructor(t,e){let i;t===void 0||t instanceof PanelLayout||typeof t=="string"?i=t:t&&(e=t),super(i),this.b=2408959,this.Qo="",this.H=null,this.ul="",this.dl=null,this._o=null,this.ue="",this.gl=null,this.Da=null,this.sn=new Point(NaN,NaN).k(),this.tr=null,this.jd=NaN,this.VM=-1,this.OD=new Rect,this.xy=null,this.ky=NaN,e&&Object.assign(this,e)}cloneProtected(t){super.cloneProtected(t),t.b=this.b&-4097|16384|32768,t.Qo=this.Qo,this.H!==null&&(this.H.me?t.H=this.H:t.H=this.H.copy()),t.ul=this.ul,t._o=null,t.ue=this.ue,t.sn.h(this.sn),t.jd=this.jd}Ho(t){super.Ho(t),t.Sa(),t.dl=null,t.tr=null,t.xy=null}toString(){let t=U.Kn(this.constructor)+"#"+GSet.xs(this);return this.data!==null&&(t+="("+U.toString(this.data)+")"),t}static LayoutNone=0;static LayoutAdded=1;static LayoutRemoved=2;static LayoutShown=4;static LayoutHidden=8;static LayoutNodeSized=16;static LayoutGroupLayout=32;static LayoutNodeReplaced=64;static LayoutStandard=127;static LayoutAll=16777215;_e(){return this.H===null?this.H=new PartTemplateSettings:this.H.me&&(this.H=this.H.copy()),this.H}ba(){super.ba(),this.H!==null&&(this.H.me=!0)}df(t,e,i,s,n,o,r){const l=this.diagram;l!==null&&(t===3&&e==="elements"?n instanceof Panel?n.Pn(a=>{l.partManager.C2(a,l)}):n instanceof Picture&&l.R2(n):t===4&&e==="elements"&&(n instanceof Panel?n.Pn(a=>l.partManager.L2(a,l)):n instanceof Picture&&l.O2(n)),l.raiseChangedEvent(t,e,i,s,n,o,r))}updateTargetBindings(t){if(super.updateTargetBindings(t),this.data===null)return;const e=this.D.r,i=e.length;for(let n=0;n<i;n++){const o=e[n];o instanceof Panel&&o.Pn(r=>{r.data!==null&&r.JI(t)})}const s=this.adornments;for(;s.next();)s.value.updateTargetBindings(t)}Go(){if(super.Go(),this.ON()){const e=this.D.r,i=e.length;for(let s=0;s<i;s++){const n=e[s];n instanceof Panel&&n.Pn(o=>o.Go())}}const t=this.adornments;for(;t.next();)t.value.Go()}updateRelationshipsFromData(){this.data!==null&&this.diagram?.partManager.updateRelationshipsFromData(this)}get key(){const t=this.diagram;if(t!==null)return t.model.getKeyForNodeData(this.data)}get adornments(){return this._o===null?EmptyIterator.instance:this._o.iteratorValues}findAdornment(t){const e=this._o;return e===null?null:e.get(t)}addAdornment(t,e){if(e===null)return;let i=null,s=this._o;if(s!==null&&(i=s.get(t)),i!==e){if(i!==null){const o=i.diagram;o!==null&&o.remove(i)}s===null&&(s=new GMap,this._o=s),e.Qo!==t&&(e.category=t),s.set(t,e);const n=this.diagram;if(n!==null){n.add(e);const o=e.adornedObject;if(o!==null){const r=o.findBindingPanel();r!==null&&(e.data=r.data)}}}}removeAdornment(t){const e=this._o;if(e===null)return;const i=e.get(t);if(i!==null){const s=i.diagram;s!==null&&(s.remove(i),i.data=null)}e.delete(t),e.count===0&&(this._o=null)}clearAdornments(){const t=this._o;if(t===null)return;const e=U.nt(),i=t.iterator;for(;i.next();){const n=i.key;e.push(n)}const s=e.length;for(let n=0;n<s;n++)this.removeAdornment(e[n]);U.Z(e)}updateAdornments(){const t=this.diagram;if(t===null)return;this.pE(t),this.yE(t);let e=this.adornments;for(;e.next();){const i=e.value;i.f(),i.hasPlaceholder()&&i.placeholder.f()}for(e=this.adornments;e.next();)e.value.updateTargetBindings()}invalidateAdornments(){const t=this.diagram;t!==null&&(t.ha(),this.ID()!==!0&&this.ED(!0))}BM(){this.ID()!==!1&&(this.updateAdornments(),this.ED(!1))}pE(t){const e="Selection";if(this.isSelected&&this.selectionAdorned){const i=this.selectionObject;if(i!==null&&this.actualBounds.isReal()&&this.isVisible()&&i.isVisibleObject()&&i.actualBounds.isReal()){let s=this.findAdornment(e);if(s===null){let n=this.selectionAdornmentTemplate;n===null&&(this.Lr()?n=t.linkSelectionAdornmentTemplate:this instanceof Group?n=t.groupSelectionAdornmentTemplate:n=t.nodeSelectionAdornmentTemplate),s=n.copy(),s!==null&&(this.Lr()&&this.selectionObject===this.path&&(s.type=Panel.Link),s.adornedObject=i)}if(s!==null){s.type===Panel.Link&&s.f(),this.addAdornment(e,s);return}}}this.removeAdornment(e)}yE(t){const e=this;t.toolManager.mouseDownTools.each(i=>{i.isEnabled&&i.updateAdornments(e)}),t.toolManager.updateAdornments(e)}EM(t){this.gl=t,t===null&&this.dI()}get layer(){return this.gl}get diagram(){const t=this.gl;return t==null?null:t.diagram}get layerName(){return this.ul}set layerName(t){const e=this.ul;if(e===t)return;let i=this.diagram;if(i!==null&&(i.findLayer(t)===null||i.partManager.addsToTemporaryLayer))return;this.ul=t,i!==null&&i.invalidateDocumentBounds(),this.t("layerName",e,t);const s=this.layer;if(s===null||s.name===t||(i=s.diagram,i===null))return;const n=i.findLayer(t);if(n===null||n===s)return;let o=s.ri(-1,this,!0);o>=0&&i.raiseChangedEvent(4,"parts",s,this,null,o,!0),o=n.ch(99999999,this,!0),s.visible!==n.visible&&this.Xe(n.visible),o>=0&&i.raiseChangedEvent(3,"parts",n,null,this,!0,o);const r=this.layerChanged;if(r===null)return;const l=i.G;i.G=!0,r(this,s,n),i.G=l}get layerChanged(){return this.H!==null?this.H.Py:null}set layerChanged(t){const e=this.layerChanged;e!==t&&(t!==null&&U.S(t,Part,"layerChanged"),this._e().Py=t,this.t("layerChanged",e,t))}get zOrder(){return this.jd}set zOrder(t){const e=this.jd;if(e===t)return;this.jd=t;const i=this.layer;i!==null&&i.rb(-1,this),this.t("zOrder",e,t);const s=this.diagram;s!==null&&s.C()}wE(){const t=this.layer;t!==null&&t.rb(-1,this)}hk(){if(this.fa()!==!1)return;this.cC(!0),this.pf();const t=this.diagram;t!==null&&(t.Cp(this),t.requestUpdate())}UD(){if(this.b|=2097152,this.fa()===!1)return;const t=this.position,e=this.location;(!e.isReal()||!t.isReal())&&this.VD(t,e);const i=this.De,s=Rect.l().h(i);i.ce(),i.x=t.x,i.y=t.y,i.k(),this.kd(s,i),Rect.i(s),this.cC(!1),this.pf()}ro(t,e,i,s){const n=this.hi;n.e(t,e,i,s),this.Se===null&&(this.Se=new Transform);const o=this.Se;o.Ue(),this.Kp(o,t,e,i,s),this.Se=o,o.RP()||o.sm(n)}Kp(t,e,i,s,n){if(this.it!==1&&t.it(this.it),this.Xt===0)return;let o=Spot.Center;this.locationSpot.isSpot()&&(o=this.locationSpot);const r=Point.l();if(this.locationObject!==this){const l=this.locationObject,a=l.naturalBounds;r.setSpot(a.x,a.y,a.width,a.height,o),l.Se!==null&&l.Se.gt(r),r.offset(-l.measuredBounds.x,-l.measuredBounds.y);let h=l.panel;for(;h!==null&&h!==this;)h.Se!==null&&h.Se.gt(r),r.offset(-h.measuredBounds.x,-h.measuredBounds.y),h=h.panel}else r.setSpot(e,i,s,n,o);t.ks(this.Xt,r.x,r.y),Point.i(r)}get locationObject(){if(this.tr===null)if(this instanceof Adornment&&this.type!==Panel.Link&&this.hasPlaceholder())this.tr=this.placeholder;else{const t=this.locationObjectName;if(t!==""){const e=this.findObject(t);e!==null?this.tr=e:this.tr=this}else this.tr=this}return this.tr?.visible?this.tr:this}get minLocation(){return this.H!==null?this.H.Sy:Point.FL}set minLocation(t){const e=this.minLocation;e.equals(t)||(t=t.N(),this._e().Sy=t,this.t("minLocation",e,t))}get maxLocation(){return this.H!==null?this.H.My:Point.RL}set maxLocation(t){const e=this.maxLocation;e.equals(t)||(t=t.N(),this._e().My=t,this.t("maxLocation",e,t))}get locationObjectName(){return this.H!==null?this.H.Ny:""}set locationObjectName(t){const e=this.locationObjectName;e!==t&&(this._e().Ny=t,this.tr=null,this.f(),this.t("locationObjectName",e,t))}get locationSpot(){return this.H!==null?this.H.Cy:Spot.TopLeft}set locationSpot(t){const e=this.locationSpot;e.equals(t)||(t=t.N(),this._e().Cy=t,this.f(),this.t("locationSpot",e,t))}move(t,e){e===!0?this.location=t:this.position=t}moveTo(t,e,i){const s=Point.z(t,e);this.move(s,i),Point.i(s)}isVisible(){if(!this.visible)return!1;const t=this.layer;if(t!==null){if(!t.visible)return!1;const i=t.diagram;if(i!==null&&i.animationManager.Wx(this))return!0}const e=this.containingGroup;return!(e!==null&&(!e.isSubGraphExpanded||!e.isVisible()))}Xe(t){const e=this.diagram;t?(this.invalidateLayout(4),this.invalidateAdornments(),e!==null&&e.Cp(this)):(this.invalidateLayout(8),this.clearAdornments()),this.Sa(),e!==null&&(e.invalidateDocumentBounds(),this instanceof Node&&this.canAvoid()&&e.fd(this),e.C())}findObject(t){if(this.name===t)return this;let e=this.xy;if(e===null&&(this.xy=e=new GMap),e.get(t)!==null)return e.get(t);const i=super.findObject(t);return i!==null?(e.set(t,i),i):(e.set(t,null),null)}s0(){this.xy=null}getRelativePoint(t,e,i){i===void 0&&(i=new Point);const s=e.isNoSpot()?Spot.Center:e,n=t.naturalBounds;if(i.e(n.width*s.x+s.offsetX,n.height*s.y+s.offsetY),t===null||t===this)return i;t.v.gt(i);let o=t.panel;for(;o!==null&&o!==this;)o.v.gt(i),o=o.panel;return this.Se!==null&&this.Se.gt(i),i.offset(-this.hi.x,-this.hi.y),i}getDocumentBounds(t){return t===void 0&&(t=new Rect),t.h(this.actualBounds)}ensureBounds(){this.ht(1/0,1/0),this.Ut()}uD(t){const e=this.locationSpot,i=this.locationObject;let s=i.naturalBounds;s.isReal()||(s=Rect.em);const n=i instanceof Shape?i.strokeWidth:0;if(t.setSpot(0,0,s.width+n,s.height+n,e),i!==this){t.offset(-n/2,-n/2),i.v.gt(t);let o=i.panel;for(;o!==null&&o!==this;)o.v.gt(t),o=o.panel}return this.Se!==null&&this.Se.gt(t),t.offset(-this.hi.x,-this.hi.y),t}hh(t,e){const i=e===void 0?this.OD:e,s=this.xE(),n=s*2;if(!this.isShadowed)return i.e(t.x-1-s,t.y-1-s,t.width+2+n,t.height+2+n),i;let o=t.x,r=t.y,l=t.width,a=t.height;const h=this.shadowBlur,c=this.shadowOffset;return l+=h,a+=h,o-=h/2,r-=h/2,c.x>0?l+=c.x:(o+=c.x,l-=c.x),c.y>0?a+=c.y:(r+=c.y,a-=c.y),i.e(o-1,r-1,l+2,a+2),i}eE(){return this.type===Panel.Link&&this instanceof Adornment&&this.category==="Selection"&&this.adornedObject instanceof Shape&&this.adornedPart.findMainElement()===this.adornedObject?this.adornedObject.strokeWidth:0}xE(){return isNaN(this.ky)&&(this.ky=this.xD()),this.ky}Tf(){this.ky=NaN}Ut(){if(this.as()===!1){this.UD();return}this.lo(!1);const t=this.De,e=Rect.l();e.h(t);const i=this.Ul();this.Pa(0,0,this.hi.width,this.hi.height);const s=this.position;this.VD(s,this.location),t.ce(),t.x=s.x,t.y=s.y,t.k(),this.kd(e,t),e.equals(t)?this.rs(i):this.Di()&&(!G.c(e.width,t.width)||!G.c(e.height,t.height))&&this.VM>=0&&this.invalidateLayout(16),Rect.i(e),this.cC(!1)}kd(t,e){const i=this.diagram;if(i===null)return;let s=!1;if(i.mh===!1&&t.isReal()){const n=Rect.l();n.h(i.documentBounds),n.subtractMargin(i.padding),t.x>n.x&&t.y>n.y&&t.right<n.right&&t.bottom<n.bottom&&e.x>n.x&&e.y>n.y&&e.right<n.right&&e.bottom<n.bottom&&(s=!0),Rect.i(n)}(this.bE()===!0||!t.equals(e))&&this.mT(s,i),i.C(),!(!t.isReal()&&!e.isReal()||t.equalsApproxClose(e))&&(this instanceof Node&&!i.undoManager.isUndoingRedoing&&this.invalidateConnectedLinks(),this.Sa())}get location(){return this.sn}set location(t){const e=t.x,i=t.y,s=this.sn;(s.x!==e&&(!isNaN(s.x)||!isNaN(e))||s.y!==i&&(!isNaN(s.y)||!isNaN(i)))&&(t=t.copy(),this.kE(t,s)&&this.t("location",s,t.copy()))}kE(t,e){if(this.Lr())return!1;if(this.sn=t,this.b|=2097152,this.as()===!1){this.hk();const i=this.ct;if(i.isReal()){const s=this.diagram;if(s===null||s.animationManager.isTicking||!s.undoManager.isUndoingRedoing){const n=i.copy();i.e(i.x+(t.x-e.x),i.y+(t.y-e.y)),this.BD(s,i,n.x,n.y),this.t("position",n,i.copy())}}}return!0}vN(t,e,i){if(this.Lr()||!t.isReal())return!1;const s=this.diagram;if(s!==null&&this.BD(s,t,e,i),this.ct=t,this.b&=-2097153,this.sn.isReal()&&(s===null||s.animationManager.isTicking||!s.undoManager.isUndoingRedoing)){const n=this.sn;this.sn=new Point(n.x+(t.x-e),n.y+(t.y-i)).k(),this.t("location",n,this.sn.copy())}return this.fa()===!1&&this.as()===!1&&(this.hk(),this.UD()),!0}BD(t,e,i,s){if(t===null||this instanceof Adornment)return;const n=t.animationManager;n.ke&&n.RA(this,new Point(i,s),e,!1)}Ec(t,e,i){const s=this.sn,n=this.ct;if(i){if(s.x===t&&s.y===e)return;this.fa()||this.as()?n.e(NaN,NaN):n.e(n.x+t-s.x,n.y+e-s.y),s.e(t,e)}else{if(n.x===t&&n.y===e)return;s.e(s.x+t-n.x,s.y+e-n.y),n.e(t,e)}this.hk()}FN(){this.b&=-2097153,this.hk()}VD(t,e){const i=this.uD(Point.l()),s=this.diagram,n=e.isReal(),o=t.isReal();n&&o?(this.b&2097152)!==0?this.zD(t,e,s,i):this.XD(t,e,s,i):n?this.zD(t,e,s,i):o&&this.XD(t,e,s,i),this.b|=2097152,Point.i(i),this.pf()}zD(t,e,i,s){const n=t.x,o=t.y;if(t.e(e.x-s.x,e.y-s.y),i!==null){const r=i.animationManager,l=r.defaultAnimation.isAnimating;!l&&r.ke&&!(this instanceof Adornment)&&r.RA(this,new Point(n,o),t,!1),!l&&!(t.x===n&&t.y===o)&&this.t("position",new Point(n,o),t.copy())}}XD(t,e,i,s){const n=e.copy();e.e(t.x+s.x,t.y+s.y),!e.equals(n)&&i!==null&&this.t("location",n,e.copy())}mT(t,e){this.CN(!1),this instanceof Node&&e.fd(this),!this.layer.isTemporary&&!t&&e.invalidateDocumentBounds();const i=this.De,s=e.viewportBounds;s.isReal()?this.Ul()?(i.BL(s,10)||this.rs(!1),this.updateAdornments()):this.isVisible()&&i.intersectsRect(s)?(this.rs(!0),this.updateAdornments()):this.invalidateAdornments():e._c=!0}Qr(){return!0}Di(){return!0}Lr(){return!1}Qs(){return!0}hasPlaceholder(){return!1}get category(){return this.Qo}set category(t){const e=this.Qo;if(e===t)return;this.svg!==null&&(this.svg.remove(),this.Ji(!0));const i=this.diagram,s=this.data;let n=null;if(i!==null&&s!==null&&!(this instanceof Adornment)){const o=i.model.undoManager;o.isEnabled&&!o.isUndoingRedoing&&(n=this.clone(),n.D.addAll(this.D))}if(this.Qo=t,this.t("category",e,t),i!==null&&s!==null&&!(this instanceof Adornment)){const o=i.model;if(o.undoManager.isUndoingRedoing)return;if(this.Lr()){i.partManager.setLinkCategoryForData(s,t);const r=i.partManager.findLinkTemplateForCategory(t);if(r!==null){r.It();const l=r.copy();l!==null&&this.fC(l,e,t)}}else{o!==null&&o.setCategoryForNodeData(s,t);const r=i.partManager.findTemplateForNodeData(s,t);if(r!==null){r.It();const l=r.copy();if(l!==null&&!(l instanceof Link)){const a=this.location.copy();this.fC(l,e,t),this.location.isReal()||(this.location=a)}}}if(n!==null){const r=this.clone();r.D.addAll(this.D),this.t("self",n,r)}}else if(this instanceof Adornment){const o=this.adornedPart;if(o!==null){const r=o._o;r!==null&&r.delete(e),o.addAdornment(this.category,this)}}}get self(){return this}set self(t){this.fC(t,this.category,t.category)}static GD=!1;fC(t,e,i){t.constructor!==this.constructor&&(Part.GD||(Part.GD=!0,U.ne('Should not change the class of the Part when changing category from "'+e+'" to "'+i+'"'),U.ne("  Old class: "+U.Kn(this.constructor)+", new class: "+U.Kn(t.constructor)+", part: "+this.toString()))),this.clearAdornments();const s=this.data,n=this.layerName,o=this.isSelected,r=this.isHighlighted;let l=!0,a=!0,h=!1;this instanceof Node&&(l=this.isTreeLeaf,a=this.isTreeExpanded,h=this.wasTreeExpanded),t.Ho(this),t.cloneProtected(this),this.Qo=i,this.svg!==null&&(this.svg.remove(),this.jc(),this.Ji(!0)),this.f(),this.C();const c=this.diagram;let f=!0;c!==null&&(f=c.skipsUndoManager,c.skipsUndoManager=!0),this.te=s,this.b=o?this.b|4096:this.b&-4097,this.b=r?this.b|524288:this.b&-524289,this instanceof Node&&(this.E=l?this.E|4:this.E&-5,this.E=a?this.E|1:this.E&-2,this.E=h?this.E|2:this.E&-3),s!==null&&this.updateTargetBindings();const u=this.layerName;u!==n&&(this.ul=n,this.layerName=u),c!==null&&(c.skipsUndoManager=f),this.Di()&&this.invalidateLayout(64)}canCopy(){if(!this.copyable)return!1;const t=this.layer;if(t===null)return!0;if(!t.allowCopy)return!1;const e=t.diagram;return e===null?!0:!!e.allowCopy}canDelete(){if(!this.deletable)return!1;const t=this.layer;if(t===null)return!0;if(!t.allowDelete)return!1;const e=t.diagram;return e===null?!0:!!e.allowDelete}canEdit(){if(!this.textEditable)return!1;const t=this.layer;if(t===null)return!0;if(!t.allowTextEdit)return!1;const e=t.diagram;return e===null?!0:!!e.allowTextEdit}canGroup(){if(!this.groupable)return!1;const t=this.layer;if(t===null)return!0;if(!t.allowGroup)return!1;const e=t.diagram;return e===null?!0:!!e.allowGroup}canMove(){if(!this.movable)return!1;const t=this.layer;if(t===null)return!0;if(!t.allowMove)return!1;const e=t.diagram;return e===null?!0:!!e.allowMove}canReshape(){if(!this.reshapable)return!1;const t=this.layer;if(t===null)return!0;if(!t.allowReshape)return!1;const e=t.diagram;return e===null?!0:!!e.allowReshape}canResize(){if(!this.resizable)return!1;const t=this.layer;if(t===null)return!0;if(!t.allowResize)return!1;const e=t.diagram;return e===null?!0:!!e.allowResize}canRotate(){if(!this.rotatable)return!1;const t=this.layer;if(t===null)return!0;if(!t.allowRotate)return!1;const e=t.diagram;return e===null?!0:!!e.allowRotate}canSelect(){if(!this.selectable)return!1;const t=this.layer;if(t===null)return!0;if(!t.allowSelect)return!1;const e=t.diagram;return e===null?!0:!!e.allowSelect}get copyable(){return(this.b&1)!==0}set copyable(t){const e=(this.b&1)!==0;e!==t&&(this.b=this.b^1,this.t("copyable",e,t))}get deletable(){return(this.b&2)!==0}set deletable(t){const e=(this.b&2)!==0;e!==t&&(this.b=this.b^2,this.t("deletable",e,t))}get textEditable(){return(this.b&4)!==0}set textEditable(t){const e=(this.b&4)!==0;e!==t&&(this.b=this.b^4,this.t("textEditable",e,t),this.invalidateAdornments())}get groupable(){return(this.b&8)!==0}set groupable(t){const e=(this.b&8)!==0;e!==t&&(this.b=this.b^8,this.t("groupable",e,t))}get movable(){return(this.b&16)!==0}set movable(t){const e=(this.b&16)!==0;e!==t&&(this.b=this.b^16,this.t("movable",e,t))}get selectionAdorned(){return(this.b&32)!==0}set selectionAdorned(t){const e=(this.b&32)!==0;e!==t&&(this.b=this.b^32,this.t("selectionAdorned",e,t),this.invalidateAdornments())}get isInDocumentBounds(){return(this.b&64)!==0}set isInDocumentBounds(t){const e=(this.b&64)!==0;if(e!==t){this.b=this.b^64;const i=this.diagram;i!==null&&i.invalidateDocumentBounds(),this.t("isInDocumentBounds",e,t)}}get isLayoutPositioned(){return(this.b&128)!==0}set isLayoutPositioned(t){const e=(this.b&128)!==0;e!==t&&(this.b=this.b^128,this.t("isLayoutPositioned",e,t),this.invalidateLayout(t?4:8))}get selectable(){return(this.b&256)!==0}set selectable(t){const e=(this.b&256)!==0;e!==t&&(this.b=this.b^256,this.t("selectable",e,t),this.invalidateAdornments())}get reshapable(){return(this.b&512)!==0}set reshapable(t){const e=(this.b&512)!==0;e!==t&&(this.b=this.b^512,this.t("reshapable",e,t),this.invalidateAdornments())}get resizable(){return(this.b&1024)!==0}set resizable(t){const e=(this.b&1024)!==0;e!==t&&(this.b=this.b^1024,this.t("resizable",e,t),this.invalidateAdornments())}get rotatable(){return(this.b&2048)!==0}set rotatable(t){const e=(this.b&2048)!==0;e!==t&&(this.b=this.b^2048,this.t("rotatable",e,t),this.invalidateAdornments())}get isSelected(){return(this.b&4096)!==0}set isSelected(t){const e=(this.b&4096)!==0;if(e!==t){const i=this.diagram;if(t){if(!this.canSelect())return;if(i!==null){const o=i.maxSelectionCount;if(i.selection.count>=o)return}}this.b=this.b^4096;let s=!1;if(i!==null){s=i.skipsUndoManager,i.skipsUndoManager=!0;const o=i.selection;o.ce(),t?o.add(this):o.delete(this),o.k()}this.t("isSelected",e,t),this.invalidateAdornments();const n=this.selectionChanged;n!==null&&n(this),i!==null&&(i.requestUpdate(),i.skipsUndoManager=s)}}get isHighlighted(){return(this.b&524288)!==0}set isHighlighted(t){const e=(this.b&524288)!==0;if(e!==t){this.b=this.b^524288;const i=this.diagram;if(i!==null){const n=i.highlighteds;n.ce(),t?n.add(this):n.delete(this),n.k()}this.t("isHighlighted",e,t),this.C();const s=this.highlightedChanged;s!==null&&s(this)}}get isShadowed(){return(this.b&8192)!==0}set isShadowed(t){const e=(this.b&8192)!==0;e!==t&&(this.b=this.b^8192,this.Ji(!0),this.t("isShadowed",e,t),this.C())}ID(){return(this.b&16384)!==0}ED(t){t?this.b|=16384:this.b&=-16385}fa(){return(this.b&32768)!==0}cC(t){t?this.b|=32768:this.b&=-32769}bE(){return(this.b&65536)!==0}CN(t){t?this.b|=65536:this.b&=-65537}Ul(){return(this.b&131072)!==0}rs(t){t?this.b|=131072:this.b&=-131073}YD(){return(this.b&1048576)!==0}ck(t){t?this.b|=1048576:this.b&=-1048577}get isAnimated(){return(this.b&262144)!==0}set isAnimated(t){const e=(this.b&262144)!==0;e!==t&&(this.b=this.b^262144,this.t("isAnimated",e,t))}get highlightedChanged(){return this.H!==null?this.H.Ly:null}set highlightedChanged(t){const e=this.highlightedChanged;e!==t&&(t!==null&&U.S(t,Part,"highlightedChanged"),this._e().Ly=t,this.t("highlightedChanged",e,t))}get selectionObjectName(){return this.H!==null?this.H.Ay:""}set selectionObjectName(t){const e=this.selectionObjectName;e!==t&&(this._e().Ay=t,this.dl=null,this.t("selectionObjectName",e,t))}get selectionAdornmentTemplate(){return this.H!==null?this.H.Ty:null}set selectionAdornmentTemplate(t){const e=this.selectionAdornmentTemplate;e!==t&&(t!==null&&t.It(),this._e().Ty=t,this.t("selectionAdornmentTemplate",e,t))}get selectionObject(){if(this.dl===null){const t=this.selectionObjectName;if(t!==null&&t!==""){const e=this.findObject(t);e!==null?this.dl=e:this.dl=this}else if(this instanceof Link){const e=this.path;e!==null?this.dl=e:this.dl=this}else this.dl=this}return this.dl}get selectionChanged(){return this.H!==null?this.H.Dy:null}set selectionChanged(t){const e=this.selectionChanged;e!==t&&(t!==null&&U.S(t,Part,"selectionChanged"),this._e().Dy=t,this.t("selectionChanged",e,t))}get resizeAdornmentTemplate(){return this.H!==null?this.H.vy:null}set resizeAdornmentTemplate(t){const e=this.resizeAdornmentTemplate;e!==t&&(this._e().vy=t!==null?t.It():null,this.t("resizeAdornmentTemplate",e,t))}get resizeObjectName(){return this.H!==null?this.H.Fy:""}set resizeObjectName(t){const e=this.resizeObjectName;e!==t&&(this._e().Fy=t,this.t("resizeObjectName",e,t))}get resizeObject(){const t=this.resizeObjectName;if(t!==""){const e=this.findObject(t);if(e!==null)return e}return this}get resizeCellSize(){return this.H!==null?this.H.Ry:Size.Zw}set resizeCellSize(t){const e=this.resizeCellSize;e.equals(t)||(t=t.N(),this._e().Ry=t,this.t("resizeCellSize",e,t))}get rotateAdornmentTemplate(){return this.H!==null?this.H.Oy:null}set rotateAdornmentTemplate(t){const e=this.rotateAdornmentTemplate;e!==t&&(this._e().Oy=t!==null?t.It():null,this.t("rotateAdornmentTemplate",e,t))}get rotateObjectName(){return this.H!==null?this.H.Iy:""}set rotateObjectName(t){const e=this.rotateObjectName;e!==t&&(this._e().Iy=t,this.t("rotateObjectName",e,t))}get rotateObject(){const t=this.rotateObjectName;if(t!==""){const e=this.findObject(t);if(e!==null)return e}return this}get rotationSpot(){return this.H!==null?this.H.Ey:Spot.Default}set rotationSpot(t){const e=this.rotationSpot;e.equals(t)||(t=t.N(),this._e().Ey=t,this.t("rotationSpot",e,t))}get text(){return this.ue}set text(t){const e=this.ue;e!==t&&(this.ue=t,this.t("text",e,t))}get containingGroup(){return this.Da}set containingGroup(t){if(this.Di()){const e=this.Da;if(e!==t){t!==null&&(this===t||t.isMemberOf(this))&&(this===t&&U.o("Cannot make a Group a member of itself: "+this.toString()),U.o("Cannot make a Group indirectly contain itself: "+this.toString()+" already contains "+t.toString())),this.invalidateLayout(2);const i=this.diagram;if(e!==null?e.uC(this):this instanceof Group&&i!==null&&i.$r.delete(this),this.Da=t,t!==null?t.dC(this):this instanceof Group&&i!==null&&i.$r.add(this),this.invalidateLayout(1),i!==null&&i.G){const n=this.data,o=i.model;if(n!==null&&o.ff()){const r=t!==null?t.data:null;o.setGroupForData(n,o.getKeyForNodeData(r))}}const s=this.containingGroupChanged;if(s!==null){let n=!0;i!==null&&(n=i.G,i.G=!0),s(this,e,t),i!==null&&(i.G=n)}if(this instanceof Group){const n=new GSet;Part.ga(n,this,!0,0,!0);const o=n.iterator;for(;o.next();){const r=o.value;if(r instanceof Node){const l=r.linksConnected;for(;l.next();)l.value.Wd()}}}if(this instanceof Node){const n=this.linksConnected;for(;n.next();)n.value.Wd();const o=this.labeledLink;o!==null&&o.Wd()}this.t("containingGroup",e,t),t!==null&&t.wE()}}else U.o("cannot set the Part.containingGroup of a Link or Adornment")}Sa(){const t=this.containingGroup;t!==null&&(t.hasPlaceholder()&&t.placeholder.f(),t.f(),t.invalidateConnectedLinks())}C(){const t=this.diagram;t!==null&&!this.as()&&!this.fa()&&this.isVisible()&&this.De.isReal()&&t.C(this.hh(this.De))}f(){if(this.Xo())return;super.f();const t=this.diagram;t!==null&&(t.Cp(this),this instanceof Node&&this.labeledLink!==null&&this.labeledLink.kf(),t.requestUpdate(!0))}kf(t){if(this.as())return;const e=this.diagram;e!==null&&(e.Cp(this),this instanceof Node&&this.invalidateConnectedLinks(),e.requestUpdate()),this.lo(!0)}tp(t){if(!t){const e=this.Da;e!==null&&e.dC(this)}}ep(t){if(!t){const e=this.Da;e!==null&&e.uC(this)}}rf(){const t=this.data;if(t!==null){const e=this.diagram;if(e!==null){const i=e.model;i!==null&&i.removeNodeData(t)}}}get containingGroupChanged(){return this.H!==null?this.H.Uy:null}set containingGroupChanged(t){const e=this.containingGroupChanged;e!==t&&(t!==null&&U.S(t,Part,"containingGroupChanged"),this._e().Uy=t,this.t("containingGroupChanged",e,t))}findSubGraphLevel(){return this.gC(this)}gC(t){const e=t.containingGroup;if(e!==null)return 1+this.gC(e);if(t instanceof Node){const i=t.labeledLink;if(i!==null)return this.gC(i)}return 0}findTopLevelPart(){return this.mC(this)}mC(t){const e=t.containingGroup;if(e!==null)return this.mC(e);if(t instanceof Node){const i=t.labeledLink;if(i!==null)return this.mC(i)}return t}get isTopLevel(){return!(this.containingGroup!==null||this instanceof Node&&this.labeledLink!==null)}isMemberOf(t){return t instanceof Group?this.pC(this,t):!1}pC(t,e){if(t===e||e===null)return!1;const i=t.containingGroup;if(i!==null&&(i===e||this.pC(i,e)))return!0;if(t instanceof Node){const s=t.labeledLink;if(s!==null)return this.pC(s,e)}return!1}findCommonContainingGroup(t){if(t===null)return null;if(this===t)return this.containingGroup;let e=this;for(;e!==null;){if(e instanceof Group&&e.ck(!0),e instanceof Node){const s=e.labeledLink;s!==null&&(e=s)}e=e.containingGroup}let i=null;for(e=t;e!==null;){if(e.YD()){i=e;break}if(e instanceof Node){const s=e.labeledLink;s!==null&&(e=s)}e=e.containingGroup}for(e=this;e!==null;){if(e instanceof Group&&e.ck(!1),e instanceof Node){const s=e.labeledLink;s!==null&&(e=s)}e=e.containingGroup}return i}get layoutConditions(){return this.H!==null?this.H.Vy:127}set layoutConditions(t){const e=this.layoutConditions;e!==t&&(this._e().Vy=t,this.t("layoutConditions",e,t))}canLayout(){if(!this.isLayoutPositioned||!this.isVisible())return!1;const t=this.layer;return!(t!==null&&t.isTemporary||this instanceof Node&&this.isLinkLabel)}PE(t){if(!this.isLayoutPositioned||(t&this.layoutConditions)===0)return!1;const e=this.layer;if(e!==null&&e.isTemporary||this instanceof Node&&this.isLinkLabel)return!1;const i=this.diagram;return!(i!==null&&i.undoManager.isUndoingRedoing)}invalidateLayout(t){if(t===void 0&&(t=16777215),!this.PE(t))return;const e=this.Da;if(e!==null){const i=e.layout;i!==null?i.p():e.invalidateLayout(t)}else{const i=this.diagram;if(i!==null){const s=i.layout;s!==null&&s.p()}}}pT(){if(!this.isVisible())return!1;const t=this.layer;return!(t!==null&&t.isTemporary)}static ga(t,e,i,s,n,o){if(o===void 0&&(o=null),!t.has(e)&&!(o!==null&&!o(e))&&!(e instanceof Adornment)){if(t.add(e),e instanceof Node){if(i&&e instanceof Group){const r=e.memberParts;for(;r.next();){const l=r.value;Part.ga(t,l,i,s,n,o)}}if(n!==!1){const r=e.linksConnected;for(;r.next();){const l=r.value;if(t.has(l))continue;const a=l.fromNode,h=l.toNode,c=a===null||t.has(a),f=h===null||t.has(h);(n?c&&f:c||f)&&Part.ga(t,l,i,s,n,o)}}if(s>1){const r=e.findTreeChildrenNodes();for(;r.next();){const l=r.value;Part.ga(t,l,i,s-1,n,o)}}}else if(e instanceof Link){const r=e.labelNodes;for(;r.next();){const l=r.value;Part.ga(t,l,i,s,n,o)}}}}get dragComputation(){return this.H!==null?this.H.By:null}set dragComputation(t){const e=this.dragComputation;e!==t&&(t!==null&&U.S(t,Part,"dragComputation"),this._e().By=t,this.t("dragComputation",e,t))}get shadowOffset(){return this.H!==null?this.H.zy:Point.OL}set shadowOffset(t){const e=this.shadowOffset;e.equals(t)||(t=t.N(),this._e().zy=t,this.C(),this.t("shadowOffset",e,t))}get shadowColor(){return this.H!==null?this.H.Xy:"gray"}set shadowColor(t){const e=this.shadowColor;e!==t&&(this._e().Xy=t,this.C(),this.t("shadowColor",e,t))}get shadowBlur(){return this.H!==null?this.H.Ln:4}set shadowBlur(t){const e=this.shadowBlur;e!==t&&(this._e().Ln=t,this.C(),this.t("shadowBlur",e,t))}}class PartTemplateSettings{me;Py;Uy;Ty;Ay;Dy;Ly;vy;Fy;Ry;Oy;Iy;Ey;Ny;Cy;Sy;My;By;Vy;zy;Xy;Ln;constructor(){this.me=!1,this.Py=null,this.Uy=null,this.Ty=null,this.Ay="",this.Dy=null,this.Ly=null,this.vy=null,this.Fy="",this.Ry=Size.Zw,this.Oy=null,this.Iy="",this.Ey=Spot.Default,this.Ny="",this.Cy=Spot.TopLeft,this.Sy=Point.FL,this.My=Point.RL,this.By=null,this.Vy=127,this.zy=Point.OL,this.Xy="gray",this.Ln=4}copy(){const t=new PartTemplateSettings;return t.Py=this.Py,t.Uy=this.Uy,t.Ty=this.Ty,t.Ay=this.Ay,t.Dy=this.Dy,t.Ly=this.Ly,t.vy=this.vy,t.Fy=this.Fy,t.Ry=this.Ry.N(),t.Oy=this.Oy,t.Iy=this.Iy,t.Ey=this.Ey.N(),t.Ny=this.Ny,t.Cy=this.Cy.N(),t.Sy=this.Sy.N(),t.My=this.My.N(),t.By=this.By,t.Vy=this.Vy,t.zy=this.zy.N(),t.Xy=this.Xy,t.Ln=this.Ln,t}}class Adornment extends Part{Ms;Dt;WS;JS;Lf;constructor(t,e){let i;t===void 0||t instanceof PanelLayout||typeof t=="string"?i=t:t&&(e=t),super(i),this.b&=-257,this.ul="Adornment",this.Ms=null,this.WS=0,this.JS=!1,this.Dt=null,this.Lf=null,e&&Object.assign(this,e)}toString(){const t=this.adornedPart;return"Adornment("+this.category+")"+(t!==null?t.toString():"")}updateRelationshipsFromData(){}Td(t){const e=this.adornedObject;if(!(e instanceof Shape))return;const i=e.part;if(!(i instanceof Link))return;const s=i.path;let n=s.geometry;i.Td(t),n=s.geometry;const o=this.D.r,r=o.length;for(let l=0;l<r;l++){const a=o[l];a.isPanelMain&&a instanceof Shape&&(a.ut=n)}}hasPlaceholder(){return this.Dt!==null&&this.Dt.isVisibleObject()}get placeholder(){return this.Dt}get adornedObject(){return this.Ms}set adornedObject(t){const e=this.adornedPart;let i=null;t!==null&&(i=t.part),e!==null&&(t===null||e!==i)&&e.removeAdornment(this.category),this.Ms=t,i!==null&&i.addAdornment(this.category,this)}get adornedPart(){const t=this.Ms;return t!==null?t.part:null}Qr(){const t=this.Ms;if(t===null)return!0;const e=t.part;return e===null||!e.as()}Di(){return!1}get containingGroup(){return null}df(t,e,i,s,n,o,r){if(t===3&&e==="elements"){if(n instanceof Placeholder)this.Dt===null&&(this.Dt=n);else if(n instanceof Panel){const l=n.findInVisualTree(a=>a instanceof Placeholder);l instanceof Placeholder&&this.Dt===null&&(this.Dt=l)}}else t===4&&e==="elements"&&this.Dt!==null&&(s===this.Dt?this.Dt=null:s instanceof Panel&&this.Dt.isContainedBy(s)&&(this.Dt=null));super.df(t,e,i,s,n,o,r)}updateAdornments(){}rf(){}}var PortSpreading=(w=>(w[w.None=0]="None",w[w.Evenly=1]="Evenly",w[w.Packed=2]="Packed",w))(PortSpreading||{});class Node extends Part{E;vt;zf;pl;va;ci;ee;constructor(t,e){let i;t===void 0||t instanceof PanelLayout||typeof t=="string"?i=t:t&&(e=t),super(i),this.E=13,this.vt=null,this.ee=new List,this.zf=null,this.pl=null,this.ci=null,this.va=!1,e&&Object.assign(this,e)}cloneProtected(t){super.cloneProtected(t),t.E=this.E,this.vt!==null&&(this.vt.me?t.vt=this.vt:t.vt=this.vt.copy())}Ho(t){super.Ho(t),t.invalidateConnectedLinks(),t.pl=this.pl,t.ci=null}static SpreadingNone=0;static SpreadingEvenly=1;static SpreadingPacked=2;yl(){return this.vt===null?this.vt=new NodeTemplateSettings:this.vt.me&&(this.vt=this.vt.copy()),this.vt}ba(){super.ba(),this.vt!==null&&(this.vt.me=!0)}KD(t){t!==null&&(this.pl===null&&(this.pl=new GSet),this.pl.add(t))}HD(t){t!==null&&this.pl!==null&&this.pl.delete(t)}qD(t,e,i){if(t===null||this.pl===null)return null;const s=this.pl.iterator;for(;s.next();){const n=s.value;if(n.Gy===this&&n.fk===t&&n.yC===e&&n.wC===i||n.Gy===t&&n.fk===this&&n.yC===i&&n.wC===e)return n}return null}invalidateLinkBundle(t,e,i){e==null&&(e=""),i==null&&(i="");const s=this.qD(t,e,i);s!==null&&s.Jd()}df(t,e,i,s,n,o,r){t===3&&e==="elements"?this.ci=null:t===4&&e==="elements"&&(this.ci=null),super.df(t,e,i,s,n,o,r)}invalidateConnectedLinks(t,e){const i=this.linksConnected;for(;i.next();){const s=i.value;t&&t.has(s)||e&&s.fromPort!==e&&s.toPort!==e||(this.Ze(s.fromPort),this.Ze(s.toPort),s.$t())}}Ze(t){if(t===null)return;const e=t.yd;e!==null&&e.Jd();const i=t.part,s=i.containingGroup;s!==null&&!i.isVisible()&&s.Ze(s.port)}Qr(){return!0}get portSpreading(){return this.vt!==null?this.vt.Yy:1}set portSpreading(t){const e=this.portSpreading;if(e!==t){this.yl().Yy=t,this.t("portSpreading",e,t);const i=this.diagram;if(i!==null&&i.undoManager.isUndoingRedoing)return;this.invalidateConnectedLinks()}}get avoidable(){return(this.E&8)!==0}set avoidable(t){const e=(this.E&8)!==0;if(e!==t){this.E=this.E^8;const i=this.diagram;i!==null&&i.fd(this),this.t("avoidable",e,t)}}get avoidableMargin(){return this.vt!==null?this.vt.Ky:Margin.XL}set avoidableMargin(t){typeof t=="number"&&(t=new Margin(t));const e=this.avoidableMargin;if(!e.equals(t)){t=t.N(),this.yl().Ky=t;const i=this.diagram;i!==null&&i.fd(this),this.t("avoidableMargin",e,t)}}canAvoid(){return this.avoidable&&!this.isLinkLabel}getAvoidableRect(t){return t.set(this.actualBounds),t.addMargin(this.avoidableMargin),t}findVisibleNode(){let t=this;for(;t!==null&&!t.isVisible();)t=t.containingGroup;return t}isVisible(){if(!super.isVisible())return!1;let t=!0,e=1;const i=this.diagram;if(i!==null){if(i.animationManager.Wx(this))return!0;t=i.isTreePathToChildren,e=i.treeCollapsePolicy}if(e===1){const n=this.findTreeParentNode();if(n!==null&&!n.isTreeExpanded)return!1}else if(e===2){const n=t?this.findLinksInto():this.findLinksOutOf();let o=!1,r=!1;for(;n.next();){const l=n.value;if(l.isTreeLink){o=!0;const a=t?l.fromNode:l.toNode;if(a&&a.isTreeExpanded){r=!0;break}}}if(o&&!r)return!1}else if(e===3){const n=t?this.findLinksInto():this.findLinksOutOf();let o=!1,r=!1;for(;n.next();){const l=n.value;if(l.isTreeLink){o=!0;const a=t?l.fromNode:l.toNode;if(a&&!a.isTreeExpanded){r=!0;break}}}if(o&&r)return!1}const s=this.labeledLink;return s!==null?s.isVisible():!0}Xe(t){super.Xe(t);const e=this.linksConnected;for(;e.next();){const i=e.value;if(t&&this.containingGroup!==null){const s=i.getOtherNode(this);s!==null&&!s.isMemberOf(this.containingGroup)&&i.$t()}i.Xe(t)}}get linksConnected(){return this.ee.iterator}findExternalTreeLinksConnected(){const t=new GSet,e=new GSet;return this.jD(this,t,e),e.iterator}jD(t,e,i){if(t===null||e.has(t))return;e.add(t);let s=!0;const n=this.diagram;n!==null&&(s=n.isTreePathToChildren),t.linksConnected.each(o=>{o.isTreeLink?(s?o.fromNode===t:o.toNode===t)&&this.jD(s?o.toNode:o.fromNode,e,i):i.add(o)})}findLinksConnected(t){if(t===void 0&&(t=null),t===null)return this.ee.iterator;const e=new ListIterator(this.ee),i=this;return e.predicate=s=>s.fromNode===i&&s.fromPortId===t||s.toNode===i&&s.toPortId===t,e}findLinksOutOf(t){t===void 0&&(t=null);const e=new ListIterator(this.ee),i=this;return e.predicate=s=>s.fromNode!==i?!1:t===null?!0:s.fromPortId===t,e}findLinksInto(t){t===void 0&&(t=null);const e=new ListIterator(this.ee),i=this;return e.predicate=s=>s.toNode!==i?!1:t===null?!0:s.toPortId===t,e}findNodesConnected(t){t===void 0&&(t=null);let e=null,i=null;const s=this.ee.iterator;for(;s.next();){const n=s.value;if(n.fromNode===this){if(t===null||n.fromPortId===t){const o=n.toNode;e!==null?e.add(o):i!==null&&i!==o?(e=new GSet,e.add(i),e.add(o)):i=o}}else if(n.toNode===this&&(t===null||n.toPortId===t)){const o=n.fromNode;e!==null?e.add(o):i!==null&&i!==o?(e=new GSet,e.add(i),e.add(o)):i=o}}return e!==null?e.iterator:i!==null?new SingletonIterator(i):EmptyIterator.instance}findNodesOutOf(t){t===void 0&&(t=null);let e=null,i=null;const s=this.ee.iterator;for(;s.next();){const n=s.value;if(n.fromNode===this&&(t===null||n.fromPortId===t)){const o=n.toNode;e!==null?e.add(o):i!==null&&i!==o?(e=new GSet,e.add(i),e.add(o)):i=o}}return e!==null?e.iterator:i!==null?new SingletonIterator(i):EmptyIterator.instance}findNodesInto(t){t===void 0&&(t=null);let e=null,i=null;const s=this.ee.iterator;for(;s.next();){const n=s.value;if(n.toNode===this&&(t===null||n.toPortId===t)){const o=n.fromNode;e!==null?e.add(o):i!==null&&i!==o?(e=new GSet,e.add(i),e.add(o)):i=o}}return e!==null?e.iterator:i!==null?new SingletonIterator(i):EmptyIterator.instance}findLinksBetween(t,e,i){e===void 0&&(e=null),i===void 0&&(i=null);const s=new ListIterator(this.ee),n=this;return s.predicate=o=>o.fromNode===n&&o.toNode===t&&(e===null||o.fromPortId===e)&&(i===null||o.toPortId===i)||o.fromNode===t&&o.toNode===n&&(i===null||o.fromPortId===i)&&(e===null||o.toPortId===e),s}findLinksTo(t,e,i){e===void 0&&(e=null),i===void 0&&(i=null);const s=new ListIterator(this.ee),n=this;return s.predicate=o=>!(o.fromNode!==n||o.toNode!==t||e!==null&&o.fromPortId!==e||i!==null&&o.toPortId!==i),s}findSuccessorParts(t){return t===void 0&&(t=new GSet),this.WD(this,t),t.remove(this),t}WD(t,e){t!==null&&(e.has(t)||(e.add(t),t.findLinksOutOf().each(i=>{if(e.has(i))return;e.add(i);const s=i.toNode;s!==null&&this.WD(s,e)})))}findPredecessorParts(t){return t===void 0&&(t=new GSet),this.JD(this,t),t.remove(this),t}JD(t,e){t!==null&&(e.has(t)||(e.add(t),t.findLinksInto().each(i=>{if(e.has(i))return;e.add(i);const s=i.fromNode;s!==null&&this.JD(s,e)})))}get linkConnected(){return this.vt!==null?this.vt.Hy:null}set linkConnected(t){const e=this.linkConnected;e!==t&&(t!==null&&U.S(t,Node,"linkConnected"),this.yl().Hy=t,this.t("linkConnected",e,t))}get linkDisconnected(){return this.vt!==null?this.vt.qy:null}set linkDisconnected(t){const e=this.linkDisconnected;e!==t&&(t!==null&&U.S(t,Node,"linkDisconnected"),this.yl().qy=t,this.t("linkDisconnected",e,t))}get linkValidation(){return this.vt!==null?this.vt.El:null}set linkValidation(t){const e=this.linkValidation;e!==t&&(t!==null&&U.S(t,Node,"linkValidation"),this.yl().El=t,this.t("linkValidation",e,t))}uk(t,e){this.Ze(e);const i=this.ee.has(t);if(i||this.ee.add(t),!i||t.fromNode===t.toNode){const s=this.linkConnected;if(s!==null){let n=!0;const o=this.diagram;o!==null&&(n=o.G,o.G=!0),s(this,t,e),o!==null&&(o.G=n)}}if(!i){if(!t.isTreeLink)return;const s=t.fromNode,n=t.toNode;if(s!==null&&n!==null&&s!==n){let o=!0;const r=this.diagram;r!==null&&(o=r.isTreePathToChildren);const l=o?n:s,a=o?s:n;if(l.va||(l.va=a),a.isTreeLeaf){if(r!==null&&r.undoManager.isUndoingRedoing)return;o?s===a&&(a.isTreeLeaf=!1):n===a&&(a.isTreeLeaf=!1)}}}}dk(t,e){this.Ze(e);const i=this.ee.delete(t);let s=null;if(i||t.toNode===t.fromNode){const n=this.linkDisconnected;if(s=this.diagram,n!==null){let o=!0;s!==null&&(o=s.G,s.G=!0),n(this,t,e),s!==null&&(s.G=o)}}if(i){if(!t.isTreeLink)return;let n=!0;s!==null&&(n=s.isTreePathToChildren);const o=n?t.toNode:t.fromNode,r=n?t.fromNode:t.toNode;if(o!==null&&(o.va=!1),r!==null&&!r.isTreeLeaf)if(r.ee.count===0){if(r.va=null,s!==null&&s.undoManager.isUndoingRedoing)return;r.isTreeLeaf=!0}else r.vp()}}vp(){if(this.va=!1,this.ee.count===0)return;let t=!0;const e=this.diagram;if(e!==null&&e.undoManager.isUndoingRedoing)return;e!==null&&(t=e.isTreePathToChildren);const i=this.ee.iterator;for(;i.next();){const s=i.value;if(s.isTreeLink){if(t){if(s.fromNode===this){this.isTreeLeaf=!1;return}}else if(s.toNode===this){this.isTreeLeaf=!1;return}}}this.isTreeLeaf=!0}updateRelationshipsFromData(){const t=this.diagram;t!==null&&t.partManager.updateRelationshipsFromData(this)}tp(t){if(super.tp(t),!t){this.vp();const e=this.zf;e!==null&&e.$D(this)}}ep(t){if(super.ep(t),!t){const e=this.zf;e!==null&&e.ZD(this)}}rf(){if(this.ee.count>0){const t=this.diagram;if(t!==null){const e=t.commandHandler!==null?t.commandHandler.deletesConnectedLinks:!0,s=this.ee.copy().iterator;for(;s.next();){const n=s.value;e?t.remove(n):(n.fromNode===this&&(n.fromNode=null),n.toNode===this&&(n.toNode=null))}}}this.labeledLink=null,super.rf()}get isLinkLabel(){return this.zf!==null}get labeledLink(){return this.zf}set labeledLink(t){const e=this.zf;if(e!==t){const i=this.diagram,s=this.data;if(e!==null){if(e.ZD(this),i!==null&&s!==null&&!i.undoManager.isUndoingRedoing){const n=e.data,o=i.model;if(n!==null&&o.jh()){const r=o.getKeyForNodeData(s);r!==void 0&&o.removeLabelKeyForLinkData(n,r)}}this.containingGroup=null}if(this.zf=t,t!==null){if(t.$D(this),i!==null&&s!==null&&!i.undoManager.isUndoingRedoing){const n=t.data,o=i.model;if(n!==null&&o.jh()){const r=o.getKeyForNodeData(s);r!==void 0&&o.addLabelKeyForLinkData(n,r)}}this.containingGroup=t.containingGroup}this.kf(),this.t("labeledLink",e,t)}}findVisiblePort(t){let e=t;for(;e!==null&&(!e.actualBounds.isReal()||!e.isVisibleObject());)e=e.panel;return e===null?this.port:e}findPort(t){if(this.ci===null){if(t===""&&this.Cn===!1)return this;this.QD()}let e=this.ci.get(t);return e!==null||t!==""&&(e=this.ci.get(""),e!==null)?e:this}get port(){return this.findPort("")}get ports(){return this.ci===null&&this.QD(),this.ci.iteratorValues}QD(){this.ci===null?this.ci=new GMap:this.ci.clear(),this.walkVisualTreeFrom(this,(t,e)=>t.oD(e)),this.ci.count===0&&this.ci.set("",this)}oD(t){const e=t.portId;e!==null&&this.ci!==null&&this.ci.set(e,t)}RN(t,e){const i=t.portId;if(i!==null){this.ci!==null&&this.ci.delete(i);const s=this.diagram;if(s!==null&&e){let n=null;const o=this.findLinksConnected(i);for(;o.next();){const r=o.value;n===null&&(n=U.nt()),n.push(r)}if(n!==null){for(let r=0;r<n.length;r++){const l=n[r];s.remove(l)}U.Z(n)}}}}isInTreeOf(t){if(t===null||t===this)return!1;let e=!0;const i=this.diagram;i!==null&&(e=i.isTreePathToChildren);let s=this;const n=t;let o;if(e)for(;s!==n;){o=null;const r=s.ee.iterator;for(;r.next();){const l=r.value;if(l.isTreeLink&&(o=l.fromNode,o!==s&&o!==this))break}if(o===this||o===null||o===s)return!1;s=o}else for(;s!==n;){o=null;const r=s.ee.iterator;for(;r.next();){const l=r.value;if(l.isTreeLink&&(o=l.toNode,o!==s&&o!==this))break}if(o===this||o===null||o===s)return!1;s=o}return!0}findTreeRoot(){let t=!0;const e=this.diagram;e!==null&&(t=e.isTreePathToChildren);let i=this,s;if(t)for(;;){s=null;const n=i.ee.iterator;for(;n.next();){const o=n.value;if(o.isTreeLink&&(s=o.fromNode,s!==i&&s!==this))break}if(s===this)return this;if(s===null||s===i)return i;i=s}else for(;;){s=null;const n=i.ee.iterator;for(;n.next();){const o=n.value;if(o.isTreeLink&&(s=o.toNode,s!==i&&s!==this))break}if(s===this)return this;if(s===null||s===i)return i;i=s}}findCommonTreeParent(t){if(t===null)return null;if(this===t)return this;let e=this;for(;e!==null;)e.ck(!0),e=e.findTreeParentNode();let i=null;for(e=t;e!==null;){if(e.YD()){i=e;break}e=e.findTreeParentNode()}for(e=this;e!==null;)e.ck(!1),e=e.findTreeParentNode();return i}findTreeParentLink(){let t=!0;const e=this.diagram;e!==null&&(t=e.isTreePathToChildren);const i=this.ee.iterator;if(t)for(;i.next();){const s=i.value;if(s.isTreeLink&&s.fromNode!==this)return s}else for(;i.next();){const s=i.value;if(s.isTreeLink&&s.toNode!==this)return s}return null}findTreeParentNode(){const t=this.va;if(t===null)return null;if(t instanceof Node)return t;const e=this.diagram,i=e!==null?e.isTreePathToChildren:!0,s=this.ee.iterator;for(;s.next();){const n=s.value;if(!n.isTreeLink)continue;const o=i?n.fromNode:n.toNode;if(o!==this)return this.va=o,o}return this.va=null,null}findTreeParentChain(t){function e(i,s){s.add(i);const n=i.findTreeParentLink();if(n!==null){s.add(n);const o=i.findTreeParentNode();if(o===null)return;e(o,s)}}return t===void 0&&(t=new GSet),e(this,t),t}findTreeLevel(){return this.SE(this)}SE(t){let e=0,i=t.findTreeParentNode();for(;i!==null&&i!==t;)i=i.findTreeParentNode(),e++;return e}findTreeChildrenLinks(){let t=!0;const e=this.diagram;e!==null&&(t=e.isTreePathToChildren);const i=new ListIterator(this.ee),s=this;return t?i.predicate=n=>!(!n.isTreeLink||n.fromNode!==s):i.predicate=n=>!(!n.isTreeLink||n.toNode!==s),i}findTreeChildrenNodes(){let t=!0;const e=this.diagram;e!==null&&(t=e.isTreePathToChildren);let i=null,s=null;const n=this.ee.iterator;if(t)for(;n.next();){const o=n.value;if(o.isTreeLink&&o.fromNode===this){const r=o.toNode;i!==null?i.add(r):s!==null&&s!==r?(i=new List,i.add(s),i.add(r)):s=r}}else for(;n.next();){const o=n.value;if(o.isTreeLink&&o.toNode===this){const r=o.fromNode;i!==null?i.add(r):s!==null&&s!==r?(i=new List,i.add(s),i.add(r)):s=r}}return i!==null?i.iterator:s!==null?new SingletonIterator(s):EmptyIterator.instance}findTreeParts(t,e){return t===void 0&&(t=1/0),U.s(t,"number",Node,"findTreeParts:level"),e===void 0&&(e=new GSet),Part.ga(e,this,!1,t,!0),e}collapseTree(t){t===void 0&&(t=1),t<1&&(t=1);const e=this.diagram;if(e===null||e.isCollapsingExpanding)return;e.isCollapsingExpanding=!0;const i=new GSet;i.add(this),this._D(i,e.isTreePathToChildren,t,e,this,e.treeCollapsePolicy===1),e.isCollapsingExpanding=!1}_D(t,e,i,s,n,o){if(i>1){const r=e?this.findLinksOutOf():this.findLinksInto();for(;r.next();){const l=r.value;if(!l.isTreeLink)continue;const a=l.getOtherNode(this);a!==null&&a!==this&&!t.has(a)&&(t.add(a),a._D(t,e,i-1,s,n,o))}}else this.tv(t,e,s,n,o)}tv(t,e,i,s,n){const o=s===this?!0:this.isTreeExpanded,r=e?this.findLinksOutOf():this.findLinksInto();for(;r.next();){const l=r.value;if(!l.isTreeLink)continue;const a=l.getOtherNode(this);if(a!==null&&a!==this){const h=t.has(a);if(h||t.add(a),o){const c=e?a.findNodesInto():a.findNodesOutOf(),f=this;c.all(u=>u===f||!u.isTreeExpanded)&&i.Yc(a,s),a.Sa(),a.Xe(!1)}a.isTreeExpanded&&(a.wasTreeExpanded=a.isTreeExpanded,h||a.tv(t,e,i,s,n))}}this.isTreeExpanded=!1}expandTree(t){t===void 0&&(t=2),t<2&&(t=2);const e=this.diagram;if(e===null||e.isCollapsingExpanding)return;e.isCollapsingExpanding=!0;const i=new GSet;i.add(this),this.ev(i,e.isTreePathToChildren,t,e,this,e.treeCollapsePolicy===1),e.isCollapsingExpanding=!1}ev(t,e,i,s,n,o){const r=n===this?!1:this.isTreeExpanded,l=e?this.findLinksOutOf():this.findLinksInto();for(;l.next();){const a=l.value;if(!a.isTreeLink)continue;r||a.Fi||a.$t();const h=a.getOtherNode(this);if(h!==null&&h!==this&&!t.has(h)){if(t.add(h),!r){h.Xe(!0),h.Sa();const c=e?h.findNodesInto():h.findNodesOutOf(),f=this;c.all(u=>u===f||!u.isTreeExpanded)&&s.Gc(h,n)}(i>2||h.wasTreeExpanded)&&(h.wasTreeExpanded=!1,h.ev(t,e,i-1,s,n,o))}}this.isTreeExpanded=!0}get isTreeExpanded(){return(this.E&1)!==0}set isTreeExpanded(t){const e=(this.E&1)!==0;if(e!==t){this.E=this.E^1;const i=this.diagram;this.t("isTreeExpanded",e,t);const s=this.treeExpandedChanged;if(s!==null){let n=!0;i!==null&&(n=i.G,i.G=!0),s(this),i!==null&&(i.G=n)}if(i!==null&&i.undoManager.isUndoingRedoing){this.Xe(t);return}t?this.expandTree():this.collapseTree()}}get wasTreeExpanded(){return(this.E&2)!==0}set wasTreeExpanded(t){const e=(this.E&2)!==0;e!==t&&(this.E=this.E^2,this.t("wasTreeExpanded",e,t))}get treeExpandedChanged(){return this.vt!==null?this.vt.jy:null}set treeExpandedChanged(t){const e=this.treeExpandedChanged;e!==t&&(t!==null&&U.S(t,Node,"treeExpandedChanged"),this.yl().jy=t,this.t("treeExpandedChanged",e,t))}get isTreeLeaf(){return(this.E&4)!==0}set isTreeLeaf(t){const e=(this.E&4)!==0;e!==t&&(this.E=this.E^4,this.t("isTreeLeaf",e,t))}get isTreeRoot(){return this.findTreeParentLink()===null}}class NodeTemplateSettings{me;Hy;qy;El;jy;Ky;Yy;Wy;Jy;da;$y;constructor(){this.me=!1,this.Hy=null,this.qy=null,this.El=null,this.jy=null,this.Ky=Margin.XL,this.Yy=1,this.Wy=null,this.Jy=null,this.da=null,this.$y=null}copy(){const t=new NodeTemplateSettings;return t.Hy=this.Hy,t.qy=this.qy,t.El=this.El,t.jy=this.jy,t.Ky=this.Ky.N(),t.Yy=this.Yy,t.Wy=this.Wy,t.Jy=this.Jy,t.da=this.da,t.$y=this.$y,t}}var LinkAdjusting=(w=>(w[w.None=0]="None",w[w.End=17]="End",w[w.Scale=18]="Scale",w[w.Stretch=19]="Stretch",w))(LinkAdjusting||{}),Routing=(w=>(w[w.Normal=1]="Normal",w[w.Orthogonal=2]="Orthogonal",w[w.AvoidsNodes=6]="AvoidsNodes",w[w.AvoidsNodesStraight=7]="AvoidsNodesStraight",w))(Routing||{}),Curve=(w=>(w[w.None=0]="None",w[w.Bezier=9]="Bezier",w[w.JumpGap=10]="JumpGap",w[w.JumpOver=11]="JumpOver",w))(Curve||{});class Link extends Part{Mt;mo;po;$d;yo;wo;Zd;Xf;Qd;_d;tg;Wh;eg;nn;Me;wl;Dr;xl;er;xC;bC;gk;kC;PC;Jh;mk;ut;ir;static $h=null;static Zh=null;Lf;SC;MC;constructor(t){super(Panel.Link),this.Mt=8,this.mo=null,this.po="",this.$d=null,this.yo=null,this.wo="",this.Zd=null,this.Xf=0,this.Qd=0,this._d=0,this.tg=NaN,this.Wh=1,this.eg=.5,this.nn=null,this.Me=new List().k(),this.wl=null,this.Dr=null,this.xl=new Rect,this.ut=new Geometry,this.er=null,this.ir=null,this.xC=Point.gn,this.bC=Point.gn,this.SC=0,this.MC=0,this.gk=new Point,this.kC=null,this.PC=null,this.Jh=null,this.mk=NaN,this.ft=null,this.Lf=[],t&&Object.assign(this,t)}cloneProtected(t){super.cloneProtected(t),t.Mt=this.Mt&-113,t.po=this.po,t.$d=this.$d,t.wo=this.wo,t.Zd=this.Zd,t.Xf=this.Xf,t.Qd=this.Qd,t._d=this._d,t.tg=this.tg,t.Wh=this.Wh,t.eg=this.eg,this.ft!==null&&(t.ft=this.ft.copy())}Ho(t){super.Ho(t),this.po=t.po,this.wo=t.wo,t.wl=null,t.$t(),t.ir=this.ir;const e=t.fromPort;e!==null&&t.fromNode.Ze(e);const i=t.toPort;i!==null&&t.toNode.Ze(i)}fe(t){t in Routing||t in Curve||t in LinkAdjusting?Link.NC(t)?this.routing=t:t===9||t===10||t===11?this.curve=t:t===17||t===18||t===19?this.adjusting=t:t===1||t===0||U.o("Unknown Link enum value for a Link property: "+t):super.fe(t)}static Normal=1;static Orthogonal=2;static AvoidsNodes=6;static AvoidsNodesStraight=7;static None=0;static Bezier=9;static JumpGap=10;static JumpOver=11;static End=17;static Scale=18;static Stretch=19;static OrientAlong=21;static OrientPlus90=22;static OrientMinus90=23;static OrientOpposite=24;static OrientUpright=25;static OrientPlus90Upright=26;static OrientMinus90Upright=27;static OrientUpright45=28;static iv=8;static sv=16;static Fa=8;static J1=3;static nv=3;static ov=1.333;static CC=1;static LC=0;static rv=10;static Gf=9999;static lv=30;static av=30;static AC=10;static hv=10;static cv=14;static fv=30;static uv=14;static eT=8;static iT=8;static dv=11;static setRoutingParameter(t,e){switch(t){case 1:Link.iv=e;break;case 2:Link.sv=e;break;case 3:Link.Fa=e;break;case 4:Link.J1=e;break;case 5:Link.nv=e;break;case 6:Link.ov=e;break;case 7:Link.CC=e;break;case 8:Link.LC=e;break;case 9:Link.rv=e;break;case 10:Link.Gf=e;break;case 11:Link.lv=e;break;case 12:Link.av=e;break;case 13:Link.AC=e;break;case 14:Link.hv=e;break;case 15:Link.cv=e;break;case 16:Link.fv=e;break;case 17:Link.uv=e;break;case 18:Link.eT=e;break;case 19:Link.iT=e;break;case 20:Link.dv=e;break}t>29&&t<71&&(Link.UT=t+parseInt(e.toString().slice(0,-1)))}static UT;Wi(){return this.ft===null&&(this.ft=new LinkSettings),this.ft}EI(t,e,i){const s=t.segmentIndex,n=t.segmentFraction;let o=t.alignmentFocus;const r=t.segmentOrientation,l=t.segmentOffset;let a=0,h=0,c=0,f=0;if(isNaN(s)){const C=this.ut,M=U.nt();C.getPointAndAngleAlongPath(n,M);const N=Point.z(M[0],M[1]);if(f=M[2],N.add(this.getPoint(0)),C.type===1)N.offset(-C.startX,-C.startY);else{const A=C.figures.first();N.offset(-A.startX,-A.startY)}r!==0&&(c=this.computeAngle(t,r,f),t.angle=c),a=N.x,h=N.y,Point.i(N),U.Z(M)}else if(s<-e||s>=e){const C=Point.l();this.qN(C),f=this.midAngle,r!==0&&(c=this.computeAngle(t,r,f),t.angle=c),a=C.x,h=C.y,Point.i(C)}else{let C,M,N=0;if(s>=0?(C=i.r[s],M=s<e-1?i.r[s+1]:C):(N=e+s,C=i.r[N],M=N>0?i.r[N-1]:C),C.equalsApprox(M)){let A,T;s>=0?(A=s>0?i.r[s-1]:C,T=s<e-2?i.r[s+2]:M):(A=N<e-1?i.r[N+1]:C,T=N>1?i.r[N-2]:M);const D=A.distanceSquaredPoint(C),v=M.distanceSquaredPoint(T);D>v+10?f=s>=0?A.directionPoint(C):C.directionPoint(A):v>D+10?f=s>=0?M.directionPoint(T):T.directionPoint(M):f=s>=0?A.directionPoint(T):T.directionPoint(A)}else f=s>=0?C.directionPoint(M):M.directionPoint(C);r!==0&&(c=this.computeAngle(t,r,f),t.angle=c),a=C.x+(M.x-C.x)*n,h=C.y+(M.y-C.y)*n}if(o.isNone()){t.moveTo(a,h,!0);return}else o.isNoSpot()&&(o=Spot.Center);const u=Transform.l();u.Ue(),u.it(t.scale,t.scale),u.ks(t.angle,0,0);const d=t.naturalBounds,m=Rect.z(0,0,d.width,d.height),g=Point.l();g.setRectSpot(m,o),u.gt(g);let p=-g.x,y=-g.y;const x=d.width,b=d.height,k=Point.bs(l),P=isNaN(l.x),S=isNaN(l.y);if(P||S){const C=x/2+Link.J1,M=b/2+Link.nv,N=f>=45&&f<=135,A=f>=225&&f<=315;r===0&&(N||A)?(k.x=S?C:l.y,k.y=P?M:l.x,N?s>=0||isNaN(s)&&n<.5||P&&(k.y=-M):A&&((s>=0||isNaN(s)&&n<.5)&&P&&(k.y=-M),S&&(k.x=-C))):(P&&(s>=0||isNaN(s)&&n<.5?k.x=C:k.x=-C),S&&(k.y=-M),k.rotate(f))}else k.rotate(f);a+=k.x,h+=k.y,u.sm(m),p+=m.x,y+=m.y;const L=Point.z(a+p,h+y);t.move(L),Point.i(L),Point.i(k),Point.i(g),Rect.i(m),Transform.i(u)}Qr(){let t=this.fromNode;if(t!==null){const i=t.findVisibleNode();if(i!==null&&(t=i),t.as()||t.fa())return!1}let e=this.toNode;if(e!==null){const i=e.findVisibleNode();if(i!==null&&(e=i),e.as()||e.fa())return!1}return!0}vN(t,e,i){return!1}FN(){}Di(){return!1}computeAngle(t,e,i){return Link.computeAngle(e,i)}static computeAngle(t,e){let i=0;switch(t){default:case 0:i=0;break;case 21:i=e;break;case 22:i=e+90;break;case 23:i=e-90;break;case 24:i=e+180;break;case 25:i=G.Ee(e),i>90&&i<270&&(i-=180);break;case 26:i=G.Ee(e+90),i>90&&i<270&&(i-=180);break;case 27:i=G.Ee(e-90),i>90&&i<270&&(i-=180);break;case 28:if(i=G.Ee(e),i>45&&i<135||i>225&&i<315)return 0;i>90&&i<270&&(i-=180);break}return G.Ee(i)}get fromNode(){return this.mo}set fromNode(t){const e=this.mo;if(e!==t){const i=this.fromPort;e!==null&&(this.yo!==e&&e.dk(this,i),this.Zy(),this.invalidateLayout(2)),this.mo=t,t!==null&&this.Xe(t.isVisible()),this.er=null,this.$t();const s=this.diagram;s!==null&&s.G&&s.partManager.setFromNodeForLink(this,t,e);const n=this.fromPort,o=this.fromPortChanged;if(o!==null){let r=!0;s!==null&&(r=s.G,s.G=!0),o(this,i,n),s!==null&&(s.G=r)}t!==null&&(this.yo!==t&&t.uk(this,n),this.Qy(),this.invalidateLayout(1)),this.t("fromNode",e,t),this.Wd()}}get fromPortId(){return this.po}set fromPortId(t){const e=this.po;if(e!==t){const i=this.fromPort;i!==null&&this.fromNode?.Ze(i),this.Zy(),this.po=t;const s=this.fromPort;s!==null&&this.fromNode?.Ze(s);const n=this.diagram;if(n!==null){const o=this.data,r=n.model;o!==null&&r.jh()&&r.setFromPortIdForLinkData(o,t)}if(i!==s){this.er=null,this.$t();const o=this.fromPortChanged;if(o!==null){let r=!0;n!==null&&(r=n.G,n.G=!0),o(this,i,s),n!==null&&(n.G=r)}}this.Qy(),this.t("fromPortId",e,t)}}get fromPort(){const t=this.mo;if(t===null)return null;const e=this.po;return t.findPort(e)}get fromPortChanged(){return this.$d}set fromPortChanged(t){const e=this.$d;e!==t&&(t!==null&&U.S(t,Link,"fromPortChanged"),this.$d=t,this.t("fromPortChanged",e,t))}get toNode(){return this.yo}set toNode(t){const e=this.yo;if(e!==t){const i=this.toPort;e!==null&&(this.mo!==e&&e.dk(this,i),this.Zy(),this.invalidateLayout(2)),this.yo=t,t!==null&&this.Xe(t.isVisible()),this.er=null,this.$t();const s=this.diagram;s!==null&&s.G&&s.partManager.setToNodeForLink(this,t,e);const n=this.toPort,o=this.toPortChanged;if(o!==null){let r=!0;s!==null&&(r=s.G,s.G=!0),o(this,i,n),s!==null&&(s.G=r)}t!==null&&(this.mo!==t&&t.uk(this,n),this.Qy(),this.invalidateLayout(1)),this.t("toNode",e,t),this.Wd()}}get toPortId(){return this.wo}set toPortId(t){const e=this.wo;if(e!==t){const i=this.toPort;i!==null&&this.toNode?.Ze(i),this.Zy(),this.wo=t;const s=this.toPort;s!==null&&this.toNode?.Ze(s);const n=this.diagram;if(n!==null){const o=this.data,r=n.model;o!==null&&r.jh()&&r.setToPortIdForLinkData(o,t)}if(i!==s){this.er=null,this.$t();const o=this.toPortChanged;if(o!==null){let r=!0;n!==null&&(r=n.G,n.G=!0),o(this,i,s),n!==null&&(n.G=r)}}this.Qy(),this.t("toPortId",e,t)}}get toPort(){const t=this.yo;if(t===null)return null;const e=this.wo;return t.findPort(e)}get toPortChanged(){return this.Zd}set toPortChanged(t){const e=this.Zd;e!==t&&(t!==null&&U.S(t,Link,"toPortChanged"),this.Zd=t,this.t("toPortChanged",e,t))}get fromSpot(){return this.ft!==null?this.ft.Dh:Spot.Default}set fromSpot(t){const e=this.fromSpot;if(!e.equals(t)){if(t=t.N(),this.Wi().Dh=t,this.t("fromSpot",e,t),e.isSide()||t.isSide()){const i=this.fromNode;i!==null&&i.Ze(this.fromPort)}this.$t()}}get fromEndSegmentLength(){return this.ft!==null?this.ft.Fh:NaN}set fromEndSegmentLength(t){const e=this.fromEndSegmentLength;if(e!==t){if(t<0&&U.J(t,">= 0",Link,"fromEndSegmentLength"),this.Wi().Fh=t,this.t("fromEndSegmentLength",e,t),this.computeSpot(!0,this.fromPort).isSide()){const i=this.fromNode;i!==null&&i.Ze(this.fromPort)}this.$t()}}get fromShortLength(){return this.ft!==null?this.ft.Oh:NaN}set fromShortLength(t){const e=this.fromShortLength;e!==t&&(this.Wi().Oh=t,this.ai(),this.t("fromShortLength",e,t))}get toSpot(){return this.ft!==null?this.ft.vh:Spot.Default}set toSpot(t){const e=this.toSpot;if(!e.equals(t)){if(t=t.N(),this.Wi().vh=t,this.t("toSpot",e,t),e.isSide()||t.isSide()){const i=this.toNode;i!==null&&i.Ze(this.toPort)}this.$t()}}get toEndSegmentLength(){return this.ft!==null?this.ft.Rh:NaN}set toEndSegmentLength(t){const e=this.toEndSegmentLength;if(e!==t){if(t<0&&U.J(t,">= 0",Link,"toEndSegmentLength"),this.Wi().Rh=t,this.t("toEndSegmentLength",e,t),this.computeSpot(!1,this.toPort).isSide()){const i=this.toNode;i!==null&&i.Ze(this.toPort)}this.$t()}}get toShortLength(){return this.ft!==null?this.ft.Ih:NaN}set toShortLength(t){const e=this.toShortLength;e!==t&&(this.Wi().Ih=t,this.ai(),this.t("toShortLength",e,t))}Wd(){const t=this.fromNode,e=this.toNode;let i=null;if(t!==null?e!==null?i=t.findCommonContainingGroup(e):i=t.containingGroup:e!==null?i=e.containingGroup:i=null,this.ME(i),this.isLabeledLink){const s=this.labelNodes;for(;s.next();){const n=s.value;n.containingGroup=i}}}ME(t){const e=this.Da;if(e!==t){e!==null&&e.uC(this),this.Da=t,t!==null&&t.dC(this);const i=this.containingGroupChanged;if(i!==null){let s=!0;const n=this.diagram;n!==null&&(s=n.G,n.G=!0),i(this,e,t),n!==null&&(n.G=s)}this.Fi&&(this.kC===e||this.PC===e)&&this.$t()}}Sa(){const t=this.containingGroup;t!==null&&this.fromNode!==t&&this.toNode!==t&&t.computesBoundsIncludingLinks&&super.Sa()}getOtherNode(t){const e=this.fromNode;return t===e?this.toNode:e}getOtherPort(t){const e=this.fromPort;return t===e?this.toPort:e}get isLabeledLink(){return this.nn===null?!1:this.nn.count>0}get labelNodes(){return this.nn===null?EmptyIterator.instance:this.nn.iterator}$D(t){this.nn===null&&(this.nn=new GSet),this.nn.add(t),this.f()}ZD(t){this.nn!==null&&(this.nn.delete(t),this.f())}tp(t){if(super.tp(t),this.Qh()&&this.invalidateOtherJumpOvers(this.actualBounds),!t){const e=this.mo;let i=null;e!==null&&(i=this.fromPort,e.uk(this,i));const s=this.yo;let n=null;s!==null&&(n=this.toPort,(s!==e||n!==i)&&s.uk(this,n)),this.Qy()}}ep(t){if(super.ep(t),this.Qh()&&this.invalidateOtherJumpOvers(this.actualBounds),!t){const e=this.mo;let i=null;e!==null&&(i=this.fromPort,e.dk(this,i));const s=this.yo;let n=null;s!==null&&(n=this.toPort,(s!==e||n!==i)&&s.dk(this,n)),this.Zy()}}rf(){if(this.Fi=!0,this.nn!==null){const e=this.diagram;if(e!==null){const s=this.nn.copy().iterator;for(;s.next();){const n=s.value;e.remove(n)}}}if(this.data!==null){const e=this.diagram;e!==null&&e.partManager.TC(this)}}updateRelationshipsFromData(){if(this.data===null)return;const e=this.diagram;e!==null&&e.partManager.updateRelationshipsFromData(this)}move(t,e){const i=e?this.location:this.position;let s=i.x;isNaN(s)&&(s=0);let n=i.y;isNaN(n)&&(n=0);const o=t.x-s,r=t.y-n;if(e===!0)super.move(t,!1);else{const a=Point.z(i.x+o,i.y+r);super.move(a,!1),Point.i(a)}this.kr(o,r);const l=this.labelNodes;for(;l.next();){const a=l.value,h=a.position;a.moveTo(h.x+o,h.y+r)}}get relinkableFrom(){return(this.Mt&1)!==0}set relinkableFrom(t){const e=(this.Mt&1)!==0;e!==t&&(this.Mt=this.Mt^1,this.t("relinkableFrom",e,t),this.invalidateAdornments())}get relinkableTo(){return(this.Mt&2)!==0}set relinkableTo(t){const e=(this.Mt&2)!==0;e!==t&&(this.Mt=this.Mt^2,this.t("relinkableTo",e,t),this.invalidateAdornments())}canRelinkFrom(){if(!this.relinkableFrom)return!1;const t=this.layer;if(t===null)return!0;if(!t.allowRelink)return!1;const e=t.diagram;return!(e!==null&&!e.allowRelink)}canRelinkTo(){if(!this.relinkableTo)return!1;const t=this.layer;if(t===null)return!0;if(!t.allowRelink)return!1;const e=t.diagram;return!(e!==null&&!e.allowRelink)}get resegmentable(){return(this.Mt&4)!==0}set resegmentable(t){const e=(this.Mt&4)!==0;e!==t&&(this.Mt=this.Mt^4,this.t("resegmentable",e,t),this.invalidateAdornments())}get isTreeLink(){return(this.Mt&8)!==0}set isTreeLink(t){const e=(this.Mt&8)!==0;e!==t&&(this.Mt=this.Mt^8,this.t("isTreeLink",e,t),this.fromNode!==null&&this.fromNode.vp(),this.toNode!==null&&this.toNode.vp())}get path(){const t=this.findMainElement();return t instanceof Shape?t:null}get routeBounds(){return this.updateRoute(),this.xl}DC(t){let e=1/0,i=1/0;const s=this.pointsCount;if(s===0)return t.e(NaN,NaN,0,0),t;if(s===1){const n=this.getPoint(0);e=Math.min(n.x,e),i=Math.min(n.y,i),t.e(n.x,n.y,0,0)}else if(s===2){const n=this.getPoint(0),o=this.getPoint(1);e=Math.min(n.x,o.x),i=Math.min(n.y,o.y),t.e(n.x,n.y,0,0),t.unionPoint(o)}else if(this.computeCurve()===9&&s>=3&&!this.isOrthogonal){let n=this.getPoint(0);if(e=n.x,i=n.y,t.e(e,i,0,0),s===3){const o=this.getPoint(1);e=Math.min(o.x,e),i=Math.min(o.y,i);const r=this.getPoint(2);e=Math.min(r.x,e),i=Math.min(r.y,i),G.Mu(n.x,n.y,o.x,o.y,o.x,o.y,r.x,r.y,.5,t)}else for(let o=3;o<s;o+=3){const r=this.getPoint(o-2);o+3>=s&&(o=s-1);const l=this.getPoint(o-1),a=this.getPoint(o);G.Mu(n.x,n.y,r.x,r.y,l.x,l.y,a.x,a.y,.5,t),e=Math.min(a.x,e),i=Math.min(a.y,i),n=a}}else{const n=this.getPoint(0),o=this.getPoint(1);e=Math.min(n.x,o.x),i=Math.min(n.y,o.y),t.e(n.x,n.y,0,0),t.unionPoint(o);for(let r=2;r<s;r++){const l=this.getPoint(r);e=Math.min(l.x,e),i=Math.min(l.y,i),t.unionPoint(l)}}return this.gk.e(e-t.x,i-t.y),t}get midPoint(){return this.qN(new Point)}qN(t){return this.updateRoute(),this.computeMidPoint(t)}computeMidPoint(t){const e=this.pointsCount;if(e===0)return t.h(Point.gn),t;if(e===1)return t.h(this.getPoint(0)),t;if(e===2){const h=this.getPoint(0),c=this.getPoint(1);return t.e((h.x+c.x)/2,(h.y+c.y)/2),t}if(this.isOrthogonal&&(this.computeCorner()>=15||this.computeCurve()===9)){this.ut.getPointAlongPath(.5,t),t.add(this.getPoint(0));const h=this.ut.figures.first();return t.offset(-h.startX,-h.startY),t}if(this.computeCurve()===9){if(e===3){const f=this.getPoint(0),u=this.getPoint(1),d=this.getPoint(2);return G.HL(f.x,f.y,u.x,u.y,u.x,u.y,d.x,d.y,t),t}const h=(e-1)/3|0,c=(h/2|0)*3;if(h%2===1){const f=this.getPoint(c),u=this.getPoint(c+1),d=this.getPoint(c+2),m=this.getPoint(c+3);return G.HL(f.x,f.y,u.x,u.y,d.x,d.y,m.x,m.y,t),t}else return t.h(this.getPoint(c)),t}const i=this.flattenedLengths,s=this.flattenedTotalLength;let n=0,o=0,r=0;for(;n<s/2&&o<e&&(r=i[o],!(n+r>s/2));)n+=r,o++;const l=this.getPoint(o),a=this.getPoint(o+1);if(Math.abs(l.x-a.x)<1)l.y>a.y?t.e(l.x,l.y-(s/2-n)):t.e(l.x,l.y+(s/2-n));else if(Math.abs(l.y-a.y)<1)l.x>a.x?t.e(l.x-(s/2-n),l.y):t.e(l.x+(s/2-n),l.y);else{const h=(s/2-n)/r,c=h*(a.x-l.x),f=h*(a.y-l.y);t.e(l.x+c,l.y+f)}return t}get midAngle(){return this.updateRoute(),this.computeMidAngle()}computeMidAngle(){const t=this.pointsCount;if(t<2)return NaN;if(t===2){const a=this.getPoint(0),h=this.getPoint(1);return a.directionPoint(h)}if(this.isOrthogonal&&(this.computeCorner()>=15||this.computeCurve()===9))return this.ut.getAngleAlongPath(.5);if(this.computeCurve()===9&&t>=4){const a=(t-1)/3|0;let h=(a/2|0)*3;if(a%2===1){h=Math.floor(h);const c=this.getPoint(h),f=this.getPoint(h+1),u=this.getPoint(h+2),d=this.getPoint(h+3);return G.qF(c.x,c.y,f.x,f.y,u.x,u.y,d.x,d.y)}else if(h>0&&h+1<t){const c=this.getPoint(h-1),f=this.getPoint(h+1);return c.directionPoint(f)}}const e=this.flattenedLengths,i=this.flattenedTotalLength;let s=0,n=0,o=0;for(;s<i/2&&n<t&&(o=e[n],!(s+o>i/2));)s+=o,n++;const r=this.getPoint(n),l=this.getPoint(n+1);if(Math.abs(r.x-l.x)<.5&&Math.abs(r.y-l.y)<Link.CC){if(n>0&&n<t-2){const a=this.getPoint(n-1),h=this.getPoint(n+2);return a.x<h.x?0:a.x>h.x?180:a.y<h.y?90:270}}else if(Math.abs(r.y-l.y)<.5&&Math.abs(r.x-l.x)<Link.CC&&n>0&&n<t-2){const a=this.getPoint(n-1),h=this.getPoint(n+2);return a.y<h.y?90:a.y>h.y?270:a.x<h.x?0:180}return r.directionPoint(l)}get flattenedLengths(){return this.Jh!==null?this.Jh:(this.Fi||this.pk(),this.NE())}get flattenedTotalLength(){let t=this.mk;if(isNaN(t)){const e=this.flattenedLengths,i=e.length;t=0;for(let s=0;s<i;s++)t+=e[s];this.mk=t}return t}NE(){this.Jh===null?this.Jh=[]:this.Jh.length=0;const t=this.Jh,e=this.pointsCount;for(let i=0;i<e-1;i++){let s=0;const n=this.getPoint(i),o=this.getPoint(i+1);G.X(n.x,o.x)?(s=o.y-n.y,s<0&&(s=-s),t.push(s)):G.X(n.y,o.y)?(s=o.x-n.x,s<0&&(s=-s),t.push(s)):(s=Math.sqrt(n.distanceSquaredPoint(o)),t.push(s))}return t}get points(){return this.Me}set points(t){const e=this.Me;if(e===t)return;let i=null;if(Array.isArray(t))i=this.convertPointsArrayToList(t);else if(t instanceof List){i=t.copy();const n=i.iterator;for(;n.next();)n.value.k()}else U.o("Link.points value is not an instance of List or Array: "+t);if(i===null)return;i.k(),this.Me=i,this.ai(),this.pk();const s=this.diagram;s!==null&&(!s.Qa&&!s.undoManager.isUndoingRedoing&&s.nb.add(this),s.animationManager.ke&&s.animationManager.TM(this,i)),this.t("points",e,i)}convertPointsArrayToList(t){let e=null,i=t.length%2===0;if(i){for(let s=0;s<t.length;s++)if(typeof t[s]!="number"||isNaN(t[s])){i=!1;break}}if(i){e=new List;for(let s=0;s<t.length/2;s++)e.add(new Point(t[s*2],t[s*2+1]).k())}else{let s=!0;for(let n=0;n<t.length;n++){const o=t[n];if(!U.$(o)||typeof o.x!="number"||isNaN(o.x)||typeof o.y!="number"||isNaN(o.y)){s=!1;break}}if(s){e=new List;for(let n=0;n<t.length;n++){const o=t[n];e.add(new Point(o.x,o.y).k())}}}return e}get pointsCount(){return this.Me.count}getPoint(t){return this.Me.r[t]}setPoint(t,e){this.Me.setElt(t,e)}setPointAt(t,e,i){this.Me.setElt(t,new Point(e,i))}insertPoint(t,e){this.Me.insertAt(t,e)}insertPointAt(t,e,i){this.Me.insertAt(t,new Point(e,i))}addPoint(t){this.Me.add(t)}addPointAt(t,e){this.Me.add(new Point(t,e))}removePoint(t){this.Me.removeAt(t)}clearPoints(){this.Me.clear()}kr(t,e){if(t===0&&e===0)return;if(this.pointsCount===0){this.defaultFromPoint.isReal()&&this.defaultFromPoint.offset(t,e),this.defaultToPoint.isReal()&&this.defaultToPoint.offset(t,e);return}const i=this.Fi,s=new List,n=this.Me.iterator;for(;n.next();){const l=n.value;s.add(new Point(l.x+t,l.y+e).k())}s.k();const o=this.Me;this.Me=s;const r=this.diagram;isNaN(t)||isNaN(e)||r!==null&&r.animationManager.ke?this.f():(this.sn.e(this.sn.x+t,this.sn.y+e),this.ct.e(this.ct.x+t,this.ct.y+e),this.kf()),i?this.pk():(this.defaultFromPoint.isReal()&&(this.defaultFromPoint=this.getPoint(0)),this.defaultToPoint.isReal()&&(this.defaultToPoint=this.getPoint(this.pointsCount-1))),r!==null&&r.animationManager.ke&&r.animationManager.TM(this,s),this.t("points",o,s)}startRoute(){this.wl===null&&(this.wl=this.Me,this.Me=this.Me.copy())}commitRoute(){if(this.wl===null)return;const t=this.wl,e=this.Me;this.wl=null;const i=this.diagram;i!==null&&i.animationManager.ke&&i.animationManager.TM(this,e),this.ai(),this.pk(),this.t("points",t,e)}rollbackRoute(){this.wl!==null&&(this.Me=this.wl,this.wl=null,this.DC(this.xl))}vR(){this.Dr!==null&&(this.points=this.Dr,this.Dr=null)}pk(){if(this.Me.count===0){this.Fi=!1;return}this.Fi=!0,this.DC(this.xl),this.Jh=null,this.mk=NaN,this.defaultFromPoint=this.getPoint(0),this.defaultToPoint=this.getPoint(this.pointsCount-1),this.yk(!1)}invalidateRoute(){this.$t()}$t(){if(this.suspendsRouting)return;const t=this.path;if(t===null)return;const e=this.diagram;if(e){if(e.nb.has(this)||e.undoManager.isUndoingRedoing)return;const i=e.animationManager;if(i.isTicking&&!i.isAnimating)return;this.Dr!==null&&!i.isTicking&&(this.Dr=null)}this.Fi=!1,this.f(),t.f()}get Fi(){return(this.Mt&16)!==0}set Fi(t){(this.Mt&16)!==0!==t&&(this.Mt=this.Mt^16)}get suspendsRouting(){return(this.Mt&32)!==0}set suspendsRouting(t){(this.Mt&32)!==0!==t&&(this.Mt=this.Mt^32)}get _y(){return(this.Mt&64)!==0}set _y(t){(this.Mt&64)!==0!==t&&(this.Mt=this.Mt^64)}get vC(){return(this.Mt&512)!==0}set vC(t){(this.Mt&512)!==0!==t&&(this.Mt=this.Mt^512)}get defaultFromPoint(){return this.xC}set defaultFromPoint(t){this.xC=t&&t.isReal()?t.copy():Point.gn}get defaultToPoint(){return this.bC}set defaultToPoint(t){this.bC=t&&t.isReal()?t.copy():Point.gn}updateRoute(){if(this.Fi||this._y)return;let t=!0;try{this._y=!0,this.startRoute(),t=this.computePoints()}catch{this._y=!1,this.rollbackRoute()}finally{this._y=!1,t?this.commitRoute():this.rollbackRoute()}}computePoints(){const t=this.diagram;if(t===null)return!1;let e=this.fromNode,i=null;if(e===null?(Link.$h||(Link.$h=new Node,Link.$h.desiredSize=Size.xc,Link.$h.ensureBounds()),this.defaultFromPoint.isReal()&&(Link.$h.location=this.defaultFromPoint,Link.$h.ensureBounds(),e=Link.$h,i=Link.$h)):i=this.fromPort,i!==null&&!e.isVisible()){const m=e.findVisibleNode();m!==null&&m!==e?(e=m,i=m.port):e=m}if(this.kC=e,e===null||!e.location.isReal()||i===null||(i=e.findVisiblePort(i),i===null))return!1;let s=this.toNode,n=null;if(s===null?(Link.Zh||(Link.Zh=new Node,Link.Zh.desiredSize=Size.xc,Link.Zh.ensureBounds()),this.defaultToPoint.isReal()&&(Link.Zh.location=this.defaultToPoint,Link.Zh.ensureBounds(),s=Link.Zh,n=Link.Zh)):n=this.toPort,n!==null&&!s.isVisible()){const m=s.findVisibleNode();m!==null&&m!==s?(s=m,n=m.port):s=m}if(this.PC=s,s===null||!s.location.isReal()||n===null||(n=s.findVisiblePort(n),n===null))return!1;const o=this.pointsCount,r=this.computeSpot(!0,i),l=this.computeSpot(!1,n),a=this.bl(r),h=this.bl(l),c=i===n&&i!==null,f=this.isOrthogonal;let u=this.curve===9;c&&!f?(u=!0,this.er=!0):this.er=!1;const d=this.computeAdjusting()===0||c;if(!f&&!c&&a&&h){let m=!1;if(!d&&o>=3){let g=this.getLinkPoint(e,i,r,!0,!1,s,n),p=this.getLinkPoint(s,n,l,!1,!1,e,i);m=this.adjustPoints(0,g,o-1,p),m&&(g=this.getLinkPoint(e,i,r,!0,!1,s,n),p=this.getLinkPoint(s,n,l,!1,!1,e,i),this.adjustPoints(0,g,o-1,p))}m||(this.clearPoints(),u?this.CE(e,i,r,s,n,l):this.LE(e,i,r,s,n,l))}else{const m=c?this.computeCurviness():0;d&&(f&&this.isAvoiding||c)&&this.clearPoints();const g=this.getLinkPoint(e,i,r,!0,f,s,n),p=this.getLinkPoint(s,n,l,!1,f,e,i);let y=0,x=0,b=0;if(f||!a||c){b=this.getLinkDirection(e,i,g,r,!0,f,s,n);let M=this.wk(e,i,r,!0,b);if(c&&(a||r.equals(l)||!f&&r.x+l.x===1&&r.y+l.y===1)&&(b-=f?90:Link.lv,m<0&&(b-=180)),b=G.Ee(b),c&&(M+=Math.abs(m)*(f?1:2)),b===0?y=M:b===90?x=M:b===180?y=-M:b===270?x=-M:(y=M*Math.cos(b*Math.PI/180),x=M*Math.sin(b*Math.PI/180)),r.isNoSpot()&&c){const N=i.getDocumentPoint(Spot.Center,Point.l()),A=Point.z(N.x+y*Link.Gf,N.y+x*Link.Gf);this.getLinkPointFromPoint(e,i,N,A,!0,g),Point.i(N),Point.i(A)}}let k=0,P=0,S=0;if(f||!h||c){S=this.getLinkDirection(s,n,p,l,!1,f,e,i);let M=this.wk(s,n,l,!1,S);if(c&&(h||r.equals(l)||!f&&r.x+l.x===1&&r.y+l.y===1)&&(S+=f?0:Link.av,m<0&&(S+=180)),S=G.Ee(S),c&&(M+=Math.abs(m)*(f?1:2)),S===0?k=M:S===90?P=M:S===180?k=-M:S===270?P=-M:(k=M*Math.cos(S*Math.PI/180),P=M*Math.sin(S*Math.PI/180)),l.isNoSpot()&&c){const N=n.getDocumentPoint(Spot.Center,Point.l()),A=Point.z(N.x+k*Link.Gf,N.y+P*Link.Gf);this.getLinkPointFromPoint(s,n,N,A,!1,p),Point.i(N),Point.i(A)}}let L=g;(f||!a||c)&&(L=new Point(g.x+y,g.y+x));let C=p;(f||!h||c)&&(C=new Point(p.x+k,p.y+P)),!d&&!f&&a&&o>3&&this.adjustPoints(0,g,o-2,C)?this.setPoint(o-1,p):!d&&!f&&h&&o>3&&this.adjustPoints(1,L,o-1,p)?this.setPoint(0,g):!d&&(f?o>=6:o>4)&&this.adjustPoints(1,L,o-2,C)?(this.setPoint(0,g),this.setPoint(o-1,p)):(this.clearPoints(),this.addPoint(g),(f||!a||c)&&this.addPoint(L),f&&this.addOrthoPoints(L,b,C,S,e,s),(f||!h||c)&&this.addPoint(C),this.addPoint(p))}return t.addInvalidRoute(this),!0}FC(t,e){return Math.abs(e.x-t.x)>Math.abs(e.y-t.y)?(e.x>=t.x?e.x=t.x+9e9:e.x=t.x-9e9,e.y=t.y):(e.y>=t.y?e.y=t.y+9e9:e.y=t.y-9e9,e.x=t.x),e}getLinkPointFromPoint(t,e,i,s,n,o){if(o===void 0&&(o=new Point),t===null||e===null)return o.h(i),o;if(!t.isVisible()){const u=t.findVisibleNode();u!==null&&u!==t&&(t=u,e=t.port)}let r=0,l=0,a=0,h=0,c=null,f=e.panel;if(f!==null&&!f.Mn()&&(f=f.panel),f===null)r=s.x,l=s.y,a=i.x,h=i.y;else{c=f.Ws;const u=1/(c.m11*c.m22-c.m12*c.m21),d=c.m22*u,m=-c.m12*u,g=-c.m21*u,p=c.m11*u,y=u*(c.m21*c.dy-c.m22*c.dx),x=u*(c.m12*c.dx-c.m11*c.dy);r=s.x*d+s.y*g+y,l=s.x*m+s.y*p+x,a=i.x*d+i.y*g+y,h=i.x*m+i.y*p+x}return e.mf(r,l,a,h,o),c!==null&&o.v(c),o}AE(t,e){const i=t.yd;return i!==null?i.gv(e):null}xk(t){if(t===null)return null;let e=t.yd;return e===null&&(e=new Knot(t.part,t),t.yd=e),e.gv(this)}getLinkPoint(t,e,i,s,n,o,r,l){if(l===void 0&&(l=new Point),i.isSpot()&&!this.bl(i))return e.getDocumentPoint(i,l),l;if(i.isSide()){const c=this.xk(e);if(c!==null){const f=c._h;if(l.h(f),n&&this.routing===7){const u=this.xk(r);if(u!==null&&c.Yf<u.Yf){const d=Point.l(),m=Point.l(),g=Rect.l();e.getDocumentPoint(Spot.TopLeft,d),e.getDocumentPoint(Spot.BottomRight,m);const p=d.x,y=d.y,x=m.x,b=m.y;g.x=Math.min(p,x),g.y=Math.min(y,b),g.width=Math.abs(p-x),g.height=Math.abs(y-b);const k=this.computeSpot(!s,r),P=this.getLinkPoint(o,r,k,!s,n,t,e,m);(i.includesSide(Spot.LeftSide)||i.includesSide(Spot.RightSide))&&P.y>=g.y&&P.y<=g.y+g.height?l.y=P.y:(i.includesSide(Spot.TopSide)||i.includesSide(Spot.BottomSide))&&P.x>=g.x&&P.x<=g.x+g.width&&(l.x=P.x),Rect.i(g),Point.i(d),Point.i(m)}}return l}}const a=e.getDocumentPoint(this.ig(i,s),Point.l()),h=Point.l();if(this.pointsCount>(n?6:2))h.h(s?this.getPoint(1):this.getPoint(this.pointsCount-2)),n&&this.FC(a,h);else if(t?.isMemberOf(o)||o?.isMemberOf(t)){const c=e.getDocumentBounds(Rect.l()),f=r.getDocumentBounds(Rect.l());c.isReal()&&f.isReal()?f.containsRect(c)?(h.h(a),this.RC(f,a.x,a.y,0,this.computeSpot(r===this.toPort,r),h)):c.containsRect(f)?(r.getDocumentPoint(Spot.Center,h),this.RC(c,h.x,h.y,0,this.computeSpot(e===this.toPort,e),h)):this.OC(r,a,s,n,h):this.OC(r,a,s,n,h),Rect.i(c),Rect.i(f)}else this.OC(r,a,s,n,h);return this.getLinkPointFromPoint(t,e,a,h,s,l),Point.i(h),Point.i(a),l}OC(t,e,i,s,n){const o=this.computeSpot(!i,t);t.getDocumentPoint(this.ig(o,!i),n),s&&this.FC(e,n)}getLinkDirection(t,e,i,s,n,o,r,l){let a=this.TE(t,e,i,s,n,o,r,l);if(t&&r){const c=Rect.l(),f=Rect.l();if(s.isNone()&&t.isMemberOf(r)&&e&&l){if(e.getDocumentBounds(c),l.getDocumentBounds(f),c.isReal()&&f.isReal()&&f.containsRect(c)){const u=this.computeSpot(l===this.toPort,l);u.equals(Spot.Left)||u.equals(Spot.LeftSide)?a=180:u.equals(Spot.Right)||u.equals(Spot.RightSide)?a=0:u.equals(Spot.Top)||u.equals(Spot.TopSide)?a=270:u.equals(Spot.Bottom)||u.equals(Spot.BottomSide)?a=90:a=G.Ee(a+180)}}else r?.isMemberOf(t)&&e&&l&&(e.getDocumentBounds(c),l.getDocumentBounds(f),c.isReal()&&f.isReal()&&c.containsRect(f)&&(a=G.Ee(a+180)));Rect.i(c),Rect.i(f)}if(this.bl(s)||e===null)return a;const h=e.getDocumentAngle();return h===0?a:(45<=h&&h<135?a+=90:135<=h&&h<225?a+=180:225<=h&&h<315&&(a+=270),G.Ee(a))}TE(t,e,i,s,n,o,r,l){if(s.isSpot())return G._w(null,s.x,s.y);if(s.isSide()){const f=this.xk(e);if(f!==null)switch(f.fi){case 1:return 270;case 8:return 90;case 2:return 180;default:return 0}else return s.includesSide(Spot.TopSide)?270:s.includesSide(Spot.BottomSide)?90:s.includesSide(Spot.LeftSide)?180:0}if(e===null||l===null)return 0;const a=e.getDocumentPoint(Spot.Center,Point.l()),h=Point.l();this.pointsCount>(o?6:2)?o?(h.h(n?this.getPoint(1):this.getPoint(this.pointsCount-2)),this.FC(a,h)):h.h(i):l.getDocumentPoint(Spot.Center,h);let c=0;return Math.abs(h.x-a.x)>Math.abs(h.y-a.y)?h.x>=a.x?c=0:c=180:h.y>=a.y?c=90:c=270,Point.i(h),Point.i(a),c}computeEndSegmentLength(t,e,i,s){return this.wk(t,e,i,s,NaN)}wk(t,e,i,s,n){if(e!==null&&i.isSide()){const r=this.xk(e);if(r!==null)return r.bk}let o=NaN;if(s?o=this.fromEndSegmentLength:o=this.toEndSegmentLength,e!==null&&isNaN(o))if(n===void 0&&(n=NaN),Link.LC>0&&this.computeCurve()===9&&!isNaN(n)&&i.isSpot()){const r=this.getOtherPort(e);if(r){const l=Point.l(),a=Point.l(),h=e.getDocumentPoint(i,l),c=r.getDocumentPoint(i.opposite(),a),f=n>=315||n<=45||n>=135&&n<=225;let u=Math.abs(f?h.x-c.x:h.y-c.y)/Link.LC;return u=Math.max(u,Link.AC),Point.i(l),Point.i(a),u}}else s?o=e.fromEndSegmentLength:o=e.toEndSegmentLength;return isNaN(o)&&(o=Link.AC),o}computeSpot(t,e){return e===void 0&&(e=null),t?this.DE(e||this.fromPort):this.vE(e||this.toPort)}DE(t){if(t===null)return Spot.Center;let e=this.fromSpot;return e.isDefault()&&(e=t.fromSpot),e===Spot.Default?Spot.None:e}vE(t){if(t===null)return Spot.Center;let e=this.toSpot;return e.isDefault()&&(e=t.toSpot),e===Spot.Default?Spot.None:e}bl(t){return t===Spot.None||t.x===.5&&t.y===.5}ig(t,e){return t.x===.5&&t.y===.5?t:Spot.Center}computeOtherPoint(t,e){if(this.computeAdjusting()!==0&&this.pointsCount>4)return this.computeMidPoint(new Point);{const i=this.AE(e,this);if(i!==null)return i._h;if(t instanceof Group){let s=this.fromNode,n=this.fromPort;n===e&&(s=this.toNode,n=this.toPort);const o=Rect.l(),r=Rect.l();if(n&&s?.isMemberOf(t)){const l=this.computeSpot(n===e,e);if(e.getDocumentBounds(o),n.getDocumentBounds(r),o.isReal()&&r.isReal()&&o.containsRect(r)){const a=n.getDocumentPoint(Spot.Center);return this.RC(o,a.x,a.y,0,l,a),Rect.i(o),Rect.i(r),a}}Rect.i(o),Rect.i(r)}return e.getDocumentPoint(Spot.Center)}}computeShortLength(t){if(t){let e=this.fromShortLength;if(isNaN(e)){const i=this.fromPort;i!==null&&(e=i.fromShortLength)}return isNaN(e)?0:e}else{let e=this.toShortLength;if(isNaN(e)){const i=this.toPort;i!==null&&(e=i.toShortLength)}return isNaN(e)?0:e}}Zm(t,e,i,s,n,o){if(this.pickable===!1)return!1;e===void 0&&(e=null),i===void 0&&(i=null);let r;if(o===void 0?(r=Transform.l(),r.Ue()):r=o,r.bc(this.v),this.containedInRect(t,r))return this.$N(e,i,n),o===void 0&&Transform.i(r),!0;if(this.intersectsRect(t,r)){let l=!1;if(!this.Af){const a=this.D.r,h=a.length;for(let c=h;c--;){const f=a[c];if(!f.visible&&f!==this.locationObject)continue;const u=f.actualBounds,d=this.naturalBounds;if(u.x>d.width||u.y>d.height||u.x+u.width<0||u.y+u.height<0)continue;const m=f,g=Transform.l();if(g.set(r),m instanceof Panel?l=m.Zm(t,e,i,s,n,g):this.path===m?m instanceof Shape&&(l=m.nE(t,s,g)):l=m.ZT(t,s,g),l){let p=m;e!==null&&(p=e(m)),p&&(i===null||i(p))&&n.add(p)}Transform.i(g)}}return o===void 0&&Transform.i(r),l||this.background!==null}return o===void 0&&Transform.i(r),!1}get isOrthogonal(){return(this.Wh&2)===2}static NC(t){return(t&2)===2}get isAvoiding(){return(this.Wh&4)===4}computeCurve(){if(this.er===null){const t=this.fromPort,e=t!==null&&t===this.toPort,i=this.isOrthogonal;this.er=e&&!i}return this.er?9:this.curve}computeCorner(){if(this.curve===9)return 0;let t=this.corner;return(isNaN(t)||t<0)&&(t=Link.hv),t}findMidLabel(){const t=this.path,e=this.D.r,i=e.length;for(let n=0;n<i;n++){const o=e[n];if(!(o===t||o.isPanelMain)&&(o.segmentIndex===-1/0||isNaN(o.segmentIndex)))return o}const s=this.labelNodes;for(;s.next();){const n=s.value;if(n.segmentIndex===-1/0||isNaN(n.segmentIndex))return n}return null}computeSpacing(){if(!this.isVisible())return 0;let t=Link.cv;t=Math.max(t,this.computeThickness());const e=this.fromPort,i=this.toPort;if(e!==null&&i!==null){const s=this.findMidLabel();if(s!==null){const n=s.naturalBounds,o=s.margin,r=isNaN(n.width)?Link.fv:n.width*s.scale+o.left+o.right,l=isNaN(n.height)?Link.uv:n.height*s.scale+o.top+o.bottom,a=s.segmentOrientation;if(a===21||a===25||a===24)t=Math.max(t,l);else if(a===23||a===27||a===22||a===26)t=Math.max(t,r);else{const c=e.getDocumentPoint(Spot.Center).directionPoint(i.getDocumentPoint(Spot.Center))/180*Math.PI;t=Math.max(t,Math.abs(Math.sin(c)*r)+Math.abs(Math.cos(c)*l)+1)}this.curve===9&&(t*=Link.ov)}}return t}arrangeBundledLinks(t,e){if(e)for(let i=0;i<t.length;i++){const s=t[i];s.computeAdjusting()===0&&s.$t()}}computeCurviness(){let t=this.curviness;if(isNaN(t)){t=Link.sv;const e=this.ir;if(e!==null){const i=U.nt();let s=0;const n=e.on;for(let r=0;r<n.length;r++){const a=n[r].computeSpacing();i.push(a),s+=a}let o=-s/2;for(let r=0;r<n.length;r++){if(n[r]===this){t=o+i[r]/2;break}o+=i[r]}e.Gy===this.fromNode&&(t=-t),U.Z(i)}}return t}computeThickness(){if(!this.isVisible())return 0;const t=this.path;return t!==null?Math.max(t.strokeWidth,1):1}hasCurviness(){return!isNaN(this.curviness)||this.ir!==null}LE(t,e,i,s,n,o){let r=this.getLinkPoint(t,e,i,!0,!1,s,n),l=this.getLinkPoint(s,n,o,!1,!1,t,e);if(this.mv(t,e,i,r,s,n,o,l),this.addPoint(r),this.addPoint(l),this.hasCurviness()){const a=l.x-r.x,h=l.y-r.y,c=this.computeCurviness(),f=c,u=r.x+a/2,d=r.y+h/2;let m=u,g=d;if(G.c(h,0))a>0?g-=f:g+=f;else{const p=-a/h;let y=Math.sqrt(f*f/(p*p+1));c<0&&(y=-y),m=(h<0?-1:1)*y+u,g=p*(m-u)+d}this.insertPointAt(1,m,g)}}mv(t,e,i,s,n,o,r,l){const a=o.getDocumentBounds(Rect.l()),h=e.getDocumentBounds(Rect.l());if(a.intersectsRect(h)&&!a.containsRect(h)&&!h.containsRect(a)){const c=Point.l();e.getDocumentPoint(this.ig(i,!0),c);const f=Point.l();o.getDocumentPoint(this.ig(r,!1),f);const u=h.width*h.height,d=a.width*a.height;u>d?(s.h(c),this.getLinkPointFromPoint(n,o,f,c,!1,f),l.h(f)):u<d?(this.getLinkPointFromPoint(t,e,c,f,!0,c),s.h(c),l.h(f)):(s.h(c),l.h(f)),Point.i(c),Point.i(f)}else if(a.containsPoint(s)){const c=Point.l();e.getDocumentPoint(this.ig(i,!0),c),l.h(c),this.IC(a,c.x,c.y,Link.Gf,l),this.getLinkPointFromPoint(n,o,a.containsPoint(c)?c:s,l,!1,l),this.getLinkPointFromPoint(t,e,c,l,!0,s),Point.i(c)}else if(h.containsPoint(l)){const c=Point.l();o.getDocumentPoint(this.ig(r,!1),c),s.h(c),this.IC(h,c.x,c.y,Link.Gf,s),this.getLinkPointFromPoint(t,e,h.containsPoint(c)?c:l,s,!0,s),this.getLinkPointFromPoint(n,o,c,s,!1,l),Point.i(c)}Rect.i(h),Rect.i(a)}RC(t,e,i,s,n,o){let r=-1;return n.equals(Spot.Left)||n.equals(Spot.LeftSide)?r=180:n.equals(Spot.Right)||n.equals(Spot.RightSide)?r=0:n.equals(Spot.Top)||n.equals(Spot.TopSide)?r=270:(n.equals(Spot.Bottom)||n.equals(Spot.BottomSide))&&(r=90),r===-1?this.IC(t,e,i,0,o):this.pv(t,e,i,0,r,o)}IC(t,e,i,s,n){const o=G._w(t,e,i);return this.pv(t,e,i,s,o,n)}pv(t,e,i,s,n,o){return n===0?o.x=t.right+s:n===90?o.y=t.bottom+s:n===180?o.x=t.x-s:n===270?o.y=t.y-s:n===45?(o.x=t.right+s,o.y=t.bottom+s):n===135?(o.x=t.x-s,o.y=t.bottom+s):n===225?(o.x=t.x-s,o.y=t.y-s):n===315&&(o.x=t.right+s,o.y=t.y-s),o}CE(t,e,i,s,n,o){let r=this.getLinkPoint(t,e,i,!0,!1,s,n),l=this.getLinkPoint(s,n,o,!1,!1,t,e);this.mv(t,e,i,r,s,n,o,l),this.addPoint(r),this.addPoint(l);const a=l.x-r.x,h=l.y-r.y,c=this.computeCurviness();let f=0,u=0,d=r.x+a/3,m=r.y+h/3,g=d,p=m;G.c(h,0)?a>0?p-=c:p+=c:(f=-a/h,u=Math.sqrt(c*c/(f*f+1)),c<0&&(u=-u),g=(h<0?-1:1)*u+d,p=f*(g-d)+m),d=r.x+2*a/3,m=r.y+2*h/3;let y=d,x=m;G.c(h,0)?a>0?x-=c:x+=c:(y=(h<0?-1:1)*u+d,x=f*(y-d)+m),this.insertPointAt(1,g,p),this.insertPointAt(2,y,x),this.setPoint(0,this.getLinkPoint(t,e,i,!0,!1,s,n)),this.setPoint(3,this.getLinkPoint(s,n,o,!1,!1,t,e))}adjustPoints(t,e,i,s){let n=this.computeAdjusting();if(this.isOrthogonal){if(n===18)return!1;n===19&&(n=17)}switch(n){case 18:return this.FE(t,e,i,s);case 19:return this.RE(t,e,i,s);case 17:return this.OE(t,e,i,s);default:return!1}}FE(t,e,i,s){const n=this.getPoint(t),o=this.getPoint(i);if(n.equalsApprox(e)&&o.equalsApprox(s))return!0;const r=n.x,l=n.y,a=o.x,h=o.y;let c=a-r,f=h-l;const u=Math.sqrt(c*c+f*f);if(G.X(u,0))return!0;let d=0;G.X(c,0)?f<0?d=-Math.PI/2:d=Math.PI/2:(d=Math.atan(f/Math.abs(c)),c<0&&(d=Math.PI-d));const m=e.x,g=e.y,p=s.x,y=s.y,x=p-m,b=y-g,k=Math.sqrt(x*x+b*b);let P=0;G.X(x,0)?b<0?P=-Math.PI/2:P=Math.PI/2:(P=Math.atan(b/Math.abs(x)),x<0&&(P=Math.PI-P));const S=k/u,L=P-d;this.setPoint(t,e);for(let C=t+1;C<i;C++){const M=this.getPoint(C);c=M.x-r,f=M.y-l;const N=Math.sqrt(c*c+f*f);if(G.X(N,0))continue;let A=0;G.X(c,0)?f<0?A=-Math.PI/2:A=Math.PI/2:(A=Math.atan(f/Math.abs(c)),c<0&&(A=Math.PI-A));const T=A+L,D=N*S,v=m+D*Math.cos(T),R=g+D*Math.sin(T);this.setPointAt(C,v,R)}return this.setPoint(i,s),!0}RE(t,e,i,s){const n=this.getPoint(t),o=this.getPoint(i);if(n.equalsApprox(e)&&o.equalsApprox(s))return!0;const r=n.x,l=n.y,a=o.x,h=o.y,c=(a-r)**2+(h-l)**2,f=e.x,u=e.y,d=s.x,m=s.y;let g=0,p=1;d-f!==0?(g=(m-u)/(d-f),p=Math.sqrt(1+1/(g*g))):g=9e9,this.setPoint(t,e);for(let y=t+1;y<i;y++){const x=this.getPoint(y),b=x.x,k=x.y;let P=.5;c!==0&&(P=((r-b)*(r-a)+(l-k)*(l-h))/c);const S=r+P*(a-r),L=l+P*(h-l);let C=Math.sqrt((b-S)**2+(k-L)**2);k<g*(b-S)+L&&(C=-C),g>0&&(C=-C);const M=f+P*(d-f),N=u+P*(m-u);if(g!==0){const A=M+C/p,T=N-(A-M)/g;this.setPointAt(y,A,T)}else this.setPointAt(y,M,N+C)}return this.setPoint(i,s),!0}OE(t,e,i,s){if(this.isOrthogonal){let n=this.getPoint(t),o=this.getPoint(t+1),r=this.getPoint(t+2),l=o.x,a=o.y;const h=l,c=a;G.c(n.y,o.y)?G.c(o.x,r.x)?a=e.y:G.c(o.y,r.y)&&(l=e.x):G.c(n.x,o.x)&&(G.c(o.y,r.y)?l=e.x:G.c(o.x,r.x)&&(a=e.y)),this.setPointAt(t+1,l,a),n=this.getPoint(i),o=this.getPoint(i-1),r=this.getPoint(i-2);let f=o.x,u=o.y;const d=f,m=u;if(G.c(n.y,o.y)?G.c(o.x,r.x)?u=s.y:G.c(o.y,r.y)&&(f=s.x):G.c(n.x,o.x)&&(G.c(o.y,r.y)?f=s.x:G.c(o.x,r.x)&&(u=s.y)),this.setPointAt(i-1,f,u),this.xT())return this.setPointAt(t+1,h,c),this.setPointAt(i-1,d,m),!1}return this.setPoint(t,e),this.setPoint(i,s),!0}addOrthoPoints(t,e,i,s,n,o){e=G.Ee(e),s=G.Ee(s);const c=s;e>=315||e<45?e=0:45<=e&&e<135?e=90:135<=e&&e<225?e=180:e=270,s>=315||s<45?s=0:45<=s&&s<135?s=90:135<=s&&s<225?s=180:s=270;const f=t,u=i,d=Rect.bs(n.actualBounds),m=Rect.bs(o.actualBounds);d.inflate(Link.Fa,Link.Fa),m.inflate(Link.Fa,Link.Fa),d.unionPoint(t),m.unionPoint(i);const g=Point.l(),p=Point.l();e===0?u.x>f.x||s===270&&u.y<f.y&&m.right>f.x||s===90&&u.y>f.y&&m.right>f.x?(g.e(u.x,f.y),p.e(u.x,(f.y+u.y)/2),s===180?(g.x=this.computeMidOrthoPosition(f.x,f.y,u.x,u.y,!1),p.x=g.x,p.y=u.y):s===270&&u.y<f.y||s===90&&u.y>f.y?(f.x<m.left?g.x=this.computeMidOrthoPosition(f.x,f.y,m.left,u.y,!1):f.x<m.right&&(s===270&&f.y<m.top||s===90&&f.y>m.bottom)?g.x=this.computeMidOrthoPosition(f.x,f.y,u.x,u.y,!1):g.x=m.right,p.x=g.x,p.y=u.y):s===0&&f.x<m.left&&f.y>m.top&&f.y<m.bottom&&(g.x=f.x,f.y<u.y?g.y=Math.min(u.y,m.top):g.y=Math.max(u.y,m.bottom),p.y=g.y)):(g.e(f.x,u.y),p.e((f.x+u.x)/2,u.y),(s===180||s===90&&u.y<d.top||s===270&&u.y>d.bottom)&&(s===180&&(m.containsPoint(f)||d.containsPoint(u))?g.y=this.computeMidOrthoPosition(f.x,f.y,u.x,u.y,!0):u.y<f.y&&(s===180||s===90)?g.y=this.computeMidOrthoPosition(f.x,d.top,u.x,Math.min(u.y,m.bottom),!0):u.y>f.y&&(s===180||s===270)&&(g.y=this.computeMidOrthoPosition(f.x,d.bottom,u.x,Math.max(u.y,m.top),!0)),p.x=u.x,p.y=g.y),g.y>d.top&&g.y<d.bottom&&(u.x>=d.left&&u.x<=f.x||f.x<=m.right&&f.x>=u.x?(s===90||s===270)&&(g.e(Math.max((f.x+u.x)/2,f.x),f.y),p.e(g.x,u.y)):(s===270||(s===0||s===180)&&u.y<f.y?g.y=Math.min(u.y,s===0?d.top:Math.min(d.top,m.top)):g.y=Math.max(u.y,s===0?d.bottom:Math.max(d.bottom,m.bottom)),p.x=u.x,p.y=g.y))):e===180?u.x<f.x||s===270&&u.y<f.y&&m.left<f.x||s===90&&u.y>f.y&&m.left<f.x?(g.e(u.x,f.y),p.e(u.x,(f.y+u.y)/2),s===0?(g.x=this.computeMidOrthoPosition(f.x,f.y,u.x,u.y,!1),p.x=g.x,p.y=u.y):s===270&&u.y<f.y||s===90&&u.y>f.y?(f.x>m.right?g.x=this.computeMidOrthoPosition(f.x,f.y,m.right,u.y,!1):f.x>m.left&&(s===270&&f.y<m.top||s===90&&f.y>m.bottom)?g.x=this.computeMidOrthoPosition(f.x,f.y,u.x,u.y,!1):g.x=m.left,p.x=g.x,p.y=u.y):s===180&&f.x>m.right&&f.y>m.top&&f.y<m.bottom&&(g.x=f.x,f.y<u.y?g.y=Math.min(u.y,m.top):g.y=Math.max(u.y,m.bottom),p.y=g.y)):(g.e(f.x,u.y),p.e((f.x+u.x)/2,u.y),(s===0||s===90&&u.y<d.top||s===270&&u.y>d.bottom)&&(s===0&&(m.containsPoint(f)||d.containsPoint(u))?g.y=this.computeMidOrthoPosition(f.x,f.y,u.x,u.y,!0):u.y<f.y&&(s===0||s===90)?g.y=this.computeMidOrthoPosition(f.x,d.top,u.x,Math.min(u.y,m.bottom),!0):u.y>f.y&&(s===0||s===270)&&(g.y=this.computeMidOrthoPosition(f.x,d.bottom,u.x,Math.max(u.y,m.top),!0)),p.x=u.x,p.y=g.y),g.y>d.top&&g.y<d.bottom&&(u.x<=d.right&&u.x>=f.x||f.x>=m.left&&f.x<=u.x?(s===90||s===270)&&(g.e(Math.min((f.x+u.x)/2,f.x),f.y),p.e(g.x,u.y)):(s===270||(s===0||s===180)&&u.y<f.y?g.y=Math.min(u.y,s===180?d.top:Math.min(d.top,m.top)):g.y=Math.max(u.y,s===180?d.bottom:Math.max(d.bottom,m.bottom)),p.x=u.x,p.y=g.y))):e===90?u.y>f.y||s===180&&u.x<f.x&&m.bottom>f.y||s===0&&u.x>f.x&&m.bottom>f.y?(g.e(f.x,u.y),p.e((f.x+u.x)/2,u.y),s===270?(g.y=this.computeMidOrthoPosition(f.x,f.y,u.x,u.y,!0),p.x=u.x,p.y=g.y):s===180&&u.x<f.x||s===0&&u.x>f.x?(f.y<m.top?g.y=this.computeMidOrthoPosition(f.x,f.y,u.x,m.top,!0):f.y<m.bottom&&(s===180&&f.x<m.left||s===0&&f.x>m.right)?g.y=this.computeMidOrthoPosition(f.x,f.y,u.x,u.y,!0):g.y=m.bottom,p.x=u.x,p.y=g.y):s===90&&f.y<m.top&&f.x>m.left&&f.x<m.right&&(f.x<u.x?g.x=Math.min(u.x,m.left):g.x=Math.max(u.x,m.right),g.y=f.y,p.x=g.x)):(g.e(u.x,f.y),p.e(u.x,(f.y+u.y)/2),(s===270||s===0&&u.x<d.left||s===180&&u.x>d.right)&&(s===270&&(m.containsPoint(f)||d.containsPoint(u))?g.x=this.computeMidOrthoPosition(f.x,f.y,u.x,u.y,!1):u.x<f.x&&(s===270||s===0)?g.x=this.computeMidOrthoPosition(d.left,f.y,Math.min(u.x,m.right),u.y,!1):u.x>f.x&&(s===270||s===180)&&(g.x=this.computeMidOrthoPosition(d.right,f.y,Math.max(u.x,m.left),u.y,!1)),p.x=g.x,p.y=u.y),g.x>d.left&&g.x<d.right&&(u.y>=d.top&&u.y<=f.y||f.y<=m.bottom&&f.y>=u.y?(s===0||s===180)&&(g.e(f.x,Math.max((f.y+u.y)/2,f.y)),p.e(u.x,g.y)):(s===180||(s===90||s===270)&&u.x<f.x?g.x=Math.min(u.x,s===90?d.left:Math.min(d.left,m.left)):g.x=Math.max(u.x,s===90?d.right:Math.max(d.right,m.right)),p.x=g.x,p.y=u.y))):u.y<f.y||s===180&&u.x<f.x&&m.top<f.y||s===0&&u.x>f.x&&m.top<f.y?(g.e(f.x,u.y),p.e((f.x+u.x)/2,u.y),s===90?(g.y=this.computeMidOrthoPosition(f.x,f.y,u.x,u.y,!0),p.x=u.x,p.y=g.y):s===180&&u.x<f.x||s===0&&u.x>=f.x?(f.y>m.bottom?g.y=this.computeMidOrthoPosition(f.x,f.y,u.x,m.bottom,!0):f.y>m.top&&(s===180&&f.x<m.left||s===0&&f.x>m.right)?g.y=this.computeMidOrthoPosition(f.x,f.y,u.x,u.y,!0):g.y=m.top,p.x=u.x,p.y=g.y):s===270&&f.y>m.bottom&&f.x>m.left&&f.x<m.right&&(f.x<u.x?g.x=Math.min(u.x,m.left):g.x=Math.max(u.x,m.right),g.y=f.y,p.x=g.x)):(g.e(u.x,f.y),p.e(u.x,(f.y+u.y)/2),(s===90||s===0&&u.x<d.left||s===180&&u.x>d.right)&&(s===90&&(m.containsPoint(f)||d.containsPoint(u))?g.x=this.computeMidOrthoPosition(f.x,f.y,u.x,u.y,!1):u.x<f.x&&(s===90||s===0)?g.x=this.computeMidOrthoPosition(d.left,f.y,Math.min(u.x,m.right),u.y,!1):u.x>f.x&&(s===90||s===180)&&(g.x=this.computeMidOrthoPosition(d.right,f.y,Math.max(u.x,m.left),u.y,!1)),p.x=g.x,p.y=u.y),g.x>d.left&&g.x<d.right&&(u.y<=d.bottom&&u.y>=f.y||f.y>=m.top&&f.y<=u.y?(s===0||s===180)&&(g.e(f.x,Math.min((f.y+u.y)/2,f.y)),p.e(u.x,g.y)):(s===180||(s===90||s===270)&&u.x<f.x?g.x=Math.min(u.x,s===270?d.left:Math.min(d.left,m.left)):g.x=Math.max(u.x,s===270?d.right:Math.max(d.right,m.right)),p.x=g.x,p.y=u.y))),this.vC=s!==c,this.SC=e,this.MC=s,this.addPoint(g.copy()),this.addPoint(p.copy()),Point.i(g),Point.i(p),Rect.i(d),Rect.i(m)}computeMidOrthoPosition(t,e,i,s,n){let o=0;return this.hasCurviness()&&!this.computeSpot(!0,this.fromPort).isSide()&&!this.computeSpot(!1,this.toPort).isSide()&&(o=this.computeCurviness()),n?(e+s)/2+o:(t+i)/2+o}xT(){if(this.diagram===null||!this.isAvoiding||this.diagram.animationManager.isTicking)return!1;const t=this.points.r,e=t.length;if(e<4)return!1;const i=this.diagram.getPositions(!1,this.containingGroup,null);for(let s=1;s<e-2;s++){const n=t[s],o=t[s+1];if(!i.isUnoccupied(Math.min(n.x,o.x),Math.min(n.y,o.y),Math.abs(n.x-o.x),Math.abs(n.y-o.y)))return!0}return!1}findClosestSegment(t){const e=t.x,i=t.y;let s=this.getPoint(0),n=this.getPoint(1),o=Point.distanceLineSegmentSquared(e,i,s.x,s.y,n.x,n.y),r=0;for(let l=1;l<this.pointsCount-1;l++){s=this.getPoint(l+1);const a=Point.distanceLineSegmentSquared(e,i,n.x,n.y,s.x,s.y);n=s,a<o&&(r=l,o=a)}return r}invalidateGeometry(){this.ai()}ai(){this.Ra&&(this.Ra=!1,this.f())}get Ra(){return(this.Mt&128)!==0}set Ra(t){(this.Mt&128)!==0!==t&&(this.Mt=this.Mt^128)}get geometry(){if(!this.Ra){if(this.updateRoute(),this.pointsCount<2)return this.Ra=!0,this.ut;this.ut=this.makeGeometry(),this.Ra=!0}return this.ut}Td(t){if(!t){if(this.Fi===!1)return;const n=this.findMainElement();if(this.Ra&&(n===null||n.geometry!==null))return}this.pointsCount>=2&&(this.ut=this.makeGeometry()),this.Ra=!0;const e=this.path;if(e===null)return;e.ut=this.ut;const i=this.D.r,s=i.length;for(let n=0;n<s;n++){const o=i[n];o!==e&&o.isPanelMain&&o instanceof Shape&&(o.ut=this.ut)}}IE(t){return this.Qh()&&t.ra.has(this)&&(this.xl.width!==0||this.xl.height!==0)&&(t.animationManager.isAnimating||t.currentTool!==t.toolManager)}makeGeometry(){const t=this.ut,e=this.pointsCount;let i=!1;const s=this.diagram;s!==null&&this.IE(s)&&(i=!0);let n=0,o=0,r=Point.bs(this.getPoint(0));const l=Point.bs(r),a=this.Me.r,h=this.computeCurve();if(h===9&&e>=3&&!G.X(this.smoothness,0))if(e===3){let c=this.getPoint(1);n=Math.min(r.x,c.x),o=Math.min(r.y,c.y),c=this.getPoint(2),n=Math.min(n,c.x),o=Math.min(o,c.y)}else if(this.isOrthogonal){for(let c=0;c<e;c++){const f=a[c];l.x=Math.min(f.x,l.x),l.y=Math.min(f.y,l.y)}n=l.x,o=l.y}else{for(let c=3;c<e;c+=3){c+3>=e&&(c=e-1);const f=this.getPoint(c);l.x=Math.min(f.x,l.x),l.y=Math.min(f.y,l.y)}n=l.x,o=l.y}else{for(let c=0;c<e;c++){const f=a[c];l.x=Math.min(f.x,l.x),l.y=Math.min(f.y,l.y)}n=l.x,o=l.y}if(n-=this.gk.x,o-=this.gk.y,r.x-=n,r.y-=o,this.computeShortLength(!0)!==0&&(r=this.tc(r,!0,l)),e===2&&!this.Qh()){let c=Point.bs(this.getPoint(1));return c.x-=n,c.y-=o,this.computeShortLength(!1)!==0&&(c=this.tc(c,!1,l)),t.type=1,t.startX=r.x,t.startY=r.y,t.endX=c.x,t.endY=c.y,Point.i(c),Point.i(r),Point.i(l),t}else{t.type=4;const c=GeoStream.JL(t);if(c.Lu(r.x,r.y,!1,!1),h===9&&e>=3&&!G.X(this.smoothness,0))if(e===3){const f=this.getPoint(1),u=f.x-n,d=f.y-o,m=Point.bs(this.getPoint(2));m.x-=n,m.y-=o,this.computeShortLength(!1)!==0&&this.tc(m,!1,l),c.wr(u,d,u,d,m.x,m.y),Point.i(m)}else if(this.isOrthogonal){const f=Point.z(n,o),u=Point.bs(this.getPoint(1)),d=Point.z(n,o),m=Point.z(n,o);let g=this.getPoint(0),p;const y=this.smoothness/3;for(let P=1;P<this.pointsCount-1;P++){p=this.getPoint(P);const S=g,L=p,C=this.getPoint(this.EC(p,P,!1));G.X(S.x,L.x)&&G.X(L.x,C.x)||G.X(S.y,L.y)&&G.X(L.y,C.y)||(this.EE(S,L,C,y,d,m),(P===1||P===2&&G.X(g.x,this.getPoint(0).x)&&G.X(g.y,this.getPoint(0).y))&&(u.x=(g.x+p.x)*.5,u.y=(g.y+p.y)*.5),c.wr(u.x-n,u.y-o,d.x-n,d.y-o,p.x-n,p.y-o),f.h(d),u.h(m),g=p)}let x=g.x,b=g.y;const k=Point.bs(this.getPoint(this.pointsCount-1));this.computeShortLength(!1)!==0&&this.tc(k,!1,Point.dn),x=.5*(x+k.x),b=.5*(b+k.y),c.wr(m.x-n,m.y-o,x-n,b-o,k.x-n,k.y-o),Point.i(k),Point.i(f),Point.i(u),Point.i(d),Point.i(m)}else for(let f=3;f<e;f+=3){const u=this.getPoint(f-2);f+3>=e&&(f=e-1);const d=this.getPoint(f-1),m=Point.bs(this.getPoint(f));f===e-1&&this.computeShortLength(!1)!==0&&this.tc(m,!1,Point.dn),c.wr(u.x-n,u.y-o,d.x-n,d.y-o,m.x-n,m.y-o),Point.i(m)}else if(this.isOrthogonal||e===2){const f=Point.bs(this.getPoint(0)),u=Point.l(),d=Point.bs(f),m=this.computeCorner();let g=1,p=0;for(;g<e;){if(g=this.EC(f,g,g>1),u.h(this.getPoint(g)),g>=e-1){if(!f.equals(u))this.computeShortLength(!1)!==0&&this.tc(u,!1,Point.dn),this.Rn(c,-n,-o,f,u,i);else if(p===0)for(g=1;g<e;)d.h(f),u.h(this.getPoint(g++)),this.Rn(c,-n,-o,f,u,i),f.h(u);break}p=this.EC(u,g+1,g<e-3);const y=this.getPoint(p);this.UE(c,-n,-o,f,u,y,f,d,m,i),d.h(u),g=p}Point.i(f),Point.i(u),Point.i(d)}else{const f=this.computeCorner();if(e>2&&f>=.5){const u=Point.bs(a[e-1]);this.computeShortLength(!1)!==0&&this.tc(u,!1,Point.dn),r.x+=n,r.y+=o;for(let d=1;d<e;d++){const m=d===1?r:a[d-1],g=d===e-1?u:a[d],p=Math.sqrt(m.distanceSquaredPoint(g)),y=f/p;if(y<.5){if(d>1){const x=m.x+(g.x-m.x)*y,b=m.y+(g.y-m.y)*y;c.Au(m.x-n,m.y-o,x-n,b-o)}c.Ys(g.x+(m.x-g.x)*y-n,g.y+(m.y-g.y)*y-o)}else d>1&&c.Au(m.x-n,m.y-o,(m.x+g.x)/2-n,(m.y+g.y)/2-o);d===e-1&&c.Ys(u.x-n,u.y-o)}Point.i(u)}else if(e>=2){const u=Point.bs(a[e-1]);this.computeShortLength(!1)!==0&&this.tc(u,!1,Point.dn);for(let d=1;d<e-1;d++)c.Ys(a[d].x-n,a[d].y-o);c.Ys(u.x-n,u.y-o),Point.i(u)}}return GeoStream.$L(c),Point.i(r),Point.i(l),t}}kk(t,e,i,s){let n=i-t;if(isNaN(n)||n===1/0||n===-1/0)return NaN;n<0&&(n=-n);let o=s-e;return isNaN(o)||o===1/0||o===-1/0?NaN:(o<0&&(o=-o),G.X(n,0)?o:G.X(o,0)?n:Math.sqrt(n*n+o*o))}EE(t,e,i,s,n,o){isNaN(s)&&(s=this.smoothness/3);const r=t.x,l=t.y,a=e.x,h=e.y,c=i.x,f=i.y,u=s*this.kk(r,l,a,h),d=s*this.kk(a,h,c,f);if(G.X(l,h)&&G.X(a,c)&&(a>r?f>h?(n.x=a-u,n.y=h-u,o.x=a+d,o.y=h+d):(n.x=a-u,n.y=h+u,o.x=a+d,o.y=h-d):f>h?(n.x=a+u,n.y=h-u,o.x=a-d,o.y=h+d):(n.x=a+u,n.y=h+u,o.x=a-d,o.y=h-d)),G.X(r,a)&&G.X(h,f)&&(h>l?c>a?(n.x=a-u,n.y=h-u,o.x=a+d,o.y=h+d):(n.x=a+u,n.y=h-u,o.x=a-d,o.y=h+d):c>a?(n.x=a-u,n.y=h+u,o.x=a+d,o.y=h-d):(n.x=a+u,n.y=h+u,o.x=a-d,o.y=h-d)),G.X(r,a)&&G.X(a,c)||G.X(l,h)&&G.X(h,f)){const m=.5*(r+c),g=.5*(l+f);n.x=m,n.y=g,o.x=m,o.y=g}}tc(t,e,i){const s=this.pointsCount;if(s<2)return t;if(e){const n=this.getPoint(1),o=n.x-i.x,r=n.y-i.y,l=this.kk(t.x,t.y,o,r);if(l===0)return t;const a=s===2?l*.5:l;let h=this.computeShortLength(!0);h>a&&(h=a);const c=h*(o-t.x)/l,f=h*(r-t.y)/l;t.x+=c,t.y+=f}else{const n=this.getPoint(s-2),o=n.x-i.x,r=n.y-i.y,l=this.kk(t.x,t.y,o,r);if(l===0)return t;const a=s===2?l*.5:l;let h=this.computeShortLength(!1);h>a&&(h=a);const c=h*(t.x-o)/l,f=h*(t.y-r)/l;t.x-=c,t.y-=f}return t}EC(t,e,i){const s=this.pointsCount;let n=t;for(;G.X(t.x,n.x)&&G.X(t.y,n.y);){if(e>=s)return s-1;n=this.getPoint(e++)}if(!G.X(t.x,n.x)&&!G.X(t.y,n.y))return e-1;let o=n;for(;G.X(t.x,n.x)&&G.X(n.x,o.x)&&(!i||(t.y>=n.y?n.y>=o.y:n.y<=o.y))||G.X(t.y,n.y)&&G.X(n.y,o.y)&&(!i||(t.x>=n.x?n.x>=o.x:n.x<=o.x));){if(e>=s)return s-1;o=this.getPoint(e++)}return e-2}UE(t,e,i,s,n,o,r,l,a,h){if(G.c(s.y,n.y)&&G.c(n.x,o.x)){let c=Math.min(a,Math.abs(n.x-l.x)/2);const f=Math.min(c,Math.abs(o.y-n.y)/2);if(c=f,G.c(c,0)){this.Rn(t,e,i,s,n,h),r.h(n);return}let u=n.x;const d=n.y,m=u;let g=d;n.x>s.x?(u=n.x-c,o.y>n.y?g=n.y+f:g=n.y-f):(u=n.x+c,o.y>n.y?g=n.y+f:g=n.y-f);const p=Point.z(u,d);this.Rn(t,e,i,s,p,h),Point.i(p),t.Au(n.x+e,n.y+i,m+e,g+i),r.e(m,g)}else if(G.c(s.x,n.x)&&G.c(n.y,o.y)){let c=Math.min(a,Math.abs(n.y-l.y)/2);const f=Math.min(c,Math.abs(o.x-n.x)/2);if(c=f,G.c(f,0)){this.Rn(t,e,i,s,n,h),r.h(n);return}const u=n.x;let d=n.y,m=u;const g=d;n.y>s.y?(d=n.y-c,o.x>n.x?m=n.x+f:m=n.x-f):(d=n.y+c,o.x>n.x?m=n.x+f:m=n.x-f);const p=Point.z(u,d);this.Rn(t,e,i,s,p,h),Point.i(p),t.Au(n.x+e,n.y+i,m+e,g+i),r.e(m,g)}else this.Rn(t,e,i,s,n,h),r.h(n)}Rn(t,e,i,s,n,o){if(o||!this.Qh())t.Ys(n.x+e,n.y+i);else{const r=Link.rv,l=r/2,a=[];let h=0;this.isVisible()&&(h=this.VE(s,n,a));let c=s.x,f=s.y;if(h>0){if(G.c(s.y,n.y))if(s.x<n.x){let u=0;for(;u<h;){const d=Math.max(s.x,Math.min(a[u++]-l,n.x-r));t.Ys(d+e,n.y+i),c=d+e,f=n.y+i;let m=Math.min(d+r,n.x);for(;u<h;){const x=a[u];if(x<m+r)u++,m=Math.min(x+l,n.x);else break}const g=n.y-r+i,p=m+e,y=n.y+i;this.curve===10?t.Lu(p,y,!1,!1):t.wr(c,g,p,g,p,y),c=p,f=y}}else{let u=h-1;for(;u>=0;){const d=Math.min(s.x,Math.max(a[u--]+l,n.x+r));t.Ys(d+e,n.y+i),c=d+e,f=n.y+i;let m=Math.max(d-r,n.x);for(;u>=0;){const x=a[u];if(x>m-r)u--,m=Math.max(x-l,n.x);else break}const g=n.y-r+i,p=m+e,y=n.y+i;this.curve===10?t.Lu(p,y,!1,!1):t.wr(c,g,p,g,p,y),c=p,f=y}}else if(G.c(s.x,n.x))if(s.y<n.y){let u=0;for(;u<h;){const d=Math.max(s.y,Math.min(a[u++]-l,n.y-r));t.Ys(n.x+e,d+i),c=n.x+e,f=d+i;let m=Math.min(d+r,n.y);for(;u<h;){const x=a[u];if(x<m+r)u++,m=Math.min(x+l,n.y);else break}const g=n.x-r+e,p=n.x+e,y=m+i;this.curve===10?t.Lu(p,y,!1,!1):t.wr(g,f,g,y,p,y),c=p,f=y}}else{let u=h-1;for(;u>=0;){const d=Math.min(s.y,Math.max(a[u--]+l,n.y+r));t.Ys(n.x+e,d+i),c=n.x+e,f=d+i;let m=Math.max(d-r,n.y);for(;u>=0;){const x=a[u];if(x>m-r)u--,m=Math.max(x-l,n.y);else break}const g=n.x-r+e,p=n.x+e,y=m+i;this.curve===10?t.Lu(p,y,!1,!1):t.wr(g,f,g,y,p,y),c=p,f=y}}}t.Ys(n.x+e,n.y+i)}}VE(t,e,i){const s=this.diagram;if(s===null||t.equals(e))return 0;const n=s.layers;for(;n.next();){const o=n.value;if(o!==null&&o.visible){const r=o.UM(),l=r.length;for(let a=0;a<l;a++){const h=r[a];if(!(h instanceof Link))continue;if(h===this)return i.length>0&&i.sort((u,d)=>u-d),i.length;if(!h.isVisible()||!h.Qh())continue;const c=h.routeBounds;if(!c.isReal()||!this.routeBounds.intersectsRect(c)||this.usesSamePort(h))continue;const f=h.path;f!==null&&f.isVisibleObject()&&this.BE(t,e,i,h)}}}return i.length>0&&i.sort((o,r)=>o-r),i.length}BE(t,e,i,s){const n=G.c(t.y,e.y),o=s.pointsCount;let r=s.getPoint(0);const l=Point.l();for(let a=1;a<o;a++){const h=s.getPoint(a);if(a<o-1){const c=s.getPoint(a+1);if(r.y===h.y&&h.y===c.y){if(h.x>r.x&&c.x>=h.x||h.x<r.x&&c.x<=h.x)continue}else if(r.x===h.x&&h.x===c.x&&(h.y>r.y&&c.y>=h.y||h.y<r.y&&c.y<=h.y))continue}this.zE(t,e,r,h,l)&&(n?i.push(l.x):i.push(l.y)),r=h}Point.i(l)}zE(t,e,i,s,n){const o=t.x,r=t.y,l=e.x,a=e.y,h=i.x,c=i.y,f=s.x,u=s.y;if(G.c(o,l)){if(!G.c(r,a)&&G.c(c,u)&&Math.min(r,a)<c&&Math.max(r,a)>c&&Math.min(h,f)<o&&Math.max(h,f)>o&&!G.c(h,f))return n.x=o,n.y=c,!0}else if(G.c(r,a)&&G.c(h,f)&&Math.min(o,l)<h&&Math.max(o,l)>h&&Math.min(c,u)<r&&Math.max(c,u)>r&&!G.c(c,u))return n.x=h,n.y=r,!0;return n.x=0,n.y=0,!1}get firstPickIndex(){return this.pointsCount<=2?0:this.isOrthogonal||!this.bl(this.computeSpot(!0))?1:0}get lastPickIndex(){const t=this.pointsCount;return t===0?0:t<=2?t-1:this.isOrthogonal||!this.bl(this.computeSpot(!1))?t-2:t-1}Qh(){const t=this.curve;return t===11||t===10}yk(t){if(t||this.Qh()){const e=this.diagram;e!==null&&!e.animationManager.isTicking&&!e.ra.has(this)&&(this.xl.width!==0||this.xl.height!==0)&&e.ra.set(this,this.xl.copy())}}invalidateOtherJumpOvers(t){const e=this.layer;if(e===null||!e.visible||e.isTemporary)return;const i=e.diagram;if(i===null||i.animationManager.isTicking)return;let s=!1;const n=i.layers;for(;n.next();){const o=n.value;if(o.visible){if(o===e){s=!0;let r=!1;const l=o.UM(),a=l.length;for(let h=0;h<a;h++){const c=l[h];c instanceof Link&&(c===this?r=!0:r&&this.yv(c,t))}}else if(s){const r=o.UM(),l=r.length;for(let a=0;a<l;a++){const h=r[a];h instanceof Link&&this.yv(h,t)}}}}}yv(t,e){if(t===null||!t.Ra||!t.Fi||!t.Qh())return;const i=t.routeBounds;i.isReal()&&(!this.routeBounds.intersectsRect(i)&&!e.intersectsRect(i)||this.usesSamePort(t)||t.ai())}usesSamePort(t){const e=this.pointsCount,i=t.pointsCount;if(e>0&&i>0){const s=this.getPoint(0),n=t.getPoint(0);if(s.equalsApprox(n))return!0;const o=this.getPoint(e-1),r=t.getPoint(i-1);if(o.equalsApprox(r)||s.equalsApprox(r)||o.equalsApprox(n))return!0}else if(this.fromNode===t.fromNode||this.toNode===t.toNode||this.fromNode===t.toNode||this.toNode===t.fromNode)return!0;return!1}isVisible(){if(!super.isVisible())return!1;const t=this.containingGroup;let e=!0;const i=this.diagram;i!==null&&(e=i.isTreePathToChildren);const s=this.fromNode;if(s!==null){if(this.isTreeLink&&e&&!s.isTreeExpanded)return!1;if(s===t)return!0;let o=s;for(;o!==null;){if(o.labeledLink===this)return!0;o=o.containingGroup}const r=s.findVisibleNode();if(r===null||r===t)return!1}const n=this.toNode;if(n!==null){if(this.isTreeLink&&!e&&!n.isTreeExpanded)return!1;if(n===t)return!0;let o=n;for(;o!==null;){if(o.labeledLink===this)return!0;o=o.containingGroup}const r=n.findVisibleNode();if(r===null||r===t)return!1}return!0}Xe(t){if(super.Xe(t),t&&this.yk(!1),this.ir!==null&&this.ir.Jd(),this.nn!==null){const i=this.nn.iterator;for(;i.next();)i.value.Xe(t)}}get adjusting(){return this.Xf}set adjusting(t){const e=this.Xf;e!==t&&(this.Xf=t,this.t("adjusting",e,t))}computeAdjusting(){return this.isAvoiding&&this.diagram!==null&&this.diagram.animationManager.defaultAnimation.isAnimating?17:this.Xf}get corner(){return this.Qd}set corner(t){const e=this.Qd;e!==t&&(this.Qd=t,this.ai(),this.t("corner",e,t))}get curve(){return this._d}set curve(t){const e=this._d;e!==t&&(this._d=t,(e===9||t===9)&&this.DC(this.xl),this.$t(),this.ai(),this.yk(e===10||e===11||t===10||t===11),this.t("curve",e,t))}get curviness(){return this.tg}set curviness(t){const e=this.tg;e!==t&&(this.tg=t,this.$t(),this.ai(),this.t("curviness",e,t))}get routing(){return this.Wh}set routing(t){const e=this.Wh;e!==t&&(this.Wh=t,this.isAvoiding&&this.diagram!==null&&(this.diagram.lp=!0),this.er=null,this.$t(),this.yk(Link.NC(e)||Link.NC(t)),this.t("routing",e,t))}get smoothness(){return this.eg}set smoothness(t){const e=this.eg;e!==t&&(this.eg=t,this.ai(),this.t("smoothness",e,t))}Qy(){const t=this.mo;if(t===null)return;const e=this.yo;if(e===null||!isNaN(this.curviness))return;const i=this.po,s=this.wo;let n=null,o=null;const r=t.ee.r,l=r.length;for(let a=0;a<l;a++){const h=r[a];!(h.mo===t&&h.po===i&&h.yo===e&&h.wo===s)&&!(h.mo===e&&h.po===s&&h.yo===t&&h.wo===i)||(o===null?o=h:(n===null&&(n=[],n.push(o)),n.push(h)))}if(n!==null){let a=t.qD(e,i,s);a===null&&(a=new LinkBundle(t,i,e,s),t.KD(a),e.KD(a)),a.on=n;for(let h=0;h<n.length;h++){const c=n[h];c.ir=a}a.Jd()}}Zy(){const t=this.ir;if(t!==null){if(!isNaN(this.curviness))return;this.ir=null;const e=t.on.indexOf(this);e>=0&&(t.on.splice(e,1),t.Jd())}}Lr(){return!0}get key(){const t=this.diagram;if(!(t===null||!t.model.jh()))return t.model.getKeyForLinkData(this.data)}}class LinkBundle{Yo;qs;Gy;yC;fk;wC;on;constructor(t,e,i,s){GSet.Je(this),this.Yo=!1,this.qs=!1,this.Gy=t,this.yC=e,this.fk=i,this.wC=s,this.on=[]}Jd(){if(!this.Yo){const t=this.on;if(t.length>0){const e=t[0].diagram;e!==null&&(e.l2.add(this),this.qs=e.undoManager.isUndoingRedoing)}}this.Yo=!0}S2(){if(this.Yo){this.Yo=!1;const t=this.on;if(t.length>0){const e=t[0],i=e.diagram,s=i===null||i.Qa&&!this.qs;this.qs=!1,e.arrangeBundledLinks(t,s),t.length===1&&(e.ir=null,t.length=0)}t.length===0&&(this.Gy.HD(this),this.fk.HD(this))}}}class PositionArray{ui;di;ec;ic;we;xe;Bt;Oa;Ia;Ah;E2;Yo;tw;af;U2;V2;constructor(t){GSet.Je(this),this.Ah=null,this.E2=null,this.Yo=!0,this.tw=!1,this.ui=1,this.di=1,this.ec=-1,this.ic=-1,this.we=t.width,this.xe=t.height,this.Bt=[],this.Oa=0,this.Ia=0,this.af=Link.dv,this.U2=this.af*2,this.V2=this.af*2}static rn=0;static sc=1;static sg=999999;static UC=PositionArray.sg+1;static VC=PositionArray.sg+2;f1(t){if(t.width<=0||t.height<=0)return;const e=t.x,i=t.y,s=t.x+t.width,n=t.y+t.height;this.ui=Math.floor((e-this.we)/this.we)*this.we,this.di=Math.floor((i-this.xe)/this.xe)*this.xe,this.ec=Math.ceil((s+2*this.we)/this.we)*this.we,this.ic=Math.ceil((n+2*this.xe)/this.xe)*this.xe;const o=1+(Math.ceil((this.ec-this.ui)/this.we)|0),r=1+(Math.ceil((this.ic-this.di)/this.xe)|0);if(this.Bt.length===0||this.Oa<o-1||this.Ia<r-1){const l=[];for(let a=0;a<=o;a++)l[a]=new Uint32Array(r);this.Bt=l,this.Oa=o-1,this.Ia=r-1}this.XE(PositionArray.UC)}get bounds(){return new Rect(this.ui,this.di,this.ec-this.ui,this.ic-this.di)}get cellWidth(){return this.we}set cellWidth(t){t>0&&t!==this.we&&(this.we=t,this.f1(this.bounds))}get cellHeight(){return this.xe}set cellHeight(t){t>0&&t!==this.xe&&(this.xe=t,this.f1(this.bounds))}ng(t,e){return this.ui<=t&&t<=this.ec&&this.di<=e&&e<=this.ic}xo(t,e){if(!this.ng(t,e))return PositionArray.UC;t-=this.ui,t/=this.we,e-=this.di,e/=this.xe;const i=t|0,s=e|0;return this.Bt[i][s]}FO(t,e,i,s){if(!this.ng(t,e))return;const n=(t-this.ui)/this.we|0,o=(e-this.di)/this.xe|0,r=(t+i-this.ui)/this.we|0,l=(e+s-this.di)/this.xe|0,a=Math.min(r,this.Oa),h=Math.min(l,this.Ia);for(let c=n;c<=a;c++){const f=this.Bt[c];if(f.fill)f.fill(PositionArray.rn,o,h+1);else for(let u=o;u<=h;u++)f[u]=PositionArray.rn}}XE(t){for(let e=0;e<=this.Oa;e++){const i=this.Bt[e];if(i.fill)i.fill(t);else for(let s=0;s<=this.Ia;s++)i[s]=t}}vT(){for(let t=0;t<=this.Oa;t++){const e=this.Bt[t];for(let i=0;i<=this.Ia;i++)e[i]>=PositionArray.sc&&(e[i]=PositionArray.UC)}}GE(t,e){return this.xo(t,e)===PositionArray.rn}isUnoccupied(t,e,i,s){if(t>this.ec||t+i<this.ui||e>this.ic||e+s<this.di)return!0;let n=(t-this.ui)/this.we|0,o=(e-this.di)/this.xe|0,r=Math.max(0,i)/this.we+1|0,l=Math.max(0,s)/this.xe+1|0;if(n<0&&(r+=n,n=0),o<0&&(l+=o,o=0),r<0||l<0)return!0;const a=Math.min(n+r-1,this.Oa)|0,h=Math.min(o+l-1,this.Ia)|0;for(let c=n;c<=a;c++){const f=this.Bt[c];for(let u=o;u<=h;u++)if(f[u]===PositionArray.rn)return!1}return!0}maxAvoidsLinksSpaceH(t,e,i,s){if(t>this.ec||e<this.ui||i>this.ic||i<this.di)return 0;const n=(t-this.ui)/this.we|0,o=(e-this.ui)/this.we|0,r=(i-this.di)/this.xe|0,l=s/this.xe+1|0;let a;for(a=0;a<l/2;a++){let h=!1;for(let c=n;c<=o;c++)if(this.Bt[c][r+a]===PositionArray.rn||this.Bt[c][r-a]===PositionArray.rn){h=!0;break}if(h)return Math.max(0,(2*a-1)*this.xe)}return s}maxAvoidsLinksSpaceV(t,e,i,s){if(t>this.ic||e<this.di||i>this.ec||i<this.ui)return 0;const n=(t-this.di)/this.xe|0,o=(e-this.di)/this.xe|0,r=(i-this.ui)/this.we|0,l=s/this.we+1|0;let a;for(a=0;a<l/2;a++){let h=!1;for(let c=n;c<=o;c++)if(this.Bt[r+a][c]===PositionArray.rn||this.Bt[r-a][c]===PositionArray.rn){h=!0;break}if(h)return Math.max(0,(2*a-1)*this.we)}return s}YE(t,e,i,s,n,o,r,l){t=t|0,e=e|0;let a=this.Bt[t][e];if(a>=PositionArray.sc&&a<PositionArray.sg)for(s?e+=i:t+=i,a+=1;n<=t&&t<=o&&r<=e&&e<=l;){const h=this.Bt[t][e];if(a>=h)break;this.Bt[t][e]=a,a+=1,s?e+=i:t+=i}return s?e:t}bo(t,e,i,s,n,o,r,l){if(t<n||t>o||e<r||e>l)return;const a=this.YE(t,e,i,s,n,o,r,l);if(s)if(i>0)for(let h=e+i;h<a;h+=i)this.bo(t,h,1,!s,n,o,r,l),this.bo(t,h,-1,!s,n,o,r,l);else for(let h=e+i;h>a;h+=i)this.bo(t,h,1,!s,n,o,r,l),this.bo(t,h,-1,!s,n,o,r,l);else if(i>0)for(let h=t+i;h<a;h+=i)this.bo(h,e,1,!s,n,o,r,l),this.bo(h,e,-1,!s,n,o,r,l);else for(let h=t+i;h>a;h+=i)this.bo(h,e,1,!s,n,o,r,l),this.bo(h,e,-1,!s,n,o,r,l)}Pk(t,e,i,s,n,o,r,l,a,h){let c=t|0,f=e|0,u=PositionArray.rn,d=PositionArray.sc;for(this.Bt[c][f]=d;u===PositionArray.rn&&c>r&&c<l&&f>a&&f<h;)d+=1,this.Bt[c][f]=d,o?f+=n:c+=n,u=this.Bt[c][f];return o?f:c}Sk(t,e,i,s,n,o,r,l,a,h){let c=i|0,f=s|0,u=PositionArray.rn;const d=PositionArray.sg;for(this.Bt[c][f]=d;u===PositionArray.rn&&c>r&&c<l&&f>a&&f<h;)this.Bt[c][f]=d,o?f+=n:c+=n,u=this.Bt[c][f]}wv(t,e,i,s,n,o){this.tw=!1;let r=t.x,l=t.y;if(!this.ng(r,l))return;r-=this.ui,r/=this.we,l-=this.di,l/=this.xe;let a=i.x,h=i.y;if(!this.ng(a,h))return;if(a-=this.ui,a/=this.we,h-=this.di,h/=this.xe,Math.abs(r-a)<=1&&Math.abs(l-h)<=1){this.tw=!0;return}let c=n.x,f=n.y,u=n.x+n.width,d=n.y+n.height;c-=this.ui,c/=this.we,f-=this.di,f/=this.xe,u-=this.ui,u/=this.we,d-=this.di,d/=this.xe;const m=Math.max(0,Math.min(this.Oa,c|0)),g=Math.min(this.Oa,Math.max(0,u|0)),p=Math.max(0,Math.min(this.Ia,f|0)),y=Math.min(this.Ia,Math.max(0,d|0)),x=0,b=90,k=270,P=this.Bt,S=r|0,L=l|0,C=a|0,M=h|0,N=e===x||e===b?1:-1,A=e===b||e===k;P[S][L]===PositionArray.rn?(this.Pk(S,L,C,M,N,A,m,g,p,y),this.Pk(S,L,C,M,1,!A,m,g,p,y),this.Pk(S,L,C,M,-1,!A,m,g,p,y)):this.Pk(S,L,C,M,N,A,S,L,S,L),P[C][M]===PositionArray.rn?(this.Sk(S,L,C,M,s===x||s===b?1:-1,s===b||s===k,m,g,p,y),this.Sk(S,L,C,M,1,!(s===b||s===k),m,g,p,y),this.Sk(S,L,C,M,-1,!(s===b||s===k),m,g,p,y)):this.Sk(S,L,C,M,N,A,C,M,C,M);const T=U.nt();if(o&&this.xv(C,M,s,S,L,T)){(T[0]!==C||T[1]!==M)&&(T.unshift(M),T.unshift(C)),(T[T.length-2]!==S||T[T.length-1]!==L)&&(T.push(S),T.push(L));let D=PositionArray.sc,v=T[T.length-2],R=T[T.length-1];P[v][R]=D++;for(let F=T.length-4;F>=0;F-=2){v=T[F+2],R=T[F+3];const O=T[F],z=T[F+1];for(;O>v?v++:O<v?v--:z>R?R++:z<R&&R--,P[v][R]=D++,!(v===O&&R===z););}}else this.bo(S,L,1,!1,m,g,p,y),this.bo(S,L,-1,!1,m,g,p,y),this.bo(S,L,1,!0,m,g,p,y),this.bo(S,L,-1,!0,m,g,p,y);U.Z(T)}xv(t,e,i,s,n,o){const c=this.Bt;let f=t,u=e;for(;;){if(f===s&&u===n)return!0;let d=f,m=u;if(i===0)if(d<s)d++;else break;else if(i===90)if(m<n)m++;else break;else if(i===180)if(d>s)d--;else break;else if(m>n)m--;else break;const g=c[d][m];if(g===0||g===PositionArray.VC)break;f=d,u=m}for(;;){let d=i,m=f,g=u;i===0?g<n?(d=90,g++):g>n&&(d=270,g--):i===90?m<s?(d=0,m++):m>s&&(d=180,m--):i===180?g<n?(d=90,g++):g>n&&(d=270,g--):m<s?(d=0,m++):m>s&&(d=180,m--);const p=c[m][g];if(d!==i&&p!==0&&p!==PositionArray.VC){if(o.push(f),o.push(u),this.xv(f,u,d,s,n,o))return!0;o.pop(),o.pop()}if(c[f][u]=PositionArray.VC,i===0){if(f===t)return!1;f--}else if(i===90){if(u===e)return!1;u--}else if(i===180){if(f===t)return!1;f++}else{if(u===e)return!1;u++}}}}class Knot{Ri;kl;Ei;og;constructor(t,e){GSet.Je(this),this.Ri=t,this.kl=e,this.Ei=[],this.og=!1}toString(){const t=this.Ei;let e=this.Ri.toString()+" "+t.length.toString()+":";for(let i=0;i<t.length;i++){const s=t[i];s!==null&&(e+=`
  `+s.toString())}return e}KE(t,e,i,s){const n=e.offsetY;switch(n){case 8:return 90;case 2:return 180;case 1:return 270;case 4:return 0}let o=i;switch(n){case 9:return o>180?270:90;case 6:return o>90&&o<=270?180:0}const r=Math.atan2(t.height,t.width)*180/Math.PI;switch(n){case 3:return o>r&&o<=180+r?180:270;case 5:return o>180-r&&o<=360-r?270:0;case 12:return o>r&&o<=180+r?90:0;case 10:return o>180-r&&o<=360-r?180:90;case 7:return o>90&&o<=180+r?180:o>180+r&&o<=360-r?270:0;case 13:return o>180&&o<=360-r?270:o>r&&o<=180?90:0;case 14:return o>r&&o<=180-r?90:o>180-r&&o<=270?180:0;case 11:return o>180-r&&o<=180+r?180:o>180+r?270:90}return s&&n!==15&&(o-=15,o<0&&(o+=360)),o>r&&o<180-r?90:o>=180-r&&o<=180+r?180:o>180+r&&o<360-r?270:0}Jd(){this.Ei.length=0}gv(t){let e=this.Ei;e.length===0&&(this.HE(),e=this.Ei);for(let i=0;i<e.length;i++){const s=e[i];if(s!==null&&s.ts===t)return s}return null}HE(){if(!this.og){const t=this.og;this.og=!0;let e,i=null;const s=this.Ri,n=s instanceof Group?s:null;if(n!==null&&!n.isSubGraphExpanded){if(!n.actualBounds.isReal())return this.og=t,this.Ei;i=n,e=i.findExternalLinksConnected()}else s.isTreeExpanded?e=s.findLinksConnected(this.kl.portId):e=s.findExternalTreeLinksConnected();this.Ei.length=0;let o=0;const r=this.kl.getDocumentPoint(Spot.TopLeft,Point.l()),l=this.kl.getDocumentPoint(Spot.BottomRight,Point.l()),a=Rect.z(r.x,r.y,0,0);a.unionPoint(l),Point.i(r),Point.i(l);const h=Point.z(a.x+a.width/2,a.y+a.height/2),c=this.kl.getDocumentAngle(),f=e.iterator;for(;f.next();){const g=f.value;if(!g.isVisible()||g.fromPort===g.toPort)continue;const p=g.fromPort===this.kl||i!==null&&g.fromNode!==null&&g.fromNode.isMemberOf(i),y=g.computeSpot(p,this.kl);if(!y.isSide())continue;let x;if(p?x=g.toPort:x=g.fromPort,x===null)continue;let b=x.part;if(b===null)continue;const k=b.findVisibleNode();k!==null&&k!==b&&(b=k,x=b.port);const P=g.computeOtherPoint(b,x);let S=h.directionPoint(P);c!==0&&(S=G.Ee(S-c));const L=this.KE(a,y,S,g.isOrthogonal);let C=0;L===0?(C=4,S>180&&(S-=360)):L===90?(C=8,S>270&&(S-=360)):L===180?C=2:(C=1,S<90&&(S+=360));let M=this.Ei[o];M===void 0?(M=new LinkInfo(g,S,C),this.Ei[o]=M):(M.ts=g,M.Xt=S,M.fi=C),M.Mk.h(P),o++}Point.i(h),this.qE();const u=this.Ei.length;let d=-1,m=0;for(o=0;o<u;o++){const g=this.Ei[o];g!==void 0&&(g.fi!==d&&(d=g.fi,m=0),g.rg=m,m++)}for(d=-1,m=0,o=u-1;o>=0;o--){const g=this.Ei[o];g!==void 0&&(g.fi!==d&&(d=g.fi,m=g.rg+1),g.Yf=m)}this.jE(this.Ei),this.WE(this.Ei),this.og=t,Rect.i(a)}return this.Ei}JE(t,e){return t===e?0:t===null?-1:e===null?1:t.fi<e.fi?-1:t.fi>e.fi?1:t.Xt<e.Xt?-1:t.Xt>e.Xt?1:0}qE(){this.Ei.sort(Knot.prototype.JE)}jE(t){const e=this.kl,i=this.Ri.portSpreading,s=Point.l(),n=Point.l(),o=Point.l(),r=Point.l();e.getDocumentPoint(Spot.TopLeft,s),e.getDocumentPoint(Spot.TopRight,n),e.getDocumentPoint(Spot.BottomRight,o),e.getDocumentPoint(Spot.BottomLeft,r);let l=0,a=0,h=0,c=0;if(i===2)for(let x=0;x<t.length;x++){const b=t[x];if(b===null)continue;const k=b.ts.computeThickness();switch(b.fi){case 8:h+=k;break;case 2:c+=k;break;case 1:l+=k;break;default:case 4:a+=k;break}}let f=0,u=0,d=1,m=n,g=o,p=0,y=0;for(let x=0;x<t.length;x++){const b=t[x];if(b===null)continue;if(f!==b.fi){switch(f=b.fi,f){case 8:m=o,g=r;break;case 2:m=r,g=s;break;case 1:m=s,g=n;break;default:case 4:m=n,g=o;break}switch(p=g.x-m.x,y=g.y-m.y,f){case 8:h>Math.abs(p)?(d=Math.abs(p)/h,h=Math.abs(p)):d=1;break;case 2:c>Math.abs(y)?(d=Math.abs(y)/c,c=Math.abs(y)):d=1;break;case 1:l>Math.abs(p)?(d=Math.abs(p)/l,l=Math.abs(p)):d=1;break;default:case 4:a>Math.abs(y)?(d=Math.abs(y)/a,a=Math.abs(y)):d=1;break}u=0}const k=b._h;if(i===2){let P=b.ts.computeThickness();switch(P*=d,k.h(m),f){case 8:k.x=m.x+p/2+h/2-u-P/2;break;case 2:k.y=m.y+y/2+c/2-u-P/2;break;case 1:k.x=m.x+p/2-l/2+u+P/2;break;default:case 4:k.y=m.y+y/2-a/2+u+P/2;break}u+=P}else{let P=.5;i===1&&(P=(b.rg+1)/(b.Yf+1)),k.x=m.x+p*P,k.y=m.y+y*P}}Point.i(s),Point.i(n),Point.i(o),Point.i(r)}WE(t){for(let e=0;e<t.length;e++){const i=t[e];i!==null&&(i.bk=this.$E(i,e))}}$E(t,e){const i=t.ts,s=i.fromPort===this.kl;let n=0;switch(t.fi){case 1:n=270;break;case 2:n=180;break;case 4:n=0;break;case 8:n=90;break}const o=i.wk(this.Ri,this.kl,Spot.None,s,n);let r=t.rg;if(r<0)return o;const l=t.Yf;if(l<=1||!i.isOrthogonal)return o;const h=t.Mk,c=t._h,f=t.fi===2||t.fi===8;f&&(r=l-1-r);const u=Link.iv,d=t.fi===2||t.fi===4,m=r<=0?c:this.Ei[f?e+1:e-1]._h,g=r>=l-1?c:this.Ei[f?e-1:e+1]._h;return(d?h.y>=m.y&&h.y<=g.y:h.x>=m.x&&h.x<=g.x)?o:(d?h.y<c.y:h.x<c.x)?o+r*u:o+(l-1-r)*u}}class LinkInfo{ts;Xt;fi;Mk;rg;Yf;_h;bk;constructor(t,e,i){this.ts=t,this.Xt=e,this.fi=i,this.Mk=new Point,this.rg=0,this.Yf=0,this._h=new Point,this.bk=0}toString(){return this.ts.toString()+" "+this.Xt.toString()+" "+this.fi.toString()+":"+this.rg.toString()+"/"+this.Yf.toString()+" "+this._h.toString()+" "+this.bk.toString()+" "+this.Mk.toString()}}class LinkSettings{Dh;vh;Fh;Rh;Oh;Ih;c0;a0;f0;h0;constructor(){this.Dh=Spot.Default,this.vh=Spot.Default,this.Fh=NaN,this.Rh=NaN,this.Oh=NaN,this.Ih=NaN,this.c0=null,this.a0=null,this.f0=1/0,this.h0=1/0}copy(){const t=new LinkSettings;return t.Dh=this.Dh.N(),t.vh=this.vh.N(),t.Fh=this.Fh,t.Rh=this.Rh,t.Oh=this.Oh,t.Ih=this.Ih,t.c0=this.c0,t.a0=this.a0,t.f0=this.f0,t.h0=this.h0,t}}class LinkElementSettings{t0;e0;i0;_p;q0;j0;constructor(){this.t0=-1/0,this.e0=0,this.i0=Point.dn,this._p=0,this.q0="None",this.j0="None"}copy(){const t=new LinkElementSettings;return t.t0=this.t0,t.e0=this.e0,t.i0=this.i0.N(),t._p=this._p,t.q0=this.q0,t.j0=this.j0,t}}class Group extends Node{lg;Dt;Ch;Fp;he;li;constructor(t,e){let i;t===void 0||t instanceof PanelLayout||typeof t=="string"?i=t:t&&(e=t),super(i),this.E=this.E|4608,this.lg=new GSet,this.Dt=null,this.li=new Layout,this.li.group=this,this.Ch=new GSet,this.Fp=null,this.he=null,e&&Object.assign(this,e)}cloneProtected(t){super.cloneProtected(t),this.E=this.E&-32769;const e=t.findInVisualTree(i=>i instanceof Placeholder);e instanceof Placeholder?t.Dt=e:t.Dt=null,this.li!==null?(t.li=this.li.copy(),t.li.group=t):(t.li!==null&&(t.li.group=null),t.li=null),this.he!==null&&(t.he=this.he.copy())}Ho(t){super.Ho(t);const e=t.findSubGraphParts(),i=t.memberParts;for(;i.next();){const s=i.value;if(s.f(),s.invalidateLayout(8),s.clearAdornments(),s instanceof Node)s.invalidateConnectedLinks(e);else if(s instanceof Link){const n=s.labelNodes;for(;n.next();)n.value.invalidateConnectedLinks(e)}}}df(t,e,i,s,n,o,r){if(t===3&&e==="elements"){if(n instanceof Placeholder)this.Dt===null?this.Dt=n:this.Dt!==n&&U.o("Cannot insert a second Placeholder into the visual tree of a Group.");else if(n instanceof Panel){const l=n.findInVisualTree(a=>a instanceof Placeholder);l instanceof Placeholder&&(this.Dt===null?this.Dt=l:this.Dt!==l&&U.o("Cannot insert a second Placeholder into the visual tree of a Group."))}}else t===4&&e==="elements"&&this.Dt!==null&&(s===this.Dt?this.Dt=null:s instanceof Panel&&this.Dt.isContainedBy(s)&&(this.Dt=null));super.df(t,e,i,s,n,o,r)}kd(t,e){if(super.kd(t,e),this.isClipping&&this.type!==Panel.Spot&&this.isSubGraphExpanded){let i=this.resizeObject;i instanceof Panel&&(i=i.findMainElement()),this.he===null&&(this.he=new Rect),i.getDocumentBounds(this.he),i instanceof Shape&&this.he.inflate(-i.strokeWidth,-i.strokeWidth)}}Pa(t,e,i,s){this.hasPlaceholder()&&(this.tr=this.placeholder),super.Pa(t,e,i,s)}ensureBounds(){this.isSubGraphExpanded&&this.memberParts.each(e=>{e.ensureBounds()}),super.ensureBounds()}Qr(){if(!super.Qr())return!1;const t=this.memberParts;for(;t.next();){const e=t.value;if(e instanceof Node){if(!e.isVisible())continue;if(e.as())return!1}else if(e instanceof Link){if(!e.isVisible())continue;if(e.as()&&e.fromNode!==this&&e.toNode!==this)return!1}}return!0}hasPlaceholder(){return this.Dt!==null&&this.Dt.isVisibleObject()&&this.isSubGraphExpanded}get placeholder(){return this.Dt}get computesBoundsAfterDrag(){return(this.E&2048)!==0}set computesBoundsAfterDrag(t){const e=(this.E&2048)!==0;e!==t&&(this.E=this.E^2048,this.t("computesBoundsAfterDrag",e,t))}get computesBoundsIncludingLinks(){return(this.E&4096)!==0}set computesBoundsIncludingLinks(t){const e=(this.E&4096)!==0;e!==t&&(this.E=this.E^4096,this.t("computesBoundsIncludingLinks",e,t))}get computesBoundsIncludingLocation(){return(this.E&8192)!==0}set computesBoundsIncludingLocation(t){const e=(this.E&8192)!==0;e!==t&&(this.E=this.E^8192,this.t("computesBoundsIncludingLocation",e,t))}get handlesDragDropForMembers(){return(this.E&16384)!==0}set handlesDragDropForMembers(t){const e=(this.E&16384)!==0;e!==t&&(this.E=this.E^16384,this.t("handlesDragDropForMembers",e,t))}get avoidableMembers(){return(this.E&131072)!==0}set avoidableMembers(t){const e=(this.E&131072)!==0;e!==t&&(this.E=this.E^131072,this.t("avoidableMembers",e,t))}get memberParts(){return this.lg.iterator}dC(t){if(this.lg.add(t)){t instanceof Group&&this.Ch.add(t);const i=this.memberAdded;if(i!==null){let s=!0;const n=this.diagram;n!==null&&(s=n.G,n.G=!0),i(this,t),n!==null&&(n.G=s)}(!this.isVisible()||!this.isSubGraphExpanded)&&t.Xe(!1)}if(t instanceof Link&&!this.computesBoundsIncludingLinks)return;let e=this.Dt;e===null&&(e=this),e.f()}uC(t){if(this.lg.delete(t)){t instanceof Group&&this.Ch.delete(t);const i=this.memberRemoved;if(i!==null){let s=!0;const n=this.diagram;n!==null&&(s=n.G,n.G=!0),i(this,t),n!==null&&(n.G=s)}(!this.isVisible()||!this.isSubGraphExpanded)&&t.Xe(!0)}if(t instanceof Link&&!this.computesBoundsIncludingLinks)return;let e=this.Dt;e===null&&(e=this),e.f()}rf(){if(this.lg.count>0){const t=this.diagram;if(t!==null){const i=this.lg.copy().iterator;for(;i.next();){const s=i.value;t.remove(s)}}}super.rf()}get layout(){return this.li}set layout(t){const e=this.li;if(e!==t){t!==null&&t.diagram!==null&&t.diagram.layout===t&&U.o("A layout cannot be both the Diagram.layout and a Group.layout: "+t),e!==null&&(e.diagram=null,e.group=null),this.li=t;const i=this.diagram;t!==null&&(t.diagram=i,t.group=this),i!==null&&(i.Jr=!0),this.t("layout",e,t),i!==null&&i.requestUpdate()}}get memberAdded(){return this.vt!==null?this.vt.Wy:null}set memberAdded(t){const e=this.memberAdded;e!==t&&(t!==null&&U.S(t,Group,"memberAdded"),this.yl().Wy=t,this.t("memberAdded",e,t))}get memberRemoved(){return this.vt!==null?this.vt.Jy:null}set memberRemoved(t){const e=this.memberRemoved;e!==t&&(t!==null&&U.S(t,Group,"memberRemoved"),this.yl().Jy=t,this.t("memberRemoved",e,t))}get memberValidation(){return this.vt!==null?this.vt.da:null}set memberValidation(t){const e=this.memberValidation;e!==t&&(t!==null&&U.S(t,Group,"memberValidation"),this.yl().da=t,this.t("memberValidation",e,t))}canAddMembers(t){const e=this.diagram;if(e===null)return!1;const i=e.commandHandler,n=i.xN(t).iterator;for(;n.next();){const o=n.value;if(!i.isValidMember(this,o))return!1}return!0}addMembers(t,e){const i=this.diagram;if(i===null)return!1;const s=i.commandHandler,n=s.xN(t);let o=!0;const r=n.iterator;for(;r.next();){const l=r.value;!e||s.isValidMember(this,l)?l.containingGroup=this:o=!1}return o}get ungroupable(){return(this.E&256)!==0}set ungroupable(t){const e=(this.E&256)!==0;e!==t&&(this.E=this.E^256,this.t("ungroupable",e,t))}canUngroup(){if(!this.ungroupable)return!1;const t=this.layer;if(t===null||!t.allowUngroup)return!1;const e=t.diagram;return!(e!==null&&!e.allowUngroup)}invalidateConnectedLinks(t){const e=this.ZE();if(super.invalidateConnectedLinks(t),e)return;this.uT(!0);const i=this.findExternalLinksConnected();for(;i.next();){const s=i.value;if(t!==void 0&&t.has(s))continue;const n=s.fromNode;if(n!==null&&n!==this&&n.isMemberOf(this)&&!n.isVisible())n.Ze(s.fromPort),n.Ze(s.toPort),s.$t();else{const o=s.toNode;o!==null&&o!==this&&o.isMemberOf(this)&&!o.isVisible()&&(o.Ze(s.fromPort),o.Ze(s.toPort),s.$t())}}}findExternalLinksConnected(){const t=this.diagram!==null&&this.diagram.d2;if(t&&this.Fp!==null)return this.Fp.iterator;const e=this.findSubGraphParts();e.add(this);const i=new GSet,s=e.iterator;for(;s.next();){const n=s.value;if(!(n instanceof Node))continue;const o=n.linksConnected;for(;o.next();){const r=o.value;e.has(r)||i.add(r)}}return t&&(this.Fp=i),i.iterator}findExternalNodesConnected(){const t=this.findSubGraphParts();t.add(this);const e=new GSet,i=t.iterator;for(;i.next();){const s=i.value;if(!(s instanceof Node))continue;const n=s.linksConnected;for(;n.next();){const o=n.value,r=o.fromNode;r!==null&&(!t.has(r)||r===this)&&e.add(r);const l=o.toNode;l!==null&&(!t.has(l)||l===this)&&e.add(l)}}return e.iterator}XU(){function t(i,s){i!==null&&(s.add(i),t(i.containingGroup,s))}const e=new GSet;return t(this,e),e}findSubGraphParts(){const t=new GSet;return Part.ga(t,this,!0,0,!0),t.delete(this),t}Xe(t){super.Xe(t);const e=this.memberParts;for(;e.next();)e.value.Xe(t)}collapseSubGraph(){const t=this.diagram;if(t===null||t.isCollapsingExpanding)return;t.isCollapsingExpanding=!0;const e=this.findSubGraphParts();this.bv(e,t,this),t.isCollapsingExpanding=!1}bv(t,e,i){const s=this.memberParts;for(;s.next();){const n=s.value;if(n.Xe(!1),n instanceof Group&&n.isSubGraphExpanded&&(n.wasSubGraphExpanded=n.isSubGraphExpanded,n.bv(t,e,i)),n instanceof Node)n.invalidateConnectedLinks(t),e.Yc(n,i);else if(n instanceof Link){const o=n.labelNodes;for(;o.next();)o.value.invalidateConnectedLinks(t)}}this.isSubGraphExpanded=!1}expandSubGraph(){const t=this.diagram;if(t===null||t.isCollapsingExpanding)return;t.isCollapsingExpanding=!0;const e=this.findSubGraphParts();this.kv(e,t,this),t.isCollapsingExpanding=!1}kv(t,e,i){const s=this.memberParts;for(;s.next();){const n=s.value;if(n.Xe(!0),n instanceof Group&&n.wasSubGraphExpanded&&(n.wasSubGraphExpanded=!1,n.kv(t,e,i)),n instanceof Node)n.invalidateConnectedLinks(t);else if(n instanceof Link){const o=n.labelNodes;for(;o.next();)o.value.invalidateConnectedLinks(t)}}this.isSubGraphExpanded=!0}get isSubGraphExpanded(){return(this.E&512)!==0}set isSubGraphExpanded(t){const e=(this.E&512)!==0;if(e!==t){this.E=this.E^512;const i=this.diagram;this.t("isSubGraphExpanded",e,t);const s=this.subGraphExpandedChanged;if(s!==null){let n=!0;i!==null&&(n=i.G,i.G=!0),s(this),i!==null&&(i.G=n)}if(i!==null&&i.undoManager.isUndoingRedoing){this.Dt!==null&&this.Dt.f(),this.memberParts.each(n=>n.updateAdornments());return}t?this.expandSubGraph():this.collapseSubGraph()}}get wasSubGraphExpanded(){return(this.E&1024)!==0}set wasSubGraphExpanded(t){const e=(this.E&1024)!==0;e!==t&&(this.E=this.E^1024,this.t("wasSubGraphExpanded",e,t))}get subGraphExpandedChanged(){return this.vt!==null?this.vt.$y:null}set subGraphExpandedChanged(t){const e=this.subGraphExpandedChanged;e!==t&&(t!==null&&U.S(t,Group,"subGraphExpandedChanged"),this.yl().$y=t,this.t("subGraphExpandedChanged",e,t))}move(t,e){e===void 0&&(e=!1);const i=e?this.location:this.position,s=i.x,n=i.y,o=t.x,r=t.y;if((s===o||isNaN(s)&&isNaN(o))&&(n===r||isNaN(n)&&isNaN(r)))return;const l=o-(isNaN(s)?0:s),a=r-(isNaN(n)?0:n),h=Point.l();super.move(t,e);const c=new GSet,u=this.findSubGraphParts().iterator;for(;u.next();){const d=u.value;d instanceof Link&&(d.suspendsRouting&&c.add(d),!(!d.Fi&&(d.fromNode===this||d.toNode===this))&&(d.suspendsRouting=!0))}for(u.reset();u.next();){const d=u.value;if(d.Lr()||d instanceof Node&&d.isLinkLabel)continue;const m=d.position,g=d.location;m.isReal()?(h.x=m.x+l,h.y=m.y+a,d.position=h):g.isReal()&&(h.x=g.x+l,h.y=g.y+a,d.location=h)}for(u.reset();u.next();){const d=u.value;if(!(d instanceof Link)||(d.suspendsRouting=c.has(d),!d.Fi&&(d.fromNode===this||d.toNode===this)))continue;const m=d.position;h.x=m.x+l,h.y=m.y+a,h.isReal()?d.move(h):d.$t()}Point.i(h)}ZE(){return(this.E&65536)!==0}uT(t){(this.E&65536)!==0!==t&&(this.E=this.E^65536)}get Lh(){return(this.E&32768)!==0}set Lh(t){(this.E&32768)!==0!==t&&(this.E=this.E^32768)}}class Placeholder extends GraphObject{Qt;ag;constructor(t){super(),this.Qt=Margin.im,this.ag=new Rect(NaN,NaN,NaN,NaN),t&&Object.assign(this,t)}cloneProtected(t){super.cloneProtected(t),t.Qt=this.Qt.N(),t.ag=this.ag.copy()}ka(t){if(this.background===null)return!1;const e=this.naturalBounds;return Rect.contains(0,0,e.width,e.height,t.x,t.y)}bd(t,e,i,s){const n=this.part;if((n===null||!(n instanceof Group)&&!(n instanceof Adornment))&&U.o("Placeholder is not inside a Group or Adornment."),n instanceof Group){const o=this.computeBorder(this.ag),r=this.minSize,l=isFinite(r.width)?Math.max(r.width,o.width):o.width,a=isFinite(r.height)?Math.max(r.height,o.height):o.height,h=this.Ke;h.Hn(l||0,a||0),this.ro(0,0,h.width,h.height);const c=n.memberParts;let f=!1;for(;c.next();)if(c.value.isVisible()){f=!0;break}const u=n.diagram;if(f&&u!==null&&!u.animationManager.LM(n)&&!isNaN(o.x)&&!isNaN(o.y)){const d=Point.l();d.setRectSpot(o,n.locationSpot),n.location=d,Point.i(d)}}else{const o=n,r=this.Ke,l=this.Qt,a=l.left+l.right,h=l.top+l.bottom,c=o.adornedObject,f=c.getDocumentAngle();o.angle=f;let u=0;c instanceof Shape&&(u=c.strokeWidth);const d=c.getDocumentScale(),m=c.naturalBounds,g=(m.width+u)*d,p=(m.height+u)*d;if(o.type!==Panel.Link){const y=o.category==="Selection"?Spot.TopLeft:o.locationSpot,x=c.getDocumentPoint(y,Point.l());o.location=x,Point.i(x)}if(!isNaN(g)&&!isNaN(p))r.Hn(g+a||0,p+h||0),this.ro(-l.left,-l.top,r.width,r.height);else{const y=c.getDocumentPoint(Spot.TopLeft,Point.l()),x=Rect.z(y.x,y.y,0,0);x.unionPoint(c.getDocumentPoint(Spot.BottomRight,y)),x.unionPoint(c.getDocumentPoint(Spot.TopRight,y)),x.unionPoint(c.getDocumentPoint(Spot.BottomLeft,y)),r.Hn(x.width+a||0,x.height+h||0),this.ro(-l.left,-l.top,r.width,r.height),Point.i(y),Rect.i(x)}}}Pa(t,e,i,s){this.actualBounds.e(t,e,i,s)}computeBorder(t){const e=this.part,i=e.diagram;if(i===null||i.animationManager.isAnimating)return t;if(e instanceof Group&&!e.layer.isTemporary&&e.computesBoundsAfterDrag&&this.ag.isReal()){const r=i.toolManager.findTool("Dragging");if(r===i.currentTool&&r.pR(e,this.ag,t))return t}const s=Rect.l(),n=this.computeMemberBounds(s),o=this.Qt;return e instanceof Group&&!e.isSubGraphExpanded?t.e(n.x-o.left,n.y-o.top,0,0):t.e(n.x-o.left,n.y-o.top,Math.max(n.width+o.left+o.right,0),Math.max(n.height+o.top+o.bottom,0)),Rect.i(s),e instanceof Group&&e.computesBoundsIncludingLocation&&e.location.isReal()&&t.unionPoint(e.location),t}computeMemberBounds(t){if(!(this.part instanceof Group))return t.e(0,0,0,0),t;const e=this.part;let i=1/0,s=1/0,n=-1/0,o=-1/0;const r=e.memberParts;for(;r.next();){const l=r.value;if(!l.isVisible()||l instanceof Link&&(!e.computesBoundsIncludingLinks||l.Xo()||l.fromNode===e||l.toNode===e))continue;const a=l.actualBounds;a.left<i&&(i=a.left),a.top<s&&(s=a.top),a.right>n&&(n=a.right),a.bottom>o&&(o=a.bottom)}if(!isFinite(i)||!isFinite(s)){const l=e.location;t.e(l.x,l.y,0,0)}else t.e(i,s,n-i,o-s);return t}get padding(){return this.Qt}set padding(t){typeof t=="number"&&(t=new Margin(t));const e=this.Qt;e.equals(t)||(t=t.N(),this.Qt=t,this.t("padding",e,t),this.f())}}class Layout{a;Ah;hg;Ar;cg;fg;Uo;Pl;ug;dg;ko;constructor(t){GSet.Je(this),this.a=null,this.Ah=null,this.hg=!0,this.Ar=!0,this.cg=!1,this.fg=new Point(0,0),this.Uo=!0,this.Pl=null,this.ug=null,this.dg=!1,this.ko=null,t&&Object.assign(this,t)}cloneProtected(t){t.hg=this.hg,t.Ar=this.Ar,t.cg=this.cg,t.fg.h(this.fg),t.Uo=this.Uo,t.Pl=this.Pl,t.ug=this.ug,t.dg=!0}copy(){const t=new this.constructor;return this.cloneProtected(t),t}fe(t){U.ur(this,t)}toString(){let t=U.Kn(this.constructor);return t+="(",this.group!==null&&(t+=" in "+this.group),this.diagram!==null&&(t+=" for "+this.diagram),t+=")",t}get diagram(){return this.a}set diagram(t){this.a=t}get group(){return this.Ah}set group(t){this.Ah!==t&&(this.Ah=t,t!==null&&(this.a=t.diagram))}get isOngoing(){return this.hg}set isOngoing(t){this.hg!==t&&(U.s(t,"boolean",Layout,"isOngoing"),this.hg=t)}get isInitial(){return this.Ar}set isInitial(t){U.s(t,"boolean",Layout,"isInitial"),this.Ar=t,t||(this.dg=!0)}get isViewportSized(){return this.cg}set isViewportSized(t){this.cg!==t&&(U.s(t,"boolean",Layout,"isViewportSized"),this.cg=t,t&&this.p())}get isRouting(){return this.Uo}set isRouting(t){this.Uo!==t&&(U.s(t,"boolean",Layout,"isRouting"),this.Uo=t)}get isRealtime(){return this.Pl}set isRealtime(t){this.Pl!==t&&(t!==null&&U.s(t,"boolean",Layout,"isRealtime"),this.Pl=t)}get isValidLayout(){return this.dg}set isValidLayout(t){if(this.dg!==t&&(U.s(t,"boolean",Layout,"isValidLayout"),this.dg=t,!t)){const e=this.diagram;e!==null&&(e.Jr=!0)}}invalidateLayout(){if(!this.isValidLayout)return;const t=this.diagram;if(t===null||t.undoManager.isUndoingRedoing)return;const e=t.animationManager;e.isTicking||(e.defaultAnimation.isAnimating&&e.stopAnimation(),(this.isOngoing&&t.Qa||this.isInitial&&!t.Qa)&&(this.isValidLayout=!1,t.requestUpdate()))}p(){this.invalidateLayout()}get network(){return this.ko}set network(t){this.ko!==t&&(this.ko=t,t!==null&&(t.layout=this))}createNetwork(){return new LayoutNetwork(this)}makeNetwork(t){const e=this.createNetwork();return t instanceof Diagram?(e.addParts(t.nodes,!0),e.addParts(t.links,!0)):t instanceof Group?e.addParts(t.memberParts):e.addParts(t.iterator),e}updateParts(){this.isValidLayout=!0;let t=this.diagram;if(t===null&&this.network!==null){const e=this.network.vertexes.iterator;for(;e.next();){const s=e.value.node;if(s!==null&&(t=s.diagram,t!==null))break}}try{t!==null&&t.startTransaction("Layout"),this.commitLayout()}finally{t!==null&&t.commitTransaction("Layout")}}commitLayout(){if(this.network===null)return;const t=this.network.vertexes.iterator;for(;t.next();)t.value.commit();if(this.isRouting){const e=this.network.edges.iterator;for(;e.next();)e.value.commit()}}doLayout(t){const e=new GSet;if(t instanceof Diagram?(this.Ea(e,t.nodes,!0,this.Lh,!0,!1,!0),this.Ea(e,t.parts,!0,this.Lh,!0,!1,!0)):t instanceof Group?this.Ea(e,t.memberParts,!1,this.Lh,!0,!1,!0):e.addAll(t.iterator),e.count>0){const s=this.diagram;s!==null&&s.startTransaction("Layout"),this.doMinimalNoNetworkLayout(e),s!==null&&s.commitTransaction("Layout")}this.isValidLayout=!0}doMinimalNoNetworkLayout(t){const e=t.count,i=Math.ceil(Math.sqrt(e));this.arrangementOrigin=this.initialOrigin(this.arrangementOrigin);const s=this.arrangementOrigin.x,n=this.arrangementOrigin.y;let o=s,r=n,l=0,a=0;const h=t.iterator;for(;h.next();){const c=h.value;c.ensureBounds();const f=c.measuredBounds,u=f.width,d=f.height;c.moveTo(o,r),c instanceof Group&&(c.Lh=!1),o+=Math.max(u,50)+20,a=Math.max(a,Math.max(d,50)),l>=i-1?(l=0,o=s,r+=a+20,a=0):l++}}Lh(t){return!!(!t.location.isReal()&&!t.position.isReal()||t instanceof Group&&t.Lh)}Ea(t,e,i,s,n,o,r){const l=e.iterator;for(;l.next();){const a=l.value;if(!(i&&!a.isTopLevel)&&!(s!==null&&!s(a))&&a.canLayout())if(n&&a instanceof Node){if(a.isLinkLabel)continue;a instanceof Group&&a.layout===null?this.Ea(t,a.memberParts,!1,s,n,o,r):(a.ensureBounds(),t.add(a))}else o&&a instanceof Link?t.add(a):r&&a.Di()&&!(a instanceof Node)&&(a.ensureBounds(),t.add(a))}}getLayoutBounds(t,e){const i=this.boundsComputation;return i!==null?(e||(e=new Rect),i(t,this,e)):!e&&t.margin.equalTo(0,0,0,0)?t.actualBounds:(e||(e=new Rect),e.set(t.actualBounds),e.addMargin(t.margin),e)}get boundsComputation(){return this.ug}set boundsComputation(t){this.ug!==t&&(t!==null&&U.S(t,Layout,"boundsComputation"),this.ug=t,this.p())}collectParts(t){const e=new GSet;return t instanceof Diagram?(this.Ea(e,t.nodes,!0,null,!0,!0,!0),this.Ea(e,t.links,!0,null,!0,!0,!0),this.Ea(e,t.parts,!0,null,!0,!0,!0)):t instanceof Group?this.Ea(e,t.memberParts,!1,null,!0,!0,!0):this.Ea(e,t.iterator,!1,null,!0,!0,!0),e}get arrangementOrigin(){return this.fg}set arrangementOrigin(t){this.fg.equals(t)||(this.fg.h(t),this.p())}initialOrigin(t){const e=this.group;if(e!==null)if(e.hasPlaceholder()){const i=e.placeholder,s=i.getDocumentPoint(Spot.TopLeft);(isNaN(s.x)||isNaN(s.y))&&s.set(t);const n=i.padding;return s.x+=n.left,s.y+=n.top,s}else{const i=e.position.copy();return(isNaN(i.x)||isNaN(i.y))&&i.set(t),i}return t}}class LayoutNetwork{li;Po;On;ew;iw;constructor(t){GSet.Je(this),this.li=t,this.Po=new GSet,this.On=new GSet,this.ew=new GMap,this.iw=new GMap}clear(){if(this.Po){const t=this.Po.iterator;for(;t.next();)t.value.clear()}if(this.On){const t=this.On.iterator;for(;t.next();)t.value.clear()}this.Po=new GSet,this.On=new GSet,this.ew=new GMap,this.iw=new GMap}toString(t){t===void 0&&(t=0);let e="LayoutNetwork"+(this.layout!==null?"("+this.layout.toString()+")":"");if(t<=0)return e;if(e+=" vertexes: "+this.Po.count+" edges: "+this.On.count,t>1){const i=this.Po.iterator;for(;i.next();){const n=i.value;e+=`
    `+n.toString(t-1)}const s=this.On.iterator;for(;s.next();){const n=s.value;e+=`
    `+n.toString(t-1)}}return e}get layout(){return this.li}set layout(t){t!==null&&(this.li=t)}get vertexes(){return this.Po}get edges(){return this.On}createVertex(){return new LayoutVertex(this)}createEdge(){return new LayoutEdge(this)}addParts(t,e,i){if(t===null)return;e===void 0&&(e=!1),U.s(e,"boolean",LayoutNetwork,"addParts:toplevelonly"),i===void 0&&(i=null),i===null&&(i=n=>{if(n instanceof Node)return!n.isLinkLabel;if(n instanceof Link){const o=n.fromNode;if(o===null||o.isLinkLabel)return!1;const r=n.toNode;return!(r===null||r.isLinkLabel)}return!1});const s=t.iterator;for(;s.next();){const n=s.value;if(n instanceof Node&&!(e&&!n.isTopLevel)&&n.canLayout()&&i(n))if(n instanceof Group&&n.layout===null)this.addParts(n.memberParts,!1);else{if(this.findVertex(n)!==null)continue;const o=this.createVertex();o.node=n,this.addVertex(o)}}for(s.reset();s.next();){const n=s.value;if(!(n instanceof Link)||e&&!n.isTopLevel||!n.canLayout()||!i(n)||this.findEdge(n)!==null)continue;const o=n.fromNode,r=n.toNode;if(o===null||r===null||o===r)continue;const l=this.findGroupVertex(o),a=this.findGroupVertex(r);this.linkVertexes(l,a,n)}}findGroupVertex(t){const e=t.findVisibleNode();if(e===null)return null;let i=this.findVertex(e);if(i!==null)return i;let s=e.containingGroup;for(;s!==null;){if(i=this.findVertex(s),i!==null)return i;s=s.containingGroup}return null}addVertex(t){this.Po.add(t);const e=t.node;e!==null&&this.ew.set(e,t),t.network=this}addNode(t){let e=this.findVertex(t);return e===null&&(e=this.createVertex(),e.node=t,this.addVertex(e)),e}deleteVertex(t){if(this.Pv(t)){let e=t.sr;for(let i=e.count-1;i>=0;i--){const s=e.elt(i);this.deleteEdge(s)}e=t.nr;for(let i=e.count-1;i>=0;i--){const s=e.elt(i);this.deleteEdge(s)}}}Pv(t){const e=this.Po.delete(t);if(e){const i=t.node;i!==null&&this.ew.delete(i)}return e}deleteNode(t){const e=this.findVertex(t);e!==null&&this.deleteVertex(e)}findVertex(t){return this.ew.get(t)}addEdge(t){this.BC(t);const e=t.toVertex;e!==null&&e.addSourceEdge(t);const i=t.fromVertex;i!==null&&i.addDestinationEdge(t)}BC(t){this.On.add(t);const e=t.link;e!==null&&this.findEdge(e)===null&&this.iw.set(e,t),t.network=this}addLink(t){const e=t.fromNode,i=t.toNode;let s=this.findEdge(t);return s===null?(s=this.createEdge(),s.link=t,e!==null&&(s.fromVertex=this.addNode(e)),i!==null&&(s.toVertex=this.addNode(i)),this.addEdge(s)):(e!==null?s.fromVertex=this.addNode(e):s.fromVertex=null,i!==null?s.toVertex=this.addNode(i):s.toVertex=null),s}deleteEdge(t){const e=t.toVertex;e!==null&&e.deleteSourceEdge(t);const i=t.fromVertex;i!==null&&i.deleteDestinationEdge(t),this.zC(t)}zC(t){const e=this.On.delete(t);if(e){const i=t.link;i!==null&&this.iw.delete(i)}return e}deleteLink(t){const e=this.findEdge(t);e!==null&&this.deleteEdge(e)}findEdge(t){return this.iw.get(t)}linkVertexes(t,e,i){if(t===null||e===null)return null;if(t.network===this&&e.network===this){const s=this.createEdge();return s.link=i,s.fromVertex=t,s.toVertex=e,this.addEdge(s),s}return null}reverseEdge(t){const e=t.fromVertex,i=t.toVertex;e===null||i===null||(e.deleteDestinationEdge(t),i.deleteSourceEdge(t),t.reverseEdge(),e.addSourceEdge(t),i.addDestinationEdge(t))}deleteSelfEdges(){const t=U.nt(),e=this.On.iterator;for(;e.next();){const s=e.value;s.fromVertex===s.toVertex&&t.push(s)}const i=t.length;for(let s=0;s<i;s++)this.deleteEdge(t[s]);U.Z(t)}deleteArtificialVertexes(){const t=U.nt(),e=this.Po.iterator;for(;e.next();){const o=e.value;o.node===null&&o.data===null&&t.push(o)}let i=t.length;for(let o=0;o<i;o++)this.deleteVertex(t[o]);const s=U.nt(),n=this.On.iterator;for(;n.next();){const o=n.value;o.link===null&&o.data===null&&s.push(o)}i=s.length;for(let o=0;o<i;o++)this.deleteEdge(s[o]);U.Z(t),U.Z(s)}deleteUselessEdges(){const t=U.nt(),e=this.On.iterator;for(;e.next();){const s=e.value;(s.fromVertex===null||s.toVertex===null)&&t.push(s)}const i=t.length;for(let s=0;s<i;s++)this.deleteEdge(t[s]);U.Z(t)}isSingleton(t){return!(t.sr.count>0||t.nr.count>0)}splitIntoSubNetworks(t){t===void 0&&(t=!0),t&&(this.deleteArtificialVertexes(),this.deleteUselessEdges(),this.deleteSelfEdges());const e=new List;let i=!0;for(;i;){i=!1;const s=this.Po.iterator;for(;s.next();){const n=s.value;if(this.isSingleton(n))continue;const o=this.layout.createNetwork();e.add(o),this.QE(o,n),i=!0;break}}return e.sort((s,n)=>s===null||n===null||s===n?0:n.vertexes.count-s.vertexes.count),e}QE(t,e){if(e===null)return;const i=new List;for(i.add(e);i.count>0;){const s=i.first();if(i.removeAt(0),!s||s.network===t)continue;this.Pv(s),t.addVertex(s);let n=s.sourceEdges;for(;n.next();){const o=n.value;o.network!==t&&(this.zC(o),t.BC(o),o.fromVertex&&i.add(o.fromVertex))}for(n=s.destinationEdges;n.next();){const o=n.value;o.network!==t&&(this.zC(o),t.BC(o),o.toVertex&&i.add(o.toVertex))}}}findAllParts(){const t=new GSet,e=this.Po.iterator;for(;e.next();){const s=e.value;s.node&&t.add(s.node)}const i=this.On.iterator;for(;i.next();){const s=i.value;s.link&&t.add(s.link)}return t}}class LayoutVertex{ko;te;Ri;Ui;es;sr;nr;constructor(t){GSet.Je(this),this.ko=t,this.Ui=new Rect(0,0,10,10),this.es=new Point(5,5),this.te=null,this.Ri=null,this.sr=new List,this.nr=new List}clear(){this.te=null,this.Ri=null,this.sr=new List,this.nr=new List}toString(t){t===void 0&&(t=0);let e="LayoutVertex#"+GSet.xs(this);if(t>0&&(e+=this.node!==null?"("+this.node.toString()+")":"",t>1)){let i="",s=!0,n=this.sr.iterator;for(;n.next();){const r=n.value;s?s=!1:i+=",",i+=r.toString(0)}let o="";for(s=!0,n=this.nr.iterator;n.next();){const r=n.value;s?s=!1:o+=",",o+=r.toString(0)}e+=" sources: "+i+" destinations: "+o}return e}get So(){return this.sr.DL}get or(){return this.nr.DL}get data(){return this.te}set data(t){if(this.te=t,t!==null&&t.bounds){const e=t.bounds,i=e.x,s=e.y,n=e.width,o=e.height;this.es.e(n/2,o/2),this.Ui.e(i,s,n,o)}}get node(){return this.Ri}set node(t){if(this.Ri!==t){if(this.Ri=t,t===null)return;t.ensureBounds();const e=this.network.layout,i=Rect.l(),s=e.getLayoutBounds(t,i);let n=s.x,o=s.y;const r=s.width,l=s.height;if(isNaN(n)&&(n=0),isNaN(o)&&(o=0),this.Ui.e(n,o,r,l),Rect.i(i),!(t instanceof Group)){const a=t.locationObject.getDocumentPoint(Spot.Center);if(a.isReal()){this.es.e(a.x-n,a.y-o);return}}this.es.e(r/2,l/2)}}get bounds(){return this.Ui}set bounds(t){this.Ui.equals(t)||this.Ui.h(t)}get focus(){return this.es}set focus(t){this.es.equals(t)||this.es.h(t)}get centerX(){return this.Ui.x+this.es.x}set centerX(t){const e=this.Ui;e.x+this.es.x!==t&&(e.x=t-this.es.x)}get centerY(){return this.Ui.y+this.es.y}set centerY(t){const e=this.Ui;e.y+this.es.y!==t&&(e.y=t-this.es.y)}get focusX(){return this.es.x}set focusX(t){const e=this.es;e.x!==t&&(e.x=t)}get focusY(){return this.es.y}set focusY(t){const e=this.es;e.y!==t&&(e.y=t)}get x(){return this.Ui.x}set x(t){const e=this.Ui;e.x!==t&&(e.x=t)}get y(){return this.Ui.y}set y(t){const e=this.Ui;e.y!==t&&(e.y=t)}get width(){return this.Ui.width}set width(t){const e=this.Ui;e.width!==t&&(e.width=t)}get height(){return this.Ui.height}set height(t){const e=this.Ui;e.height!==t&&(e.height=t)}commit(){const t=this.te;if(t!==null){const i=this.bounds,s=t.bounds;U.$(s)?(s.x=i.x,s.y=i.y,s.width=i.width,s.height=i.height):t.bounds=i.copy();return}const e=this.node;if(e!==null){const i=this.bounds;if(!(e instanceof Group)){const s=Rect.l();e.ensureBounds();const n=this.network.layout.getLayoutBounds(e,s),o=e.locationObject.getDocumentPoint(Spot.Center);if(n.isReal()&&o.isReal()){e.moveTo(i.x+this.focusX-(o.x-n.x)+e.margin.left,i.y+this.focusY-(o.y-n.y+e.margin.top)),Rect.i(s);return}Rect.i(s)}e.moveTo(i.x+e.margin.left,i.y+e.margin.top)}}addSourceEdge(t){t!==null&&(this.sr.has(t)||this.sr.add(t))}deleteSourceEdge(t){t!==null&&this.sr.delete(t)}addDestinationEdge(t){t!==null&&(this.nr.has(t)||this.nr.add(t))}deleteDestinationEdge(t){t!==null&&this.nr.delete(t)}get network(){return this.ko}set network(t){this.ko=t}get sourceVertexes(){const t=new GSet,e=this.sourceEdges;for(;e.next();){const i=e.value;i.fromVertex&&t.add(i.fromVertex)}return t.iterator}get destinationVertexes(){const t=new GSet,e=this.destinationEdges;for(;e.next();){const i=e.value;i.toVertex&&t.add(i.toVertex)}return t.iterator}get vertexes(){const t=new GSet;let e=this.sourceEdges;for(;e.next();){const i=e.value;i.fromVertex&&t.add(i.fromVertex)}for(e=this.destinationEdges;e.next();){const i=e.value;i.toVertex&&t.add(i.toVertex)}return t.iterator}get sourceEdges(){return this.sr.iterator}get destinationEdges(){return this.nr.iterator}get edges(){const t=new List;let e=this.sourceEdges;for(;e.next();){const i=e.value;t.add(i)}for(e=this.destinationEdges;e.next();){const i=e.value;t.add(i)}return t.iterator}get edgesCount(){return this.sr.count+this.nr.count}static standardComparer(t,e){const i=t.Ri,s=e.Ri;if(i)if(s){const n=i.text,o=s.text;return n<o?-1:n>o?1:0}else return 1;else return s!==null?-1:0}static smartComparer(t,e){if(t!==null)if(e!==null){const i=t.Ri,s=e.Ri;if(i!==null)if(s!==null){const n=i.text.toLocaleLowerCase(),o=s.text.toLocaleLowerCase(),r=n.split(/([+-]?[.]?\d+(?:\.\d*)?(?:e[+-]?\d+)?)/),l=o.split(/([+-]?[.]?\d+(?:\.\d*)?(?:e[+-]?\d+)?)/);let a=0;for(;a<r.length;a++)if(l[a]!==""&&l[a]!==void 0){const h=parseFloat(r[a]),c=parseFloat(l[a]);if(isNaN(h))if(isNaN(c)){if(r[a].localeCompare(l[a])!==0)return r[a].localeCompare(l[a]);continue}else return 1;else{if(isNaN(c))return-1;if(h-c!==0)return h-c;continue}}else{if(r[a]==="")continue;return 1}return l[a]!==""&&l[a]!==void 0?-1:0}else return 1;else return s!==null?-1:0}else return 1;else return e!==null?-1:0}}class LayoutEdge{ko;te;ts;is;ss;constructor(t){GSet.Je(this),this.ko=t,this.te=null,this.ts=null,this.is=null,this.ss=null}clear(){this.te=null,this.ts=null,this.is=null,this.ss=null}toString(t){t===void 0&&(t=0);let e="LayoutEdge#"+GSet.xs(this);return t>0&&(e+=this.ts!==null?"("+this.ts.toString()+")":"",t>1&&(e+=" "+(this.is?this.is.toString():"null")+" --> "+(this.ss?this.ss.toString():"null"))),e}reverseEdge(){const t=this.is;this.is=this.ss,this.ss=t}commit(){}getOtherVertex(t){return this.ss===t?this.is:this.is===t?this.ss:null}get network(){return this.ko}set network(t){this.ko=t}get data(){return this.te}set data(t){this.te!==t&&(this.te=t)}get link(){return this.ts}set link(t){this.ts!==t&&(this.ts=t)}get fromVertex(){return this.is}set fromVertex(t){this.is!==t&&(this.is=t)}get toVertex(){return this.ss}set toVertex(t){this.ss!==t&&(this.ss=t)}}var GridAlignment=(w=>(w[w.Position=0]="Position",w[w.Location=1]="Location",w))(GridAlignment||{}),GridArrangement=(w=>(w[w.LeftToRight=10]="LeftToRight",w[w.RightToLeft=11]="RightToLeft",w))(GridArrangement||{}),GridSorting=(w=>(w[w.Forwards=20]="Forwards",w[w.Reverse=21]="Reverse",w[w.Ascending=22]="Ascending",w[w.Descending=23]="Descending",w))(GridSorting||{});class GridLayout extends Layout{gg;mg;Ro;In;de;He;Si;Mi;constructor(t){super(),this.isViewportSized=!0,this.gg=NaN,this.mg=NaN,this.Ro=new Size(NaN,NaN).k(),this.In=new Size(10,10).k(),this.de=1,this.He=10,this.Si=22,this.Mi=GridLayout.standardComparer,t&&Object.assign(this,t)}cloneProtected(t){super.cloneProtected(t),t.gg=this.gg,t.mg=this.mg,t.Ro.h(this.Ro),t.In.h(this.In),t.de=this.de,t.He=this.He,t.Si=this.Si,t.Mi=this.Mi}fe(t){t in GridSorting?this.sorting=t:t in GridArrangement?this.arrangement=t:t in GridAlignment?this.alignment=t:super.fe(t)}doLayout(t){this.arrangementOrigin=this.initialOrigin(this.arrangementOrigin);const e=this.collectParts(t),i=this.diagram,n=e.copy().iterator;for(;n.next();){const m=n.value;if(m.Lr()&&(m.fromNode!==null||m.toNode!==null)){e.delete(m);continue}if(m.ensureBounds(),m instanceof Group){const g=m.memberParts;for(;g.next();){const p=g.value;e.delete(p)}}}const o=e.toArray();if(o.length===0)return;switch(this.sorting){case 20:break;case 21:o.reverse();break;case 22:o.sort(this.comparer);break;case 23:o.sort(this.comparer),o.reverse();break}let r=this.wrappingColumn;isNaN(r)&&(r=0);let l=this.wrappingWidth;if(isNaN(l)&&i!==null){const m=i.viewportBounds,g=i.padding;l=Math.max(m.width-g.left-g.right,0)}else l=Math.max(this.wrappingWidth,0);r<=0&&l<=0&&(r=1);let a=this.spacing.width;isFinite(a)||(a=0);let h=this.spacing.height;isFinite(h)||(h=0),i!==null&&i.startTransaction("Layout");const c=[];switch(this.alignment){case 0:this._E(o,l,r,a,h,c);break;case 1:this.t3(o,l,r,a,h,c);break}let f=0,u=0,d=0;for(let m=0;m<c.length;m++){const g=c[m];f=Math.min(f,g.x),u=Math.min(u,g.y),d=Math.max(d,g.x+g.width)}this.arrangement===11?this.commitLayers(c,new Point(f+a/2-(d+f),u-h/2)):this.commitLayers(c,new Point(f-a/2,u-h/2)),i!==null&&i.commitTransaction("Layout"),this.isValidLayout=!0}_E(t,e,i,s,n,o){const r=Rect.l();let l=Math.max(this.cellSize.width,1);if(!isFinite(l)){l=0;for(let p=0;p<t.length;p++){const y=t[p],x=this.getLayoutBounds(y,r);l=Math.max(l,x.width)}}l+=s,l=Math.max(l,1);let a=Math.max(this.cellSize.height,1);if(!isFinite(a)){a=0;for(let p=0;p<t.length;p++){const y=t[p],x=this.getLayoutBounds(y,r);a=Math.max(a,x.height)}}a+=n,a=Math.max(a,1);const h=this.arrangement,c=this.arrangementOrigin.x,f=this.arrangementOrigin.y;let u=c,d=f,m=0,g=0;for(let p=0;p<t.length;p++){const y=t[p],x=this.getLayoutBounds(y,r),b=Math.ceil((x.width+s)/l),k=Math.ceil((x.height+n)/a),P=b*l,S=k*a;let L=0;switch(h){case 11:L=Math.abs(u-x.width);break;default:L=u+x.width;break}(i>0&&m>i-1||e>0&&m>0&&L-c>e)&&(o.push(new Rect(0,d,e+s,g)),m=0,u=c,d+=g,g=0),g=Math.max(g,S);let C=0;switch(h){case 11:C=-x.width;break;default:C=0;break}switch(y.moveTo(u+C+y.margin.left,d+y.margin.top),h){case 11:u-=P;break;default:u+=P;break}m++}o.push(new Rect(0,d,e+s,g)),Rect.i(r)}t3(t,e,i,s,n,o){const r=Rect.l();let l=Math.max(this.cellSize.width,1),a=0,h=0,c=0;const f=Point.l();for(let C=0;C<t.length;C++){const M=t[C],N=this.getLayoutBounds(M,r),A=M.getRelativePoint(M.locationObject,M.locationSpot,f);a=Math.max(a,A.x),h=Math.max(h,N.width-A.x),c=Math.max(c,A.y)}const u=this.arrangement;switch(u){case 11:a+=s;break;default:h+=s;break}isFinite(l)?l=Math.max(l+s,1):l=Math.max(a+h,1);const d=this.arrangementOrigin.x,m=this.arrangementOrigin.y;let g=d,p=m,y=0;e>=a&&(e-=a);let x=0,b=0;const k=Math.max(this.cellSize.height,1);c=0;let P=0,S=!0;const L=Point.l();for(let C=0;C<t.length;C++){const M=t[C],N=this.getLayoutBounds(M,r),A=M.getRelativePoint(M.locationObject,M.locationSpot,f);if(y>0)switch(u){case 11:{let D=(g-d-(N.width-A.x))/l;G.X(Math.round(D),D)?D=Math.round(D):D=Math.floor(D),g=D*l+d;break}default:{let D=(g-d+A.x)/l;G.X(Math.round(D),D)?D=Math.round(D):D=Math.ceil(D),g=D*l+d;break}}else switch(u){case 11:x=g+A.x+N.width;break;default:x=g-A.x;break}let T=0;switch(u){case 11:T=-(g+A.x)+x;break;default:T=g+N.width-A.x-x;break}if(i>0&&y>i-1||e>0&&y>0&&T>e){o.push(new Rect(0,S?p-c:p,e+s,P+c+n));for(let D=0;D<y&&C!==y;D++){const v=t[C-y+D],R=v.getRelativePoint(v.locationObject,v.locationSpot,L);v.moveTo(v.position.x,v.position.y+c-R.y)}P+=n,S?p+=P:p+=P+c,c=0,P=0,y=0,g=d,S=!1}switch(g===d&&(u===11?b=Math.max(b,N.width-A.x):b=Math.min(b,-A.x)),c=Math.max(c,A.y),P=Math.max(P,N.height-A.y),isFinite(k)&&(P=Math.max(P,Math.max(N.height,k)-A.y)),S?M.moveTo(g-A.x,p-A.y):M.moveTo(g-A.x,p),u){case 11:g-=A.x+s;break;default:g+=N.width-A.x+s;break}y++}if(o.push(new Rect(0,p,e+s,(S?P:P+c)+n)),t.length!==y)for(let C=0;C<y;C++){const M=t[t.length-y+C],N=M.getRelativePoint(M.locationObject,M.locationSpot,f);M.moveTo(M.position.x,M.position.y+c-N.y)}if(Point.i(f),Point.i(L),u===11)for(let C=0;C<o.length;C++){const M=o[C];M.width+=b,M.x-=b}else for(let C=0;C<o.length;C++){const M=o[C];M.x>b&&(M.width+=M.x-b,M.x=b)}Rect.i(r)}commitLayers(t,e){}get wrappingWidth(){return this.gg}set wrappingWidth(t){this.gg!==t&&(U.s(t,"number",GridLayout,"wrappingWidth"),(t>0||isNaN(t))&&(this.gg=t,this.isViewportSized=isNaN(t),this.p()))}get wrappingColumn(){return this.mg}set wrappingColumn(t){this.mg!==t&&(U.s(t,"number",GridLayout,"wrappingColumn"),(t>0||isNaN(t))&&(this.mg=t,this.p()))}get cellSize(){return this.Ro}set cellSize(t){this.Ro.equals(t)||(this.Ro.h(t),this.p())}get spacing(){return this.In}set spacing(t){this.In.equals(t)||(this.In.h(t),this.p())}get alignment(){return this.de}set alignment(t){this.de!==t&&(t===1||t===0)&&(this.de=t,this.p())}get arrangement(){return this.He}set arrangement(t){this.He!==t&&(t===10||t===11)&&(this.He=t,this.p())}get sorting(){return this.Si}set sorting(t){this.Si!==t&&(t===20||t===21||t===22||t===23)&&(this.Si=t,this.p())}get comparer(){return this.Mi}set comparer(t){this.Mi!==t&&(U.S(t,GridLayout,"comparer"),this.Mi=t,this.p())}static standardComparer(t,e){const i=t.text,s=e.text;return i<s?-1:i>s?1:0}static smartComparer(t,e){if(t!==null)if(e!==null){const i=t.text.toLocaleLowerCase(),s=e.text.toLocaleLowerCase(),n=i.split(/([+-]?[.]?\d+(?:\.\d*)?(?:e[+-]?\d+)?)/),o=s.split(/([+-]?[.]?\d+(?:\.\d*)?(?:e[+-]?\d+)?)/);let r=0;for(;r<n.length;r++)if(o[r]!==""&&o[r]!==void 0){const l=parseFloat(n[r]),a=parseFloat(o[r]);if(isNaN(l))if(isNaN(a)){if(n[r].localeCompare(o[r])!==0)return n[r].localeCompare(o[r]);continue}else return 1;else{if(isNaN(a))return-1;if(l-a!==0)return l-a;continue}}else{if(n[r]==="")continue;return 1}return o[r]!==""&&o[r]!==void 0?-1:0}else return 1;else return e!==null?-1:0}static Position=0;static Location=1;static LeftToRight=10;static RightToLeft=11;static Forward=20;static Reverse=21;static Ascending=22;static Descending=23}class PartManager{pg;on;Ct;Mo;yg;wg;a;XC;constructor(){this.pg=new GSet,this.on=new GSet,this.Ct=new GSet,this.Mo=new GMap,this.yg=new GMap,this.wg=new GMap,this.a=null,this.XC=!1}clear(){this.pg.clear(),this.on.clear(),this.Ct.clear(),this.Mo.clear(),this.yg.clear(),this.wg.clear()}Io(t){this.a=t}ch(t){if(t instanceof Node){if(this.pg.add(t),t instanceof Group){const i=t.containingGroup;i===null?this.diagram.$r.add(t):i.Ch.add(t);const s=t.layout;s!==null&&(s.diagram=this.diagram)}}else t instanceof Link?(this.on.add(t),t.isAvoiding&&(this.diagram.lp=!0)):t instanceof Adornment||this.Ct.add(t);const e=t.data;e!==null&&(t instanceof Adornment||(t instanceof Link?this.Sv(e,t):this.Mo.set(e,t)))}ri(t){if(t.clearAdornments(),t instanceof Node){if(this.pg.delete(t),t instanceof Group){const i=t.containingGroup;i===null?this.diagram.$r.delete(t):i.Ch.delete(t);const s=t.layout;s!==null&&(s.diagram=null)}}else t instanceof Link?this.on.delete(t):t instanceof Adornment||this.Ct.delete(t);const e=t.data;e!==null&&(t instanceof Adornment||(t instanceof Link?this.Mv(e,t):this.Mo.delete(e)))}Sv(t,e){this.yg.set(t,e)}Mv(t,e){this.yg.delete(t)}rebuildParts(){const t=this.diagram;if(t===null)return;const e=t.nodeTemplateMap.iterator;for(;e.next();){const u=e.value,d=e.key;(!u.Di()||u instanceof Group)&&U.o(`Invalid node template in Diagram.nodeTemplateMap: template for "${d}" must be a Node or a simple Part, not a Group or Link: ${u}`)}const i=t.groupTemplateMap.iterator;for(;i.next();){const u=i.value,d=i.key;u instanceof Group||U.o(`Invalid group template in Diagram.groupTemplateMap: template for "${d}" must be a Group, not a normal Node or Link: ${u}`)}const s=t.linkTemplateMap.iterator;for(;s.next();){const u=s.value,d=s.key;u instanceof Link||U.o(`Invalid link template in Diagram.linkTemplateMap: template for "${d}" must be a Link, not a normal Node or simple Part: ${u}`)}const n=U.nt(),o=t.selection.iterator;for(;o.next();){const d=o.value.data;d&&n.push(d)}const r=U.nt(),l=t.highlighteds.iterator;for(;l.next();){const d=l.value.data;d&&r.push(d)}const a=U.nt(),h=this.nodes.iterator;for(;h.next();){const u=h.value;u.data!==null&&(a.push(u.data),a.push(u.location))}const c=this.links.iterator;for(;c.next();){const u=c.value;u.data!==null&&(a.push(u.data),a.push(u.location))}const f=this.parts.iterator;for(;f.next();){const u=f.value;u.data!==null&&(a.push(u.data),a.push(u.location))}this.Nv(),this.v2();for(let u=0;u<n.length;u++){const d=this.findPartForData(n[u]);d!==null&&(d.isSelected=!0)}for(let u=0;u<r.length;u++){const d=this.findPartForData(r[u]);d!==null&&(d.isHighlighted=!0)}for(let u=0;u<a.length;u+=2){const d=this.findPartForData(a[u]);d!==null&&(d.location=a[u+1])}U.Z(n),U.Z(r),U.Z(a)}v2(){const t=this.diagram.model;this.nw(t.nodeDataArray)}nw(t,e){const i=this.diagram.model;t.forEach(s=>{i.containsNodeData(s)&&this.Cv(s,!1)}),t.forEach(s=>{i.containsNodeData(s)&&this.Nk(s)}),e!==!1&&this.diagram.c1(!1)}Cv(t,e){if(t==null||this.diagram.undoManager.isUndoingRedoing||this.Mo.has(t))return null;e===void 0&&(e=!0);const i=this.e3(t);return i!==null&&e&&this.Nk(t),i}e3(t){if(t==null||this.diagram.undoManager.isUndoingRedoing||this.Mo.has(t))return null;const e=this.i3(t),i=this.findTemplateForNodeData(t,e);if(i!==null){i.It();const s=i.copy();if(s!==null){const n=this.diagram.wi;return this.diagram.wi=!0,s.Qo=e,s.te=t,this.addsToTemporaryLayer&&(s.ul="Tool"),this.diagram.add(s),s.te=null,s.data=t,this.diagram.wi=n,s}}return null}insertLink(t,e,i,s){return null}Nk(t){}i3(t){return this.diagram.model.getCategoryForNodeData(t)}static Lv=!1;static Av=!1;findTemplateForNodeData(t,e){const i=this.diagram,s=i.model,n=s.ff()&&s.isGroupForData(t);let o=null;return n?(o=i.groupTemplateMap.get(e),o===null&&(o=i.groupTemplateMap.get(""),o===null&&(PartManager.Av||(PartManager.Av=!0,U.ne('No Group template found for category "'+e+'"'),U.ne("  Using default group template")),o=i.o2))):(o=i.nodeTemplateMap.get(e),o===null&&(o=i.nodeTemplateMap.get(""),o===null&&(PartManager.Lv||(PartManager.Lv=!0,U.ne('No Node template found for category "'+e+'"'),U.ne("  Using default node template")),o=i.e2))),o}getLinkCategoryForData(t){return""}setLinkCategoryForData(t,e){}setFromNodeForLink(t,e,i){}setToNodeForLink(t,e,i){}static Tv=!1;findLinkTemplateForCategory(t){const e=this.diagram;let i=e.linkTemplateMap.get(t);return i===null&&(i=e.linkTemplateMap.get(""),i===null&&(PartManager.Tv||(PartManager.Tv=!0,U.ne('No Link template found for category "'+t+'"'),U.ne("  Using default link template")),i=e.i2)),i}WI(t,e,i){t instanceof Link?(e!==null&&this.Mv(e,t),i!==null&&this.Sv(i,t)):t instanceof Part&&(e!==null&&this.Mo.delete(e),i!==null&&this.Mo.set(i,t))}Nv(){const t=this.diagram.model;this.GC(t.nodeDataArray)}GC(t){t.forEach(e=>{this.Ck(e)})}Ck(t){const e=this.findPartForData(t);e!==null&&(this.diagram.A2(e,!1),this.YC(e))}YC(t){}TC(t){}findPartForKey(t){if(t==null)return null;const i=this.diagram.model.findNodeDataForKey(t);return i!==null?this.Mo.get(i):null}findNodeForKey(t){if(t==null)return null;const i=this.diagram.model.findNodeDataForKey(t);if(i===null)return null;const s=this.Mo.get(i);return s instanceof Node?s:null}findLinkForKey(t){return null}findPartForData(t){if(t===null)return null;let e=this.Mo.get(t);return e!==null||(e=this.yg.get(t)),e}findNodeForData(t){if(t===null)return null;const e=this.Mo.get(t);return e instanceof Node?e:null}findLinkForData(t,e){return t===null?null:this.yg.get(t)}findNodesByExample(...t){const e=new GSet,i=this.pg.iterator;for(;i.next();){const s=i.value,n=s.data;if(n!==null)for(let o=0;o<arguments.length;o++){const r=arguments[o];if(U.$(r)&&this.KC(n,r)){e.add(s);break}}}return e.iterator}findLinksByExample(...t){const e=new GSet,i=this.on.iterator;for(;i.next();){const s=i.value,n=s.data;if(n!==null)for(let o=0;o<arguments.length;o++){const r=arguments[o];if(U.$(r)&&this.KC(n,r)){e.add(s);break}}}return e.iterator}KC(t,e){for(const i in e){const s=t[i],n=e[i];if(Array.isArray(n)){if(!Array.isArray(s))return!1;const o=s,r=n;if(o.length<r.length)return!1;for(let l=0;l<o.length;l++){const a=o[l],h=r[l];if(h!==void 0&&!this.Dv(a,h))return!1}}else if(!this.Dv(s,n))return!1}return!0}Dv(t,e){if(U.st(e)){if(!e(t))return!1}else if(e instanceof RegExp){if(!t||!e.test(t.toString()))return!1}else if(U.$(t)&&U.$(e)){if(!this.KC(t,e))return!1}else if(t!==e)return!1;return!0}doModelDataChanged(t){if(t.model===this.diagram.model&&this.diagram.G){this.diagram.G=!1;try{const e=t.change;t.modelChange===""&&t.object!==null&&e===2&&this.ow(t.object,t.propertyName)}finally{this.diagram.G=!0}}}doModelChanged(t){const e=this.diagram;if(!e||t.model!==e.model)return;const i=t.change;if(e.AO(t),!!e.G){e.G=!1;try{const s=t.modelChange;if(s!=="")if(i===2){if(s==="nodeCategory"){const n=t.object;if(n!==null){const o=this.findPartForData(n),r=t.newValue;o!==null&&typeof r=="string"&&(o.category=r)}}else if(s==="nodeDataArray"){const n=t.oldValue;this.GC(n);const o=t.newValue;this.nw(o)}e.isModified=!0}else if(i===3){const n=t.newValue;s==="nodeDataArray"&&U.$(n)&&this.Cv(n),e.isModified=!0}else if(i===4){const n=t.oldValue;s==="nodeDataArray"&&U.$(n)&&this.Ck(n),e.isModified=!0}else i===1&&(s==="SourceChanged"?t.object!==null?this.ow(t.object,t.propertyName):(this.updateAllRelationshipsFromData(),this.updateAllTargetBindings()):s==="ModelDisplaced"&&this.rebuildParts());else if(i===2){const n=t.propertyName,o=t.object,r=e.model;o===r?(n==="nodeKeyProperty"||n==="nodeCategoryProperty")&&(e.undoManager.isUndoingRedoing||this.rebuildParts()):o!==null&&this.ow(o,n),e.isModified=!0}else(i===3||i===4)&&(this.s3(t,e.model),e.isModified=!0)}finally{e.G=!0}}}updateAllTargetBindings(t){t===void 0&&(t="");let e=this.parts.iterator;for(;e.next();)e.value.updateTargetBindings(t);for(e=this.nodes.iterator;e.next();)e.value.updateTargetBindings(t);for(e=this.links.iterator;e.next();)e.value.updateTargetBindings(t)}updateAllThemeBindings(){let t=this.parts.iterator;for(;t.next();)t.value.Go();for(t=this.nodes.iterator;t.next();)t.value.Go();for(t=this.links.iterator;t.next();)t.value.Go()}updateAllRelationshipsFromData(){const t=this.diagram.model,e=new GSet,i=t.nodeDataArray;for(let o=0;o<i.length;o++){const r=i[o];e.add(r)}const s=[];this.nodes.each(o=>{o.data!==null&&!e.has(o.data)&&s.push(o.data)}),this.parts.each(o=>{o.data!==null&&!e.has(o.data)&&s.push(o.data)}),s.forEach(o=>t.vv(o,!1));for(let o=0;o<i.length;o++){const r=i[o];this.findPartForData(r)===null&&t.Fv(r,!1)}this.Rv();let n=this.parts.iterator;for(;n.next();)n.value.updateRelationshipsFromData();for(n=this.nodes.iterator;n.next();)n.value.updateRelationshipsFromData();for(n=this.links.iterator;n.next();)n.value.updateRelationshipsFromData()}Rv(){}updateRelationshipsFromData(t){}ow(t,e){if(typeof e=="string"){const i=this.findPartForData(t);if(i!==null)i.updateTargetBindings(e);else{const s=this.o3(t);if(s!==null&&s.length>0){for(let o=0;o<s.length;o++)s[o].updateTargetBindings(e);const n=s[0].part;if(n!==null){const o=n.adornments;for(;o.next();)o.value.updateTargetBindings(e)}U.Z(s)}}t===this.diagram.model.modelData&&this.updateAllTargetBindings(e)}}o3(t){let e=null;const i=this.wg.iterator;for(;i.next();){const s=i.value;for(let n=0;n<s.length;n++){const r=s[n].findItemPanelForData(t);r!==null&&(e===null&&(e=U.nt()),e.push(r))}if(e!==null)break}return e}HC(t){return this.wg.get(t)}s3(t,e){const i=t.object;if(!Array.isArray(i))return;const s=t.change===3,n=s?t.newParam:t.oldParam,o=s?t.newValue:t.oldValue,r=this.HC(i);if(Array.isArray(r))for(let l=0;l<r.length;l++){const a=r[l];s?a.Q1(o,n,!0):a.ZI(n)}}C2(t,e){e!==null&&t.Pn(s=>e.gT(s));const i=t.Ta;if(Array.isArray(i)){const s=this.HC(i);if(s===null)this.wg.set(i,[t]);else{for(let n=0;n<s.length;n++)if(s[n]===t)return;s.push(t)}}}L2(t,e){t.Pn(s=>e.DO(s));const i=t.Ta;if(Array.isArray(i)){const s=this.HC(i);if(s!==null){for(let n=0;n<s.length;n++)if(s[n]===t){s.splice(n,1),s.length===0&&this.wg.delete(i);return}}}}copyParts(t,e,i){i===void 0&&(i=!1);const s=new GMap;if(Array.isArray(t))for(let o=0;o<t.length;o++)this.Lk(t[o],e,s,i);else{const o=t.iterator;for(;o.next();)this.Lk(o.value,e,s,i)}if(e!==null){const o=e.model,r=e.Tp().dragsLink,l=new GSet,a=new GMap,h=s.iterator;for(;h.next();){const c=h.value;if(c instanceof Link)!r&&(c.fromNode===null||c.toNode===null)&&l.add(c);else if(c instanceof Node&&c.data!==null){if(o.Vm()){const f=c,u=h.key,d=u.findTreeParentNode();if(d!==null){const m=s.get(d);if(m!==null){o.setParentKeyForNodeData(f.data,o.getKeyForNodeData(m.data));const g=e.findLinkForData(f.data),p=u.findTreeParentLink();p!==null&&g!==null&&a.set(p,g)}}}else if(o.a1()){const f=c,u=h.key,d=o.isRelatedKeysPathTo?u.findNodesOutOf():u.findNodesInto();for(;d.next();){const m=d.value,g=s.get(m);if(g!==null){o.addRelatedKeyForNodeData(f.data,g.key);const p=e.partManager.findLinkForData(f.data,g.key),y=this.findLinkForData(u.data,m.key);y!==null&&p!==null&&a.set(y,p)}else o.removeRelatedKeyForNodeData(f.data,m.key)}}}}if(l.count>0&&e.removeParts(l,!1),a.count>0){const c=a.iterator;for(;c.next();){const f=c.key,u=c.value;s.set(f,u)}}}if(e!==null&&this.diagram!==null){const o=e.model,r=o.afterCopyFunction;if(r!==null){const l=new GMap;s.each(h=>{h.key.data!==null&&l.set(h.key.data,h.value.data)});const a=this.diagram.model;r(l,o,a)}}const n=s.iterator;for(;n.next();)n.value.updateTargetBindings();return s}Lk(t,e,i,s){if(t===null||s&&!t.canCopy())return null;if(i.has(t))return i.get(t);const n=this.qC(t,e);if(!(n instanceof Part))return null;if(n.isSelected=!1,n.isHighlighted=!1,i.set(t,n),t instanceof Node){const o=t.linksConnected;for(;o.next();){const r=o.value;if(r.fromNode===t){const l=i.get(r);l!==null&&(l.fromNode=n)}if(r.toNode===t){const l=i.get(r);l!==null&&(l.toNode=n)}}if(t instanceof Group&&n instanceof Group){const r=t.memberParts;for(;r.next();){const l=r.value,a=this.Lk(l,e,i,s);a instanceof Link||a!==null&&(a.containingGroup=n)}}}else if(t instanceof Link&&n instanceof Link){const o=t.fromNode;if(o!==null){const a=i.get(o);a!==null&&(n.fromNode=a)}const r=t.toNode;if(r!==null){const a=i.get(r);a!==null&&(n.toNode=a)}const l=t.labelNodes;for(;l.next();){const a=l.value,h=this.Lk(a,e,i,s);h!==null&&h instanceof Node&&(h.labeledLink=n)}}return n}qC(t,e){let i=null;const s=t.data;if(s!==null&&e!==null){const n=e.model;if(!(t instanceof Link)){const o=n.copyNodeData(s);n.addNodeData(o),i=e.findPartForData(o)}}else if(t.It(),i=t.copy(),i!==null){const n=this.diagram;if(e!==null)e.add(i);else if(s!==null&&n!==null&&n.commandHandler!==null&&n.commandHandler.copiesClipboardData){const o=n.model;let r=null;i instanceof Link||(r=o.copyNodeData(s)),i.data=r}}return i}get nodes(){return this.pg}get links(){return this.on}get parts(){return this.Ct}get diagram(){return this.a}get addsToTemporaryLayer(){return this.XC}set addsToTemporaryLayer(t){this.XC=t}}class GraphLinksPartManager extends PartManager{v2(){const t=this.diagram.model;this.nw(t.nodeDataArray),this.Ov(t.linkDataArray)}nw(t){super.nw(t,!1);const e=this.links.iterator;for(;e.next();)e.value.Wd();this.diagram.c1(!1)}Ov(t){t.forEach(e=>{this.Iv(e)}),this.diagram.c1(!1)}Iv(t){if(t==null||this.diagram.undoManager.isUndoingRedoing||this.findLinkForData(t))return null;const e=this.getLinkCategoryForData(t),i=this.findLinkTemplateForCategory(e);if(i!==null){i.It();const s=i.copy();if(s!==null){const n=this.diagram.wi;this.diagram.wi=!0,s.Qo=e,s.te=t;const o=this.diagram.model,r=o.Ak(t,!0);r!==""&&(s.fromPortId=r);const l=o.Vi(t,!0);if(l!==void 0){const f=this.findNodeForKey(l);f instanceof Node&&(s.fromNode=f)}const a=o.Ak(t,!1);a!==""&&(s.toPortId=a);const h=o.Vi(t,!1);if(h!==void 0){const f=this.findNodeForKey(h);f instanceof Node&&(s.toNode=f)}const c=o.getLabelKeysForLinkData(t);return Array.isArray(c)&&c.forEach(f=>{const u=this.findNodeForKey(f);u!==null&&(u.labeledLink=s)}),this.addsToTemporaryLayer&&(s.ul="Tool"),this.diagram.add(s),s.te=null,s.data=t,this.diagram.wi=n,s}}return null}Nv(){const t=this.diagram.model;this.Ev(t.linkDataArray),this.GC(t.nodeDataArray)}Ev(t){t.forEach(e=>{this.Ck(e)})}getLinkCategoryForData(t){return this.diagram.model.getCategoryForLinkData(t)}setLinkCategoryForData(t,e){return this.diagram.model.setCategoryForLinkData(t,e)}setFromNodeForLink(t,e,i){const s=this.diagram.model,n=e!==null?e.data:null;s.setFromKeyForLinkData(t.data,s.getKeyForNodeData(n))}setToNodeForLink(t,e,i){const s=this.diagram.model,n=e!==null?e.data:null;s.setToKeyForLinkData(t.data,s.getKeyForNodeData(n))}TC(t){this.diagram.model.removeLinkData(t.data)}findPartForKey(t){const e=super.findPartForKey(t);if(e===null){const s=this.diagram.model.findLinkDataForKey(t);if(s!==null)return this.findLinkForData(s)}return e}findLinkForKey(t){if(t==null)return null;const i=this.diagram.model.findLinkDataForKey(t);return i!==null?this.findLinkForData(i):null}doModelChanged(t){if(super.doModelChanged(t),!this.diagram)return;const e=this.diagram;if(t.model!==e.model)return;const i=t.change;if(e.G){e.G=!1;try{const s=t.modelChange;if(s!==""){if(i===2){if(s==="linkFromKey"){const n=t.object,o=this.findLinkForData(n);if(o!==null){const r=t.newValue,l=this.findNodeForKey(r);o.fromNode=l}}else if(s==="linkToKey"){const n=t.object,o=this.findLinkForData(n);if(o!==null){const r=t.newValue,l=this.findNodeForKey(r);o.toNode=l}}else if(s==="linkFromPortId"){const n=t.object,o=this.findLinkForData(n);if(o!==null){const r=t.newValue;typeof r=="string"&&(o.fromPortId=r)}}else if(s==="linkToPortId"){const n=t.object,o=this.findLinkForData(n);if(o!==null){const r=t.newValue;typeof r=="string"&&(o.toPortId=r)}}else if(s==="nodeGroupKey"){const n=t.object,o=this.findPartForData(n);if(o!==null){const r=t.newValue;if(r!==void 0){const l=this.findNodeForKey(r);l instanceof Group?o.containingGroup=l:o.containingGroup=null}else o.containingGroup=null}}else if(s==="linkLabelKeys"){const n=t.object,o=this.findLinkForData(n);if(o!==null){const r=t.oldValue,l=t.newValue;Array.isArray(r)&&r.forEach(a=>{if(l.indexOf(a)>=0)return;const h=this.findNodeForKey(a);h!==null&&(h.labeledLink=null)}),Array.isArray(l)&&l.forEach(a=>{const h=this.findNodeForKey(a);h!==null&&(h.labeledLink=o)})}}else if(s==="linkCategory"){const n=t.object,o=this.findLinkForData(n),r=t.newValue;o!==null&&typeof r=="string"&&(o.category=r)}else if(s==="linkDataArray"){const n=t.oldValue;this.Ev(n);const o=t.newValue;this.Ov(o)}e.isModified=!0}else if(i===3){const n=t.newValue;if(s==="linkDataArray"&&U.$(n))this.Iv(n);else if(s==="linkLabelKeys"&&t.model.isKeyType(n)){const o=t.object,r=this.findLinkForData(o),l=this.findNodeForKey(n);r!==null&&l!==null&&(l.labeledLink=r)}e.isModified=!0}else if(i===4){const n=t.oldValue;if(s==="linkDataArray"&&U.$(n))this.Ck(n);else if(s==="linkLabelKeys"&&t.model.isKeyType(n)){const o=this.findNodeForKey(n);o!==null&&(o.labeledLink=null)}e.isModified=!0}}else if(i===2){const n=t.propertyName,o=t.object,r=e.model;o===r&&(n==="linkFromKeyProperty"||n==="linkToKeyProperty"||n==="linkFromPortIdProperty"||n==="linkToPortIdProperty"||n==="linkLabelKeysProperty"||n==="nodeIsGroupProperty"||n==="nodeGroupKeyProperty"||n==="linkCategoryProperty")&&(e.undoManager.isUndoingRedoing||this.rebuildParts()),e.isModified=!0}}finally{e.G=!0}}}Rv(){const t=this.diagram.model,e=new Set,i=t.linkDataArray;i.forEach(n=>{e.add(n)});const s=[];this.links.each(n=>{n.data!==null&&!e.has(n.data)&&s.push(n.data)}),s.forEach(n=>{t.Uv(n,!1)}),i.forEach(n=>{this.findLinkForData(n)===null&&t.Vv(n,!1)})}updateRelationshipsFromData(t){const e=t.data;if(e===null)return;const i=t.diagram;if(i===null)return;const s=i.model;if(t instanceof Link){let n=s.Vi(e,!0),o=i.findNodeForKey(n);t.fromNode=o,n=s.Vi(e,!1),o=i.findNodeForKey(n),t.toNode=o;const r=s.getLabelKeysForLinkData(e);if(r.length>0||t.labelNodes.count>0){if(r.length===1&&t.labelNodes.count===1){const f=r[0],u=t.labelNodes.first();if(u!==null&&s.getKeyForNodeData(u.data)===f)return}const l=new GSet().addAll(r),a=new GSet;t.labelNodes.each(f=>{if(f.data!==null){const u=s.getKeyForNodeData(f.data);u!==void 0&&a.add(u)}});const h=a.copy();h.removeAll(l);const c=l.copy();if(c.removeAll(a),h.count>0||c.count>0){const f=t;h.each(u=>{const d=i.findNodeForKey(u);d!==null&&d.labeledLink===f&&(d.labeledLink=null)}),c.each(u=>{const d=i.findNodeForKey(u);d!==null&&d.labeledLink!==f&&(d.labeledLink=f)})}}}else if(!(t instanceof Adornment)){const n=s.getGroupKeyForNodeData(e),o=i.findPartForKey(n);(o===null||o instanceof Group)&&(t.containingGroup=o)}}Nk(t){const e=this.diagram.model,i=e.getKeyForNodeData(t);if(i!==void 0){const s=e.lw(i),n=this.findPartForData(t);if(s!==null&&n!==null){const r=s.iterator;for(;r.next();){const l=r.value;if(e.containsNodeData(l)){if(n instanceof Group&&e.getGroupKeyForNodeData(l)===i){const a=this.findPartForData(l);a!==null&&(a.containingGroup=n)}}else{const a=this.findLinkForData(l);if(a!==null&&n instanceof Node){e.Vi(l,!0)===i&&(a.fromNode=n),e.Vi(l,!1)===i&&(a.toNode=n);const h=e.getLabelKeysForLinkData(l);Array.isArray(h)&&h.some(c=>c===i?(n.labeledLink=a,!0):!1)}}}e.ln(i)}const o=e.getGroupKeyForNodeData(t);if(o!==void 0){const r=this.findNodeForKey(o);n!==null&&r instanceof Group&&(n.containingGroup=r)}}}YC(t){const e=this.diagram.model;if(t instanceof Node){const i=e.getKeyForNodeData(t.data);if(i!==void 0){const s=t.linksConnected;for(;s.next();){const n=s.value;e.an(i,n.data)}if(t.isLinkLabel){const n=t.labeledLink;n!==null&&e.an(i,n.data)}if(t instanceof Group){const n=t.memberParts;for(;n.next();){const r=n.value.data;e.containsNodeData(r)&&e.an(i,r)}}}}}qC(t,e){let i=super.qC(t,e);if(t instanceof Link){const s=t.data;if(s!==null&&e!==null){const n=e.model,o=n.copyLinkData(s);n.addLinkData(o),i=e.findLinkForData(o)}else if(i!==null){const n=this.diagram;if(s!==null&&n!==null&&n.commandHandler!==null&&n.commandHandler.copiesClipboardData){const r=n.model.copyLinkData(s);i.data=r}}}return i}insertLink(t,e,i,s){const n=this.diagram,o=n.model,r=n.toolManager.findTool("Linking");let l="";t!==null&&(e===null&&(e=t),l=e.portId,l===null&&(l=""));let a="";i!==null&&(s===null&&(s=i),a=s.portId,a===null&&(a=""));const h=r.archetypeLinkData;if(h instanceof Link){h.It();const c=h.copy();if(c!==null){c.fromNode=t,c.fromPortId=l,c.toNode=i,c.toPortId=a,n.add(c);const f=r.archetypeLabelNodeData;if(f instanceof Node){f.It();const u=f.copy();u!==null&&(u.labeledLink=c,n.add(u))}return c}}else if(h!==null){const c=o.copyLinkData(h);if(U.$(c)){t!==null&&o.xg(c,o.getKeyForNodeData(t.data),!0),o.bg(c,l,!0),i!==null&&o.xg(c,o.getKeyForNodeData(i.data),!1),o.bg(c,a,!1),o.addLinkData(c);const f=r.archetypeLabelNodeData;if(f!==null&&!(f instanceof Node)){const d=o.copyNodeData(f);o.addNodeData(d);const m=o.getKeyForNodeData(d);m!==void 0&&o.addLabelKeyForLinkData(c,m)}return n.findLinkForData(c)}}return null}}class TreePartManager extends PartManager{Ua=null;Tk(t,e){if(t===null||e===null||e.findTreeParentLink()!==null)return;const i=this.diagram.toolManager.findTool("Linking");let s=t,n=e;if(this.diagram.isTreePathToChildren){if(i!==null&&i.Uu(s,n,null,!0))return}else if(s=e,n=t,i!==null&&i.Uu(s,n,null,!0))return;const o=this.getLinkCategoryForData(e.data),r=this.findLinkTemplateForCategory(o);if(r!==null){r.It();const l=r.copy();if(l!==null){const a=this.diagram.wi;this.diagram.wi=!0,l.Qo=o,l.te=e.data,l.fromNode=s,l.toNode=n,this.diagram.add(l),l.te=null,l.data=e.data,this.diagram.wi=a}}}getLinkCategoryForData(t){return this.diagram.model.getParentLinkCategoryForNodeData(t)}setLinkCategoryForData(t,e){this.diagram.model.setParentLinkCategoryForNodeData(t,e)}setFromNodeForLink(t,e,i){const s=this.diagram.model;i===void 0&&(i=null);const n=e!==null?e.data:null;if(this.diagram.isTreePathToChildren)s.setParentKeyForNodeData(t.data,s.getKeyForNodeData(n));else{const o=this.Ua;this.Ua=t,i!==null&&s.setParentKeyForNodeData(i.data,void 0);const r=t.toNode!==null?t.toNode.data:null;s.setParentKeyForNodeData(n,s.getKeyForNodeData(r)),this.Ua=o}}setToNodeForLink(t,e,i){const s=this.diagram.model;i===void 0&&(i=null);const n=e!==null?e.data:null;if(this.diagram.isTreePathToChildren){const o=this.Ua;this.Ua=t,i!==null&&s.setParentKeyForNodeData(i.data,void 0);const r=t.fromNode!==null?t.fromNode.data:null;s.setParentKeyForNodeData(n,s.getKeyForNodeData(r)),this.Ua=o}else s.setParentKeyForNodeData(t.data,s.getKeyForNodeData(n))}TC(t){this.diagram.model.setParentKeyForNodeData(t.data,void 0)}findLinkForKey(t){if(t==null)return null;const i=this.diagram.model.findNodeDataForKey(t);return i!==null?this.findLinkForData(i):null}doModelChanged(t){if(super.doModelChanged(t),!this.diagram)return;const e=this.diagram;if(t.model!==e.model)return;const i=t.change;if(e.G){e.G=!1;try{const s=t.modelChange;if(s!==""){if(i===2){if(s==="nodeParentKey"){const n=t.object,o=n?this.findNodeForData(n):null,r=t.newValue,l=this.findNodeForKey(r);if(n&&this.Ua!==null)l!==null&&(this.Ua.data=n,this.Ua.category=this.getLinkCategoryForData(n));else if(o!==null){const a=o.findTreeParentLink();a!==null?l===null?e.remove(a):e.isTreePathToChildren?a.fromNode=l:a.toNode=l:this.Tk(l,o)}}else if(s==="parentLinkCategory"){const n=t.object,o=n?this.findNodeForData(n):null,r=t.newValue;if(o!==null&&typeof r=="string"){const l=o.findTreeParentLink();l!==null&&(l.category=r)}}e.isModified=!0}}else i===2&&(t.object===e.model&&t.propertyName==="nodeParentKeyProperty"&&(e.undoManager.isUndoingRedoing||this.rebuildParts()),e.isModified=!0)}finally{e.G=!0}}}updateRelationshipsFromData(t){const e=t.data;if(e===null)return;const i=t.diagram;if(i===null)return;const s=i.model;if(t instanceof Node){const n=s.getParentKeyForNodeData(e),o=i.findNodeForKey(n),r=t.findTreeParentNode();if(o!==r){const l=t.findTreeParentLink();o!==null?l!==null?i.isTreePathToChildren?l.fromNode=o:l.toNode=o:this.Tk(o,t):l!==null&&i.A2(l,!1)}}}ow(t,e){if(super.ow(t,e),typeof e=="string"&&this.findPartForData(t)!==null){const s=this.findLinkForData(t);s!==null&&s.updateTargetBindings(e)}}Nk(t){const e=this.diagram.model,i=e.getKeyForNodeData(t);if(i!==void 0){const s=e.lw(i),n=this.findPartForData(t);if(s!==null&&n!==null){const r=s.iterator;for(;r.next();){const l=r.value;if(e.containsNodeData(l)&&n instanceof Node&&e.getParentKeyForNodeData(l)===i){const a=this.findNodeForData(l);this.Tk(n,a)}}e.ln(i)}const o=e.getParentKeyForNodeData(t);if(o!==void 0&&n instanceof Node){const r=this.findNodeForKey(o);this.Tk(r,n)}}}YC(t){const e=this.diagram.model;if(t instanceof Node){const i=e.getKeyForNodeData(t.data),s=this.findLinkForData(t.data);if(s!==null){s.isSelected=!1,s.isHighlighted=!1;const r=s.layer;if(r!==null){const l=r.ri(-1,s,!1);l>=0&&this.diagram.raiseChangedEvent(4,"parts",r,s,null,l,null);const a=s.layerChanged;a!==null&&a(s,r,null)}}const n=this.diagram.isTreePathToChildren,o=t.linksConnected;for(;o.next();){const r=o.value,l=n?r.toNode:r.fromNode;if(l!==null){const a=l.data;e.containsNodeData(a)&&e.an(i,a)}}}}insertLink(t,e,i,s){const n=this.diagram.model;let o=t,r=i;if(this.diagram.isTreePathToChildren||(o=i,r=t),o!==null&&r!==null){const l=o.data,a=r.data;return n.setParentKeyForNodeData(a,n.getKeyForNodeData(l)),r.findTreeParentLink()}return null}}var BindingMode=(w=>(w[w.OneWay=1]="OneWay",w[w.TwoWay=2]="TwoWay",w))(BindingMode||{});class Binding{n;jC;nc;Kf;Va;Hf;qf;jf;Dk;Ti;Id;Df;constructor(t,e,i,s){GSet.Je(this),t===void 0?t="":U.s(t,"string",Binding,"constructor:targetprop"),e===void 0?e=t:U.s(e,"string",Binding,"constructor:sourceprop"),i===void 0?i=null:i!==null&&U.S(i,Binding,"constructor:conv"),this.jC=-1,this.Ti=null,this.nc=t,this.Id=0,this.Df=0,this.Kf=null,this.Va=e,this.Hf=i,s===void 0?(this.qf=1,this.jf=null):(this.qf=2,this.jf=s),this.Dk=new GSet,this.n=2}copy(){const t=new this.constructor;return this.cloneProtected(t),t}cloneProtected(t){t.nc=this.nc,t.Id=this.Id,t.Df=this.Df,t.Kf=this.Kf,t.Va=this.Va,t.Hf=this.Hf,t.qf=this.qf,t.jf=this.jf,t.n=this.n&-2}static OneWay=1;static TwoWay=2;static parseEnum(t,e){return U.S(t,Binding,"parseEnum:ctor"),i=>{let s=parseInt(i);return isNaN(s)&&(s=U.$a(t,i),s===null)?e:s}}fe(t){t in BindingMode?this.mode=t:U.ur(this,t)}static toString(t){return U.toString(t)}toString(){return"Binding("+this.targetProperty+":"+this.sourceProperty+(this.targetId!==-1?" "+this.targetId:"")+" "+BindingMode[this.mode]+")"}k(){return this.n=this.n|1,this}get targetId(){return this.jC}set targetId(t){this.u&&U.L(this),this.jC=t}get targetProperty(){return this.nc}set targetProperty(t){this.u&&U.L(this),U.s(t,"string",Binding,"targetProperty"),this.nc=t}get sourceProperty(){return this.Va}set sourceProperty(t){this.u&&U.L(this),U.s(t,"string",Binding,"sourceProperty"),this.Va=t}get u(){return(this.n&1)!==0}get isToData(){return(this.n&2)!==0}get isToObject(){return(this.n&4)!==0}get isToModel(){return(this.n&8)!==0}get isToTheme(){return(this.n&16)!==0}get WC(){return this.isToTheme&&!(this.isToData||this.isToObject||this.isToModel)}xd(){return!1}get sourceName(){return this.Kf}set sourceName(t){this.u&&U.L(this),t!==null&&U.s(t,"string",Binding,"sourceName"),this.Kf=t,t!==null?this.n=this.n&-3|4:this.n=this.n|2}get converter(){return this.Hf}set converter(t){this.u&&U.L(this),t!==null&&U.S(t,Binding,"converter"),this.Hf=t}get backConverter(){return this.jf}set backConverter(t){this.u&&U.L(this),t!==null&&U.S(t,Binding,"backConverter"),this.jf=t}get mode(){return this.qf}set mode(t){this.u&&U.L(this),this.isToTheme&&t===2&&U.o("Theme Bindings cannot be TwoWay."),this.qf=t}makeTwoWay(t){return this.isToTheme&&U.o("Theme Bindings cannot be TwoWay."),this.mode=2,t&&(U.S(t,Binding,"makeTwoWay"),this.backConverter=t),this}ofObject(t){return this.u&&U.L(this),t===void 0&&(t=""),this.sourceName=t,this}ofModel(){return this.u&&U.L(this),this.n=this.n&-3&-5|8,this.Kf=null,this}$T(t,e){const i=this.sourceName;let s=null;return i===null||i===""?s=t:i==="/"?s=e.part:i==="."?s=e:i===".."?s=e.panel:s=t.findObject(i),s}check(t){const e=this.nc,i=this.Va,s=this.Hf;(this.xd()&&s===null&&this.Ba===null&&e===""||s===null&&e==="")&&U.ne("Binding error: target property is the empty string: "+this.toString()),this.xd()&&this.WC&&i===""&&s===null&&this.Ba===null&&U.ne("Binding error: theme bindings require a source property when not using a converter: "+this.toString()),t&&typeof e=="string"&&(!U.st(["setAttribute"])&&e.length>0&&e[0]!=="_"&&!U.qw(t,e)?U.ne("Binding error: undefined target property: "+e+" on "+t.toString()):e==="name"&&t instanceof GraphObject&&U.ne("Binding error: cannot modify GraphObject.name on "+t.toString()))}updateTarget(t,e,i,s){const n=this.Va;if(i!==void 0&&n!==""&&n!==i||this.isToTheme&&t.diagram===null)return;const o=this.nc,r=this.Hf;let l=e;if(n!==""&&!this.WC&&(l=Model.St(e,n)),l!==void 0)if(r===null){if(o!==""){if(this.xd()){const a=t.diagram?.themeManager;if(l=this.Bv(a,l,t,o),l===void 0)return}s?s.et(t,o,l):(e instanceof GraphObject||e instanceof RowColumnDefinition)&&Model.et(t,o,l)}}else try{if(o!==""){let a=r(l,t);if(this.xd()){const h=t.diagram?.themeManager;if(a=this.Bv(h,a,t,o),a===void 0)return}s?s.et(t,o,a):(e instanceof GraphObject||e instanceof RowColumnDefinition)&&Model.et(t,o,a)}else r(l,t)}catch{}}updateSource(t,e,i,s){if(this.qf!==2)return;const n=this.nc;if(i!==void 0&&n!==i)return;const o=this.Va,r=this.jf,l=s!==null?s.diagram:null,a=l!==null?l.model:null;let h=t;if(n!==""&&(h=Model.St(t,n)),h!==void 0&&!this.Dk.has(t))try{if(this.Dk.add(t),r===null){if(o!=="")a!==null?a.setDataProperty(e,o,h):(e instanceof GraphObject||e instanceof RowColumnDefinition)&&(e[o]=h);else if(a!==null&&s!==null&&s.itemIndex>=0&&s.panel!==null&&Array.isArray(s.panel.itemArray)){const c=s.itemIndex,f=s.panel.itemArray;a.removeArrayItem(f,c),a.insertArrayItem(f,c,h)}}else try{if(o!==""){const c=r(h,e,a);a!==null?a.setDataProperty(e,o,c):(e instanceof GraphObject||e instanceof RowColumnDefinition)&&(e[o]=c)}else{const c=r(h,e,a);if(c!==void 0&&a!==null&&s!==null&&s.itemIndex>=0&&s.panel!==null&&Array.isArray(s.panel.itemArray)){const f=s.itemIndex,u=s.panel.itemArray;a.removeArrayItem(u,f),a.insertArrayItem(u,f,c)}}}catch{}}finally{this.Dk.delete(t)}}}class ThemeBinding extends Binding{aw;Ba;oc;constructor(t,e,i,s,n){super(t,e,s),i==null&&(i=""),n===void 0&&(n=null),this.aw=i,this.Ba=n,this.oc=null,this.n=16}cloneProtected(t){super.cloneProtected(t),t.aw=this.aw,t.Ba=this.Ba,t.oc=this.oc}xd(){return!0}get themeSource(){return this.aw}set themeSource(t){this.u&&U.L(this),t!==null&&U.s(t,"string",ThemeBinding,"themeSource"),this.aw=t,this.oc=null,t!==null?this.n=this.n|16:this.n=this.n&-17}get themeConverter(){return this.Ba}set themeConverter(t){this.u&&U.L(this),t!==null&&U.S(t,ThemeBinding,"themeConverter"),this.Ba=t}ofData(){return this.u&&U.L(this),this.n=this.n|2,this.Kf=null,this}Bv(t,e,i,s){if(!t||(this.WC&&(e=this.Va),!e&&e!==0))return;let n=this.themeSource;this.oc!==null?n=this.oc:typeof n=="string"&&n.includes(".")&&(this.oc=n.split("."),n=this.oc);let o=t.findValue(e,n,s);if(o===void 0&&U.ne(`Theme warning: ${e} could not be found when setting target property ${s}.`),t.readsCssVariables&&typeof o=="string"&&o.startsWith("var(")){const r=o.match(this.r3);r&&(o=getComputedStyle(root.document.documentElement).getPropertyValue(r[1]))}return U.st(this.Ba)&&(o=this.Ba(o,i)),o}r3=/var\((.*)\)/}class Model{Pt;kg;Bo;JC;Bi;be;za;Wf;Jf;Pg;Sg;Mg;Ng;hw;rc;rr;cw;Vo;vk;constructor(t,e){if(GSet.Je(this),this.Pt="",this.kg="",this.Bo=!1,this.JC={},this.Bi=[],this.be=new GMap,this.za="key",this.Wf=null,this.Jf=null,this.Pg=!1,this.Sg=!1,this.Mg=!1,this.Ng=null,this.hw=100,this.rc="category",this.rr=new GMap,this.cw=[],this.Vo=!1,this.vk=null,this.undoManager=new UndoManager,t!==void 0&&(Array.isArray(t)?this.nodeDataArray=t:e=t),e){Object.assign(this,e);const i=e.Changed;i&&(delete this.Changed,this.addChangedListener(i))}}cloneProtected(t){t.Pt=this.Pt,t.kg=this.kg,t.Bo=this.Bo,t.za=this.za,t.Wf=this.Wf,t.Jf=this.Jf,t.Pg=this.Pg,t.Sg=this.Sg,t.Mg=this.Mg,t.Ng=this.Ng,t.hw=this.hw,t.rc=this.rc}copy(){const t=new this.constructor;return this.cloneProtected(t),t}clear(){this.Bi=[],this.be.clear(),this.rr.clear(),this.undoManager.clear()}toString(t){if(t===void 0&&(t=0),t>1)return this.toJson();{let e=(this.name!==""?this.name:"")+" Model";if(t>0){e+=`
 node data:`;const i=this.nodeDataArray,s=i.length;for(let n=0;n<s;n++){const o=i[n];e+=" "+this.getKeyForNodeData(o)+":"+U.toString(o)}}return e}}toIncrementalData(t){t.change!==1&&U.o("Model.toIncrementalData argument is not a Transaction ChangedEvent:"+t.toString());const e=t.object;if(!t.isTransactionFinished||!(e instanceof Transaction))return null;const i=this.zv(e);return this.$C(e,t.propertyName==="FinishedUndo",i)}$C(t,e,i){const s=this;let n=!1;const o=new GSet,r=new GSet,l=new GSet;t.changes.each(u=>{if(u.model===s){if(u.modelChange==="nodeDataArray")u.change===3?o.add(u.newValue):u.change===4&&l.add(u.oldValue);else if(s.containsNodeData(u.object))u.object!==null&&r.add(u.object);else if(u.change===2&&(s.modelData===u.object||u.propertyName==="modelData"))n=!0;else if(u.object!==null)if(i.has(u.object)){const d=i.get(u.object);d&&d.each(m=>{s.containsNodeData(m)&&r.add(m)})}else{if(u.object instanceof Model||s.jh()&&s.containsLinkData(u.object))return;s.Xv(u.object).each(m=>{r.add(m)})}}});const a=new GSet;o.each(u=>{const d=s.getKeyForNodeData(u);d!==void 0&&a.add(d),e||r.add(u)});const h=new GSet;l.each(u=>{const d=s.getKeyForNodeData(u);d!==void 0&&h.add(d),e&&r.add(u)});const c=s.cloneDeep(r.toArray());let f=null;return n&&(f===null&&(f={}),f.modelData=this.cloneDeep(this.modelData)),a.count>0&&(f===null&&(f={}),e?f.removedNodeKeys=a.toArray():f.insertedNodeKeys=a.toArray()),c.length>0&&(f===null&&(f={}),f.modifiedNodeData=c),h.count>0&&(f===null&&(f={}),e?f.insertedNodeKeys=h.toArray():f.removedNodeKeys=h.toArray()),f}cloneDeep(t){return this.Cg(t,!0)}Cg(t,e,i,s){if(!U.$(t))return t;i||(i=new GMap);const n=i.get(t);if(n)return n;let o;if(Array.isArray(t)){o=[],i.set(t,o);for(let r=0;r<t.length;r++){const l=t[r];o.push(this.Cg(l,!1,i,s))}}else if(t instanceof Point||t instanceof Size||t instanceof Rect||t instanceof Margin||t instanceof Spot)o=t.copy(),i.set(t,o);else{if(t instanceof Brush||t instanceof Geometry)return t;if(t instanceof List)o=new List().addAll(this.Cg(t.toArray(),!1,i,s)),i.set(t,o);else if(t instanceof GSet)o=new GSet().addAll(this.Cg(t.toArray(),!1,i,s)),i.set(t,o);else if(t instanceof GMap)o=new GMap().addAll(this.Cg(t.toArray(),!1,i,s)),i.set(t,o);else if(t instanceof Date)o=new Date(t),i.set(t,o);else if(t instanceof RegExp)o=new RegExp(t),i.set(t,o),o.lastIndex=t.lastIndex;else if(Model.ZC(null,"",t))o=t;else if(U.st(t.copy))o=t.copy(),i.set(t,o);else{o={},i.set(t,o);for(const r in t){if(r==="__gohashid")continue;const l=t[r];o[r]=this.Cg(l,!1,i,s)}}}return o}quote(t){return JSON.stringify(t).replace(/[\u007F-\uFFFF]/g,i=>{const s="0000"+i.charCodeAt(0).toString(16);return"\\u"+s.substring(s.length-4)})}Lg(){let t="";return this.name!==""&&(t+=`,
  "name": `+this.quote(this.name)),this.dataFormat!==""&&(t+=`,
  "dataFormat": `+this.quote(this.dataFormat)),this.isReadOnly&&(t+=`,
  "isReadOnly": `+this.isReadOnly),this.nodeKeyProperty!=="key"&&typeof this.nodeKeyProperty=="string"&&(t+=`,
  "nodeKeyProperty": `+this.quote(this.nodeKeyProperty)),this.copiesArrays&&(t+=`,
  "copiesArrays": true`),this.copiesArrayObjects&&(t+=`,
  "copiesArrayObjects": true`),this.copiesKey&&(t+=`,
  "copiesKey": true`),this.pointsDigits!==100&&(t+=`,
  "pointsDigits": `+this.pointsDigits.toString()),this.nodeCategoryProperty!=="category"&&typeof this.nodeCategoryProperty=="string"&&(t+=`,
  "nodeCategoryProperty": `+this.quote(this.nodeCategoryProperty)),t}fw(t){t.name&&(this.name=t.name),t.dataFormat&&(this.dataFormat=t.dataFormat),t.isReadOnly&&(this.isReadOnly=!0),t.nodeKeyProperty&&(this.nodeKeyProperty=t.nodeKeyProperty),t.copiesArrays&&(this.copiesArrays=!0),t.copiesArrayObjects&&(this.copiesArrayObjects=!0),t.copiesKey!==void 0&&(this.copiesKey=t.copiesKey),t.pointsDigits!==void 0&&(this.pointsDigits=parseInt(t.pointsDigits)),t.nodeCategoryProperty&&(this.nodeCategoryProperty=t.nodeCategoryProperty)}Gv(){const t=this.modelData;return`,
  "modelData": `+this.Yv(t)}Kv(t){const e=t.modelData;U.$(e)&&(this.replaceJsonObjects(e),this.modelData=e)}QC(){const t=this.modelData;let e=!1;for(const s in t)if(!this.Fk(t,s,t[s])){e=!0;break}let i="";return e&&(i=this.Gv()),i+`,
  "nodeDataArray": `+this.Xa(this.nodeDataArray,!0)}_C(t){this.Kv(t);const e=t.nodeDataArray;Array.isArray(e)&&(this.replaceJsonObjects(e),this.nodeDataArray=e)}tL(t,e,i){if(t===e)return!0;if(typeof t!=typeof e||U.st(t)||U.st(e))return!1;if(Array.isArray(t)&&Array.isArray(e)){if(i.get(t)===e)return!0;if(i.set(t,e),t.length!==e.length)return!1;for(let s=0;s<t.length;s++)if(!this.tL(t[s],e[s],i))return!1;return!0}else if(U.$(t)&&U.$(e)){if(i.get(t)===e)return!0;i.set(t,e);for(const s in t){const n=t[s];if(this.Fk(t,s,n))continue;const o=e[s];if(o===void 0||!this.tL(n,o,i))return!1}for(const s in e){const n=e[s];if(this.Fk(e,s,n))continue;const o=t[s];if(o===void 0||!this.tL(o,n,i))return!1}return!0}return!1}static Hv=`,
  "insertedNodeKeys": `;static l3=`,
  "modifiedNodeData": `;static qv=`,
  "removedNodeKeys": `;zv(t){let e=new GMap;const i=(s,n)=>{const o=n.part;if(!o)return;const r=o.data;if(s===r)return;let l=e.get(s);l===null?(l=new GSet,l.add(r),e.set(s,l)):l.add(r)};return t.changes.each(s=>{if(s.diagram!==null){const n=s.change;if(n===2){if(s.object!==null){const o=s.object.panel;if(o){const r=o.data;r&&i(r,o)}}}else if(n===3||n===4){const o=s.object,r=o.itemArray;r&&i(r,o)}}}),e}Xv(t){const e=new GSet;for(let i=0;i<this.nodeDataArray.length;i++){const s=this.nodeDataArray[i];this.Rk(t,s,s,e)}return e}Rk(t,e,i,s){if(Array.isArray(e))for(let n=0;n<e.length;n++){const o=e[n];if(o===t)return s.add(i),!0;if(this.Rk(t,o,i,s))return!0}else if(U.$(e)&&Object.getPrototypeOf(e)===Object.prototype)for(const n in e){const o=e[n];if(o===t)return s.add(i),!0;if(this.Rk(t,o,i,s))return!0}return!1}eL(t,e,i){const s=this;let n=!1;const o=new GSet,r=new GSet,l=new GSet;t.changes.each(f=>{if(f.model===s){if(f.modelChange==="nodeDataArray")f.change===3?o.add(f.newValue):f.change===4&&l.add(f.oldValue);else if(s.containsNodeData(f.object))f.object!==null&&r.add(f.object);else if(f.change===2&&(s.modelData===f.object||f.propertyName==="modelData"))n=!0;else if(f.object!==null)if(i.has(f.object)){const u=i.get(f.object);u&&u.each(d=>{s.containsNodeData(d)&&r.add(d)})}else{if(f.object instanceof Model||s.jh()&&s.containsLinkData(f.object))return;s.Xv(f.object).each(d=>{r.add(d)})}}});const a=new GSet;o.each(f=>{const u=s.getKeyForNodeData(f);u!==void 0&&a.add(u),e||r.add(f)});const h=new GSet;l.each(f=>{const u=s.getKeyForNodeData(f);u!==void 0&&h.add(u),e&&r.add(f)});let c="";return n&&(c+=this.Gv()),a.count>0&&(c+=(e?Model.qv:Model.Hv)+this.Xa(a.toArray(),!0)),r.count>0&&(c+=Model.l3+this.Xa(r.toArray(),!0)),h.count>0&&(c+=(e?Model.Hv:Model.qv)+this.Xa(h.toArray(),!0)),c}uw(t){(t.name!==void 0&&t.name!==this.name||t.dataFormat!==void 0&&t.dataFormat!==this.dataFormat||t.isReadOnly!==void 0&&t.isReadOnly!==this.isReadOnly||t.nodeKeyProperty!==void 0&&t.nodeKeyProperty!==this.nodeKeyProperty||t.copiesArrays!==void 0&&t.copiesArrays!==this.copiesArrays||t.copiesArrayObjects!==void 0&&t.copiesArrayObjects!==this.copiesArrayObjects||t.copiesKey!==void 0&&t.copiesKey!==this.copiesKey||t.nodeCategoryProperty!==void 0&&t.nodeCategoryProperty!==this.nodeCategoryProperty)&&U.o("applyIncrementalJson cannot change Model properties"),this.Kv(t);const e=t.insertedNodeKeys,i=t.modifiedNodeData,s=new GMap;if(Array.isArray(i))for(let o=0;o<i.length;o++){const r=i[o],l=this.getKeyForNodeData(r);l!=null&&s.set(l,r)}if(Array.isArray(e)){const o=e.length;for(let r=0;r<o;r++){const l=e[r];let a=this.findNodeDataForKey(l);if(a===null){const h=s.get(l);a=h||this.copyNodeData({}),a!==null&&(this.setKeyForNodeData(a,l),this.addNodeData(a))}}}if(Array.isArray(i)){const o=i.length;for(let r=0;r<o;r++){const l=i[r],a=this.getKeyForNodeData(l),h=this.findNodeDataForKey(a);if(h!==null){for(const c in l)c==="__gohashid"||c===this.nodeKeyProperty||(this.Um()||this.a1())&&c===this.nodeIsGroupProperty||this.setDataProperty(h,c,l[c]);this.Ag(l,h)}}}const n=t.removedNodeKeys;if(Array.isArray(n)){const o=n.length;for(let r=0;r<o;r++){const l=n[r],a=this.findNodeDataForKey(l);a!==null&&this.removeNodeData(a)}}}toIncrementalJson(t,e){t.change!==1&&U.o("Model.toIncrementalJson argument is not a Transaction ChangedEvent:"+t.toString());const i=t.object;if(!t.isTransactionFinished||!(i instanceof Transaction))return'{ "incremental": 0 }';e===void 0&&(e=U.Kn(this));const s=this.zv(i),n=this.eL(i,t.propertyName==="FinishedUndo",s);return'{ "class": '+this.quote(e)+', "incremental": 1'+this.Lg()+n+"}"}toIncrementalJSON(t,e){return this.toIncrementalJson(t,e)}toJson(t){return t===void 0&&(t=U.Kn(this)),'{ "class": '+this.quote(t)+this.Lg()+this.QC()+"}"}toJSON(t){return this.toJson(t)}applyIncrementalJson(t){let e=null;if(typeof t=="string")try{e=root.JSON.parse(t)}catch{}else U.$(t)?e=t:U.o("Unable to modify a Model from: "+t);const i=e.incremental;typeof i!="number"&&U.o("Unable to apply non-incremental changes to Model: "+t),i!==0&&(this.startTransaction("applyIncrementalJson"),this.uw(e),this.commitTransaction("applyIncrementalJson"))}applyIncrementalJSON(t){return this.applyIncrementalJson(t)}static fromJson(t,e){e===void 0&&(e=null),e!==null&&U.se(e,Model,Model,"fromJson:model");let i=null;if(typeof t=="string")try{i=root.JSON.parse(t)}catch{}else U.$(t)?i=t:U.o("Unable to construct a Model from: "+t);if(e===null){const s=Model.a3(i);s===null||s instanceof Model?e=s:U.o("Unable to construct a Model of declared class: "+i.class)}return e===null&&(e=Model.jv()),e.fw(i),e._C(i),e}static fromJSON(t,e){return this.fromJson(t,e)}static jv(){return new Model}static a3(t){let e=null,i=t.class;if(typeof i=="string")try{let s=null;i.indexOf("go.")===0?s=Model.iL(i.substring(3)):(s=Model.iL(i),s===null&&(s=root[i])),U.st(s)&&(e=new s)}catch{}return e}replaceJsonObjects(t){if(Array.isArray(t)){const e=t.length;for(let i=0;i<e;i++){const s=t[i];U.$(s)&&this.Wv(t,i,this.replaceJsonObjects(s))}}else if(U.$(t)){for(const e in t){const i=t[e];if(U.$(i)){const s=this.replaceJsonObjects(i);t[e]=s,this.replaceJsonPropertyValue(t,e,s)}}return this.h3(t)}return t}replaceJsonPropertyValue(t,e,i){if(e==="points"&&Array.isArray(i)){let s=i.length%2===0;for(let n=0;n<i.length;n++)if(typeof i[n]!="number"){s=!1;break}if(s){const n=new List;for(let o=0;o<i.length/2;o++)n.add(new Point(i[o*2],i[o*2+1]));t[e]=n}}}writeJsonValue(t){return t===void 0?"undefined":t===null?"null":t===!0?"true":t===!1?"false":typeof t=="string"?this.quote(t):typeof t=="number"?t===1/0?"9e9999":t===-1/0?"-9e9999":isNaN(t)?'{"class":"NaN"}':t.toString():t instanceof Boolean?this.writeJsonValue(t.valueOf()):t instanceof String?this.writeJsonValue(t.valueOf()):t instanceof Number?this.writeJsonValue(t.valueOf()):t instanceof Date?'{"class":"Date", "value":"'+t.toJSON()+'"}':Array.isArray(t)?this.Xa(t):U.$(t)?this.Yv(t):U.st(t)?"null":'"'+t.toString()+'"'}Xa(t,e){e===void 0&&(e=!1);const i=t.length;if(i<=0)return"[]";const s=new StringBuilder;s.add("["),e&&i>1&&s.add(`
`);for(let n=0;n<i;n++){const o=t[n];o!==void 0&&(n>0&&(s.add(","),e&&s.add(`
`)),s.add(this.writeJsonValue(o)))}return e&&i>1&&s.add(`
`),s.add("]"),s.toString()}Fk(t,e,i){return!!(i===void 0||e==="__gohashid"||e[0]==="_"||U.st(i))}qe(t){return isNaN(t)?"NaN":t===1/0?"9e9999":t===-1/0?"-9e9999":t}Yv(t){const e=t;if(e instanceof Point)t={class:"go.Point",x:this.qe(e.x),y:this.qe(e.y)};else if(e instanceof Size)t={class:"go.Size",width:this.qe(e.width),height:this.qe(e.height)};else if(e instanceof Rect)t={class:"go.Rect",x:this.qe(e.x),y:this.qe(e.y),width:this.qe(e.width),height:this.qe(e.height)};else if(e instanceof Margin)t={class:"go.Margin",top:this.qe(e.top),right:this.qe(e.right),bottom:this.qe(e.bottom),left:this.qe(e.left)};else if(e instanceof Spot)e.isSpot()?t={class:"go.Spot",x:this.qe(e.x),y:this.qe(e.y),offsetX:this.qe(e.offsetX),offsetY:this.qe(e.offsetY)}:t={class:"go.Spot",enum:e.toString()};else if(e instanceof Brush){if(t={class:"go.Brush",type:BrushType[e.type]},e.type===1?t.color=e.color:(e.type===2||e.type===3)&&(t.start=e.start,t.end=e.end,e.type===3&&(e.startRadius!==0&&(t.startRadius=this.qe(e.startRadius)),isNaN(e.endRadius)||(t.endRadius=this.qe(e.endRadius)))),e.colorStops!==null){const n={},o=e.colorStops.iterator;for(;o.next();){const r=o.key,l=o.value;n[r]=l}t.colorStops=n}}else if(e instanceof Geometry)t={class:"go.Geometry",type:GeometryType[e.type]},e.startX!==0&&(t.startX=this.qe(e.startX)),e.startY!==0&&(t.startY=this.qe(e.startY)),e.endX!==0&&(t.endX=this.qe(e.endX)),e.endY!==0&&(t.endY=this.qe(e.endY)),e.spot1.equals(Spot.TopLeft)||(t.spot1=e.spot1),e.spot2.equals(Spot.BottomRight)||(t.spot2=e.spot2),e.type===4&&(t.path=Geometry.stringify(e));else if(Model.ZC(null,"",e))return"{}";let i="{",s=!0;for(const n in t){const o=this.St(t,n);this.Fk(t,n,o)||(s?s=!1:i+=",",i+=this.quote(n)+":"+this.writeJsonPropertyValue(n,o))}return i+="}",i}writeJsonPropertyValue(t,e){if(t==="points"&&e instanceof List){const i=e;let s="[";const n=i.iterator;for(;n.next();){const o=n.value;s.length>1&&(s+=","),s+=this.Jv(o.x),s+=",",s+=this.Jv(o.y)}return s+="]",s}else return this.writeJsonValue(e)}Jv(t){if(t===1/0)return"9e9999";if(t===-1/0)return"-9e9999";if(isNaN(t))return"0";const e=this.pointsDigits;return e>16?t.toString():t.toFixed(e)}get pointsDigits(){return this.hw}set pointsDigits(t){t<0?t=0:t>100&&(t=100),this.hw=t}je(t){return typeof t=="number"?t:t==="NaN"?NaN:t==="9e9999"?1/0:t==="-9e9999"?-1/0:parseFloat(t)}h3(t){if(!U.$(t))return t;let e=t.class||"";if(typeof e!="string"||e==="")return t;if(e==="NaN")return NaN;if(e==="Date")return new Date(t.value);if(e.indexOf("go.")!==0)return t;e=e.substring(3);let i=t;if(e==="Point")i=new Point(this.je(t.x),this.je(t.y));else if(e==="Size")i=new Size(this.je(t.width),this.je(t.height));else if(e==="Rect")i=new Rect(this.je(t.x),this.je(t.y),this.je(t.width),this.je(t.height));else if(e==="Margin")i=new Margin(this.je(t.top),this.je(t.right),this.je(t.bottom),this.je(t.left));else if(e==="Spot")typeof t.enum=="string"?i=Spot.parse(t.enum):i=new Spot(this.je(t.x),this.je(t.y),this.je(t.offsetX),this.je(t.offsetY));else if(e==="Brush"){const s=new Brush;s.type=U.$a(BrushType,t.type)??1,typeof t.color=="string"&&(s.color=t.color),t.start instanceof Spot&&(s.start=t.start),t.end instanceof Spot&&(s.end=t.end),typeof t.startRadius=="number"&&(s.startRadius=this.je(t.startRadius)),typeof t.endRadius=="number"&&(s.endRadius=this.je(t.endRadius));const n=t.colorStops;if(U.$(n))for(const o in n){const r=parseFloat(o);s.addColorStop(r,n[o])}i=s}else if(e==="Geometry"){let s=null;typeof t.path=="string"?s=Geometry.parse(t.path):s=new Geometry,s.type=U.$a(GeometryType,t.type)??1,typeof t.startX=="number"&&(s.startX=this.je(t.startX)),typeof t.startY=="number"&&(s.startY=this.je(t.startY)),typeof t.endX=="number"&&(s.endX=this.je(t.endX)),typeof t.endY=="number"&&(s.endY=this.je(t.endY)),t.spot1 instanceof Spot&&(s.spot1=t.spot1),t.spot2 instanceof Spot&&(s.spot2=t.spot2),i=s}else if(e==="EnumValue"){let s=t.classType;s.indexOf("go.")===0&&(s=s.substring(3));const n=Model.iL(s);U.st(n)&&(i=U.$a(n,t.name))}return i}get name(){return this.Pt}set name(t){const e=this.Pt;e!==t&&(U.s(t,"string",Model,"name"),this.Pt=t,this.t("name",e,t))}get dataFormat(){return this.kg}set dataFormat(t){const e=this.kg;e!==t&&(U.s(t,"string",Model,"dataFormat"),this.kg=t,this.t("dataFormat",e,t))}get isReadOnly(){return this.Bo}set isReadOnly(t){const e=this.Bo;e!==t&&(U.s(t,"boolean",Model,"isReadOnly"),this.Bo=t,this.t("isReadOnly",e,t))}get modelData(){return this.JC}set modelData(t){const e=this.modelData;e!==t&&(U.wc(t,Model,"modelData"),this.containsNodeData(t)&&U.o("Model.modelData Object must not be used by the rest of the model: "+t),this.JC=t,this.t("modelData",e,t),this.updateTargetBindings(t))}addChangedListener(t){return U.S(t,Model,"addChangedListener:listener"),this.cw.push(t),this}removeChangedListener(t){U.S(t,Model,"removeChangedListener:listener");const e=this.cw.indexOf(t);e>=0&&this.cw.splice(e,1)}D2(t){this.skipsUndoManager||this.undoManager.handleChanged(t),this.$v(t)}$v(t){this.cw.forEach(e=>e(t))}lR(t){this.$v(t)}raiseChangedEvent(t,e,i,s,n,o,r){this.Ft("",t,e,i,s,n,o,r)}raiseChanged(t,e,i,s,n){this.Ft("",2,t,this,e,i,s,n)}t(t,e,i,s,n){this.Ft("",2,t,this,e,i,s,n)}raiseDataChanged(t,e,i,s,n,o){this.Ft("",2,e,t,i,s,n,o)}Ft(t,e,i,s,n,o,r,l){r===void 0&&(r=null),l===void 0&&(l=null);const a=new ChangedEvent;a.model=this,a.change=e,a.modelChange=t,a.propertyName=i,a.object=s,a.oldValue=n,a.oldParam=r,a.newValue=o,a.newParam=l,this.D2(a)}get undoManager(){return this.vk}set undoManager(t){const e=this.vk;e!==t&&(e&&e.removeModel(this),this.vk=t,t.addModel(this))}get skipsUndoManager(){return this.Vo}set skipsUndoManager(t){U.s(t,"boolean",Model,"skipsUndoManager"),this.Vo=t}changeState(t,e){if(t!==null&&t.model===this)if(t.change===2){const i=t.object,s=t.propertyName,n=t.getValue(e);if(i!==null&&s===this.nodeKeyProperty&&this.containsNodeData(i)){const o=t.getValue(!e);o!==void 0&&this.be.delete(o),n!==void 0&&this.be.set(n,i)}this.et(i,s,n)}else if(t.change===3){const i=t.newParam;if(t.modelChange==="nodeDataArray"){const s=t.newValue;if(U.$(s)&&typeof i=="number"){const n=this.getKeyForNodeData(s);e?(this.Bi[i]===s&&this.No(this.Bi,i),n!==void 0&&this.be.delete(n)):(this.Bi[i]!==s&&this.lr(this.Bi,i,s),n!==void 0&&this.be.set(n,s))}}else if(t.modelChange===""){let s=t.object;if(s&&!Array.isArray(s)&&t.propertyName&&(s=this.St(s,t.propertyName)),Array.isArray(s)&&typeof i=="number"){const n=t.newValue;e?this.No(s,i):this.lr(s,i,n)}}else U.o("unknown ChangeType.Insert modelChange: "+t.toString())}else if(t.change===4){const i=t.oldParam;if(t.modelChange==="nodeDataArray"){const s=t.oldValue;if(U.$(s)&&typeof i=="number"){const n=this.getKeyForNodeData(s);e?(this.Bi[i]!==s&&this.lr(this.Bi,i,s),n!==void 0&&this.be.set(n,s)):(this.Bi[i]===s&&this.No(this.Bi,i),n!==void 0&&this.be.delete(n))}}else if(t.modelChange===""){let s=t.object;if(s&&!Array.isArray(s)&&t.propertyName&&(s=this.St(s,t.propertyName)),Array.isArray(s)&&typeof i=="number"){const n=t.oldValue;e?this.lr(s,i,n):this.No(s,i)}}else U.o("unknown ChangeType.Remove modelChange: "+t.toString())}else t.change===1||U.o("unknown ChangedEvent: "+t.toString())}startTransaction(t){return this.undoManager.startTransaction(t)}commitTransaction(t){return this.undoManager.commitTransaction(t)}rollbackTransaction(){return this.undoManager.rollbackTransaction()}commit(t,e){let i=e;i===void 0&&(i="");const s=this.skipsUndoManager;i===null&&(this.skipsUndoManager=!0,i=""),this.undoManager.startTransaction(i);let n=!1;try{t(this),n=!0}finally{n?this.undoManager.commitTransaction(i):this.undoManager.rollbackTransaction(),this.skipsUndoManager=s}}updateTargetBindings(t,e){e===void 0&&(e=""),this.Ft("SourceChanged",1,e,t,null,null)}get nodeKeyProperty(){return this.za}set nodeKeyProperty(t){const e=this.za;e!==t&&(this.En(t,Model,"nodeKeyProperty"),t===""&&U.o("Model.nodeKeyProperty may not be the empty string"),this.be.count>0&&U.o("Cannot set Model.nodeKeyProperty when there is existing node data"),this.za=t,this.t("nodeKeyProperty",e,t))}En(t,e,i){typeof t!="string"&&!U.st(t)&&U.si(t,"string or function",e,i)}getKeyForNodeData(t){if(t===null)return;const e=this.za;if(e==="")return;const i=this.St(t,e);if(i!==void 0){if(this.isKeyType(i))return i;U.o("Key value for node data "+t+" is not a number or a string: "+i)}}setKeyForNodeData(t,e){if((e==null||!this.isKeyType(e))&&U.si(e,"number or string",Model,"setKeyForNodeData:key"),t===null)return;const i=this.za;if(i==="")return;if(!this.containsNodeData(t)){this.et(t,i,e);return}const s=this.St(t,i);if(s!==e){if(this.findNodeDataForKey(e)!==null)return;this.et(t,i,e),s!==void 0&&this.be.delete(s),this.be.set(e,t),this.Ft("nodeKey",2,i,t,s,e),typeof i=="string"&&this.updateTargetBindings(t,i),this.dw(s,e)}}get makeUniqueKeyFunction(){return this.Wf}set makeUniqueKeyFunction(t){const e=this.Wf;e!==t&&(t!==null&&U.S(t,Model,"makeUniqueKeyFunction"),this.Wf=t,this.t("makeUniqueKeyFunction",e,t))}isKeyType(t){return typeof t=="number"||typeof t=="string"}containsNodeData(t){if(t===null)return!1;const e=this.getKeyForNodeData(t);return e===void 0?!1:this.be.get(e)===t}findNodeDataForKey(t){return t===null&&U.o("Model.findNodeDataForKey:key must not be null"),t===void 0||!this.isKeyType(t)?null:this.be.get(t)}get nodeDataArray(){return this.Bi}set nodeDataArray(t){const e=this.Bi;if(e!==t){this.sL(t,Model,"nodeDataArray"),this.be.clear(),this.nL();const i=t.length;for(let o=0;o<i;o++){const r=t[o];U.$(r)||U.o("Model.nodeDataArray must only contain Objects, not: "+r),r===this.modelData&&U.o("nodeDataArray Objects must not be the shared Model.modelData")}this.Bi=t;const s=new List;for(let o=0;o<i;o++){const r=t[o],l=this.getKeyForNodeData(r);l===void 0||this.be.get(l)!==null?s.add(r):this.be.set(l,r)}const n=s.iterator;for(;n.next();){const o=n.value;this.makeNodeDataKeyUnique(o);const r=this.getKeyForNodeData(o);r!==void 0&&this.be.set(r,o)}this.Ft("nodeDataArray",2,"nodeDataArray",this,e,t);for(let o=0;o<i;o++){const r=t[o];this.Tg(r),this.Dg(r)}}}Ok(t){return t===void 0?!1:this.be.has(t)}makeNodeDataKeyUnique(t){if(t===null)return;const e=this.za;if(e==="")return;let i=this.getKeyForNodeData(t);if(i!==void 0&&!this.Ok(i))return;const s=this.Wf;if(s!==null&&(i=s(this,t),i!=null&&!this.Ok(i))){this.et(t,e,i);return}if(typeof i=="string"){let n=2;for(;this.Ok(i+n);)n++;this.et(t,e,i+n)}else if(i===void 0||typeof i=="number"){let n=-this.be.count-1;for(;this.Ok(n);)n--;this.et(t,e,n)}}addNodeData(t){t!==null&&(t===this.modelData&&U.o("Model.addNodeData cannot add the shared Model.modelData Object"),this.containsNodeData(t)||this.Fv(t,!0))}Fv(t,e){let i=this.getKeyForNodeData(t);if(i===void 0)this.makeNodeDataKeyUnique(t),i=this.getKeyForNodeData(t);else{if(this.be.get(i)===t)return;this.makeNodeDataKeyUnique(t),i=this.getKeyForNodeData(t)}i===void 0&&U.o("Model.makeNodeDataKeyUnique failed on "+t+".  Data not added to Model."),this.be.set(i,t);let s=null;e&&(s=this.Bi.length,this.lr(this.Bi,s,t)),this.Ft("nodeDataArray",3,"nodeDataArray",this,null,t,null,s),this.Tg(t),this.Dg(t)}addNodeDataCollection(t){if(Array.isArray(t)){const e=t.length;for(let i=0;i<e;i++)this.addNodeData(t[i])}else{const e=t.iterator;for(;e.next();){const i=e.value;this.addNodeData(i)}}}removeNodeData(t){t!==null&&this.vv(t,!0)}vv(t,e){const i=this.getKeyForNodeData(t);i!==void 0&&this.be.delete(i);let s=null;if(e){if(s=this.Bi.indexOf(t),s<0)return;this.No(this.Bi,s)}this.Ft("nodeDataArray",4,"nodeDataArray",this,t,null,s,null),this.gw(t)}removeNodeDataCollection(t){if(Array.isArray(t)){const e=t.length;for(let i=0;i<e;i++)this.removeNodeData(t[i])}else{const e=t.iterator;for(;e.next();){const i=e.value;this.removeNodeData(i)}}}mergeNodeDataArray(t){if(t===this.nodeDataArray||!Array.isArray(t))return;const e=new GSet;e.addAll(this.be.iteratorKeys);const i=new GSet,s=t.length;for(let o=0;o<s;o++){const r=t[o],l=this.getKeyForNodeData(r);if(l!==void 0){i.add(l);const a=this.findNodeDataForKey(l);if(a===r)continue;if(a!==null)this.assignAllDataProperties(a,r),this.Ag(r,a);else{const h=this.cloneDeep(r);this.setKeyForNodeData(h,l),this.addNodeData(h)}}else{const a=this.cloneDeep(r);this.addNodeData(a);const h=this.getKeyForNodeData(a);h!==void 0&&i.add(h)}}const n=e.iterator;for(;n.next();){const o=n.value;if(!i.has(o)){const r=this.findNodeDataForKey(o);r&&this.removeNodeData(r)}}}dw(t,e){if(e===void 0)return;const i=this.lw(t);i instanceof GSet&&this.rr.set(e,i)}nL(){}Tg(t){}Dg(t){}gw(t){}an(t,e){if(t===void 0)return;let i=this.rr.get(t);i===null&&(i=new GSet,this.rr.set(t,i)),i.add(e)}ln(t,e){if(t===void 0)return;const i=this.rr.get(t);i instanceof GSet&&(e==null?this.rr.delete(t):(i.delete(e),i.count===0&&this.rr.delete(t)))}lw(t){if(t===void 0)return null;const e=this.rr.get(t);return e instanceof GSet?e:null}GU(t){t===void 0?this.rr.clear():this.rr.delete(t)}get copyNodeDataFunction(){return this.Jf}set copyNodeDataFunction(t){const e=this.Jf;e!==t&&(t!==null&&U.S(t,Model,"copyNodeDataFunction"),this.Jf=t,this.t("copyNodeDataFunction",e,t))}get copiesArrays(){return this.Pg}set copiesArrays(t){const e=this.Pg;e!==t&&(t!==null&&U.s(t,"boolean",Model,"copiesArrays"),this.Pg=t,this.t("copiesArrays",e,t))}get copiesArrayObjects(){return this.Sg}set copiesArrayObjects(t){const e=this.Sg;e!==t&&(t!==null&&U.s(t,"boolean",Model,"copiesArrayObjects"),this.Sg=t,this.t("copiesArrayObjects",e,t))}get copiesKey(){return this.Mg}set copiesKey(t){const e=this.Mg;e!==t&&(t!==null&&U.s(t,"boolean",Model,"copiesKey"),this.Mg=t,this.t("copiesKey",e,t))}copyNodeData(t){let e=null;const i=this.Jf;return i!==null?e=i(t,this):e=this.Ik(t,!0),e}Ik(t,e){if(U.$(t))if(Array.isArray(t))if(this.copiesArrays){const i=t,s=[];for(let n=0;n<i.length;n++){const o=i[n],r=this.Ik(o,this.copiesArrayObjects);s.push(r)}return s}else return t;else{if(t instanceof Point||t instanceof Size||t instanceof Rect||t instanceof Margin||t instanceof Spot)return t.copy();if(e){const i=t,s=i.constructor,n=s?new s:{},o=!this.copiesKey&&typeof this.nodeKeyProperty=="string"?this.nodeKeyProperty:null;for(const r in i){if(r==="__gohashid"){n.__gohashid=void 0;continue}if(r===o){n[o]=void 0;continue}const l=this.St(i,r);if(!U.$(l))n[r]=l;else if(Model.ZC(i,r,l))this.et(n,r,l);else{const a=this.Ik(l,!1);this.et(n,r,a)}}return n}else return t}else return t}get afterCopyFunction(){return this.Ng}set afterCopyFunction(t){const e=this.Ng;e!==t&&(t!==null&&U.S(t,Model,"afterCopyFunction"),this.Ng=t,this.t("afterCopyFunction",e,t))}static ZC(t,e,i){const s=U.Kn(i);return i instanceof Model||i instanceof UndoManager||i instanceof Transaction||i instanceof ChangedEvent||i instanceof GraphObject||i instanceof RowColumnDefinition||i instanceof Diagram||i instanceof EventTarget||s==="Layer"||s==="RowColumnDefinition"||s.indexOf("Animation")>=0||s.indexOf("Tool")>=0||s.indexOf("CommandHandler")>=0||s.indexOf("Layout")>=0}static Zv=!1;setDataProperty(t,e,i){if(this.containsNodeData(t)){if(e===this.nodeKeyProperty){this.setKeyForNodeData(t,i);return}else if(e===this.nodeCategoryProperty){this.setCategoryForNodeData(t,i);return}}else!Model.Zv&&t instanceof GraphObject&&(Model.Zv=!0,U.ne('Model.setDataProperty is modifying a GraphObject, "'+t.toString()+'"'),U.ne("  Is that really your intent?"));const s=this.St(t,e);s!==i&&(this.et(t,e,i),this.raiseDataChanged(t,e,s,i))}set(t,e,i){this.setDataProperty(t,e,i)}assignAllDataProperties(t,e){if(!e)return;const i=this.containsNodeData(t);for(const s in e)s!=="__gohashid"&&(i&&s===this.nodeKeyProperty||this.setDataProperty(t,s,e[s]))}addArrayItem(t,e){this.insertArrayItem(t,-1,e)}insertArrayItem(t,e,i){e<0&&(e=t.length),t=this.lr(t,e,i),this.Ft("",3,"",t,null,i,null,e)}removeArrayItem(t,e){e===void 0&&(e=-1),t===this.Bi&&U.o("Model.removeArrayItem should not be called on the Model.nodeDataArray"),e===-1&&(e=t.length-1);const i=t[e];t=this.No(t,e),this.Ft("",4,"",t,i,null,e,null)}get nodeCategoryProperty(){return this.rc}set nodeCategoryProperty(t){const e=this.rc;e!==t&&(this.En(t,Model,"nodeCategoryProperty"),this.rc=t,this.t("nodeCategoryProperty",e,t))}getCategoryForNodeData(t){if(t===null)return"";const e=this.rc;if(e==="")return"";const i=this.St(t,e);if(i===void 0)return"";if(typeof i=="string")return i;U.o("getCategoryForNodeData found a non-string category for "+t+": "+i)}setCategoryForNodeData(t,e){if(U.s(e,"string",Model,"setCategoryForNodeData:cat"),t===null)return;const i=this.rc;if(i==="")return;if(!this.containsNodeData(t)){this.et(t,i,e);return}let s=this.St(t,i);s===void 0&&(s=""),s!==e&&(this.et(t,i,e),this.Ft("nodeCategory",2,i,t,s,e))}Ag(t,e){this.setCategoryForNodeData(e,this.getCategoryForNodeData(t))}get type(){return"Model"}Vm(){return!1}Um(){return!1}a1(){return!1}jh(){return!1}Ax(){return!1}ff(){return!1}static p2(){return new Model}St(t,e){return Model.St(t,e)}static St(t,e){if(!t||!e)return null;let i;try{U.st(e)?i=e(t):U.st(t.getAttribute)?(i=t.getAttribute(e),i===null&&(i=void 0)):i=t[e]}catch{}return i}et(t,e,i){Model.et(t,e,i)}static et(t,e,i){if(!(!t||!e)){try{U.st(e)?e(t,i):U.st(t.setAttribute)?t.setAttribute(e,i):t[e]=i}catch{}return t}}sL(t,e,i){Array.isArray(t)||U.si(t,"Array",e,i)}Wv(t,e,i){return t[e]=i,t}lr(t,e,i){return e>=t.length?t.push(i):t.splice(e,0,i),t}No(t,e){return e>=t.length?t.pop():t.splice(e,1),t}static iL(t){return Model.oL[t]?Model.oL[t]:root.go!==void 0&&root.go[t]?root.go[t]:null}static Sl(t,e){Model.oL[e]=t}static oL={}}Model.fromJSON=Model.fromJson=Model.fromJson;Model.Sl(Brush,"Brush"),Model.Sl(Geometry,"Geometry"),Model.Sl(Margin,"Margin"),Model.Sl(Point,"Point"),Model.Sl(Rect,"Rect"),Model.Sl(Size,"Size"),Model.Sl(Spot,"Spot"),Model.Sl(Model,"Model");class GraphLinksModel extends Model{Os;ar;Oe;Ga;$f;Zf;Vl;Co;Lo;lc;ac;hc;hn;Qf;Un;vg;constructor(t,e,i){if(super(),this.Os=[],this.ar=new GSet,this.Oe=new GMap,this.Ga="",this.$f=null,this.Zf=null,this.Vl=null,this.Co="from",this.Lo="to",this.lc="",this.ac="",this.hc="category",this.hn="",this.Qf="isGroup",this.Un="group",this.vg=!1,e!==void 0&&(this.linkDataArray=e),t!==void 0&&(Array.isArray(t)?this.nodeDataArray=t:i=t),i){Object.assign(this,i);const s=i.Changed;s&&(delete this.Changed,this.addChangedListener(s))}}cloneProtected(t){super.cloneProtected(t),t.Ga=this.Ga,t.$f=this.$f,t.Zf=this.Zf,t.Co=this.Co,t.Lo=this.Lo,t.lc=this.lc,t.ac=this.ac,t.hc=this.hc,t.hn=this.hn,t.Qf=this.Qf,t.Un=this.Un,t.vg=this.vg}clear(){this.Os=[],this.Oe.clear(),this.ar.clear(),super.clear()}toString(t){if(t===void 0&&(t=0),t>=2)return this.toJson();{let e=(this.name!==""?this.name:"")+" GraphLinksModel";if(t>0){e+=`
 node data:`;let i=this.nodeDataArray,s=i.length,n=0;for(n=0;n<s;n++){const o=i[n];e+=" "+this.getKeyForNodeData(o)+":"+Binding.toString(o)}for(e+=`
 link data:`,i=this.linkDataArray,s=i.length,n=0;n<s;n++){const o=i[n];e+=" "+this.Vi(o,!0)+"-->"+this.Vi(o,!1)}}return e}}$C(t,e,i){if(this.linkKeyProperty===""){const f=this.skipsUndoManager;this.skipsUndoManager=!0,this.linkKeyProperty="key",this.skipsUndoManager=f}let s=super.$C(t,e,i);const n=this,o=new GSet,r=new GSet,l=new GSet;t.changes.each(f=>{if(f.model===n){if(f.modelChange==="linkDataArray")f.change===3?o.add(f.newValue):f.change===4&&l.add(f.oldValue);else if(n.containsLinkData(f.object))f.object!==null&&r.add(f.object);else if(f.object!==null)if(f.object!==null&&i.has(f.object)){const u=i.get(f.object);u&&u.each(d=>{n.containsLinkData(d)&&r.add(d)})}else{if(f.object instanceof Model||n.containsNodeData(f.object))return;n.Qv(f.object).each(d=>r.add(d))}}});const a=new GSet;o.each(f=>{const u=n.getKeyForLinkData(f);u!==void 0&&a.add(u),e||r.add(f)});const h=new GSet;l.each(f=>{const u=n.getKeyForLinkData(f);u!==void 0&&h.add(u),e&&r.add(f)});const c=n.cloneDeep(r.toArray());return a.count>0&&(s===null&&(s={}),e?s.removedLinkKeys=a.toArray():s.insertedLinkKeys=a.toArray()),c.length>0&&(s===null&&(s={}),s.modifiedLinkData=c),h.count>0&&(s===null&&(s={}),e?s.insertedLinkKeys=h.toArray():s.removedLinkKeys=h.toArray()),s}Lg(){const t=super.Lg();let e="";return this.linkCategoryProperty!=="category"&&typeof this.linkCategoryProperty=="string"&&(e+=`,
  "linkCategoryProperty": `+this.quote(this.linkCategoryProperty)),this.linkKeyProperty!==""&&typeof this.linkKeyProperty=="string"&&(e+=`,
  "linkKeyProperty": `+this.quote(this.linkKeyProperty)),this.linkFromKeyProperty!=="from"&&typeof this.linkFromKeyProperty=="string"&&(e+=`,
  "linkFromKeyProperty": `+this.quote(this.linkFromKeyProperty)),this.linkToKeyProperty!=="to"&&typeof this.linkToKeyProperty=="string"&&(e+=`,
  "linkToKeyProperty": `+this.quote(this.linkToKeyProperty)),this.linkFromPortIdProperty!==""&&typeof this.linkFromPortIdProperty=="string"&&(e+=`,
  "linkFromPortIdProperty": `+this.quote(this.linkFromPortIdProperty)),this.linkToPortIdProperty!==""&&typeof this.linkToPortIdProperty=="string"&&(e+=`,
  "linkToPortIdProperty": `+this.quote(this.linkToPortIdProperty)),this.linkLabelKeysProperty!==""&&typeof this.linkLabelKeysProperty=="string"&&(e+=`,
  "linkLabelKeysProperty": `+this.quote(this.linkLabelKeysProperty)),this.nodeIsGroupProperty!=="isGroup"&&typeof this.nodeIsGroupProperty=="string"&&(e+=`,
  "nodeIsGroupProperty": `+this.quote(this.nodeIsGroupProperty)),this.nodeGroupKeyProperty!=="group"&&typeof this.nodeGroupKeyProperty=="string"&&(e+=`,
  "nodeGroupKeyProperty": `+this.quote(this.nodeGroupKeyProperty)),t+e}fw(t){super.fw(t),t.linkKeyProperty&&(this.linkKeyProperty=t.linkKeyProperty),t.linkFromKeyProperty&&(this.linkFromKeyProperty=t.linkFromKeyProperty),t.linkToKeyProperty&&(this.linkToKeyProperty=t.linkToKeyProperty),t.linkFromPortIdProperty&&(this.linkFromPortIdProperty=t.linkFromPortIdProperty),t.linkToPortIdProperty&&(this.linkToPortIdProperty=t.linkToPortIdProperty),t.linkCategoryProperty&&(this.linkCategoryProperty=t.linkCategoryProperty),t.linkLabelKeysProperty&&(this.linkLabelKeysProperty=t.linkLabelKeysProperty),t.nodeIsGroupProperty&&(this.nodeIsGroupProperty=t.nodeIsGroupProperty),t.nodeGroupKeyProperty&&(this.nodeGroupKeyProperty=t.nodeGroupKeyProperty)}QC(){const t=super.QC(),e=`,
  "linkDataArray": `+this.Xa(this.linkDataArray,!0);return t+e}_C(t){super._C(t);const e=t.linkDataArray;Array.isArray(e)&&(this.replaceJsonObjects(e),this.linkDataArray=e)}_v=`,
  "insertedLinkKeys": `;c3=`,
  "modifiedLinkData": `;tF=`,
  "removedLinkKeys": `;Qv(t){const e=new GSet;for(let i=0;i<this.linkDataArray.length;i++){const s=this.linkDataArray[i];this.Rk(t,s,s,e)}return e}eL(t,e,i){if(this.linkKeyProperty===""){const f=this.skipsUndoManager;this.skipsUndoManager=!0,this.linkKeyProperty="key",this.skipsUndoManager=f}const s=super.eL(t,e,i),n=this,o=new GSet,r=new GSet,l=new GSet;t.changes.each(f=>{if(f.model===n){if(f.modelChange==="linkDataArray")f.change===3?o.add(f.newValue):f.change===4&&l.add(f.oldValue);else if(n.containsLinkData(f.object))f.object!==null&&r.add(f.object);else if(f.object!==null)if(f.object!==null&&i.has(f.object)){const u=i.get(f.object);u&&u.each(d=>{n.containsLinkData(d)&&r.add(d)})}else{if(f.object instanceof Model||n.containsNodeData(f.object))return;n.Qv(f.object).each(d=>r.add(d))}}});const a=new GSet;o.each(f=>{const u=n.getKeyForLinkData(f);u!==void 0&&a.add(u),e||r.add(f)});const h=new GSet;l.each(f=>{const u=n.getKeyForLinkData(f);u!==void 0&&h.add(u),e&&r.add(f)});let c=s;return a.count>0&&(c+=(e?this.tF:this._v)+this.Xa(a.toArray(),!0)),r.count>0&&(c+=this.c3+this.Xa(r.toArray(),!0)),h.count>0&&(c+=(e?this._v:this.tF)+this.Xa(h.toArray(),!0)),c}uw(t){(t.linkCategoryProperty!==void 0&&t.linkCategoryProperty!==this.linkCategoryProperty||t.linkKeyProperty!==void 0&&t.linkKeyProperty!==this.linkKeyProperty||t.linkFromKeyProperty!==void 0&&t.linkFromKeyProperty!==this.linkFromKeyProperty||t.linkToKeyProperty!==void 0&&t.linkToKeyProperty!==this.linkToKeyProperty||t.linkFromPortIdProperty!==void 0&&t.linkFromPortIdProperty!==this.linkFromPortIdProperty||t.linkToPortIdProperty!==void 0&&t.linkToPortIdProperty!==this.linkToPortIdProperty||t.linkLabelKeysProperty!==void 0&&t.linkLabelKeysProperty!==this.linkLabelKeysProperty||t.nodeIsGroupProperty!==void 0&&t.nodeIsGroupProperty!==this.nodeIsGroupProperty||t.nodeGroupKeyProperty!==void 0&&t.nodeGroupKeyProperty!==this.nodeGroupKeyProperty)&&U.o("applyIncrementalJson cannot change Model properties"),super.uw(t);const e=t.insertedLinkKeys;if(Array.isArray(e)){const n=e.length;for(let o=0;o<n;o++){const r=e[o];let l=this.findLinkDataForKey(r);l===null&&(l=this.copyLinkData({}),this.setKeyForLinkData(l,r),this.addLinkData(l))}}const i=t.modifiedLinkData;if(Array.isArray(i)){const n=i.length;for(let o=0;o<n;o++){const r=i[o],l=this.getKeyForLinkData(r),a=this.findLinkDataForKey(l);if(a!==null){for(const h in r)h==="__gohashid"||h===this.linkKeyProperty||this.setDataProperty(a,h,r[h]);this.eF(r,a)}}}const s=t.removedLinkKeys;if(Array.isArray(s)){const n=s.length;for(let o=0;o<n;o++){const r=s[o],l=this.findLinkDataForKey(r);l!==null&&this.removeLinkData(l)}}}changeState(t,e){if(!(t===null||t.model!==this)){if(t.change===2){const i=t.object,s=t.propertyName;if(i!==null&&s===this.linkKeyProperty&&this.containsLinkData(i)){const n=t.getValue(e),o=t.getValue(!e);o!==void 0&&this.Oe.delete(o),n!==void 0&&this.Oe.set(n,i),this.et(i,s,n);return}}else if(t.change===3){let i=t.newParam;if(t.modelChange==="linkDataArray"){const s=t.newValue;if(U.$(s)&&typeof i=="number"){const n=this.getKeyForLinkData(s);e?(this.ar.delete(s),this.Os[i]===s&&this.No(this.linkDataArray,i),n!==void 0&&this.Oe.delete(n)):(this.ar.add(s),this.Os[i]!==s&&this.lr(this.Os,i,s),n!==void 0&&this.Oe.set(n,s))}return}else if(t.modelChange==="linkLabelKeys"){const s=t.object,n=s!==null?this.getLabelKeysForLinkData(s):null;Array.isArray(n)&&typeof i=="number"&&(e?(i=n.indexOf(t.newValue),i>=0&&this.No(n,i)):n.indexOf(t.newValue)<0&&this.lr(n,i,t.newValue));return}}else if(t.change===4){let i=t.oldParam;if(t.modelChange==="linkDataArray"){const s=t.oldValue;if(U.$(s)&&typeof i=="number"){const n=this.getKeyForLinkData(s);e?(this.ar.add(s),this.Os[i]!==s&&this.lr(this.Os,i,s),n!==void 0&&this.Oe.set(n,s)):(this.ar.delete(s),this.Os[i]===s&&this.No(this.linkDataArray,i),n!==void 0&&this.Oe.delete(n))}return}else if(t.modelChange==="linkLabelKeys"){const s=t.object,n=s!==null?this.getLabelKeysForLinkData(s):null;Array.isArray(n)&&typeof i=="number"&&(e?n.indexOf(t.oldValue)<0&&this.lr(n,i,t.oldValue):(i=n.indexOf(t.oldValue),i>=0&&this.No(n,i)));return}}super.changeState(t,e)}}get archetypeNodeData(){return this.Vl}set archetypeNodeData(t){const e=this.Vl;e!==t&&(t!==null&&U.wc(t,GraphLinksModel,"archetypeNodeData"),this.Vl=t,this.t("archetypeNodeData",e,t))}rL(t){if(t===void 0)return;const e=this.Vl;if(e!==null){let i=this.findNodeDataForKey(t);i===null&&(i=this.copyNodeData(e),this.et(i,this.nodeKeyProperty,t),this.addNodeData(i))}return t}get linkFromKeyProperty(){return this.Co}set linkFromKeyProperty(t){const e=this.Co;e!==t&&(this.En(t,GraphLinksModel,"linkFromKeyProperty"),this.Co=t,this.t("linkFromKeyProperty",e,t))}getFromKeyForLinkData(t){return this.Vi(t,!0)}setFromKeyForLinkData(t,e){this.xg(t,e,!0)}get linkToKeyProperty(){return this.Lo}set linkToKeyProperty(t){const e=this.Lo;e!==t&&(this.En(t,GraphLinksModel,"linkToKeyProperty"),this.Lo=t,this.t("linkToKeyProperty",e,t))}getToKeyForLinkData(t){return this.Vi(t,!1)}setToKeyForLinkData(t,e){this.xg(t,e,!1)}Vi(t,e){if(t===null)return;const i=e?this.Co:this.Lo;if(i==="")return;const s=this.St(t,i);if(s!==void 0){if(this.isKeyType(s))return s;U.o((e?"FromKey":"ToKey")+" value for link data "+t+" is not a number or a string: "+s)}}xg(t,e,i){if(e===null&&(e=void 0),e!==void 0&&!this.isKeyType(e)&&U.si(e,"number or string",GraphLinksModel,i?"setFromKeyForLinkData:key":"setToKeyForLinkData:key"),t===null)return;const s=i?this.Co:this.Lo;if(s==="")return;if(e=this.rL(e),!this.containsLinkData(t)){this.et(t,s,e);return}const n=this.St(t,s);n!==e&&(this.ln(n,t),this.et(t,s,e),this.findNodeDataForKey(e)===null&&this.an(e,t),this.Ft(i?"linkFromKey":"linkToKey",2,s,t,n,e),typeof s=="string"&&this.updateTargetBindings(t,s))}get linkFromPortIdProperty(){return this.lc}set linkFromPortIdProperty(t){const e=this.lc;e!==t&&(this.En(t,GraphLinksModel,"linkFromPortIdProperty"),this.lc=t,this.t("linkFromPortIdProperty",e,t))}getFromPortIdForLinkData(t){return this.Ak(t,!0)}setFromPortIdForLinkData(t,e){this.bg(t,e,!0)}get linkToPortIdProperty(){return this.ac}set linkToPortIdProperty(t){const e=this.ac;e!==t&&(this.En(t,GraphLinksModel,"linkToPortIdProperty"),this.ac=t,this.t("linkToPortIdProperty",e,t))}getToPortIdForLinkData(t){return this.Ak(t,!1)}setToPortIdForLinkData(t,e){this.bg(t,e,!1)}Ak(t,e){if(t===null)return"";const i=e?this.lc:this.ac;if(i==="")return"";const s=this.St(t,i);return s===void 0?"":s}bg(t,e,i){if(U.s(e,"string",GraphLinksModel,i?"setFromPortIdForLinkData:portname":"setToPortIdForLinkData:portname"),t===null)return;const s=i?this.lc:this.ac;if(s==="")return;if(!this.containsLinkData(t)){this.et(t,s,e);return}let n=this.St(t,s);n===void 0&&(n=""),n!==e&&(this.et(t,s,e),this.Ft(i?"linkFromPortId":"linkToPortId",2,s,t,n,e),typeof s=="string"&&this.updateTargetBindings(t,s))}get linkLabelKeysProperty(){return this.hn}set linkLabelKeysProperty(t){const e=this.hn;e!==t&&(this.En(t,GraphLinksModel,"linkLabelKeysProperty"),this.hn=t,this.t("linkLabelKeysProperty",e,t))}getLabelKeysForLinkData(t){if(t===null)return GraphLinksModel.EmptyArray;const e=this.hn;if(e==="")return GraphLinksModel.EmptyArray;const i=this.St(t,e);return i===void 0?GraphLinksModel.EmptyArray:i}setLabelKeysForLinkData(t,e){if(this.sL(e,GraphLinksModel,"setLabelKeysForLinkData:arr"),t===null)return;const i=this.hn;if(i==="")return;if(!this.containsLinkData(t)){this.et(t,i,e);return}let s=this.St(t,i);if(s===void 0&&(s=GraphLinksModel.EmptyArray),s!==e){if(Array.isArray(s)){const o=s.length;for(let r=0;r<o;r++){const l=s[r];this.ln(l,t)}}this.et(t,i,e);const n=e.length;for(let o=0;o<n;o++){const r=e[o];this.findNodeDataForKey(r)===null&&this.an(r,t)}this.Ft("linkLabelKeys",2,i,t,s,e),typeof i=="string"&&this.updateTargetBindings(t,i)}}addLabelKeyForLinkData(t,e){if(e==null||(this.isKeyType(e)||U.si(e,"number or string",GraphLinksModel,"addLabelKeyForLinkData:key"),t===null))return;const i=this.hn;if(i==="")return;const s=this.St(t,i);if(s===void 0){const n=[];n.push(e),this.setLabelKeysForLinkData(t,n)}else if(Array.isArray(s)){let n=s.indexOf(e);if(n>=0)return;n=s.length,s.push(e),this.containsLinkData(t)&&(this.findNodeDataForKey(e)===null&&this.an(e,t),this.Ft("linkLabelKeys",3,i,t,null,e,null,n))}else U.o(i+" property is not an Array; cannot addLabelKeyForLinkData: "+t)}removeLabelKeyForLinkData(t,e){if(e==null||(this.isKeyType(e)||U.si(e,"number or string",GraphLinksModel,"removeLabelKeyForLinkData:key"),t===null))return;const i=this.hn;if(i==="")return;const s=this.St(t,i);if(Array.isArray(s)){const n=s.indexOf(e);if(n<0)return;this.No(s,n),this.containsLinkData(t)&&(this.ln(e,t),this.Ft("linkLabelKeys",4,i,t,e,null,n,null))}else s!==void 0&&U.o(i+" property is not an Array; cannot removeLabelKeyforLinkData: "+t)}get linkDataArray(){return this.Os}set linkDataArray(t){const e=this.Os;if(e!==t){this.sL(t,GraphLinksModel,"linkDataArray"),this.Oe.clear();const i=t.length;for(let n=0;n<i;n++){const o=t[n];U.$(o)||U.o("GraphLinksModel.linkDataArray must only contain Objects, not: "+o)}if(this.Os=t,this.linkKeyProperty!==""){const n=new List;for(let r=0;r<i;r++){const l=t[r],a=this.getKeyForLinkData(l);a===void 0||this.Oe.get(a)!==null?n.add(l):this.Oe.set(a,l)}const o=n.iterator;for(;o.next();){const r=o.value;this.makeLinkDataKeyUnique(r);const l=this.getKeyForLinkData(r);l!==void 0&&this.Oe.set(l,r)}}const s=new GSet;for(let n=0;n<i;n++){const o=t[n];s.add(o)}this.ar=s,this.Ft("linkDataArray",2,"linkDataArray",this,e,t);for(let n=0;n<i;n++){const o=t[n];this.lL(o)}}}get linkKeyProperty(){return this.Ga}set linkKeyProperty(t){const e=this.Ga;if(e!==t){this.En(t,GraphLinksModel,"linkKeyProperty"),this.Ga=t,this.Oe.clear();const i=this.linkDataArray.length;for(let s=0;s<i;s++){const n=this.linkDataArray[s];let o=this.getKeyForLinkData(n);o===void 0&&(this.makeLinkDataKeyUnique(n),o=this.getKeyForLinkData(n)),o!==void 0&&this.Oe.set(o,n)}this.t("linkKeyProperty",e,t)}}getKeyForLinkData(t){if(t===null)return;const e=this.Ga;if(e==="")return;const i=this.St(t,e);if(i!==void 0){if(this.isKeyType(i))return i;U.o("Key value for link data "+t+" is not a number or a string: "+i)}}setKeyForLinkData(t,e){if((e==null||!this.isKeyType(e))&&U.si(e,"number or string",GraphLinksModel,"setKeyForLinkData:key"),t===null)return;const i=this.Ga;if(i==="")return;if(!this.containsLinkData(t)){this.et(t,i,e);return}const s=this.St(t,i);if(s!==e){if(this.findLinkDataForKey(e)!==null)return;this.et(t,i,e),s!==void 0&&this.Oe.delete(s),this.Oe.set(e,t),this.Ft("linkKey",2,i,t,s,e),typeof i=="string"&&this.updateTargetBindings(t,i)}}get makeUniqueLinkKeyFunction(){return this.$f}set makeUniqueLinkKeyFunction(t){const e=this.$f;e!==t&&(t!==null&&U.S(t,GraphLinksModel,"makeUniqueLinkKeyFunction"),this.$f=t,this.t("makeUniqueLinkKeyFunction",e,t))}findLinkDataForKey(t){return t===null&&U.o("GraphLinksModel.findLinkDataForKey:key must not be null"),t===void 0||!this.isKeyType(t)?null:this.Oe.get(t)}Ek(t){return t===void 0?!1:this.Oe.has(t)}makeLinkDataKeyUnique(t){if(t===null)return;const e=this.Ga;if(e==="")return;let i=this.getKeyForLinkData(t);if(i!==void 0&&!this.Ek(i))return;const s=this.$f;if(s!==null&&(i=s(this,t),i!=null&&!this.Ek(i))){this.et(t,e,i);return}if(typeof i=="string"){let n=2;for(;this.Ek(i+n);)n++;this.et(t,e,i+n)}else if(i===void 0||typeof i=="number"){let n=-this.Oe.count-1;for(;this.Ek(n);)n--;this.et(t,e,n)}}containsLinkData(t){return t===null?!1:this.ar.has(t)}addLinkData(t){t!==null&&(this.containsLinkData(t)||this.Vv(t,!0))}Vv(t,e){if(this.linkKeyProperty!==""){let s=this.getKeyForLinkData(t);if(s===void 0)this.makeLinkDataKeyUnique(t),s=this.getKeyForLinkData(t);else{if(this.Oe.get(s)===t)return;this.makeLinkDataKeyUnique(t),s=this.getKeyForLinkData(t)}s===void 0&&U.o("GraphLinksModel.makeLinkDataKeyUnique failed on "+t+". Data not added to model."),this.Oe.set(s,t)}this.ar.add(t);let i=null;e&&(i=this.Os.length,this.lr(this.Os,i,t)),this.Ft("linkDataArray",3,"linkDataArray",this,null,t,null,i),this.lL(t)}addLinkDataCollection(t){if(Array.isArray(t)){const e=t.length;for(let i=0;i<e;i++)this.addLinkData(t[i])}else{const e=t.iterator;for(;e.next();){const i=e.value;this.addLinkData(i)}}}removeLinkData(t){t!==null&&this.Uv(t,!0)}Uv(t,e){this.ar.delete(t);const i=this.getKeyForLinkData(t);i!==void 0&&this.Oe.delete(i);let s=null;if(e){if(s=this.Os.indexOf(t),s<0)return;this.No(this.Os,s)}this.Ft("linkDataArray",4,"linkDataArray",this,t,null,s,null),this.f3(t)}removeLinkDataCollection(t){if(Array.isArray(t)){const e=t.length;for(let i=0;i<e;i++)this.removeLinkData(t[i])}else{const e=t.iterator;for(;e.next();){const i=e.value;this.removeLinkData(i)}}}mergeLinkDataArray(t){if(this.linkKeyProperty===""&&U.o("GraphLinksModel.linkKeyProperty must not be an empty string for .mergeLinkDataArray() to succeed."),t===this.linkDataArray||!Array.isArray(t))return;const e=new GSet;e.addAll(this.Oe.iteratorKeys);const i=new GSet,s=t.length;for(let o=0;o<s;o++){const r=t[o],l=this.getKeyForLinkData(r);if(l!==void 0){i.add(l);const a=this.findLinkDataForKey(l);if(a===r)continue;if(a!==null)this.assignAllDataProperties(a,r),this.eF(r,a);else{const h=this.cloneDeep(r);this.setKeyForLinkData(h,l),this.addLinkData(h)}}else{const a=this.cloneDeep(r);this.addLinkData(a);const h=this.getKeyForLinkData(a);h!==void 0&&i.add(h)}}const n=e.iterator;for(;n.next();){const o=n.value;if(!i.has(o)){const r=this.findLinkDataForKey(o);r&&this.removeLinkData(r)}}}lL(t){let e=this.Vi(t,!0);e=this.rL(e),this.findNodeDataForKey(e)===null&&this.an(e,t),e=this.Vi(t,!1),e=this.rL(e),this.findNodeDataForKey(e)===null&&this.an(e,t);const i=this.getLabelKeysForLinkData(t);if(Array.isArray(i)){const s=i.length;for(let n=0;n<s;n++)e=i[n],this.findNodeDataForKey(e)===null&&this.an(e,t)}}f3(t){let e=this.Vi(t,!0);this.ln(e,t),e=this.Vi(t,!1),this.ln(e,t);const i=this.getLabelKeysForLinkData(t);if(Array.isArray(i)){const s=i.length;for(let n=0;n<s;n++)e=i[n],this.ln(e,t)}}get copyLinkDataFunction(){return this.Zf}set copyLinkDataFunction(t){const e=this.Zf;e!==t&&(t!==null&&U.S(t,GraphLinksModel,"copyLinkDataFunction"),this.Zf=t,this.t("copyLinkDataFunction",e,t))}copyLinkData(t){let e=null;const i=this.Zf;return i!==null?e=i(t,this):e=this.Ik(t,!0),U.$(e)&&(this.Co!==""&&this.et(e,this.Co,void 0),this.Lo!==""&&this.et(e,this.Lo,void 0),this.hn!==""&&this.et(e,this.hn,[])),e}get nodeIsGroupProperty(){return this.Qf}set nodeIsGroupProperty(t){const e=this.Qf;e!==t&&(this.En(t,GraphLinksModel,"nodeIsGroupProperty"),this.Qf=t,this.t("nodeIsGroupProperty",e,t))}isGroupForNodeData(t){if(t===null)return!1;const e=this.Qf;return e===""?!1:!!this.St(t,e)}isGroupForData(t){return this.isGroupForNodeData(t)}get nodeGroupKeyProperty(){return this.Un}set nodeGroupKeyProperty(t){const e=this.Un;e!==t&&(this.En(t,GraphLinksModel,"nodeGroupKeyProperty"),this.Un=t,this.t("nodeGroupKeyProperty",e,t))}get copiesGroupKeyOfNodeData(){return this.vg}set copiesGroupKeyOfNodeData(t){this.vg!==t&&(U.s(t,"boolean",GraphLinksModel,"copiesGroupKeyOfNodeData"),this.vg=t)}getGroupKeyForNodeData(t){if(t===null)return;const e=this.Un;if(e==="")return;const i=this.St(t,e);if(i!==void 0){if(this.isKeyType(i))return i;U.o("GroupKey value for node data "+t+" is not a number or a string: "+i)}}getGroupForData(t){return this.getGroupKeyForNodeData(t)}setGroupKeyForNodeData(t,e){if(e===null&&(e=void 0),e!==void 0&&!this.isKeyType(e)&&U.si(e,"number or string",GraphLinksModel,"setGroupKeyForNodeData:key"),t===null)return;const i=this.Un;if(i==="")return;if(!this.containsNodeData(t)){this.et(t,i,e);return}const s=this.St(t,i);s!==e&&(this.ln(s,t),this.et(t,i,e),this.findNodeDataForKey(e)===null&&this.an(e,t),this.Ft("nodeGroupKey",2,i,t,s,e),typeof i=="string"&&this.updateTargetBindings(t,i))}setGroupForData(t,e){this.setGroupKeyForNodeData(t,e)}copyNodeData(t){const e=super.copyNodeData(t);return!this.copiesGroupKeyOfNodeData&&this.Un!==""&&this.St(e,this.Un)!==void 0&&this.et(e,this.Un,void 0),e}setDataProperty(t,e,i){if(this.containsNodeData(t)){if(e===this.nodeKeyProperty){this.setKeyForNodeData(t,i);return}else if(e===this.nodeCategoryProperty){this.setCategoryForNodeData(t,i);return}else if(e===this.nodeGroupKeyProperty){this.setGroupKeyForNodeData(t,i);return}}else if(this.containsLinkData(t)){if(e===this.linkFromKeyProperty){this.xg(t,i,!0);return}else if(e===this.linkToKeyProperty){this.xg(t,i,!1);return}else if(e===this.linkFromPortIdProperty){this.bg(t,i,!0);return}else if(e===this.linkToPortIdProperty){this.bg(t,i,!1);return}else if(e===this.linkKeyProperty){this.setKeyForLinkData(t,i);return}else if(e===this.linkCategoryProperty){this.setCategoryForLinkData(t,i);return}else if(e===this.linkLabelKeysProperty){this.setLabelKeysForLinkData(t,i);return}}const s=this.St(t,e);s!==i&&(this.et(t,e,i),this.raiseDataChanged(t,e,s,i))}assignAllDataProperties(t,e){if(!e)return;const i=this.containsNodeData(t),s=this.containsLinkData(t);for(const n in e)if(n!=="__gohashid"&&!(i&&n===this.nodeKeyProperty)){{if(i&&n===this.nodeIsGroupProperty&&this.St(t,n)===e[n])continue;if(s&&n===this.linkKeyProperty)continue}this.setDataProperty(t,n,e[n])}}dw(t,e){super.dw(t,e);const i=this.be.iterator;for(;i.next();){const n=i.value;this.aL(n,t,e)}const s=this.ar.iterator;for(;s.next();){const n=s.value;this.u3(n,t,e)}}aL(t,e,i){if(this.getGroupKeyForNodeData(t)===e){const n=this.Un;this.et(t,n,i),this.Ft("nodeGroupKey",2,n,t,e,i),typeof n=="string"&&this.updateTargetBindings(t,n)}}u3(t,e,i){if(this.Vi(t,!0)===e){const r=this.Co;this.et(t,r,i),this.Ft("linkFromKey",2,r,t,e,i),typeof r=="string"&&this.updateTargetBindings(t,r)}if(this.Vi(t,!1)===e){const r=this.Lo;this.et(t,r,i),this.Ft("linkToKey",2,r,t,e,i),typeof r=="string"&&this.updateTargetBindings(t,r)}const o=this.getLabelKeysForLinkData(t);if(Array.isArray(o)){const r=o.length,l=this.hn;for(let a=0;a<r;a++)o[a]===e&&(this.Wv(o,a,i),this.Ft("linkLabelKeys",3,l,t,e,i,a,a))}}nL(){super.nL();const t=this.linkDataArray,e=t.length;for(let i=0;i<e;i++){const s=t[i];this.lL(s)}}Tg(t){super.Tg(t);const e=this.getKeyForNodeData(t),i=this.lw(e);if(i!==null){const s=U.nt(),n=i.iterator;for(;n.next();){const o=n.value;if(this.containsNodeData(o)){if(this.getGroupKeyForNodeData(o)===e){const l=this.Un;this.Ft("nodeGroupKey",2,l,o,e,e),typeof l=="string"&&this.updateTargetBindings(o,l),s.push(o)}}else{if(this.Vi(o,!0)===e){const h=this.Co;this.Ft("linkFromKey",2,h,o,e,e),typeof h=="string"&&this.updateTargetBindings(o,h),s.push(o)}if(this.Vi(o,!1)===e){const h=this.Lo;this.Ft("linkToKey",2,h,o,e,e),typeof h=="string"&&this.updateTargetBindings(o,h),s.push(o)}const a=this.getLabelKeysForLinkData(o);if(Array.isArray(a)){const h=a.length,c=this.hn;for(let f=0;f<h;f++)a[f]===e&&(this.Ft("linkLabelKeys",3,c,o,e,e,f,f),s.push(o))}}}for(let o=0;o<s.length;o++)this.ln(e,s[o]);U.Z(s)}}Dg(t){super.Dg(t);const e=this.getGroupKeyForNodeData(t);this.findNodeDataForKey(e)===null&&this.an(e,t)}gw(t){super.gw(t);const e=this.getGroupKeyForNodeData(t);this.ln(e,t)}get linkCategoryProperty(){return this.hc}set linkCategoryProperty(t){const e=this.hc;e!==t&&(this.En(t,GraphLinksModel,"linkCategoryProperty"),this.hc=t,this.t("linkCategoryProperty",e,t))}getCategoryForLinkData(t){if(t===null)return"";const e=this.hc;if(e==="")return"";const i=this.St(t,e);if(i===void 0)return"";if(typeof i=="string")return i;U.o("getCategoryForLinkData found a non-string category for "+t+": "+i)}getLinkCategoryForData(t){return this.getCategoryForLinkData(t)}setCategoryForLinkData(t,e){if(U.s(e,"string",GraphLinksModel,"setCategoryForLinkData:cat"),t===null)return;const i=this.hc;if(i==="")return;if(!this.containsLinkData(t)){this.et(t,i,e);return}let s=this.St(t,i);s===void 0&&(s=""),s!==e&&(this.et(t,i,e),this.Ft("linkCategory",2,i,t,s,e),typeof i=="string"&&this.updateTargetBindings(t,i))}setLinkCategoryForData(t,e){this.setCategoryForLinkData(t,e)}Ag(t,e){super.Ag(t,e),this.setGroupKeyForNodeData(e,this.getGroupKeyForNodeData(t))}eF(t,e){this.setCategoryForLinkData(e,this.getCategoryForLinkData(t)),this.setFromKeyForLinkData(e,this.getFromKeyForLinkData(t)),this.setToKeyForLinkData(e,this.getToKeyForLinkData(t)),this.setLabelKeysForLinkData(e,this.getLabelKeysForLinkData(t)),this.setFromPortIdForLinkData(e,this.getFromPortIdForLinkData(t)),this.setToPortIdForLinkData(e,this.getToPortIdForLinkData(t))}get type(){return"GraphLinksModel"}Um(){return!0}jh(){return!0}Ax(){return!0}ff(){return!0}static EmptyArray=Object.freeze([])}Model.Sl(GraphLinksModel,"GraphLinksModel");Model.jv=()=>new GraphLinksModel;Model.p2=()=>new GraphLinksModel;class TreeModel extends Model{Vn;Fg;cc;constructor(t,e){if(super(),this.Vn="parent",this.Fg=!1,this.cc="parentLinkCategory",t!==void 0&&(Array.isArray(t)?this.nodeDataArray=t:e=t),e){Object.assign(this,e);const i=e.Changed;i&&(delete this.Changed,this.addChangedListener(i))}}cloneProtected(t){super.cloneProtected(t),t.Vn=this.Vn,t.Fg=this.Fg,t.cc=this.cc}toString(t){if(t===void 0&&(t=0),t>=2)return this.toJson();{let e=(this.name!==""?this.name:"")+" TreeModel";if(t>0){e+=`
 node data:`;const i=this.nodeDataArray,s=i.length;for(let n=0;n<s;n++){const o=i[n];e+=" "+this.getKeyForNodeData(o)+":"+Binding.toString(o)}}return e}}Lg(){const t=super.Lg();let e="";return this.nodeParentKeyProperty!=="parent"&&typeof this.nodeParentKeyProperty=="string"&&(e+=`,
  "nodeParentKeyProperty": `+this.quote(this.nodeParentKeyProperty)),t+e}fw(t){super.fw(t),t.nodeParentKeyProperty&&(this.nodeParentKeyProperty=t.nodeParentKeyProperty)}uw(t){t.nodeParentKeyProperty!==void 0&&t.nodeParentKeyProperty!==this.nodeParentKeyProperty&&U.o("applyIncrementalJson cannot change Model properties"),super.uw(t)}maybeEnsureLinkReference(t){return t}get nodeParentKeyProperty(){return this.Vn}set nodeParentKeyProperty(t){const e=this.Vn;e!==t&&(this.En(t,TreeModel,"nodeParentKeyProperty"),this.Vn=t,this.t("nodeParentKeyProperty",e,t))}get copiesParentKeyOfNodeData(){return this.Fg}set copiesParentKeyOfNodeData(t){this.Fg!==t&&(U.s(t,"boolean",TreeModel,"copiesParentKeyOfNodeData"),this.Fg=t)}getParentKeyForNodeData(t){if(t===null)return;const e=this.Vn;if(e==="")return;const i=this.St(t,e);if(i!==void 0){if(this.isKeyType(i))return i;U.o("ParentKey value for node data "+t+" is not a number or a string: "+i)}}setParentKeyForNodeData(t,e){if(e===null&&(e=void 0),e!==void 0&&!this.isKeyType(e)&&U.si(e,"number or string",TreeModel,"setParentKeyForNodeData:key"),t===null)return;const i=this.Vn;if(i==="")return;if(e=this.maybeEnsureLinkReference(e),!this.containsNodeData(t)){this.et(t,i,e);return}const s=this.St(t,i);s!==e&&(this.ln(s,t),this.et(t,i,e),this.findNodeDataForKey(e)===null&&this.an(e,t),this.Ft("nodeParentKey",2,i,t,s,e),typeof i=="string"&&this.updateTargetBindings(t,i))}get parentLinkCategoryProperty(){return this.cc}set parentLinkCategoryProperty(t){const e=this.cc;e!==t&&(this.En(t,TreeModel,"parentLinkCategoryProperty"),this.cc=t,this.t("parentLinkCategoryProperty",e,t))}get linkCategoryProperty(){return this.parentLinkCategoryProperty}set linkCategoryProperty(t){this.parentLinkCategoryProperty=t}getParentLinkCategoryForNodeData(t){if(t===null)return"";const e=this.cc;if(e==="")return"";const i=this.St(t,e);if(i===void 0)return"";if(typeof i=="string")return i;U.o("getParentLinkCategoryForNodeData found a non-string category for "+t+": "+i)}getLinkCategoryForData(t){return this.getParentLinkCategoryForNodeData(t)}setParentLinkCategoryForNodeData(t,e){if(U.s(e,"string",TreeModel,"setParentLinkCategoryForNodeData:cat"),t===null)return;const i=this.cc;if(i==="")return;if(!this.containsNodeData(t)){this.et(t,i,e);return}let s=this.St(t,i);s===void 0&&(s=""),s!==e&&(this.et(t,i,e),this.Ft("parentLinkCategory",2,i,t,s,e),typeof i=="string"&&this.updateTargetBindings(t,i))}setLinkCategoryForData(t,e){this.setParentLinkCategoryForNodeData(t,e)}copyNodeData(t){const e=super.copyNodeData(t);return!this.copiesParentKeyOfNodeData&&this.Vn!==""&&this.St(e,this.Vn)!==void 0&&this.et(e,this.Vn,void 0),e}setDataProperty(t,e,i){if(this.containsNodeData(t)){if(e===this.nodeKeyProperty){this.setKeyForNodeData(t,i);return}else if(e===this.nodeCategoryProperty){this.setCategoryForNodeData(t,i);return}else if(e===this.nodeParentKeyProperty){this.setParentKeyForNodeData(t,i);return}else if(e===this.parentLinkCategoryProperty){this.setParentLinkCategoryForNodeData(t,i);return}}const s=this.St(t,e);s!==i&&(this.et(t,e,i),this.raiseDataChanged(t,e,s,i))}dw(t,e){super.dw(t,e);const i=this.be.iterator;for(;i.next();){const s=i.value;this.aL(s,t,e)}}aL(t,e,i){if(this.getParentKeyForNodeData(t)===e){const n=this.Vn;this.et(t,n,i),this.Ft("nodeParentKey",2,n,t,e,i),typeof n=="string"&&this.updateTargetBindings(t,n)}}Tg(t){super.Tg(t);const e=this.getKeyForNodeData(t),i=this.lw(e);if(i!==null){const s=U.nt(),n=i.iterator;for(;n.next();){const o=n.value;if(this.containsNodeData(o)&&this.getParentKeyForNodeData(o)===e){const l=this.Vn;this.Ft("nodeParentKey",2,l,o,e,e),typeof l=="string"&&this.updateTargetBindings(o,l),s.push(o)}}for(let o=0;o<s.length;o++)this.ln(e,s[o]);U.Z(s)}}Dg(t){super.Dg(t);let e=this.getParentKeyForNodeData(t);e=this.maybeEnsureLinkReference(e),this.findNodeDataForKey(e)===null&&this.an(e,t)}gw(t){super.gw(t);const e=this.getParentKeyForNodeData(t);this.ln(e,t)}Ag(t,e){super.Ag(t,e),this.setParentLinkCategoryForNodeData(e,this.getParentLinkCategoryForNodeData(t)),this.setParentKeyForNodeData(e,this.getParentKeyForNodeData(t))}get type(){return"TreeModel"}Vm(){return!0}Ax(){return!0}}Model.Sl(TreeModel,"TreeModel");var CircularArrangement=(w=>(w[w.ConstantSpacing=0]="ConstantSpacing",w[w.ConstantDistance=1]="ConstantDistance",w[w.ConstantAngle=2]="ConstantAngle",w[w.Packed=3]="Packed",w))(CircularArrangement||{}),CircularDirection=(w=>(w[w.Clockwise=10]="Clockwise",w[w.Counterclockwise=11]="Counterclockwise",w[w.BidirectionalLeft=12]="BidirectionalLeft",w[w.BidirectionalRight=13]="BidirectionalRight",w))(CircularDirection||{}),CircularSorting=(w=>(w[w.Forwards=20]="Forwards",w[w.Reverse=21]="Reverse",w[w.Ascending=22]="Ascending",w[w.Descending=23]="Descending",w[w.Optimized=24]="Optimized",w))(CircularSorting||{}),CircularNodeDiameterFormula=(w=>(w[w.Pythagorean=30]="Pythagorean",w[w.Circular=31]="Circular",w))(CircularNodeDiameterFormula||{});class CircularLayout extends Layout{gi;_f;Uk;Rg;Vk;Ya;hL;cL;fL;Is;mw;pw;fc;yw;iF;Og;Ig;Eg;tu;He;P;Si;Mi;In;Ug;constructor(t){super(),this.gi=0,this._f=0,this.Uk=0,this.Rg=360,this.Vk=0,this.Ya=0,this.hL=new Point,this.cL=30,this.fL=0,this.Is=0,this.mw=0,this.pw=new VertexArrangement,this.fc=0,this.yw=0,this.iF=600,this.Og=NaN,this.Ig=1,this.Eg=0,this.tu=360,this.He=0,this.P=10,this.Si=24,this.Mi=LayoutVertex.standardComparer,this.In=6,this.Ug=30,t&&Object.assign(this,t)}cloneProtected(t){super.cloneProtected(t),t.Og=this.Og,t.Ig=this.Ig,t.Eg=this.Eg,t.tu=this.tu,t.He=this.He,t.P=this.P,t.Si=this.Si,t.Mi=this.Mi,t.In=this.In,t.Ug=this.Ug}fe(t){t in CircularSorting?this.sorting=t:t in CircularDirection?this.direction=t:t in CircularArrangement?this.arrangement=t:t in CircularNodeDiameterFormula?this.nodeDiameterFormula=t:super.fe(t)}createNetwork(){return new CircularNetwork(this)}d3(t,e,i){t=this.g3(t);let s=this.Vk,n=this.cL,o=this.gi,r=this._f,l=this.Uk,a=this.Rg,h=this.Ya,c=this.fL,f=this.Is,u=this.mw;if(s=this.arrangement,n=this.nodeDiameterFormula,o=this.radius,(!isFinite(o)||o<=0)&&(o=NaN),r=this.aspectRatio,(!isFinite(r)||r<=0)&&(r=1),l=this.startAngle,isFinite(l)||(l=0),a=this.sweepAngle,(!isFinite(a)||a>360||a<1)&&(a=360),h=this.spacing,isFinite(h)||(h=NaN),s===3&&n===31?s=0:s===3&&n!==31&&(n=31,s=this.arrangement),(this.direction===12||this.direction===13)&&this.sorting!==24){for(let g=0;!(g>=t.length||(e.add(t.elt(g)),g+1>=t.length));g+=2)i.add(t.elt(g+1));this.direction===12?(this.arrangement===3&&e.reverse(),t=new List,t.addAll(e),t.addAll(i)):(this.arrangement===3&&i.reverse(),t=new List,t.addAll(i),t.addAll(e))}const d=t.length;c=0;let m=0;for(let g=0;g<t.length;g++){const p=l+a*m*(this.direction===10?1:-1)/d;let y=t.elt(g).diameter;isNaN(y)&&(y=t.elt(g).Ka(p)),a<360&&(g===0||g===t.length-1)&&(y/=2),c+=y,m++}if(isNaN(o)||s===3){if(isNaN(h)&&(h=6),s!==0&&s!==3){let g=-1/0;for(let p=0;p<d;p++){const y=t.elt(p),x=t.elt(p===d-1?0:p+1);isNaN(y.diameter)&&y.Ka(0),isNaN(x.diameter)&&x.Ka(0),g=Math.max(g,(y.diameter+x.diameter)/2)}if(u=g+h,s===2){const p=2*Math.PI/d,y=(g+h)/p;r>1?(o=y,f=o*r):(f=y,o=f)}else o=this.Bk(u*(a>=360?d:d-1),r,l*Math.PI/180,a*Math.PI/180)}else o=this.Bk(c+(a>=360?d:d-1)*(s!==3?h:h*1.6),r,l*Math.PI/180,a*Math.PI/180);f=o*r}else{f=o*r;const g=this.uL(o,f,l*Math.PI/180,a*Math.PI/180);if(isNaN(h))s===0&&(h=(g-c)/(a>=360?d:d-1));else if(s===0){const p=(g-c)/(a>=360?d:d-1);p<h?(o=this.Bk(c+h*(a>=360?d:d-1),r,l*Math.PI/180,a*Math.PI/180),f=o*r):h=p}else{let p=-1/0;for(let b=0;b<d;b++){const k=t.elt(b),P=t.elt(b===d-1?0:b+1);isNaN(k.diameter)&&k.Ka(0),isNaN(P.diameter)&&P.Ka(0),p=Math.max(p,(k.diameter+P.diameter)/2)}const y=p+h,x=this.Bk(y*(a>=360?d:d-1),r,l*Math.PI/180,a*Math.PI/180);x>o?(o=x,f=o*r,u=y):u=g/(a>=360?d:d-1)}}return this.Vk=s,this.cL=n,this.gi=o,this._f=r,this.Uk=l,this.Rg=a,this.Ya=h,this.fL=c,this.Is=f,this.mw=u,t}doLayout(t){this.network===null&&(this.network=this.makeNetwork(t)),this.arrangementOrigin=this.initialOrigin(this.arrangementOrigin);const e=this.network.vertexes;if(e.count<=1){if(e.count===1){const u=e.first();u.centerX=0,u.centerY=0}this.updateParts(),this.network=null,this.isValidLayout=!0;return}let i=new List;i.addAll(e.iterator);const s=new List,n=new List;i=this.d3(i,s,n);const o=this.Vk,r=this.gi,l=this.Uk,a=this.Rg,h=this.Ya,c=this.Is,f=this.mw;if((this.direction===12||this.direction===13)&&o===3)this.sF(i,a,l-a/2,10);else if(this.direction===12||this.direction===13){let u=0;switch(o){case 1:u=this.zk(r,c,l,f)*180/Math.PI;break;case 0:{let d=0,m=0;const g=s.first();g!==null&&(d=g.Ka(Math.PI/2));const p=n.first();p!==null&&(m=p.Ka(Math.PI/2)),u=this.zk(r,c,l,h+(d+m)/2)*180/Math.PI;break}case 2:u=a/i.length;break}if(this.direction===12){switch(o){case 1:this.ww(s,a/2,l,11);break;case 0:this.xw(s,a/2,l,11);break;case 2:this.bw(s,a/2,l,11);break}switch(o){case 1:this.ww(n,a/2,l+u,10);break;case 0:this.xw(n,a/2,l+u,10);break;case 2:this.bw(n,a/2,l+u,10);break}}else{switch(o){case 1:this.ww(n,a/2,l,11);break;case 0:this.xw(n,a/2,l,11);break;case 2:this.bw(n,a/2,l,11);break}switch(o){case 1:this.ww(s,a/2,l+u,10);break;case 0:this.xw(s,a/2,l+u,10);break;case 2:this.bw(s,a/2,l+u,10);break}}}else switch(o){case 1:this.ww(i,a,l,this.direction);break;case 0:this.xw(i,a,l,this.direction);break;case 2:this.bw(i,a,l,this.direction);break;case 3:this.sF(i,a,l,this.direction);break}this.updateParts(),this.network=null,this.isValidLayout=!0}bw(t,e,i,s){const n=this.Rg,o=this.gi,r=this.Is,l=i*Math.PI/180,a=e*Math.PI/180,h=t.length;for(let c=0;c<h;c++){const f=l+(s===10?c*a/(n>=360?h:h-1):-(c*a)/h),u=t.elt(c),d=o*Math.tan(f)/r,m=Math.sqrt((o*o+r*r*d*d)/(1+d*d));u.centerX=m*Math.cos(f),u.centerY=m*Math.sin(f),u.actualAngle=f*180/Math.PI}}xw(t,e,i,s){const n=this.gi,o=this.Is,r=this.Ya;let l=i*Math.PI/180;const a=t.length;for(let h=0;h<a;h++){const c=t.elt(h),f=t.elt(h===a-1?0:h+1),u=n*Math.cos(l),d=o*Math.sin(l);c.centerX=u,c.centerY=d,c.actualAngle=l*180/Math.PI,isNaN(c.diameter)&&c.Ka(0),isNaN(f.diameter)&&f.Ka(0);const m=(c.diameter+f.diameter)/2,g=this.zk(n,o,s===10?l:-l,m+r);l+=s===10?g:-g}}ww(t,e,i,s){const n=this.gi,o=this.Is,r=this.mw;let l=i*Math.PI/180;const a=t.length;for(let h=0;h<a;h++){const c=t.elt(h);c.centerX=n*Math.cos(l),c.centerY=o*Math.sin(l),c.actualAngle=l*180/Math.PI;const f=this.zk(n,o,s===10?l:-l,r);l+=s===10?f:-f}}sF(t,e,i,s){let n=this.yw;const o=this.Rg;if(this.fc=0,this.pw=new VertexArrangement,e<360){for(n=i+(s===10?o:-o);n<0;)n+=360;n%=360,n>180&&(n-=360),n*=Math.PI/180,this.yw=n,this.nF(t,e,i,s)}else this.oF(t,e,i,s);this.pw.commit(t)}oF(t,e,i,s){const n=this.gi,o=this.Is,r=this.Ya,l=this._f;let a=n*Math.cos(i*Math.PI/180),h=o*Math.sin(i*Math.PI/180);const c=t.toArray();if(c.length===3){c[0].centerX=n,c[0].centerY=0,c[1].centerX=c[0].centerX-c[0].width/2-c[1].width/2-r,c[1].y=c[0].y,c[2].centerX=(c[0].centerX+c[1].centerX)/2,c[2].y=c[0].y-c[2].height-r;return}else if(c.length===4){c[0].centerX=n,c[0].centerY=0,c[2].centerX=-c[0].centerX,c[2].centerY=c[0].centerY,c[1].centerX=0,c[1].y=Math.min(c[0].y,c[2].y)-c[1].height-r,c[3].centerX=0,c[3].y=Math.max(c[0].y+c[0].height+r,c[2].y+c[2].height+r);return}const f=Point.l();for(let k=0;k<c.length&&(c[k].centerX=a,c[k].centerY=h,!(k>=c.length-1));k++)this.rF(a,h,c,k,s,f)||this.lF(a,h,c,k,s,f),a=f.x,h=f.y;if(Point.i(f),this.fc++,this.fc>23)return;const u=c[0].centerX,d=c[0].centerY,m=c[c.length-1].centerX,g=c[c.length-1].centerY;let p=Math.abs(u-m)-((c[0].width+c[c.length-1].width)/2+r);const y=Math.abs(d-g)-((c[0].height+c[c.length-1].height)/2+r);let x=0;if(Math.abs(y)<1){const k=Math.abs(u-m),P=(c[0].width+c[c.length-1].width)/2;k<P&&(x=0),p=k-P}else y>0?x=y:Math.abs(p)<1?x=0:x=p;let b=!1;Math.abs(m)>Math.abs(g)?b=m>0!=d>g:b=g>0!=u<m,b=s===10?b:!b,b&&(x=-Math.abs(x),x=Math.min(x,-c[c.length-1].width),x=Math.min(x,-c[c.length-1].height)),this.pw.m3(x,c),Math.abs(x)>1&&(this.fc<8?this.gi-=x/(2*Math.PI):c.length<5&&x>10?this.gi/=2:this.gi-=x>0?1.7:-2.3,this.Is=this.gi*l,this.oF(t,e,i,s))}nF(t,e,i,s){const n=this.gi,o=this.Is,r=this._f;let l=n*Math.cos(i*Math.PI/180),a=o*Math.sin(i*Math.PI/180);const h=Point.l(),c=t.toArray();for(let m=0;m<c.length&&(c[m].centerX=l,c[m].centerY=a,!(m>=c.length-1));m++)this.rF(l,a,c,m,s,h)||this.lF(l,a,c,m,s,h),l=h.x,a=h.y;if(Point.i(h),this.fc++,this.fc>23)return;const f=Math.atan2(a,l);let u=s===10?this.yw-f:f-this.yw;u=Math.abs(u)<Math.abs(u-2*Math.PI)?u:u-2*Math.PI;const d=u*(n+o)/2;this.pw.p3(d,c),Math.abs(d)>1&&(this.fc<8?this.gi-=d/(2*Math.PI):this.gi-=d>0?1.7:-2.3,this.Is=this.gi*r,this.nF(t,e,i,s))}rF(t,e,i,s,n,o){const r=this.Ya,l=this.gi,a=this.Is;let h=0,c=0;const f=(i[s].width+i[s+1].width)/2+r;let u=!1;if(e>=0!=(n===10)){if(h=t+f,h>l){if(h=t-f,h<-l)return o.x=h,o.y=c,!1;u=!0}}else if(h=t-f,h<-l){if(h=t+f,h>l)return o.x=h,o.y=c,!1;u=!0}return c=Math.sqrt(1-Math.min(1,h*h/(l*l)))*a,e<0!==u&&(c=-c),Math.abs(e-c)>(i[s].height+i[s+1].height)/2?(o.x=h,o.y=c,!1):(o.x=h,o.y=c,!0)}lF(t,e,i,s,n,o){const r=this.Ya,l=this.gi,a=this.Is;let h=0,c=0;const f=(i[s].height+i[s+1].height)/2+r;let u=!1;if(t>=0!=(n===10)){if(c=e-f,c<-a){if(c=e+f,c>a)return o.x=h,o.y=c,!1;u=!0}}else if(c=e+f,c>a){if(c=e-f,c<-a)return o.x=h,o.y=c,!1;u=!0}return h=Math.sqrt(1-Math.min(1,c*c/(a*a)))*l,t<0!==u&&(h=-h),Math.abs(t-h)>(i[s].width+i[s+1].width)/2?(o.x=h,o.y=c,!1):(o.x=h,o.y=c,!0)}commitLayout(){this.commitNodes(),this.isRouting&&this.commitLinks()}commitNodes(){const t=this.group!==null&&this.group.hasPlaceholder(),e=t?this.group.location.copy():null;let i=this.actualCenter;if(t?i=new Point(0,0):(i.x=this.arrangementOrigin.x+this.gi,i.y=this.arrangementOrigin.y+this.Is),this.network!==null){const s=this.network.vertexes.iterator;for(;s.next();){const n=s.value;n.x+=i.x,n.y+=i.y,n.commit()}}if(t&&this.group&&e){this.group.ensureBounds();const s=this.group.position.copy(),n=this.group.location.copy(),o=e.subtract(n.subtract(s));this.group.move(o),this.hL=o.subtract(s)}}commitLinks(){if(this.network!==null){const t=this.network.edges.iterator;for(;t.next();)t.value.commit()}}uL(t,e,i,s){const n=this.iF;if(Math.abs(this._f-1)<.001)return i!==void 0&&s!==void 0?s*t:2*Math.PI*t;const o=t>e?Math.sqrt(t*t-e*e)/t:Math.sqrt(e*e-t*t)/e;let r=0,l=0;i!==void 0&&s!==void 0?l=s/(n+1):l=Math.PI/(2*(n+1));let a=0;for(let h=0;h<=n;h++){i!==void 0&&s!==void 0?a=i+h*s/n:a=h*Math.PI/(2*n);const c=Math.sin(a);r+=Math.sqrt(1-o*o*c*c)*l}return i!==void 0&&s!==void 0?(t>e?t:e)*r:4*(t>e?t:e)*r}Bk(t,e,i,s){let n=0;return i!==void 0&&s!==void 0?n=this.uL(1,e,i,s):n=this.uL(1,e),t/n}zk(t,e,i,s){if(Math.abs(this._f-1)<.001)return s/t;const n=t>e?Math.sqrt(t*t-e*e)/t:Math.sqrt(e*e-t*t)/e;let o=0;const r=2*Math.PI/(this.network.vertexes.count*700);t>e&&(i+=Math.PI/2);for(let l=0;;l++){const a=i+l*r,h=Math.sin(a);if(o+=(t>e?t:e)*Math.sqrt(1-n*n*h*h)*r,o>=s)return l*r}}g3(t){switch(this.sorting){case 20:break;case 21:t.reverse();break;case 22:t.sort(this.comparer);break;case 23:t.sort(this.comparer),t.reverse();break;case 24:return this.y3(this.w3(t));default:U.o("Invalid sorting type.")}return t}w3(t){const e=[];for(let s=0;s<t.length;s++)e.push(0);const i=new List;for(let s=0;s<t.length;s++){let n=-1,o=-1;if(s===0)for(let c=0;c<t.length;c++){const u=t.elt(c).edgesCount;u>n&&(n=u,o=c)}else for(let c=0;c<t.length;c++){const f=e[c];f>n&&(n=f,o=c)}i.add(t.elt(o)),e[o]=-1;const r=t.elt(o);let l=0;const a=r.sourceEdges;for(;a.next();){const f=a.value.fromVertex;l=t.indexOf(f),!(l<0)&&e[l]>=0&&e[l]++}const h=r.destinationEdges;for(;h.next();){const f=h.value.toVertex;l=t.indexOf(f),!(l<0)&&e[l]>=0&&e[l]++}}return i}y3(t){const e=[];for(let f=0;f<t.length;f++){const u=t.elt(f);e[f]=[];let d=0;const m=u.destinationEdges;for(;m.next();){const p=m.value.toVertex;d=t.indexOf(p),d!==f&&e[f].indexOf(d)<0&&e[f].push(d)}const g=u.sourceEdges;for(;g.next();){const p=g.value.fromVertex;d=t.indexOf(p),d!==f&&e[f].indexOf(d)<0&&e[f].push(d)}}const i=[];for(let f=0;f<e.length;f++)i[f]=0;const s=[],n=[],o=[],r=[],l=new List;let a=0;for(let f=0;f<e.length;f++){const u=e[f].length;if(u===1){r.push(f);continue}if(u===0){l.add(t.elt(f));continue}if(a===0){s.push(f),a++;continue}let d=1/0,m=1/0,g=-1;const p=[];for(let y=0;y<s.length;y++)e[s[y]].indexOf(s[y===s.length-1?0:y+1])<0&&p.push(y===s.length-1?0:y+1);if(p.length===0)for(let y=0;y<s.length;y++)p.push(y);for(let y=0;y<p.length;y++){const x=p[y],b=this.x3(e[f],n,o,i,x,s);let k=0;for(let P=0;P<e[f].length;P++){const S=e[f][P],L=s.indexOf(S);if(L>=0){const C=Math.abs(x-(L>=x?L+1:L));k+=C<s.length+1-C?C:s.length+1-C}}for(let P=0;P<n.length;P++){let S=i[n[P]],L=i[o[P]];if(S>=x&&S++,L>=x&&L++,S>L){const C=L;L=S,S=C}L-S<(s.length+2)/2==(S<x&&x<=L)&&k++}(b<d||b===d&&k<m)&&(d=b,m=k,g=x)}s.splice(g,0,f);for(let y=0;y<s.length;y++)i[s[y]]=y;for(let y=0;y<e[f].length;y++){const x=e[f][y];s.indexOf(x)>=0&&(n.push(f),o.push(x))}a++}let h=!1;const c=s.length;for(;;){h=!0;for(let f=0;f<r.length;f++){const u=r[f],d=e[u][0],m=s.indexOf(d);if(m>=0){let g=0;for(let p=0;p<e[d].length;p++){const y=e[d][p],x=s.indexOf(y);if(x<0||x===m)continue;const b=x>m?x-m:m-x,k=c-b;g+=x<m!=b>k?1:-1}s.splice(g<0?m:m+1,0,u),r.splice(f,1),f--}else h=!1}if(h)break;s.push(r[0]),r.splice(0,1)}for(let f=0;f<s.length;f++){const u=s[f];l.add(t.elt(u))}return l}x3(t,e,i,s,n,o){let r=0;for(let l=0;l<e.length;l++){const a=e[l],h=i[l],c=s[a],f=s[h];let u=0,d=0;if(c<f?(u=c,d=f):(u=f,d=c),u<n&&n<=d)for(let m=0;m<t.length;m++){const g=t[m];o.indexOf(g)<0||u<s[g]&&s[g]<d||u===s[g]||d===s[g]||r++}else for(let m=0;m<t.length;m++){const g=t[m];o.indexOf(g)<0||!(u<s[g]&&s[g]<d)||u===s[g]||d===s[g]||r++}}return r}get radius(){return this.Og}set radius(t){this.Og!==t&&(U.s(t,"number",CircularLayout,"radius"),(t>0||isNaN(t))&&(this.Og=t,this.p()))}get aspectRatio(){return this.Ig}set aspectRatio(t){this.Ig!==t&&(U.s(t,"number",CircularLayout,"aspectRatio"),t>0&&(this.Ig=t,this.p()))}get startAngle(){return this.Eg}set startAngle(t){this.Eg!==t&&(U.s(t,"number",CircularLayout,"startAngle"),this.Eg=t,this.p())}get sweepAngle(){return this.tu}set sweepAngle(t){this.tu!==t&&(U.s(t,"number",CircularLayout,"sweepAngle"),t>0&&t<=360?this.tu=t:this.tu=360,this.p())}get arrangement(){return this.He}set arrangement(t){this.He!==t&&(t===3||t===0||t===1||t===2)&&(this.He=t,this.p())}get direction(){return this.P}set direction(t){this.P!==t&&(t===10||t===11||t===12||t===13)&&(this.P=t,this.p())}get sorting(){return this.Si}set sorting(t){this.Si!==t&&(this.Si=t,this.p())}get comparer(){return this.Mi}set comparer(t){this.Mi!==t&&(U.S(t,CircularLayout,"comparer"),this.Mi=t,this.p())}get spacing(){return this.In}set spacing(t){this.In!==t&&(U.s(t,"number",CircularLayout,"spacing"),this.In=t,this.p())}get nodeDiameterFormula(){return this.Ug}set nodeDiameterFormula(t){this.Ug!==t&&(t===30||t===31)&&(this.Ug=t,this.p())}get actualXRadius(){return this.gi}get actualYRadius(){return this.Is}get actualSpacing(){return this.Ya}get actualCenter(){return this.hL}static ConstantSpacing=0;static ConstantDistance=1;static ConstantAngle=2;static Packed=3;static Clockwise=10;static Counterclockwise=11;static BidirectionalLeft=12;static BidirectionalRight=13;static Forwards=20;static Reverse=21;static Ascending=22;static Descending=23;static Optimized=24;static Pythagorean=30;static Circular=31}class VertexArrangement{eu;uc;iu;constructor(){this.eu=-1/0,this.uc=null,this.iu=null}m3(t,e){if(t>0&&this.eu<0||Math.abs(t)<Math.abs(this.eu)&&!(t<0&&this.eu>0)){this.eu=t,this.uc=[],this.iu=[];for(let i=0;i<e.length;i++)this.uc[i]=e[i].bounds.x,this.iu[i]=e[i].bounds.y}}p3(t,e){if(Math.abs(t)<Math.abs(this.eu)){this.eu=t,this.uc=[],this.iu=[];for(let i=0;i<e.length;i++)this.uc[i]=e[i].bounds.x,this.iu[i]=e[i].bounds.y}}commit(t){if(!(this.uc===null||this.iu===null))for(let e=0;e<this.uc.length;e++){const i=t.elt(e);i.x=this.uc[e],i.y=this.iu[e]}}}class CircularNetwork extends LayoutNetwork{constructor(t){super(t)}createVertex(){return new CircularVertex(this)}createEdge(){return new CircularEdge(this)}}class CircularVertex extends LayoutVertex{Ao;Xk;constructor(t){super(t),this.Ao=NaN,this.Xk=NaN}Ka(t){const e=this.network;if(e===null)return NaN;const i=e.layout;if(i===null)return NaN;if(i.arrangement===3){if(i.nodeDiameterFormula===31)return this.Ao=Math.max(this.width,this.height),this.Ao;{const s=Math.abs(Math.sin(t)),n=Math.abs(Math.cos(t));return s===0?this.width:n===0?this.height:(this.Ao=Math.min(this.height/s,this.width/n),this.Ao)}}else return i.nodeDiameterFormula===31?(this.Ao=Math.max(this.width,this.height),this.Ao):(this.Ao=Math.sqrt(this.width*this.width+this.height*this.height),this.Ao)}get diameter(){return this.Ao}set diameter(t){this.Ao!==t&&(U.s(t,"number",CircularVertex,"diameter"),this.Ao=t)}get actualAngle(){return this.Xk}set actualAngle(t){this.Xk!==t&&(U.s(t,"number",CircularVertex,"actualAngle"),this.Xk=t)}}class CircularEdge extends LayoutEdge{constructor(t){super(t)}}class ForceDirectedLayout extends Layout{kw;Ha;Es;Vg;Bn;zi;Bg;zg;Xg;su;Gg;Yg;nu;ou;ru;lu;Kg;Hg;au;dc;constructor(t){super(),this.kw=0,this.Ha=0,this.Es=new Size(100,100).k(),this.Vg=!1,this.Bn=!0,this.zi=!1,this.Bg=100,this.zg=300,this.Xg=1,this.su=1e3,this.Gg=10,this.Yg=Math,this.nu=.05,this.ou=50,this.ru=150,this.lu=0,this.Kg=10,this.Hg=5,this.au=NaN,this.dc=10,t&&Object.assign(this,t)}cloneProtected(t){super.cloneProtected(t),t.Es.h(this.Es),t.Vg=this.Vg,t.Bn=this.Bn,t.zi=this.zi,t.Bg=this.Bg,t.zg=this.zg,t.Xg=this.Xg,t.su=this.su,t.Gg=this.Gg,t.Yg=this.Yg,t.nu=this.nu,t.ou=this.ou,t.ru=this.ru,t.lu=this.lu,t.Kg=this.Kg,t.Hg=this.Hg,t.au=this.au,t.dc=this.dc}createNetwork(){return new ForceDirectedNetwork(this)}doLayout(t){this.network=this.makeNetwork(t);let e=this.network.vertexes.iterator;const i=this.maxIterations;if(this.network.vertexes.count>0){for(this.network.deleteSelfEdges(),e=this.network.vertexes.iterator;e.next();){const o=e.value;o.charge=this.electricalCharge(o),o.mass=this.gravitationalMass(o)}const s=this.network.edges.iterator;for(;s.next();){const o=s.value;o.stiffness=this.springStiffness(o),o.length=this.springLength(o)}if(this.dL(),this.Ha=0,this.needsPrelayout()){const o=this.network,r=o.splitIntoSubNetworks(!1);let l=r.iterator;for(;l.next();){const a=l.value;this.doConnectedSubnetLayout(a)}for(l=r.iterator,this.b3(l,o),l=r.iterator;l.next();){const a=l.value,h=a.vertexes.iterator;for(;h.next();){const f=h.value;o.addVertex(f)}const c=a.edges.iterator;for(;c.next();){const f=c.value;o.addEdge(f)}}}else this.aF(this.network,this.maxIterations);this.updateParts()}this.maxIterations=i,this.isValidLayout=!0}needsPrelayout(){if(this.network===null||this.network.vertexes.count<3)return!1;let t=0,e=0;const i=this.network.vertexes.first().bounds,s=this.network.vertexes.iterator;for(;s.next();){const n=s.value,o=n.bounds;if(isNaN(n.x)||isNaN(n.y)||o.intersectsRect(i)&&(t++,t>2))return!0;if(e>10)return!1;e++}return!1}doConnectedSubnetLayout(t){let e=t.vertexes.iterator;for(;e.next();){const l=e.value;l.hierarchicalVertexes.add(l)}let i=t,s=this.au;if(isNaN(s)&&(s=t.edges.count/t.vertexes.count),s<t.vertexes.count)for(;i.vertexes.count>Math.max(100,Math.sqrt(s*t.vertexes.count));)i=this.coarsenNetwork(i);let n=0;e=i.vertexes.iterator;let o=this.randomNumberGenerator;for(o===null&&(this.randomNumberGenerator=o=new RandomNumberGenerator(0));e.next();){e.value.idInCluster=n++;const l=10*(o.random()-.5),a=10*(o.random()-.5);this.isFixed(e.value)||(e.value.x=l,e.value.y=a);const h=e.value.hierarchicalVertexes.iterator;for(;h.next();)this.isFixed(h.value)||(h.value.x=l,h.value.y=a)}const r=this.computePairwiseDistances(i);this.k3(i,r,this.maxPrelayoutIterations,t.vertexes.count),this.aF(t,this.maxIterations)}computePairwiseDistances(t){const e=t.vertexes.count,i=new Array(e);for(let r=0;r<e;r++)i[r]=new Array(e).fill(-1),i[r][r]=0;const s=t.vertexes.iterator;let n=new Map,o=[];for(;s.next();){const r=s.value;for(o=[r],n=new Map,n.set(r.idInCluster,0);o.length>0;){const l=o.shift(),a=l.vertexes.iterator;for(;a.next();){const h=a.value;n.has(h.idInCluster)||(n.set(h.idInCluster,n.get(l.idInCluster)+1),o.push(h))}}for(let l=0;l<e;l++){const a=Math.min(i[r.idInCluster][l],i[l][r.idInCluster]),h=n.get(l);(a<0||h<a)&&(i[r.idInCluster][l]=h,i[l][r.idInCluster]=h)}}return i}coarsenNetwork(t){const e=this.createNetwork(),i=new Map;let s=0,n=t.vertexes.iterator;for(;n.next();)n.value.idInCluster=s++;for(n=t.vertexes.iterator;n.next();){const r=n.value;if(i.has(r.idInCluster))continue;let l=Number.MAX_SAFE_INTEGER,a=null;const h=r.vertexes.iterator;for(;h.next();){const f=h.value;i.has(f.idInCluster)||f.hierarchicalVertexes.length<l&&(l=f.hierarchicalVertexes.length,a=f)}const c=e.createVertex();c.hierarchicalVertexes.addAll(r.hierarchicalVertexes),a!=null&&c.hierarchicalVertexes.addAll(a.hierarchicalVertexes),i.set(r.idInCluster,c),a!=null&&i.set(a.idInCluster,c),e.addVertex(c)}const o=t.edges.iterator;for(;o.next();){const r=o.value,l=i.get(r.fromVertex.idInCluster),a=i.get(r.toVertex.idInCluster);if(l===a)continue;const h=e.createEdge();h.fromVertex=l||null,h.toVertex=a||null,e.addEdge(h)}return e}cx(t,e){let i=!0;const s=t.vertexes.iterator;for(;s.next();){const n=s.value;i?(i=!1,e.set(n.bounds)):e.unionRect(n.bounds)}return e}b3(t,e){const i=this.arrangementSpacing,s=t.count;let n=!0,o=0,r=0;const l=U.nt();for(let f=0;f<s+e.vertexes.count+2;f++)l[f]=null;let a=0;t.reset();const h=Rect.l();let c;for(;t.next();){const f=t.value;if(this.cx(f,h),n)n=!1,o=h.x+h.width/2,r=h.y+h.height/2,l[0]=new Point(h.x+h.width+i.width,h.y),l[1]=new Point(h.x,h.y+h.height+i.height),a=2;else{const u=this.hF(l,a,o,r,h.width,h.height,i),d=l[u],m=new Point(d.x+h.width+i.width,d.y),g=new Point(d.x,d.y+h.height+i.height);u+1<a&&l.splice(u+1,0,null),l[u]=m,l[u+1]=g,a++;const p=d.x-h.x,y=d.y-h.y;for(c=f.vertexes.iterator;c.next();){const x=c.value;this.isFixed(x)||(x.centerX+=p,x.centerY+=y)}}}for(Rect.i(h),c=e.vertexes.iterator;c.next();){const f=c.value,u=f.bounds;if(a<2){o=u.x+u.width/2,r=u.y+u.height/2,l[0]=new Point(u.x+u.width+i.width,u.y),l[1]=new Point(u.x,u.y+u.height+i.height),a=2;continue}const d=this.hF(l,a,o,r,u.width,u.height,i),m=l[d],g=new Point(m.x+u.width+i.width,m.y),p=new Point(m.x,m.y+u.height+i.height);d+1<a&&l.splice(d+1,0,null),l[d]=g,l[d+1]=p,a++,this.isFixed(f)||(f.centerX=m.x+f.width/2,f.centerY=m.y+f.height/2)}U.Z(l)}hF(t,e,i,s,n,o,r){let l=9e19,a=-1;t:for(let h=0;h<e;h++){const c=t[h],f=c.x-i,u=c.y-s,d=f*f+u*u;if(d<l){for(let m=h-1;m>=0;m--)if(t[m].y>c.y&&t[m].x-c.x<n+r.width)continue t;for(let m=h+1;m<e;m++)if(t[m].x>c.x&&t[m].y-c.y<o+r.height)continue t;a=h,l=d}}return a}dL(){if(this.network===null||!this.comments)return;const t=this.network.vertexes.iterator;for(;t.next();){const e=t.value;this.addComments(e)}}addComments(t){if(this.network===null)return;const e=t.node;if(e!==null){const i=e.findNodesConnected();for(;i.next();){const s=i.value;if(s.category!=="Comment"||!s.isVisible())continue;let n=this.network.findVertex(s);n===null&&(n=this.network.addNode(s)),n.charge=this.defaultCommentElectricalCharge;let o=null;const r=n.destinationEdges;for(;r.next();){const l=r.value;if(l.toVertex===t){o=l;break}}if(o===null){const l=n.sourceEdges;for(;l.next();){const a=l.value;if(a.fromVertex===t){o=a;break}}}o===null&&(o=this.network.linkVertexes(t,n,null)),o.length=this.defaultCommentSpringLength}}}cF(t,e){const i=t.bounds,s=i.x,n=i.y,o=i.width,r=i.height,l=e.bounds,a=l.x,h=l.y,c=l.width,f=l.height;if(s+o<a)if(n>h+f){const u=s+o-a,d=n-h-f;return G.ix(u*u+d*d)}else if(n+r<h){const u=s+o-a,d=n+r-h;return G.ix(u*u+d*d)}else return a-(s+o);else if(s>a+c)if(n>h+f){const u=s-a-c,d=n-h-f;return G.ix(u*u+d*d)}else if(n+r<h){const u=s-a-c,d=n+r-h;return G.ix(u*u+d*d)}else return s-(a+c);else return n>h+f?n-(h+f):n+r<h?h-(n+r):.1}aF(t,e){const i=this.Ha+e;for(;this.Ha<i&&(this.Ha++,!!this.P3(t)););}P3(t){const e=t.vertexes.toArray();if(e.length<=0)return!1;const i=e[0];i.forceX=0,i.forceY=0;let s=i.centerX,n=s,o=i.centerY,r=o;for(let m=1;m<e.length;m++){const g=e[m];g.forceX=0,g.forceY=0;const p=g.centerX,y=g.centerY;s=Math.min(s,p),n=Math.max(n,p),o=Math.min(o,y),r=Math.max(r,y)}const l=n-s>r-o;l?e.sort((m,g)=>m===null||g===null||m===g?0:m.centerX-g.centerX):e.sort((m,g)=>m===null||g===null||m===g?0:m.centerY-g.centerY);const a=this.su;let h=0,c=0,f=0;for(let m=0;m<e.length;m++){const g=e[m],p=g.bounds,y=g.focus,x=p.x+y.x,b=p.y+y.y;c=g.charge*this.electricalFieldX(x,b),f=g.charge*this.electricalFieldY(x,b),c+=g.mass*this.gravitationalFieldX(x,b),f+=g.mass*this.gravitationalFieldY(x,b),g.forceX+=c,g.forceY+=f;for(let k=m+1;k<e.length;k++){const P=e[k];if(!this.shouldInteract(g,P)||k===m)continue;const S=P.bounds,L=P.focus,C=S.x+L.x,M=S.y+L.y;if(x-C>a||C-x>a){if(l)break;continue}if(b-M>a||M-b>a){if(!l)break;continue}const N=this.cF(g,P),A=2*g.charge,T=2*P.charge;if(N>1)h=A*T/(N*N),c=h*(x-C)/N,f=h*(b-M)/N;else{let D=this.randomNumberGenerator;D===null&&(this.randomNumberGenerator=D=new RandomNumberGenerator(0));const v=D.random(),R=D.random();if(x>C)c=Math.abs(P.bounds.right-g.bounds.x),c=A*T*(1+c)*v;else if(x<C)c=Math.abs(P.bounds.x-g.bounds.right),c=-(A*T)*(1+c)*v;else{const F=Math.max(P.width,g.width);c=A*T*((1+F)*v-F/2)}if(b>M)f=Math.abs(P.bounds.bottom-g.bounds.y),f=A*T*(1+f)*R;else if(x<C)f=Math.abs(P.bounds.y-g.bounds.bottom),f=-(A*T)*(1+f)*R;else{const F=Math.max(P.height,g.height);f=A*T*((1+F)*R-F/2)}}g.forceX+=c,g.forceY+=f,P.forceX-=c,P.forceY-=f}}const u=t.edges.iterator;for(;u.next();){const m=u.value,g=m.fromVertex,p=m.toVertex,y=g.bounds,x=g.focus,b=y.x+x.x,k=y.y+x.y,P=p.bounds,S=p.focus,L=P.x+S.x,C=P.y+S.y,M=this.cF(g,p);M>1&&(h=.1*m.stiffness*(M-m.length),c=h*.5*(g.width+p.height)*(b-L)/M,f=h*.5*(g.width+p.height)*(k-C)/M),g.forceX-=c,g.forceY-=f,p.forceX+=c,p.forceY+=f}let d=0;for(let m=0;m<e.length;m++){const g=e[m];this.isFixed(g)?this.moveFixedVertex(g):d=Math.max(d,this.moveVertex(g)||0)}return d>this.epsilonDistance*this.epsilonDistance}k3(t,e,i,s){const n=this.Ha+i,o=Math.sqrt(s);this.kw=this.dc*t.vertexes.count;const r=t.vertexes.toArray();let l=0,a=0,h=0;for(;this.Ha<n;){this.Ha++,a=l,l=0;for(let c=0;c<r.length;c++){r[c].forceX=0,r[c].forceY=0;for(let u=0;u<r.length;u++){if(c===u)continue;const d=Math.sqrt((r[c].centerX-r[u].centerX)**2+(r[c].centerY-r[u].centerY)**2),m=e[r[c].idInCluster][r[u].idInCluster],g=(d-this.dc*o*m)/d;r[c].forceX+=g*(r[u].x-r[c].x),r[c].forceY+=g*(r[u].y-r[c].y)}const f=Math.sqrt(r[c].forceX*r[c].forceX+r[c].forceY*r[c].forceY);if(f>0){r[c].forceX=this.kw*r[c].forceX/f,r[c].forceY=this.kw*r[c].forceY/f,this.isFixed(r[c])||(r[c].x+=r[c].forceX,r[c].y+=r[c].forceY);const u=r[c].hierarchicalVertexes.iterator;for(;u.next();){const d=u.value;this.isFixed(d)||(d.centerX+=r[c].forceX,d.centerY+=r[c].forceY)}}l+=f*f}if(l>=a){if(h++,h>=5)break}else h=0;this.kw*=.95}}moveVertex(t){let e=t.forceX,i=t.forceY;const s=this.moveLimit;return e<-s?e=-s:e>s&&(e=s),i<-s?i=-s:i>s&&(i=s),t.centerX+=e,t.centerY+=i,e*e+i*i}shouldInteract(t,e){return!0}moveFixedVertex(t){}commitLayout(){this.Pw(),this.commitNodes(),this.isRouting&&this.commitLinks()}Pw(){if(this.network===null||!this.setsPortSpots)return;const t=this.network.edges.iterator;for(;t.next();){const i=t.value.link;i!==null&&(i.fromSpot=Spot.Default,i.toSpot=Spot.Default)}}commitNodes(){if(!this.network)return;let t=0,e=0;if(this.arrangesToOrigin){const n=Rect.l();this.cx(this.network,n);const o=this.arrangementOrigin;t=o.x-n.x,e=o.y-n.y,Rect.i(n)}const i=Rect.l(),s=this.network.vertexes.iterator;for(;s.next();){const n=s.value;(t!==0||e!==0)&&(i.h(n.bounds),i.x+=t,i.y+=e,n.bounds=i),n.commit()}Rect.i(i)}commitLinks(){if(!this.network)return;const t=this.network.edges.iterator;for(;t.next();)t.value.commit()}springStiffness(t){const e=t.stiffness;return isNaN(e)?this.nu:e}springLength(t){const e=t.length;return isNaN(e)?this.ou:e}electricalCharge(t){const e=t.charge;return isNaN(e)?this.ru:e}electricalFieldX(t,e){return 0}electricalFieldY(t,e){return 0}gravitationalMass(t){const e=t.mass;return isNaN(e)?this.lu:e}gravitationalFieldX(t,e){return 0}gravitationalFieldY(t,e){return 0}isFixed(t){return t.isFixed}get currentIteration(){return this.Ha}get arrangementSpacing(){return this.Es}set arrangementSpacing(t){this.Es.equals(t)||(this.Es.h(t),this.p())}get arrangesToOrigin(){return this.Vg}set arrangesToOrigin(t){this.Vg!==t&&(U.s(t,"boolean",ForceDirectedLayout,"arrangesToOrigin"),this.Vg=t,this.p())}get setsPortSpots(){return this.Bn}set setsPortSpots(t){this.Bn!==t&&(U.s(t,"boolean",ForceDirectedLayout,"setsPortSpots"),this.Bn=t,this.p())}get comments(){return this.zi}set comments(t){this.zi!==t&&(U.s(t,"boolean",ForceDirectedLayout,"comments"),this.zi=t,this.p())}get maxPrelayoutIterations(){return this.Bg}set maxPrelayoutIterations(t){this.Bg!==t&&(U.s(t,"number",ForceDirectedLayout,"maxPrelayoutIterations"),t>=0&&(this.Bg=t,this.p()))}get maxIterations(){return this.zg}set maxIterations(t){this.zg!==t&&(U.s(t,"number",ForceDirectedLayout,"maxIterations"),t>=0&&(this.zg=t,this.p()))}get epsilonDistance(){return this.Xg}set epsilonDistance(t){this.Xg!==t&&(U.s(t,"number",ForceDirectedLayout,"epsilonDistance"),t>0&&(this.Xg=t,this.p()))}get infinityDistance(){return this.su}set infinityDistance(t){this.su!==t&&(U.s(t,"number",ForceDirectedLayout,"infinityDistance"),t>1&&(this.su=t,this.p()))}get moveLimit(){return this.Gg}set moveLimit(t){this.Gg!==t&&(U.s(t,"number",ForceDirectedLayout,"moveLimit"),this.Gg=t,this.p())}get randomNumberGenerator(){return this.Yg}set randomNumberGenerator(t){this.Yg!==t&&(t!==null&&!U.st(t.random)&&U.o('ForceDirectedLayout.randomNumberGenerator must have a "random()" function on it: '+t),this.Yg=t)}get defaultSpringStiffness(){return this.nu}set defaultSpringStiffness(t){this.nu!==t&&(U.s(t,"number",ForceDirectedLayout,"defaultSpringStiffness"),this.nu=t,this.p())}get defaultSpringLength(){return this.ou}set defaultSpringLength(t){this.ou!==t&&(U.s(t,"number",ForceDirectedLayout,"defaultSpringLength"),this.ou=t,this.p())}get defaultElectricalCharge(){return this.ru}set defaultElectricalCharge(t){this.ru!==t&&(U.s(t,"number",ForceDirectedLayout,"defaultElectricalCharge"),this.ru=t,this.p())}get defaultGravitationalMass(){return this.lu}set defaultGravitationalMass(t){this.lu!==t&&(U.s(t,"number",ForceDirectedLayout,"defaultGravitationalMass"),this.lu=t,this.p())}get defaultCommentSpringLength(){return this.Kg}set defaultCommentSpringLength(t){this.Kg!==t&&(U.s(t,"number",ForceDirectedLayout,"defaultCommentSpringLength"),this.Kg=t,this.p())}get defaultCommentElectricalCharge(){return this.Hg}set defaultCommentElectricalCharge(t){this.Hg!==t&&(U.s(t,"number",ForceDirectedLayout,"defaultCommentElectricalCharge"),this.Hg=t,this.p())}get prelayoutQuality(){return this.au}set prelayoutQuality(t){this.au!==t&&(U.s(t,"number",ForceDirectedLayout,"prelayoutQuality"),this.au=t,this.p())}get prelayoutSpread(){return this.dc}set prelayoutSpread(t){this.dc!==t&&(U.s(t,"number",ForceDirectedLayout,"prelayoutSpread"),this.dc=t,this.p())}}class ForceDirectedNetwork extends LayoutNetwork{constructor(t){super(t)}createVertex(){return new ForceDirectedVertex(this)}createEdge(){return new ForceDirectedEdge(this)}}class ForceDirectedVertex extends LayoutVertex{Gk;Yk;Kk;Hk;qk;hierarchicalVertexes;idInCluster;constructor(t){super(t),this.Gk=!1,this.Yk=NaN,this.Kk=NaN,this.Hk=0,this.qk=0,this.hierarchicalVertexes=new List,this.idInCluster=-1}get isFixed(){return this.Gk}set isFixed(t){this.Gk!==t&&(U.s(t,"boolean",ForceDirectedVertex,"isFixed"),this.Gk=t)}get charge(){return this.Yk}set charge(t){this.Yk!==t&&(U.s(t,"number",ForceDirectedVertex,"charge"),this.Yk=t)}get mass(){return this.Kk}set mass(t){this.Kk!==t&&(U.s(t,"number",ForceDirectedVertex,"mass"),this.Kk=t)}get forceX(){return this.Hk}set forceX(t){this.Hk!==t&&(U.s(t,"number",ForceDirectedVertex,"forceX"),this.Hk=t)}get forceY(){return this.qk}set forceY(t){this.qk!==t&&(U.s(t,"number",ForceDirectedVertex,"forceY"),this.qk=t)}}class ForceDirectedEdge extends LayoutEdge{jk;Wk;constructor(t){super(t),this.jk=NaN,this.Wk=NaN}get stiffness(){return this.jk}set stiffness(t){this.jk!==t&&(U.s(t,"number",ForceDirectedEdge,"stiffness"),this.jk=t)}get length(){return this.Wk}set length(t){this.Wk!==t&&(U.s(t,"number",ForceDirectedEdge,"length"),this.Wk=t)}}class RandomNumberGenerator{I;R;Q;M;A;seed;constructor(t){t===void 0&&(t=42),this.seed=t,this.A=48271,this.M=2147483647,this.Q=this.M/this.A,this.R=this.M%this.A,this.I=1/this.M,this.random()}random(){const t=this.seed/this.Q,e=this.seed%this.Q,i=this.A*e-this.R*t;return i>0?this.seed=i:this.seed=i+this.M,this.seed*this.I}}var LayeredDigraphCycleRemove=(w=>(w[w.DepthFirst=0]="DepthFirst",w[w.Greedy=1]="Greedy",w[w.FromLayers=2]="FromLayers",w))(LayeredDigraphCycleRemove||{}),LayeredDigraphLayering=(w=>(w[w.OptimalLinkLength=10]="OptimalLinkLength",w[w.LongestPathSink=11]="LongestPathSink",w[w.LongestPathSource=12]="LongestPathSource",w))(LayeredDigraphLayering||{}),LayeredDigraphInit=(w=>(w[w.DepthFirstOut=20]="DepthFirstOut",w[w.DepthFirstIn=21]="DepthFirstIn",w[w.Naive=22]="Naive",w))(LayeredDigraphInit||{}),LayeredDigraphAggressive=(w=>(w[w.None=30]="None",w[w.Less=31]="Less",w[w.More=32]="More",w))(LayeredDigraphAggressive||{}),LayeredDigraphPack=(w=>(w[w.None=0]="None",w[w.Expand=1]="Expand",w[w.Straighten=2]="Straighten",w[w.Median=4]="Median",w[w.MaybeExpand=8]="MaybeExpand",w[w.All=15]="All",w))(LayeredDigraphPack||{}),LayeredDigraphAlign=(w=>(w[w.None=0]="None",w[w.UpperLeft=1]="UpperLeft",w[w.UpperRight=2]="UpperRight",w[w.LowerLeft=4]="LowerLeft",w[w.LowerRight=8]="LowerRight",w[w.All=15]="All",w))(LayeredDigraphAlign||{});class LayeredDigraphLayout extends Layout{Us;ti;P;hu;cu;fu;gc;uu;hr;du;Bn;_;Sw;zt;qg;Vs;ie;Bs;ms;ps;Rt;jg;Wg;Jk;cn;gu;cr;zn;Xn;gL;qa;constructor(t){super(),this.Us=25,this.ti=25,this.P=0,this.hu=0,this.cu=10,this.fu=20,this.gc=4,this.uu=31,this.hr=15,this.du=10,this.Bn=!0,this._=-1,this.Sw=-1,this.zt=-1,this.qg=0,this.Vs=0,this.ie=new Int16Array(0),this.Bs=new Float32Array(0),this.ms=new Float32Array(0),this.ps=new Float32Array(0),this.Rt=new Float32Array(0),this.jg=0,this.Wg=new Int16Array(0),this.Jk=new Int16Array(0),this.cn=0,this.gu=null,this.cr=new Point,this.zn=[],this.zn.length=100,this.Xn=15,this.gL=0,this.qa=!0,t&&Object.assign(this,t)}cloneProtected(t){super.cloneProtected(t),t.Us=this.Us,t.ti=this.ti,t.P=this.P,t.hu=this.hu,t.cu=this.cu,t.fu=this.fu,t.gc=this.gc,t.uu=this.uu,t.hr=this.hr,t.du=this.du,t.Bn=this.Bn,t.Xn=this.Xn,t.qa=this.qa}fe(t){t in LayeredDigraphAggressive?this.aggressiveOption=t:t in LayeredDigraphCycleRemove?this.cycleRemoveOption=t:t in LayeredDigraphInit?this.initializeOption=t:t in LayeredDigraphLayering?this.layeringOption=t:super.fe(t)}createNetwork(){return new LayeredDigraphNetwork(this)}doLayout(t){this.network===null&&(this.network=this.makeNetwork(t)),this.arrangementOrigin=this.initialOrigin(this.arrangementOrigin),this.S3(),this.network.vertexes.count>0&&(this.network.deleteSelfEdges(),this.cycleRemoveOption!==2&&this.removeCycles(),this.M3(),this.cycleRemoveOption===2&&this.removeCycles(),this.N3(),this.C3(),this.L3(),this.reduceCrossings(),this.straightenAndPack(),this.updateParts()),this.network=null,this.isValidLayout=!0}linkMinLength(t){return 1}linkLengthWeight(t){return 1}linkStraightenWeight(t){const e=t.fromVertex.node||t.fromVertex.data,i=t.toVertex.node||t.toVertex.data;return e===null&&i===null?8:e===null||i===null?4:1}nodeMinLayerSpace(t,e){return t.node===null&&t.data===null?0:this.P===90||this.P===270?e?t.focus.y+10:t.bounds.height-t.focus.y+10:e?t.focus.x+10:t.bounds.width-t.focus.x+10}nodeMinColumnSpace(t,e){if(t.node===null&&t.data===null)return 0;const i=e?t.$k:t.Zk;if(i!==null)return i;const s=this.P;return s===90||s===270?e?t.$k=t.focus.x/this.ti+1|0:t.Zk=(t.bounds.width-t.focus.x)/this.ti+1|0:e?t.$k=t.focus.y/this.ti+1|0:t.Zk=(t.bounds.height-t.focus.y)/this.ti+1|0}ei(){const t=this.network.vertexes.count;this.Wg.length<t*2&&(this.Wg=new Int16Array(t*2));let e=0;const i=this.network.vertexes.iterator;for(;i.next();){const s=i.value;this.Wg[e]=s.column,e++,this.Wg[e]=s.index,e++}return this.Wg}ns(t){let e=0;const i=this.network.vertexes.iterator;for(;i.next();){const s=i.value;s.column=t[e],e++,s.index=t[e],e++}}fF(t,e){const i=this.ja(t),s=this.ie[t];this.Jk.length<s*s&&(this.Jk=new Int16Array(s*s));const n=this.Jk;for(let o=0;o<s;o++){let r=0;const l=i[o],a=l.near;let h=0;a!==null&&a!==l&&a.layer===l.layer&&(r+=Math.max(0,Math.abs(a.index-l.index)-1));let c,f=0,u,d=0,m=0,g=0,p,y=0,x,b=0,k=0,P=0,S;if(e>=0){for(c=i[o].So,f=0;f<c.length;f++)if(u=c[f],u.valid&&u.fromVertex.layer!==t)for(d=u.fromVertex.index,m=u.portToPos,g=u.portFromPos,y=f+1;y<c.length;y++)x=c[y],x.valid&&x.fromVertex.layer!==t&&(b=x.fromVertex.index,k=x.portToPos,P=x.portFromPos,m<k&&(d>b||d===b&&g>P)&&r++,k<m&&(b>d||b===d&&P>g)&&r++)}if(e<=0){for(c=i[o].or,f=0;f<c.length;f++)if(u=c[f],u.valid&&u.toVertex.layer!==t)for(d=u.toVertex.index,m=u.portToPos,g=u.portFromPos,y=f+1;y<c.length;y++)x=c[y],x.valid&&x.toVertex.layer!==t&&(b=x.toVertex.index,k=x.portToPos,P=x.portFromPos,g<P&&(d>b||d===b&&m>k)&&r++,P<g&&(b>d||b===d&&k>m)&&r++)}for(n[o*s+o]=r,h=o+1;h<s;h++){let L=0,C=0;if(e>=0){for(p=i[o].So,S=i[h].So,f=0;f<p.length;f++)if(u=p[f],u.valid&&u.fromVertex.layer!==t)for(d=u.fromVertex.index,m=u.portToPos,g=u.portFromPos,y=0;y<S.length;y++)x=S[y],x.valid&&x.fromVertex.layer!==t&&(b=x.fromVertex.index,k=x.portToPos,P=x.portFromPos,(d<b||d===b&&g<P)&&C++,(b<d||b===d&&P<g)&&L++)}if(e<=0){for(p=i[o].or,S=i[h].or,f=0;f<p.length;f++)if(u=p[f],u.valid&&u.toVertex.layer!==t)for(d=u.toVertex.index,m=u.portToPos,g=u.portFromPos,y=0;y<S.length;y++)x=S[y],x.valid&&x.toVertex.layer!==t&&(b=x.toVertex.index,k=x.portToPos,P=x.portFromPos,(d<b||d===b&&m<k)&&C++,(b<d||b===d&&k<m)&&L++)}n[o*s+h]=L,n[h*s+o]=C}}return this.Wa(t,i),n}countCrossings(){let t=0;for(let e=0;e<=this._;e++){const i=this.fF(e,1),s=this.ie[e];for(let n=0;n<s;n++)for(let o=n;o<s;o++)t+=i[n*s+o]}return t}A3(t,e,i){const s=this.ja(t),n=this.ie[t];let o=0;for(let r=0;r<n;r++){let l=null;e<=0&&(l=s[r].So);let a=null;e>=0&&(a=s[r].or);let h,c=0,f=0;if(l!==null)for(let u=0;u<l.length;u++)h=l[u],h.valid&&h.fromVertex.layer!==t&&(c=h.fromVertex.column+h.portFromColOffset,f=h.toVertex.column+h.portToColOffset,i?o+=Math.abs(c-f)*this.linkStraightenWeight(h):o+=Math.abs(c-f));if(a!==null)for(let u=0;u<a.length;u++)h=a[u],h.valid&&h.toVertex.layer!==t&&(c=h.fromVertex.column+h.portFromColOffset,f=h.toVertex.column+h.portToColOffset,i?o+=(Math.abs(c-f)+1)*this.linkStraightenWeight(h):o+=Math.abs(c-f))}return this.Wa(t,s),o}Qk(t){let e=0;for(let i=0;i<=this._;i++)e+=this.A3(i,1,t);return e}Mw(){let t=1/0;this.zt=-1;const e=this.network.vertexes.iterator;for(;e.next();){const i=e.value;t=Math.min(t,i.column-this.nodeMinColumnSpace(i,!0)),this.zt=Math.max(this.zt,i.column+this.nodeMinColumnSpace(i,!1))}for(e.reset();e.next();){const i=e.value;i.column-=t}this.zt-=t}Nw(t,e){const i=this.ja(t),s=this.ie[t],n=new Float32Array(s);for(let o=0;o<s;o++){const r=i[o];let l=null;e<=0&&(l=r.So);let a=null;e>=0&&(a=r.or);let h=0,c=0;const f=r.near;f!==null&&f.layer===r.layer&&(h+=f.column-1,c++);let u;if(l!==null)for(let d=0;d<l.length;d++){u=l[d];const m=u.fromVertex;u.valid&&!u.rev&&m.layer!==t&&(h+=m.column,c++)}if(a!==null)for(let d=0;d<a.length;d++){u=a[d];const m=u.toVertex;u.valid&&!u.rev&&m.layer!==t&&(h+=m.column,c++)}c===0?n[o]=-1:n[o]=h/c}return this.Wa(t,i),n}uF(t,e){const i=this.ja(t),s=this.ie[t],n=new Int16Array(s);for(let o=0;o<s;o++){const r=i[o];let l=null;e<=0&&(l=r.So);let a=null;e>=0&&(a=r.or);let h=0;const c=[],f=r.near;f!==null&&f.layer===r.layer&&(c[h]=f.column-1,h++);let u;if(l!==null)for(let d=0;d<l.length;d++){u=l[d];const m=u.fromVertex;u.valid&&!u.rev&&m.layer!==t&&(c[h]=m.column+u.portFromColOffset,h++)}if(a!==null)for(let d=0;d<a.length;d++){u=a[d];const m=u.toVertex;u.valid&&!u.rev&&m.layer!==t&&(c[h]=m.column+u.portToColOffset,h++)}if(h===0)n[o]=-1;else{c.sort((m,g)=>m-g);const d=h>>1;(h&1)!==0?n[o]=c[d]:n[o]=c[d-1]+c[d]>>1}}return this.Wa(t,i),n}Cw(t,e,i,s,n){if(t.component===i){t.component=e;let o=0,r=0;if(s){const l=t.destinationEdges;for(;l.next();){const a=l.value,h=a.toVertex;o=t.layer-h.layer,r=this.linkMinLength(a),o===r&&this.Cw(h,e,i,s,n)}}if(n){const l=t.sourceEdges;for(;l.next();){const a=l.value,h=a.fromVertex;o=h.layer-t.layer,r=this.linkMinLength(a),o===r&&this.Cw(h,e,i,s,n)}}}}mL(t,e,i,s,n){if(t.component===i){if(t.component=e,s){const o=t.destinationEdges;for(;o.next();){const l=o.value.toVertex;this.mL(l,e,i,s,n)}}if(n){const o=t.sourceEdges;for(;o.next();){const l=o.value.fromVertex;this.mL(l,e,i,s,n)}}}}removeCycles(){const t=this.network.edges.iterator;for(;t.next();){const e=t.value;e.rev=!1}switch(this.hu){default:case 1:this.T3();break;case 0:this.D3();break;case 2:this.v3();break}}v3(){const t=this.network,e=t.vertexes.iterator;let i=1/0;for(;e.next();){const s=e.value;i=Math.min(i,s.layer)}if(i<1/0){if(i<0)for(e.reset();e.next();){const r=e.value;r.layer-=i}const s=[];for(e.reset();e.next();){const r=e.value,l=s[r.layer];l===void 0?s[r.layer]=[r]:l.push(r)}let n=0;for(let r=0;r<s.length;r++){const l=s[r];if(!l||l.length===0)n++;else if(r>0)for(let a=0;a<l.length;a++){const h=l[a];h.layer-=n}}const o=t.edges.iterator;for(;o.next();){const r=o.value,l=r.fromVertex,a=r.toVertex;l.layer<a.layer&&(t.reverseEdge(r),r.rev=!0)}}}T3(){const t=this.network;let e=0,i=t.vertexes.count-1;const s=[];s.length=i+1;const n=t.vertexes.iterator;for(;n.next();){const r=n.value;r.ii=!0}for(;this.F3(t)!==null;){let r;for(r=this.dF(t);r!==null;)s[i]=r,i--,r.ii=!1,r=this.dF(t);for(r=this.gF(t);r!==null;)s[e]=r,e++,r.ii=!1,r=this.gF(t);r=this.R3(t),r!==null&&(s[e]=r,e++,r.ii=!1)}for(let r=0;r<t.vertexes.count;r++)s[r].index=r;const o=t.edges.iterator;for(;o.next();){const r=o.value,l=r.fromVertex,a=r.toVertex;l.index>a.index&&(t.reverseEdge(r),r.rev=!0)}}F3(t){const e=t.vertexes.iterator;for(;e.next();){const i=e.value;if(i.ii)return i}return null}dF(t){const e=t.vertexes.iterator;for(;e.next();){const i=e.value;if(i.ii){let s=!0;const n=i.destinationEdges;for(;n.next();)if(n.value.toVertex.ii){s=!1;break}if(s)return i}}return null}gF(t){const e=t.vertexes.iterator;for(;e.next();){const i=e.value;if(i.ii){let s=!0;const n=i.sourceEdges;for(;n.next();)if(n.value.fromVertex.ii){s=!1;break}if(s)return i}}return null}R3(t){let e=null,i=0;const s=this.network.vertexes.iterator;for(;s.next();){const n=s.value;if(n.ii){let o=0;const r=n.destinationEdges;for(;r.next();)r.value.toVertex.ii&&o++;let l=0;const a=n.sourceEdges;for(;a.next();)a.value.fromVertex.ii&&l++;(e===null||i<o-l)&&(e=n,i=o-l)}}return e}D3(){const t=this.network.vertexes.iterator;for(;t.next();){const i=t.value;i.mu=-1,i._n=-1}const e=this.network.edges.iterator;for(;e.next();){const i=e.value;i.forest=!1}for(this.jg=0,t.reset();t.next();){const i=t.value;i.sourceEdges.count===0&&this.pL(i)}for(t.reset();t.next();){const i=t.value;i.mu===-1&&this.pL(i)}for(e.reset();e.next();){const i=e.value;if(!i.forest){const s=i.fromVertex,n=s.mu,o=s._n,r=i.toVertex,l=r.mu,a=r._n;l<n&&o<a&&(this.network.reverseEdge(i),i.rev=!0)}}}pL(t){t.mu=this.jg,this.jg++;const e=t.destinationEdges;for(;e.next();){const i=e.value,s=i.toVertex;s.mu===-1&&(i.forest=!0,this.pL(s))}t._n=this.jg,this.jg++}M3(){const t=this.network.vertexes.iterator;for(;t.next();){const s=t.value;s.layer=-1}for(this._=-1,this.assignLayers(),t.reset();t.next();){const s=t.value;this._=Math.max(this._,s.layer)}this._>=9999&&U.o("LayeredDigraphLayout, too many layers: "+this._);const e=this.direction==0||this.direction==180,i=[];for(const s=this.network.vertexes.iterator;s.next();){const n=s.value;if(n.node===null||n.centered)continue;const o=n.layer;let r=i[o];r===void 0&&(r=0);const l=e?n.width:n.height;l>r&&(i[o]=l)}for(const s=this.network.vertexes.iterator;s.next();){const n=s.value;if(n.node===null||n.centered)continue;const o=i[n.layer];e?(n.focusX=o/2,n.focusY=n.focus.y,n.width=o):(n.focusX=n.focus.x,n.focusY=o/2,n.height=o)}}assignLayers(){switch(this.cu){case 11:this.mF();break;case 12:this.O3();break;default:case 10:this.I3();break}}mF(){const t=this.network.vertexes.iterator;for(;t.next();){const e=t.value,i=this.pF(e);this._=Math.max(i,this._)}}pF(t){let e=0;if(t.layer===-1){const i=t.destinationEdges;for(;i.next();){const s=i.value,n=s.toVertex,o=this.linkMinLength(s);e=Math.max(e,this.pF(n)+o)}t.layer=e}else e=t.layer;return e}O3(){let t=0;const e=this.network.vertexes.iterator;for(;e.next();){const i=e.value;t=this.yF(i),this._=Math.max(t,this._)}for(e.reset();e.next();){const i=e.value;i.layer=this._-i.layer}}yF(t){let e=0;if(t.layer===-1){const i=t.sourceEdges;for(;i.next();){const s=i.value,n=s.fromVertex,o=this.linkMinLength(s);e=Math.max(e,this.yF(n)+o)}t.layer=e}else e=t.layer;return e}I3(){this.mF();const t=this.network.vertexes.iterator;for(;t.next();){const i=t.value;i.ii=!1}for(t.reset();t.next();){const i=t.value;i.sourceEdges.count===0&&this.wF(i)}let e=1/0;for(t.reset();t.next();){const i=t.value;e=Math.min(e,i.layer)}for(this._=-1,t.reset();t.next();){const i=t.value;i.layer-=e,this._=Math.max(this._,i.layer)}}wF(t){if(!t.ii){t.ii=!0;const e=t.destinationEdges;for(;e.next();){const s=e.value.toVertex;this.wF(s)}this.E3(t),this.U3(t)}}E3(t){const e=this.network.vertexes.iterator;for(;e.next();){const r=e.value;r.component=-1}const i=0,s=1,n=t.So;let o=n.length;for(let r=0;r<o;r++){const l=n[r],a=l.fromVertex,h=l.toVertex,c=this.linkMinLength(l);a.layer-h.layer>c&&this.Cw(a,i,-1,!0,!1)}for(this.Cw(t,s,-1,!0,!0);t.component!==i;){let r=0,l=1/0,a=0,h=null;const c=this.network.vertexes.iterator;for(;c.next();){const f=c.value;if(f.component===s){let u=0,d=!1;const m=f.So;o=m.length;for(let p=0;p<o;p++){const y=m[p],x=y.fromVertex;if(u+=this.linkLengthWeight(y),x.component!==s){r+=this.linkLengthWeight(y);const b=x.layer-f.layer,k=this.linkMinLength(y);l=Math.min(l,b-k)}}const g=f.or;o=g.length;for(let p=0;p<o;p++){const y=g[p],x=y.toVertex;u-=this.linkLengthWeight(y),x.component!==s?r-=this.linkLengthWeight(y):d=!0}(h===null||u<a)&&!d&&(h=f,a=u)}}if(r>0){for(e.reset();e.next();){const f=e.value;f.component===s&&(f.layer+=l)}t.component=i}else h.component=i}}U3(t){const e=this.network.vertexes.iterator;for(;e.next();){const n=e.value;n.component=-1}const i=0,s=1;for(this.Cw(t,s,-1,!0,!1);t.component!==i;){let n=0,o=1/0,r=0,l=null;const a=this.network.vertexes.iterator;for(;a.next();){const h=a.value;if(h.component===s){let c=0,f=!1;const u=h.So;let d=u.length;for(let g=0;g<d;g++){const p=u[g],y=p.fromVertex;c+=this.linkLengthWeight(p),y.component!==s?n+=this.linkLengthWeight(p):f=!0}const m=h.or;d=m.length;for(let g=0;g<d;g++){const p=m[g],y=p.toVertex;if(c-=this.linkLengthWeight(p),y.component!==s){n-=this.linkLengthWeight(p);const x=h.layer-y.layer,b=this.linkMinLength(p);o=Math.min(o,x-b)}}(l===null||c>r)&&!f&&(l=h,r=c)}}if(n<0){for(e.reset();e.next();){const h=e.value;h.component===s&&(h.layer-=o)}t.component=i}else l.component=i}}N3(){const t=this.network,e=[],i=t.edges.iterator;for(;i.next();){const s=i.value;s.valid=!1,e.push(s)}for(let s=0;s<e.length;s++){const n=e[s];let o=n.fromVertex;const r=n.toVertex;if(n.valid||(o.node===null&&o.data===null||r.node===null&&r.data===null)&&o.layer===r.layer)continue;let l=0,a=0,h=0,c=0;if(n.link!==null){const P=n.link;if(P===null)continue;const S=o.node,L=r.node;if(S===null||L===null)continue;let C=P.fromNode,M=P.toNode,N=P.fromPort;for(;N!==null&&!N.isVisibleObject();)N=N.panel;let A=P.toPort;for(;A!==null&&!A.isVisibleObject();)A=A.panel;if(n.rev){const z=C,Y=N;C=M,N=A,M=z,A=Y}const T=o.focus,D=r.focus,v=n.rev?r.bounds:o.bounds,R=Point.l();S!==C?v.isReal()&&C.isVisible()?C.actualBounds.isReal()?(C.getRelativePoint(N,Spot.Center,R),R.x+=C.actualBounds.x-v.x,R.y+=C.actualBounds.y-v.y):(C.getRelativePoint(N,Spot.Center,R),R.isReal()||R.h(T)):R.h(T):v.isReal()?(C.getRelativePoint(N,Spot.Center,R),R.isReal()||R.h(T)):R.h(T);const F=n.rev?o.bounds:r.bounds,O=Point.l();L!==M?F.isReal()&&M.isVisible()?M.actualBounds.isReal()?(M.getRelativePoint(A,Spot.Center,O),O.x+=M.actualBounds.x-F.x,O.y+=M.actualBounds.y-F.y):(M.getRelativePoint(A,Spot.Center,O),O.isReal()||O.h(D)):O.h(D):F.isReal()?(M.getRelativePoint(A,Spot.Center,O),O.isReal()||O.h(D)):O.h(D),this.P===90||this.P===270?(l=Math.round((R.x-T.x)/this.ti),h=R.x,a=Math.round((O.x-D.x)/this.ti),c=O.x):(l=Math.round((R.y-T.y)/this.ti),h=R.y,a=Math.round((O.y-D.y)/this.ti),c=O.y),Point.i(R),Point.i(O),n.portFromColOffset=l,n.portFromPos=h,n.portToColOffset=a,n.portToPos=c}else n.portFromColOffset=0,n.portFromPos=0,n.portToColOffset=0,n.portToPos=0;let f=o.layer;const u=r.layer,d=this.V3(n),m=d===1||d===3,g=d===2||d===3;let p,y,x=null,b;g&&(x=this.B3(o,r),b=1,y=t.createVertex(),y.node=null,y._k=1,y.layer=f,y.near=o,t.addVertex(y),p=t.linkVertexes(o,y,n.link),p.valid=!1,p.rev=n.rev,p.portFromColOffset=l,p.portToColOffset=0,p.portFromPos=h,p.portToPos=0,o=y);let k=1;if(m&&k--,f-u>k&&f>0){for(n.valid=!1,y=t.createVertex(),y.node=null,y._k=2,y.layer=f-1,x&&b<x.length&&y.layer===x[b].layer&&(y.near=x[b++]),t.addVertex(y),p=t.linkVertexes(o,y,n.link),p.valid=!0,p.rev=n.rev,p.portFromColOffset=g?0:l,p.portToColOffset=0,p.portFromPos=g?0:h,p.portToPos=0,o=y,f--;f-u>k&&f>0;)y=t.createVertex(),y.node=null,y._k=3,y.layer=f-1,x&&b<x.length&&y.layer===x[b].layer&&(y.near=x[b++]),t.addVertex(y),p=t.linkVertexes(o,y,n.link),p.valid=!0,p.rev=n.rev,p.portFromColOffset=0,p.portToColOffset=0,p.portFromPos=0,p.portToPos=0,o=y,f--;p=t.linkVertexes(y,r,n.link),p.valid=!m,m&&(y.near=r),p.rev=n.rev,p.portFromColOffset=0,p.portToColOffset=a,p.portFromPos=0,p.portToPos=c}else n.valid=!0}}V3(t){let e=0;const i=t.link;if(i!==null){const s=i.fromPort,n=i.toPort;if(s!==null&&n!==null){const o=i.fromNode,r=i.toNode;if(o!==null&&r!==null){const l=this.tP(!0),a=this.tP(!1),h=this.setsPortSpots?l:i.computeSpot(!0,s),c=this.setsPortSpots?a:i.computeSpot(!1,n),f=i.isOrthogonal;if(h.isSide()&&h.includesSide(a)&&c.isSide()&&c.includesSide(l))return 0;const u=i.getLinkPoint(o,s,h,!0,f,r,n,Point.l()),d=i.getLinkDirection(o,s,u,h,!0,f,r,n);Point.i(u),(!h.isNone()&&d===this.xF(t,!0)||this.setsPortSpots&&o!==null&&o.ports.count===1&&t.rev)&&(e+=1);const m=i.getLinkPoint(r,n,c,!1,f,o,s,Point.l()),g=i.getLinkDirection(r,n,m,c,!1,f,o,s);Point.i(m),(!c.isNone()&&g===this.xF(t,!1)||this.setsPortSpots&&r!==null&&r.ports.count===1&&t.rev)&&(e+=2)}}}return e}xF(t,e){return this.P===90?e&&!t.rev||!e&&t.rev?270:90:this.P===180?e&&!t.rev||!e&&t.rev?0:180:this.P===270?e&&!t.rev||!e&&t.rev?90:270:e&&!t.rev||!e&&t.rev?180:0}B3(t,e){const i=[];return i.push(e),this.bF(t,i)?i.reverse():[]}bF(t,e){const i=e[e.length-1].sourceEdges.iterator;for(;i.next();){const s=i.value;if(s.rev||!s.valid)continue;const n=s.fromVertex;if(e.push(n),n===t||this.bF(t,e))return!0;e.pop()}return!1}C3(){this.ie.length!==this._+1&&(this.ie=new Int16Array(this._+1));const t=this.ie;for(let i=0;i<=this._;i++)t[i]=0;const e=this.network.vertexes.iterator;for(;e.next();){const i=e.value;i.index=-1}this.initializeIndices(),this.Sw=-1,this.qg=0,this.Vs=0;for(let i=0;i<=this._;i++)t[i]>t[this.Vs]&&(this.Sw=t[i]-1,this.Vs=i),t[i]<t[this.qg]&&(this.qg=i);this.gu=[];for(let i=0;i<t.length;i++)this.gu[i]=[];for(e.reset();e.next();){const i=e.value,s=i.layer,n=this.gu[s];n[i.index]=i}}initializeIndices(){switch(this.fu){default:case 22:this.z3();break;case 20:this.X3();break;case 21:this.G3();break}}z3(){let t=null;const e=this.network.vertexes.iterator;for(;e.next();){const i=e.value;if(i.near&&(t===null&&(t=new Map),i.layer===i.near.layer)){const s=t.get(i.near)||[];s.push(i),t.set(i.near,s)}}for(e.reset();e.next();){const i=e.value;if(i.near)continue;const s=i.layer;if(i.index=this.ie[s],this.ie[s]++,!t)continue;const n=t.get(i);Array.isArray(n)&&n.forEach(o=>{o.index=this.ie[s],this.ie[s]++})}}X3(){let t=null;const e=this.network.vertexes.iterator;for(;e.next();){const i=e.value;if(i.near&&(t===null&&(t=new Map),i.layer===i.near.layer)){const s=t.get(i.near)||[];s.push(i),t.set(i.near,s)}}for(let i=this._;i>=0;i--)for(e.reset();e.next();){const s=e.value;s.layer===i&&s.index===-1&&this.kF(s,t)}}kF(t,e){if(t.near)return;const i=t.layer;if(t.index=this.ie[i],this.ie[i]++,e){const o=e.get(t);Array.isArray(o)&&o.forEach(r=>{r.index=this.ie[i],this.ie[i]++})}const s=t.or;let n=!0;for(;n;){n=!1;for(let o=0;o<s.length-1;o++){const r=s[o],l=s[o+1];r.portFromColOffset>l.portFromColOffset&&(n=!0,s[o]=l,s[o+1]=r)}}for(let o=0;o<s.length;o++){const r=s[o];if(r.valid){const l=r.toVertex;l.index===-1&&this.kF(l,e)}}}G3(){let t=null;const e=this.network.vertexes.iterator;for(;e.next();){const i=e.value;if(i.near&&(t===null&&(t=new Map),i.layer===i.near.layer)){const s=t.get(i.near)||[];s.push(i),t.set(i.near,s)}}for(let i=0;i<=this._;i++)for(e.reset();e.next();){const s=e.value;s.layer===i&&s.index===-1&&this.PF(s,t)}}PF(t,e){if(t.near)return;const i=t.layer;if(t.index=this.ie[i],this.ie[i]++,e){const a=e.get(t);Array.isArray(a)&&a.forEach(h=>{h.index=this.ie[i],this.ie[i]++})}const s=t.So;let n=!0,o=0;for(;n;)for(n=!1,o=0;o<s.length-1;o++){const a=s[o],h=s[o+1];a.portToColOffset>h.portToColOffset&&(n=!0,s[o]=h,s[o+1]=a)}let r,l;for(o=0;o<s.length;o++)l=s[o],l.valid&&(r=l.fromVertex,r.index===-1&&this.PF(r,e))}L3(){this.zt=-1;for(let t=0;t<=this._;t++){const e=this.ja(t);let i=0;const s=this.ie[t];for(let n=0;n<s;n++){const o=e[n];i+=this.nodeMinColumnSpace(o,!0),o.column=i,i+=1,i+=this.nodeMinColumnSpace(o,!1)}this.zt=Math.max(this.zt,i-1),this.Wa(t,e)}}reduceCrossings(){let t=this.countCrossings(),e=this.ei(),i=0,s=0,n=0;for(i=0;i<this.gc;i++){for(s=0;s<=this._;s++)this.eP(s,1),this.ys(s,1,!1,1);for(n=this.countCrossings(),n<t&&(t=n,e=this.ei()),s=this._;s>=0;s--)this.eP(s,-1),this.ys(s,-1,!1,-1);n=this.countCrossings(),n<t&&(t=n,e=this.ei())}for(this.ns(e),i=0;i<this.gc;i++){for(s=0;s<=this._;s++)this.eP(s,0),this.ys(s,0,!1,0);for(n=this.countCrossings(),n<t&&(t=n,e=this.ei()),s=this._;s>=0;s--)this.eP(s,0),this.ys(s,0,!1,0);n=this.countCrossings(),n<t&&(t=n,e=this.ei())}this.ns(e);let o=!1,r=0,l=0,a=0,h=0;switch(this.uu){case 30:break;case 32:for(a=t+1;(h=this.countCrossings())<a;)for(a=h,r=this._;r>=0;r--)for(l=0;l<=r;l++){for(o=!0;o;)for(o=!1,s=r;s>=l;s--)o=this.ys(s,-1,!1,-1)||o;for(n=this.countCrossings(),n>=t?this.ns(e):(t=n,e=this.ei()),o=!0;o;)for(o=!1,s=r;s>=l;s--)o=this.ys(s,1,!1,1)||o;for(n=this.countCrossings(),n>=t?this.ns(e):(t=n,e=this.ei()),o=!0;o;)for(o=!1,s=l;s<=r;s++)o=this.ys(s,1,!1,1)||o;for(n>=t?this.ns(e):(t=n,e=this.ei()),o=!0;o;)for(o=!1,s=l;s<=r;s++)o=this.ys(s,-1,!1,-1)||o;for(n>=t?this.ns(e):(t=n,e=this.ei()),o=!0;o;)for(o=!1,s=r;s>=l;s--)o=this.ys(s,0,!1,0)||o;for(n>=t?this.ns(e):(t=n,e=this.ei()),o=!0;o;)for(o=!1,s=l;s<=r;s++)o=this.ys(s,0,!1,0)||o;n>=t?this.ns(e):(t=n,e=this.ei())}break;default:case 31:for(r=this._,l=0,a=t+1;(h=this.countCrossings())<a;){for(a=h,o=!0;o;)for(o=!1,s=r;s>=l;s--)o=this.ys(s,-1,!1,-1)||o;for(n=this.countCrossings(),n>=t?this.ns(e):(t=n,e=this.ei()),o=!0;o;)for(o=!1,s=r;s>=l;s--)o=this.ys(s,1,!1,1)||o;for(n=this.countCrossings(),n>=t?this.ns(e):(t=n,e=this.ei()),o=!0;o;)for(o=!1,s=l;s<=r;s++)o=this.ys(s,1,!1,1)||o;for(n>=t?this.ns(e):(t=n,e=this.ei()),o=!0;o;)for(o=!1,s=l;s<=r;s++)o=this.ys(s,-1,!1,-1)||o;for(n>=t?this.ns(e):(t=n,e=this.ei()),o=!0;o;)for(o=!1,s=r;s>=l;s--)o=this.ys(s,0,!1,0)||o;for(n>=t?this.ns(e):(t=n,e=this.ei()),o=!0;o;)for(o=!1,s=l;s<=r;s++)o=this.ys(s,0,!1,0)||o;n>=t?this.ns(e):(t=n,e=this.ei())}break}this.ns(e)}eP(t,e){let i=0,s=!1;const n=this.ja(t),o=this.ie[t],r=this.uF(t,e),l=this.Nw(t,e);for(i=0;i<o;i++)l[i]===-1&&(l[i]=n[i].column),r[i]===-1&&(r[i]=n[i].column);let a=!0,h;for(;a;)for(a=!1,i=0;i<o-1;i++)if(r[i+1]<r[i]||r[i+1]===r[i]&&l[i+1]<l[i]){s=!0,a=!0;const f=r[i];r[i]=r[i+1],r[i+1]=f;const u=l[i];l[i]=l[i+1],l[i+1]=u,h=n[i],n[i]=n[i+1],n[i+1]=h}let c=0;for(i=0;i<o;i++)h=n[i],h.index=i,c+=this.nodeMinColumnSpace(h,!0),h.column=c,c+=1,c+=this.nodeMinColumnSpace(h,!1);return this.Wa(t,n),s}ys(t,e,i,s){const n=this.ja(t),o=this.ie[t],r=this.fF(t,e);let l=0,a;if(!i||s>0)for(a=new Float32Array(o),l=0;l<o;l++)a[l]=-1;else a=this.Nw(t,-1);let h;if(!i||s<0)for(h=new Float32Array(o),l=0;l<o;l++)h[l]=-1;else h=this.Nw(t,1);let c=!1,f=!0;for(;f;)for(f=!1,l=0;l<o-1;l++){const u=r[n[l].index*o+n[l+1].index],d=r[n[l+1].index*o+n[l].index];let m=0,g=0;const p=n[l].column,y=n[l+1].column,x=this.nodeMinColumnSpace(n[l],!0),b=this.nodeMinColumnSpace(n[l],!1),k=this.nodeMinColumnSpace(n[l+1],!0),P=this.nodeMinColumnSpace(n[l+1],!1),S=p-x+k,L=y-b+P;let C=0,M=0,N=0,A=0,T=0,D=0,v=0,R,F=0,O,z=0;const Y=n[l].sourceEdges.iterator;if(i&&s<=0)for(;Y.next();){const J=Y.value;R=J.fromVertex,J.valid&&R.layer!==t&&(N=this.linkStraightenWeight(J),A=J.portFromColOffset,T=J.portToColOffset,D=R.column,C+=(Math.abs(p+T-(D+A))+1)*N,M+=(Math.abs(L+T-(D+A))+1)*N)}for(Y.reset();Y.next();){const J=Y.value;if(R=J.fromVertex,J.valid&&R.layer===t){for(F=0;F<n.length&&n[F]!==R;)F++;F<l&&(m+=2*(l-F),g+=2*(l+1-F)),F===l+1&&(m+=1),F>l+1&&(m+=4*(F-l),g+=4*(F-(l+1)))}}const E=n[l].destinationEdges.iterator;if(i&&s>=0)for(;E.next();){const J=E.value;O=J.toVertex,J.valid&&O.layer!==t&&(N=this.linkStraightenWeight(J),A=J.portFromColOffset,T=J.portToColOffset,v=O.column,C+=(Math.abs(p+A-(v+T))+1)*N,M+=(Math.abs(L+A-(v+T))+1)*N)}for(E.reset();E.next();){const J=E.value;if(O=J.toVertex,J.valid&&O.layer===t){for(z=0;z<n.length&&n[z]!==O;)z++;z===l+1&&(g+=1)}}const X=n[l+1].sourceEdges.iterator;if(i&&s<=0)for(;X.next();){const J=X.value;R=J.fromVertex,J.valid&&R.layer!==t&&(N=this.linkStraightenWeight(J),A=J.portFromColOffset,T=J.portToColOffset,D=R.column,C+=(Math.abs(y+T-(D+A))+1)*N,M+=(Math.abs(S+T-(D+A))+1)*N)}for(X.reset();X.next();){const J=X.value;if(R=J.fromVertex,J.valid&&R.layer===t){for(F=0;F<n.length&&n[F]!==R;)F++;F<l&&(m+=2*(l+1-F),g+=2*(l-F)),F===l&&(g+=1),F>l+1&&(m+=4*(F-(l+1)),g+=4*(F-l))}}const B=n[l+1].destinationEdges.iterator;if(i&&s>=0)for(;B.next();){const J=B.value;O=J.toVertex,J.valid&&O.layer!==t&&(N=this.linkStraightenWeight(J),A=J.portFromColOffset,T=J.portToColOffset,v=O.column,C+=(Math.abs(y+A-(v+T))+1)*N,M+=(Math.abs(S+A-(v+T))+1)*N)}for(B.reset();B.next();){const J=B.value;if(O=J.toVertex,J.valid&&O.layer===t){for(z=0;z<n.length&&n[z]!==O;)z++;z===l&&(m+=1)}}let H=0,q=0;const W=a[n[l].index],Z=h[n[l].index],V=a[n[l+1].index],$=h[n[l+1].index];if(W!==-1&&(H+=Math.abs(W-p),q+=Math.abs(W-L)),Z!==-1&&(H+=Math.abs(Z-p),q+=Math.abs(Z-L)),V!==-1&&(H+=Math.abs(V-y),q+=Math.abs(V-S)),$!==-1&&(H+=Math.abs($-y),q+=Math.abs($-S)),g<m-.5||g===m&&d<u-.5||g===m&&d===u&&M<C-.5||g===m&&d===u&&M===C&&q<H-.5){c=!0,f=!0,n[l].column=L,n[l+1].column=S;const J=n[l];n[l]=n[l+1],n[l+1]=J}}for(l=0;l<o;l++)n[l].index=l;return this.Wa(t,n),c}straightenAndPack(){if(this.Xn!==0){this.Y3();return}let t=0,e=!1,i=(this.hr&1)!==0;const s=(this.hr&8)!==0;if(this.network.edges.count>1e3&&s&&(i=!1),i){const n=[];let o=0;for(o=0;o<=this._;o++)n[o]=0;let r=0;const l=this.network.vertexes.iterator;for(;l.next();){const h=l.value;t=h.layer,r=h.column;const c=this.nodeMinColumnSpace(h,!1);n[t]=Math.max(n[t],r+c)}const a=8;for(l.reset();l.next();){const h=l.value;t=h.layer,r=h.column,h.column=((this.zt-n[t])*a>>1)+r*a}this.zt*=a}if((this.hr&2)!==0){e=!0;let n=0;for(;e&&n<this.du;){for(e=!1,t=this.Vs+1;t<=this._;t++)e=this.Jg(t,1)||e;for(t=this.Vs-1;t>=0;t--)e=this.Jg(t,-1)||e;e=this.Jg(this.Vs,0)||e,n++}}if((this.hr&4)!==0){for(t=this.Vs+1;t<=this._;t++)this.yL(t,1);for(t=this.Vs-1;t>=0;t--)this.yL(t,-1);this.yL(this.Vs,0)}if(i&&(this.SF(-1),this.SF(1)),(this.hr&2)!==0){e=!0;let n=0;for(;e&&n<this.du;){for(e=!1,e=this.Jg(this.Vs,0)||e,t=this.Vs+1;t<=this._;t++)e=this.Jg(t,0)||e;for(t=this.Vs-1;t>=0;t--)e=this.Jg(t,0)||e;n++}}}Jg(t,e){let i=!1;for(;this.K3(t,e);)i=!0;return i}K3(t,e){let i=0;const s=this.ja(t),n=this.ie[t],o=this.Nw(t,-1);if(e>0)for(i=0;i<n;i++)o[i]=-1;const r=this.Nw(t,1);if(e<0)for(i=0;i<n;i++)r[i]=-1;let l=!1,a=!0;for(;a;)for(a=!1,i=0;i<n;i++){const h=s[i].column,c=this.nodeMinColumnSpace(s[i],!0),f=this.nodeMinColumnSpace(s[i],!1);let u=0;i-1<0||h-s[i-1].column-1>c+this.nodeMinColumnSpace(s[i-1],!1)?u=h-1:u=h;let d=0;i+1>=n||s[i+1].column-h-1>f+this.nodeMinColumnSpace(s[i+1],!0)?d=h+1:d=h;let m=0,g=0,p=0,y=0,x=0,b=0;if(e<=0){const M=s[i].sourceEdges.iterator;for(;M.next();){const N=M.value,A=N.fromVertex;if(N.valid&&A.layer!==t){y=this.linkStraightenWeight(N),x=N.portFromColOffset,b=N.portToColOffset;const T=A.column;m+=(Math.abs(h+b-(T+x))+1)*y,g+=(Math.abs(u+b-(T+x))+1)*y,p+=(Math.abs(d+b-(T+x))+1)*y}}}if(e>=0){const M=s[i].destinationEdges.iterator;for(;M.next();){const N=M.value,A=N.toVertex;if(N.valid&&A.layer!==t){y=this.linkStraightenWeight(N),x=N.portFromColOffset,b=N.portToColOffset;const T=A.column;m+=(Math.abs(h+x-(T+b))+1)*y,g+=(Math.abs(u+x-(T+b))+1)*y,p+=(Math.abs(d+x-(T+b))+1)*y}}}let k=0,P=0,S=0;const L=o[s[i].index],C=r[s[i].index];L!==-1&&(k+=Math.abs(L-h),P+=Math.abs(L-u),S+=Math.abs(L-d)),C!==-1&&(k+=Math.abs(C-h),P+=Math.abs(C-u),S+=Math.abs(C-d)),g<m||g===m&&P<k?(l=!0,a=!0,s[i].column=u):(p<m||p===m&&S<k)&&(l=!0,a=!0,s[i].column=d)}return this.Wa(t,s),this.Mw(),l}yL(t,e){let i=0;const s=this.ja(t),n=this.ie[t],o=this.uF(t,e),r=new Int16Array(o);let l=!1,a=!0;for(;a;)for(a=!1,i=0;i<n;i++){const h=s[i].column,c=this.nodeMinColumnSpace(s[i],!0),f=this.nodeMinColumnSpace(s[i],!1);let u=0,d=0,m=0,g=0,p=0;r[i]===-1?i===0&&i===n-1?u=h:i===0?(d=s[i+1].column,d-h===f+this.nodeMinColumnSpace(s[i+1],!0)?u=h-1:u=h):i===n-1?(m=s[i-1].column,h-m===c+this.nodeMinColumnSpace(s[i-1],!1)?u=h+1:u=h):(m=s[i-1].column,p=m+this.nodeMinColumnSpace(s[i-1],!1)+c+1,d=s[i+1].column,g=d-this.nodeMinColumnSpace(s[i+1],!0)-f-1,u=(p+g)/2|0):i===0&&i===n-1?u=r[i]:i===0?(d=s[i+1].column,g=d-this.nodeMinColumnSpace(s[i+1],!0)-f-1,u=Math.min(r[i],g)):i===n-1?(m=s[i-1].column,p=m+this.nodeMinColumnSpace(s[i-1],!1)+c+1,u=Math.max(r[i],p)):(m=s[i-1].column,p=m+this.nodeMinColumnSpace(s[i-1],!1)+c+1,d=s[i+1].column,g=d-this.nodeMinColumnSpace(s[i+1],!0)-f-1,p<r[i]&&r[i]<g?u=r[i]:p>=r[i]?u=p:g<=r[i]&&(u=g)),u!==h&&(l=!0,a=!0,s[i].column=u)}return this.Wa(t,s),this.Mw(),l}H3(){for(let t=0;t<=this.zt;t++)for(;this.q3(t,1););this.Mw()}q3(t,e){let i=!0;const s=this.network.vertexes.iterator;for(;s.next();){const o=s.value,r=this.nodeMinColumnSpace(o,!0),l=this.nodeMinColumnSpace(o,!1);if(o.column-r<=t&&o.column+l>=t){i=!1;break}}let n=!1;if(i){if(e>0)for(s.reset();s.next();){const o=s.value;o.column>t&&(o.column-=1,n=!0)}if(e<0)for(s.reset();s.next();){const o=s.value;o.column<t&&(o.column+=1,n=!0)}}return n}j3(){this.H3();for(let t=0;t<this.zt;t++)for(;this.W3(t,1););this.Mw()}W3(t,e){let i=t;e>0&&(i=t+1),e<0&&(i=t-1);let s=0;const n=[],o=[];for(s=0;s<=this._;s++)n[s]=!1,o[s]=!1;const r=this.network.vertexes.iterator;for(;r.next();){const h=r.value,c=h.column-this.nodeMinColumnSpace(h,!0),f=h.column+this.nodeMinColumnSpace(h,!1);c<=t&&f>=t&&(n[h.layer]=!0),c<=i&&f>=i&&(o[h.layer]=!0)}let l=!0,a=!1;for(s=0;s<=this._;s++)l=l&&!(n[s]&&o[s]);if(l){if(e>0)for(r.reset();r.next();){const h=r.value;h.column>t&&(h.column-=1,a=!0)}if(e<0)for(r.reset();r.next();){const h=r.value;h.column<t&&(h.column+=1,a=!0)}}return a}SF(t){this.j3();let e=0,i,s=0,n=0,o=0;if(t>0)for(e=0;e<=this.zt;e++)for(i=this.ei(),s=this.Qk(!0),n=s+1;s<n;)n=s,this.MF(e,1),o=this.Qk(!0),o>s?this.ns(i):o<s&&(s=o,i=this.ei());if(t<0)for(e=this.zt;e>=0;e--)for(i=this.ei(),s=this.Qk(!0),n=s+1;s<n;)n=s,this.MF(e,-1),o=this.Qk(!0),o>s?this.ns(i):o<s&&(s=o,i=this.ei());this.Mw()}MF(t,e){this.cn=0;const i=this.network.vertexes.iterator;for(;i.next();){const c=i.value;c.component=-1}if(e>0)for(i.reset();i.next();){const c=i.value;c.column-this.nodeMinColumnSpace(c,!0)<=t&&(c.component=this.cn)}if(e<0)for(i.reset();i.next();){const c=i.value;c.column+this.nodeMinColumnSpace(c,!1)>=t&&(c.component=this.cn)}for(this.cn++,i.reset();i.next();){const c=i.value;c.component===-1&&(this.mL(c,this.cn,-1,!0,!0),this.cn++)}let s=0;const n=[];for(s=0;s<this.cn*this.cn;s++)n[s]=!1;const o=[];for(s=0;s<(this._+1)*(this.zt+1);s++)o[s]=-1;for(i.reset();i.next();){const c=i.value,f=c.layer,u=Math.max(0,c.column-this.nodeMinColumnSpace(c,!0)),d=Math.min(this.zt,c.column+this.nodeMinColumnSpace(c,!1));for(let m=u;m<=d;m++)o[f*(this.zt+1)+m]=c.component}for(let c=0;c<=this._;c++){if(e>0)for(let f=0;f<this.zt;f++)o[c*(this.zt+1)+f]!==-1&&o[c*(this.zt+1)+f+1]!==-1&&o[c*(this.zt+1)+f]!==o[c*(this.zt+1)+f+1]&&(n[o[c*(this.zt+1)+f]*this.cn+o[c*(this.zt+1)+f+1]]=!0);if(e<0)for(let f=this.zt;f>0;f--)o[c*(this.zt+1)+f]!==-1&&o[c*(this.zt+1)+f-1]!==-1&&o[c*(this.zt+1)+f]!==o[c*(this.zt+1)+f-1]&&(n[o[c*(this.zt+1)+f]*this.cn+o[c*(this.zt+1)+f-1]]=!0)}const r=[];for(s=0;s<this.cn;s++)r[s]=!0;const l=[];l.push(0);let a=0;for(;l.length!==0;)if(a=l[l.length-1],l.pop(),r[a])for(r[a]=!1,s=0;s<this.cn;s++)n[a*this.cn+s]&&l.splice(0,0,s);let h=!1;if(e>0)for(i.reset();i.next();){const c=i.value;r[c.component]&&(c.column-=1,h=!0)}if(e<0)for(i.reset();i.next();){const c=i.value;r[c.component]&&(c.column+=1,h=!0)}return h}Y3(){const t=U.nt(),e=this.gu.length;for(let u=0;u<=e;u++)t[u]=[];const i=this.network.vertexes.iterator;for(;i.next();){const u=i.value,d=e-u.layer,m=t[d];m[u.index]=u}const s=new GSet;this.J3(t,s);let n=null,o=null,r=null,l=null;const a=(this.Xn&1)!==0,h=(this.Xn&2)!==0,c=(this.Xn&4)!==0,f=(this.Xn&8)!==0;a&&(this.al(t,s,!0),n=this.iP(t,!0,!1)),t.reverse(),c&&(this.al(t,s,!1),r=this.iP(t,!1,!1));for(const u of t)u.reverse();f&&(this.al(t,s,!1),l=this.iP(t,!1,!0)),t.reverse(),h&&(this.al(t,s,!0),o=this.iP(t,!0,!0)),U.Z(t),this.$3(n,o,r,l),this.network.vertexes.each(u=>{const d=u,m=U.nt();a&&m.push(n.get(d)),h&&m.push(o.get(d)),c&&m.push(r.get(d)),f&&m.push(l.get(d)),m.sort((b,k)=>b-k);const g=m.length,p=Math.floor((g-1)/2),y=Math.ceil((g-1)/2),x=(m[p]+m[y])/2;U.Z(m),d.mi=x})}J3(t,e){const i=t.length;for(let s=1;s<i-1;s++){let n=0,o=0;const r=t[s],l=t[s+1];for(let a=0;o<l.length;a++){const h=l[a],c=this.Z3(h);if(a===l.length-1||c){let f=r.length-1;for(c&&(f=h.getProperSourceVertexes()[0].index);o<=a;){const d=l[o].getProperSourceEdges();for(const m of d){const p=m.fromVertex.index;(p<n||p>f)&&e.add(m)}o++}n=f}}}}Z3(t){if(t.node===null){const e=t.getProperSourceVertexes();if(e.length>0)return e[0].node===null}return!1}al(t,e,i){this.Q3(t);for(const s of t){let n=-1;for(const o of s){const r=i?o.getProperSourceVertexes():o.getProperDestinationVertexes(),l=r.length;if(l>0){r.sort((h,c)=>h.Ja-c.Ja);const a=(l-1)/2;for(let h=Math.floor(a),c=Math.ceil(a);h<=c;h++)if(o.Gn===o){const f=r[h];let u;i?u=f.getDestinationEdge(o):u=o.getDestinationEdge(f),!e.has(u)&&n<f.Ja&&(f.Gn=o,o.mc=f.mc,o.Gn=f.mc,n=f.Ja)}}}}}Q3(t){for(let e=0;e<t.length;e++){const i=t[e];for(let s=0;s<i.length;s++){const n=i[s];n.mc=n,n.Gn=n,n.NF=e,n.Ja=s}}}iP(t,e,i){const s=this.P===90||this.P===270;for(const o of t)for(const r of o)r.os=r,r.pu=1/0,r.mi=NaN,r.Yn=0;this._3(t,e,i);for(const o of t)for(const r of o)r.mc===r&&this.CF(r,t);for(let o=0;o<t.length;o++){if(t[o].length<=0)continue;const r=t[o][0];if(r.os===r){r.os.pu===1/0&&(r.os.pu=0);let l=o,a=0,h;do{for(h=t[l][a];h.Gn!==h.mc;)if(h=h.Gn,l++,h.Ja>0){const c=this.LF(h,t),f=s?c.width:c.height,u=h.os.pu+h.mi+h.Yn-(c.mi+c.Yn+f+this.columnSpacing);c.os.pu=Math.min(c.os.pu,u)}a=h.Ja+1}while(l<t.length&&a<t[l].length&&h.os===t[l][a].os)}}const n=new GMap;for(const o of t)for(const r of o){r.mi=r.mi+r.os.pu+r.Yn;const l=s?r.width:r.height;n.set(r,i?-r.mi-l:r.mi)}return n}_3(t,e,i){const s=this.P===90||this.P===270;for(const n of t)for(const o of n)if(o.mc===o){let r=0,l=o;for(;l.Gn!==o;){const a=l.Gn,h=s?l.width:l.height,c=s?a.width:a.height;let f,u,d,m;e?(d=l.getDestinationEdge(a),f=d.portFromPos,u=d.portToPos,d.link!==null&&(l.node&&l.node!==d.link.fromNode&&(f=s?l.focusX:l.focusY),a.node&&a.node!==d.link.toNode&&(u=s?a.focusX:a.focusY)),i?m=l.Yn+(h-f)-(c-u):m=l.Yn+f-u):(d=a.getDestinationEdge(l),f=d.portToPos,u=d.portFromPos,d.link!==null&&(l.node&&l.node!==d.link.toNode&&(f=s?l.focusX:l.focusY),a.node&&a.node!==d.link.fromNode&&(u=s?a.focusX:a.focusY)),i?m=l.Yn+(h-f)-(c-u):m=l.Yn+f-u),a.Yn=m,r=Math.min(r,m),l=l.Gn}l=o;do l.Yn=l.Yn-r,l=l.Gn;while(l!==o)}}CF(t,e){if(!isNaN(t.mi))return;t.mi=0;let i=t;do{if(i.Ja>0){const s=this.LF(i,e),n=s.mc;this.CF(n,e),t.os===t&&(t.os=n.os);const o=this.P===90||this.P===270?s.width:s.height;if(t.os===n.os){const r=n.mi+s.Yn+o-i.Yn+this.columnSpacing;t.mi=Math.max(t.mi,r)}}i=i.Gn}while(i!==t);for(;i.Gn!==t;)i=i.Gn,i.mi=t.mi,i.os=t.os}LF(t,e){const i=t.NF,s=t.Ja;return s<1&&U.o("Could not determine previous vertex in layer"),e[i][s-1]}$3(...t){let e=-1;const i=U.nt(),s=U.nt();let n=1/0;for(let o=0;o<4;o++){if(!t[o])continue;const r=this.tU(t[o],i,s,o);r<n&&(e=o,n=r)}for(let o=0;o<4;o++){const r=t[o];if(!r)continue;const l=o===0||o===2?i[e]-i[o]:s[e]-s[o];l!==0&&r.each(a=>{r.set(a.key,a.value+l)})}U.Z(i),U.Z(s)}tU(t,e,i,s){if(!t||t.count===0)return e[s]=0,i[s]=0,1/0;let n=1/0,o=-1/0;return t.each(r=>{const l=r.key,a=r.value,h=this.P===90||this.P===270?l.width:l.height;a<n&&(n=a),a+h>o&&(o=a+h)}),e[s]=n,i[s]=o,o-n}commitLayout(){this.Pw(),this.commitNodes(),this.wL(),this.isRouting&&this.commitLinks()}Pw(){if(!this.setsPortSpots)return;const t=this.tP(!0),e=this.tP(!1),i=this.network.edges.iterator;for(;i.next();){const n=i.value.link;n!==null&&(n.fromSpot=t,n.toSpot=e)}}tP(t){return this.P===270?t?Spot.MiddleTop:Spot.MiddleBottom:this.P===90?t?Spot.MiddleBottom:Spot.MiddleTop:this.P===180?t?Spot.MiddleLeft:Spot.MiddleRight:t?Spot.MiddleRight:Spot.MiddleLeft}commitNodes(){this.Bs.length!==this._+1&&(this.Bs=new Float32Array(this._+1)),this.ms.length!==this._+1&&(this.ms=new Float32Array(this._+1)),this.ps.length!==this._+1&&(this.ps=new Float32Array(this._+1)),this.Rt.length!==this._+1&&(this.Rt=new Float32Array(this._+1));for(let d=0;d<=this._;d++)this.Bs[d]=0,this.ms[d]=0,this.ps[d]=0,this.Rt[d]=0;const t=this.network.vertexes.iterator;for(;t.next();){const d=t.value,m=d.layer;this.Bs[m]=Math.max(this.Bs[m],this.nodeMinLayerSpace(d,!0)),this.ms[m]=Math.max(this.ms[m],this.nodeMinLayerSpace(d,!1))}let e=0;const i=this.Us;for(let d=0;d<=this._;d++){let m=i;this.Bs[d]+this.ms[d]<=0&&(m=0),d>0&&(e+=m/2),this.P===90||this.P===0?(e+=this.ms[d],this.ps[d]=e,e+=this.Bs[d]):(e+=this.Bs[d],this.ps[d]=e,e+=this.ms[d]),d<this._&&(e+=m/2),this.Rt[d]=e}const s=e,n=this.arrangementOrigin;for(let d=0;d<=this._;d++)this.P===270?this.ps[d]=n.y+this.ps[d]:this.P===90?(this.ps[d]=n.y+s-this.ps[d],this.Rt[d]=s-this.Rt[d]):this.P===180?this.ps[d]=n.x+this.ps[d]:(this.ps[d]=n.x+s-this.ps[d],this.Rt[d]=s-this.Rt[d]);const o=this.Xn!==0;t.reset();const r=this.P===270||this.P===90;let l=1/0,a=1/0,h=1/0,c=-1/0;for(;t.next();){const d=t.value,m=d.layer,g=d.column|0;let p=0,y=0;r?(p=n.x+this.ti*g,y=this.ps[m]):(p=this.ps[m],y=n.y+this.ti*g),d.centerX=p,d.centerY=y,o&&isFinite(d.mi)&&(r?d.node?d.x=n.x+d.mi:d.centerX=n.x+d.mi:d.node?d.y=n.y+d.mi:d.centerY=n.y+d.mi),l=Math.min(d.x,l),a=Math.min(d.y,a),r?(h=l,c=Math.max(c,d.bounds.right)):(h=a,c=Math.max(c,d.bounds.bottom))}this.gL=c-h;const f=n.x-l,u=n.y-a;for(this.cr=new Point(o&&r?0:f,o&&!r?0:u),t.reset();t.next();){const d=t.value;d.x+=f,d.y+=u,d.commit()}}wL(){let t=0;const e=this.Us;for(let n=0;n<=this._;n++)t+=this.Bs[n],t+=this.ms[n];t+=this._*e;const i=[],s=this.Xn!==0?this.gL:this.ti*this.zt;for(let n=this.maxLayer;n>=0;n--)this.P===270?n===0?i.push(new Rect(0,0,s,Math.abs(this.Rt[0]))):i.push(new Rect(0,this.Rt[n-1],s,Math.abs(this.Rt[n-1]-this.Rt[n]))):this.P===90?n===0?i.push(new Rect(0,this.Rt[0],s,Math.abs(this.Rt[0]-t))):i.push(new Rect(0,this.Rt[n],s,Math.abs(this.Rt[n-1]-this.Rt[n]))):this.P===180?n===0?i.push(new Rect(0,0,Math.abs(this.Rt[0]),s)):i.push(new Rect(this.Rt[n-1],0,Math.abs(this.Rt[n-1]-this.Rt[n]),s)):n===0?i.push(new Rect(this.Rt[0],0,Math.abs(this.Rt[0]-t),s)):i.push(new Rect(this.Rt[n],0,Math.abs(this.Rt[n-1]-this.Rt[n]),s));this.commitLayers(i,this.cr)}commitLayers(t,e){}commitLinks(){const t=this.network.edges.iterator;let e=null;for(;t.next();)e=t.value.link,e!==null&&e.pointsCount>0&&(e.startRoute(),e.clearPoints(),e.commitRoute());for(t.reset();t.next();)e=t.value.link,e!==null&&e.updateRoute();for(t.reset();t.next();){const i=t.value;if(e=i.link,e===null||e.pointsCount===0)continue;e.startRoute();const s=e;let n=s.fromNode,o=s.toNode,r=s.fromPort,l=s.toPort;if(n!==null){const N=n.findVisibleNode();N!==null&&N!==n&&(n=N,r=N.port)}if(o!==null){const N=o.findVisibleNode();N!==null&&N!==o&&(o=N,l=N.port)}const a=e.computeSpot(!0,r),h=e.computeSpot(!1,l);let c=i.fromVertex,f=i.toVertex;if(i.valid){if(e.curve===9&&e.pointsCount===4)if(c.column===f.column&&this.alignOption===0){const N=e.getLinkPoint(n,r,a,!0,!1,o,l),A=e.getLinkPoint(o,l,h,!1,!1,n,r);N.isReal()||N.set(n.actualBounds.center),A.isReal()||A.set(o.actualBounds.center),e.clearPoints(),e.addPointAt(N.x,N.y),e.addPointAt((2*N.x+A.x)/3,(2*N.y+A.y)/3),e.addPointAt((N.x+2*A.x)/3,(N.y+2*A.y)/3),e.addPointAt(A.x,A.y)}else{let N=!1,A=!1;if(r!==null&&e.bl(a)&&(N=!0),l!==null&&e.bl(h)&&(A=!0),N||A){let T=null;N&&(T=e.getLinkPointFromPoint(n,r,r.getDocumentPoint(Spot.Center),e.getPoint(3),!0),T.isReal()||T.set(n.actualBounds.center),e.setPointAt(0,T.x,T.y));let D=null;if(A&&(D=e.getLinkPointFromPoint(o,l,l.getDocumentPoint(Spot.Center),e.getPoint(0),!1),D.isReal()||D.set(o.actualBounds.center),e.setPointAt(3,D.x,D.y)),T){const v=e.getPoint(2);e.setPointAt(1,(T.x*2+v.x)/3,(T.y*2+v.y)/3)}if(D){const v=e.getPoint(1);e.setPointAt(2,(D.x*2+v.x)/3,(D.y*2+v.y)/3)}}}e.commitRoute();continue}if(c.layer===f.layer){e.commitRoute();continue}let u=!1,d=!1;const m=this.Us;let g=0,p=e.firstPickIndex+1;if(e.isOrthogonal)d=!0,g=e.pointsCount,g>4&&e.points.removeRange(2,g-3);else if(e.curve===9)u=!0,g=e.pointsCount,g>4&&e.points.removeRange(2,g-3),g===4&&(p=2);else{g=e.pointsCount;const N=a===Spot.None,A=h===Spot.None;g>2&&N&&A?e.points.removeRange(1,g-2):g>3&&N&&!A?e.points.removeRange(1,g-3):g>3&&!N&&A?e.points.removeRange(2,g-2):g>4&&!N&&!A&&e.points.removeRange(2,g-3)}let y,x,b=0,k=0,P=0,S=0,L=0,C=0,M=0;if(i.rev){let N=0;for(;f!==null&&c!==f;){y=null,x=null;const A=f.sourceEdges.iterator;for(;A.next();){const T=A.value;if(T.link===i.link&&(y=T.fromVertex,x=T.toVertex,y.node===null))break}if(y===null)break;if(y!==c)if(b=e.getPoint(p-1).x,k=e.getPoint(p-1).y,P=y.centerX,S=y.centerY,d)this.P===180||this.P===0?p===e.firstPickIndex+1?(e.insertPointAt(p++,b,k),e.insertPointAt(p++,b,S)):(x!==null?x.centerY:k)!==S&&(L=this.Rt[y.layer-1]+this.cr.x,e.insertPointAt(p++,L,k),e.insertPointAt(p++,L,S)):p===e.firstPickIndex+1?(e.insertPointAt(p++,b,k),e.insertPointAt(p++,P,k)):(x!==null?x.centerX:b)!==P&&(L=this.Rt[y.layer-1]+this.cr.y,e.insertPointAt(p++,b,L),e.insertPointAt(p++,P,L));else if(p===e.firstPickIndex+1)if(C=Math.max(10,this.Bs[f.layer]),M=Math.max(10,this.ms[f.layer]),u)this.P===180?P<=f.bounds.x?(N=f.bounds.x,e.insertPointAt(p++,N-C,S),e.insertPointAt(p++,N,S),e.insertPointAt(p++,N+M,S)):(e.insertPointAt(p++,P-C,S),e.insertPointAt(p++,P,S),e.insertPointAt(p++,P+M,S)):this.P===90?S>=f.bounds.bottom?(N=f.bounds.y+f.bounds.height,e.insertPointAt(p++,P,N+M),e.insertPointAt(p++,P,N),e.insertPointAt(p++,P,N-C)):(e.insertPointAt(p++,P,S+M),e.insertPointAt(p++,P,S),e.insertPointAt(p++,P,S-C)):this.P===270?S<=f.bounds.y?(N=f.bounds.y,e.insertPointAt(p++,P,N-C),e.insertPointAt(p++,P,N),e.insertPointAt(p++,P,N+M)):(e.insertPointAt(p++,P,S-C),e.insertPointAt(p++,P,S),e.insertPointAt(p++,P,S+M)):this.P===0&&(P>=f.bounds.right?(N=f.bounds.x+f.bounds.width,e.insertPointAt(p++,N+M,S),e.insertPointAt(p++,N,S),e.insertPointAt(p++,N-C,S)):(e.insertPointAt(p++,P+M,S),e.insertPointAt(p++,P,S),e.insertPointAt(p++,P-C,S)));else{e.insertPointAt(p++,b,k);let T=0;this.P===180||this.P===0?((this.P===180?P>=f.bounds.right:P<=f.bounds.x)&&(T=(this.P===0?-C:M)/2),e.insertPointAt(p++,b+T,S)):((this.P===270?S>=f.bounds.bottom:S<=f.bounds.y)&&(T=(this.P===90?-C:M)/2),e.insertPointAt(p++,P,k+T)),e.insertPointAt(p++,P,S)}else C=Math.max(10,this.Bs[y.layer]),M=Math.max(10,this.ms[y.layer]),u?this.P===180?(e.insertPointAt(p++,P-C-Math.max(10,m),S),e.insertPointAt(p++,Math.min(P-C+m/2,P),S),e.insertPointAt(p++,P,S),e.insertPointAt(p++,P,S),e.insertPointAt(p++,Math.max(P+M-m/2,P),S),e.insertPointAt(p++,P+M+m,S)):this.P===90?(e.insertPointAt(p++,P,S+M+Math.max(10,m)),e.insertPointAt(p++,P,Math.max(S+M-m/2,S)),e.insertPointAt(p++,P,S),e.insertPointAt(p++,P,S),e.insertPointAt(p++,P,Math.min(S-C+m/2,S)),e.insertPointAt(p++,P,S-C-m)):this.P===270?(e.insertPointAt(p++,P,S-C-Math.max(10,m)),e.insertPointAt(p++,P,Math.min(S-C+m/2,S)),e.insertPointAt(p++,P,S),e.insertPointAt(p++,P,S),e.insertPointAt(p++,P,Math.max(S+M-m/2,S)),e.insertPointAt(p++,P,S+M+m)):(e.insertPointAt(p++,P+M+Math.max(10,m),S),e.insertPointAt(p++,Math.max(P+M-m/2,P),S),e.insertPointAt(p++,P,S),e.insertPointAt(p++,P,S),e.insertPointAt(p++,Math.min(P-C+m/2,P),S),e.insertPointAt(p++,P-C-m,S)):(this.P===180||this.P===90||this.P,e.insertPointAt(p++,P,S));f=y}if(l===null||a!==Spot.None||d)if(b=e.getPoint(p-1).x,k=e.getPoint(p-1).y,P=e.getPoint(p).x,S=e.getPoint(p).y,d){const A=this.ms[c.layer];let T=0;this.P===180||this.P===0?(T=k,T>=c.bounds.y&&T<=c.bounds.bottom&&(this.P===180?P>=c.bounds.x:P<=c.bounds.right)&&(N=c.centerX+(this.P===180?-A:A),T<c.bounds.y+c.bounds.height/2?T=c.bounds.y-this.ti/2:T=c.bounds.bottom+this.ti/2,e.insertPointAt(p++,N,k),e.insertPointAt(p++,N,T)),e.insertPointAt(p++,P,T),e.insertPointAt(p++,P,S)):(T=b,T>=c.bounds.x&&T<=c.bounds.right&&(this.P===270?S>=c.bounds.y:S<=c.bounds.bottom)&&(N=c.centerY+(this.P===270?-A:A),T<c.bounds.x+c.bounds.width/2?T=c.bounds.x-this.ti/2:T=c.bounds.right+this.ti/2,e.insertPointAt(p++,b,N),e.insertPointAt(p++,T,N)),e.insertPointAt(p++,T,S),e.insertPointAt(p++,P,S))}else if(u)C=Math.max(10,this.Bs[c.layer]),M=Math.max(10,this.ms[c.layer]),this.P===180&&P>=c.bounds.x?(N=c.bounds.x+c.bounds.width,e.setPointAt(p-2,N,k),e.setPointAt(p-1,N+M,k)):this.P===90&&S<=c.bounds.bottom?(N=c.bounds.y,e.setPointAt(p-2,b,N),e.setPointAt(p-1,b,N-C)):this.P===270&&S>=c.bounds.y?(N=c.bounds.y+c.bounds.height,e.setPointAt(p-2,b,N),e.setPointAt(p-1,b,N+M)):this.P===0&&P<=c.bounds.right&&(N=c.bounds.x,e.setPointAt(p-2,N,k),e.setPointAt(p-1,N-C,k));else{C=Math.max(10,this.Bs[c.layer]),M=Math.max(10,this.ms[c.layer]);let A=0;this.P===180||this.P===0?((this.P===180?P<=c.bounds.x:P>=c.bounds.right)&&(A=(this.P===0?M:-C)/2),e.insertPointAt(p++,P+A,k)):((this.P===270?S<=c.bounds.y:S>=c.bounds.bottom)&&(A=(this.P===90?M:-C)/2),e.insertPointAt(p++,b,S+A)),e.insertPointAt(p++,P,S)}}else{for(;c!==null&&c!==f;){y=null,x=null;const N=c.destinationEdges.iterator;for(;N.next();){const A=N.value;if(A.link===i.link&&(y=A.toVertex,x=A.fromVertex,x.node!==null&&(x=null),y.node===null))break}if(y===null)break;y!==f&&(b=e.getPoint(p-1).x,k=e.getPoint(p-1).y,P=y.centerX,S=y.centerY,d?this.P===180||this.P===0?(x!==null?x.centerY:k)!==S&&(L=this.Rt[y.layer]+this.cr.x,p===e.firstPickIndex+1&&(this.P===0?L=Math.max(L,b):L=Math.min(L,b)),e.insertPointAt(p++,L,k),e.insertPointAt(p++,L,S)):(x!==null?x.centerX:b)!==P&&(L=this.Rt[y.layer]+this.cr.y,p===e.firstPickIndex+1&&(this.P===90?L=Math.max(L,k):L=Math.min(L,k)),e.insertPointAt(p++,b,L),e.insertPointAt(p++,P,L)):(C=Math.max(10,this.Bs[y.layer]),M=Math.max(10,this.ms[y.layer]),u?this.P===180?(e.insertPointAt(p++,P+M+Math.max(10,m),S),e.insertPointAt(p++,Math.max(P+M-m/2,P),S),e.insertPointAt(p++,P,S),e.insertPointAt(p++,P,S),e.insertPointAt(p++,Math.min(P-C+m/2,P),S),e.insertPointAt(p++,P-C-m,S)):this.P===90?(e.insertPointAt(p++,P,S-C-Math.max(10,m)),e.insertPointAt(p++,P,Math.min(S-C+m/2,S)),e.insertPointAt(p++,P,S),e.insertPointAt(p++,P,S),e.insertPointAt(p++,P,Math.max(S+M-m/2,S)),e.insertPointAt(p++,P,S+M+m)):this.P===270?(e.insertPointAt(p++,P,S+M+Math.max(10,m)),e.insertPointAt(p++,P,Math.max(S+M-m/2,S)),e.insertPointAt(p++,P,S),e.insertPointAt(p++,P,S),e.insertPointAt(p++,P,Math.min(S-C+m/2,S)),e.insertPointAt(p++,P,S-C-m)):(e.insertPointAt(p++,P-C-Math.max(10,m),S),e.insertPointAt(p++,Math.min(P-C+m/2,P),S),e.insertPointAt(p++,P,S),e.insertPointAt(p++,P,S),e.insertPointAt(p++,Math.max(P+M-m/2,P),S),e.insertPointAt(p++,P+M+m,S)):this.P===180?(e.insertPointAt(p++,P+M,S),e.insertPointAt(p++,P-C,S)):this.P===90?(e.insertPointAt(p++,P,S-C),e.insertPointAt(p++,P,S+M)):this.P===270?(e.insertPointAt(p++,P,S+M),e.insertPointAt(p++,P,S-C)):(e.insertPointAt(p++,P-C,S),e.insertPointAt(p++,P+M,S)))),c=y}d&&(b=e.getPoint(p-1).x,k=e.getPoint(p-1).y,P=e.getPoint(p).x,S=e.getPoint(p).y,this.P===180||this.P===0?k!==S&&(this.P===0?L=Math.min(Math.max((P+b)/2,this.Rt[f.layer]+this.cr.x),P):L=Math.max(Math.min((P+b)/2,this.Rt[f.layer]+this.cr.x),P),e.insertPointAt(p++,L,k),e.insertPointAt(p++,L,S)):b!==P&&(this.P===90?L=Math.min(Math.max((S+k)/2,this.Rt[f.layer]+this.cr.y),S):L=Math.max(Math.min((S+k)/2,this.Rt[f.layer]+this.cr.y),S),e.insertPointAt(p++,b,L),e.insertPointAt(p++,P,L)))}if(s!==null&&u&&e.pointsCount>=4){if(n!==null&&r!==null&&s.bl(a)){const N=r.getDocumentPoint(Spot.Center);N.isReal()||N.setTo(n.actualBounds.centerX,n.actualBounds.centerY);const A=e.getPoint(3),T=e.getPoint(2);this.direction===90||this.direction===270?(e.setPointAt(1,A.x,(T.y+A.y)/2),e.setPointAt(2,A.x,(T.y+A.y)/2)):(e.setPointAt(1,(T.x+A.x)/2,A.y),e.setPointAt(2,(T.x+A.x)/2,A.y));const D=e.getLinkPointFromPoint(n,r,N,e.getPoint(1),!0);e.setPointAt(0,D.x,D.y)}if(o!==null&&l!==null&&s.bl(h)){const N=l.getDocumentPoint(Spot.Center);N.isReal()||N.setTo(o.actualBounds.centerX,o.actualBounds.centerY);const A=e.getPoint(e.pointsCount-4),T=e.getLinkPointFromPoint(o,l,N,A,!1),D=e.getPoint(e.pointsCount-3);this.direction===90||this.direction===270?(e.setPointAt(e.pointsCount-2,A.x,(D.y+T.y)/2),e.setPointAt(e.pointsCount-3,A.x,(D.y+T.y)/2)):(e.setPointAt(e.pointsCount-2,(D.x+T.x)/2,A.y),e.setPointAt(e.pointsCount-3,(D.x+T.x)/2,A.y));const v=e.getLinkPointFromPoint(o,l,N,e.getPoint(e.pointsCount-2),!1);e.setPointAt(e.pointsCount-1,v.x,v.y)}}e.commitRoute(),i.commit()}}S3(){this.Sw=-1,this.qg=0,this.Vs=0,this.gu=null;for(let t=0;t<this.zn.length;t++)this.zn[t]=null}ja(t){let e;const i=this.ie[t];if(i>=this.zn.length){const n=[];for(let o=0;o<this.zn.length;o++)n[o]=this.zn[o];this.zn=n}this.zn[i]===void 0||this.zn[i]===null?e=[]:(e=this.zn[i],this.zn[i]=null);const s=this.gu[t];for(let n=0;n<s.length;n++){const o=s[n];e[o.index]=o}return e}Wa(t,e){this.zn[this.ie[t]]=e}get layerSpacing(){return this.Us}set layerSpacing(t){this.Us!==t&&(U.s(t,"number",LayeredDigraphLayout,"layerSpacing"),t>=0&&(this.Us=t,this.p()))}get columnSpacing(){return this.ti}set columnSpacing(t){this.ti!==t&&(U.s(t,"number",LayeredDigraphLayout,"columnSpacing"),t>0&&(this.ti=t,this.p()))}get direction(){return this.P}set direction(t){this.P!==t&&(U.s(t,"number",LayeredDigraphLayout,"direction"),t===0||t===90||t===180||t===270?(this.P=t,this.p()):U.o("LayeredDigraphLayout.direction must be 0, 90, 180, or 270"))}get cycleRemoveOption(){return this.hu}set cycleRemoveOption(t){this.hu!==t&&(t===1||t===0||t===2)&&(this.hu=t,this.p())}get layeringOption(){return this.cu}set layeringOption(t){this.cu!==t&&(t===10||t===11||t===12)&&(this.cu=t,this.p())}get initializeOption(){return this.fu}set initializeOption(t){this.fu!==t&&(t===20||t===21||t===22)&&(this.fu=t,this.p())}get iterations(){return this.gc}set iterations(t){this.gc!==t&&t>=0&&(this.gc=t,this.p())}get aggressiveOption(){return this.uu}set aggressiveOption(t){this.uu!==t&&(t===30||t===31||t===32)&&(this.uu=t,this.p())}get packOption(){return this.hr}set packOption(t){this.hr!==t&&(U.s(t,"number",LayeredDigraphLayout,"packOption"),t>=0&&t<8&&(this.hr=t,this.p()))}get packIterations(){return this.du}set packIterations(t){this.du=t}get alignOption(){return this.Xn}set alignOption(t){this.Xn!==t&&(U.s(t,"number",LayeredDigraphLayout,"align"),t>=0&&t<16&&(this.Xn=t,this.p()))}get centered(){return this.qa}set centered(t){this.centered!==t&&(U.s(t,"boolean",LayeredDigraphLayout,"centered"),this.qa=t,this.p())}get setsPortSpots(){return this.Bn}set setsPortSpots(t){this.Bn!==t&&(U.s(t,"boolean",LayeredDigraphLayout,"setsPortSpots"),this.Bn=t,this.p())}get maxLayer(){return this._}get maxIndex(){return this.Sw}get maxColumn(){return this.zt}get minIndexLayer(){return this.qg}get maxIndexLayer(){return this.Vs}static CycleDepthFirst=0;static CycleGreedy=1;static CycleFromLayers=2;static LayerOptimalLinkLength=10;static LayerLongestPathSink=11;static LayerLongestPathSource=12;static InitDepthFirstOut=20;static InitDepthFirstIn=21;static InitNaive=22;static AggressiveNone=30;static AggressiveLess=31;static AggressiveMore=32;static PackNone=0;static PackExpand=1;static PackStraighten=2;static PackMedian=4;static PackAll=15;static AlignNone=0;static AlignUpperLeft=1;static AlignUpperRight=2;static AlignLowerLeft=4;static AlignLowerRight=8;static AlignAll=15}class LayeredDigraphNetwork extends LayoutNetwork{constructor(t){super(t)}createVertex(){const t=new LayeredDigraphVertex(this);return t.centered=this.layout.centered,t}createEdge(){return new LayeredDigraphEdge(this)}}class LayeredDigraphVertex extends LayoutVertex{gl;pa;Tt;sP;nP;qa;ii;mu;_n;_k;$k;Zk;mc;Gn;NF;Ja;os;pu;mi;Yn;Lw=null;Aw=null;Tw=null;Dw=null;constructor(t){super(t),this.gl=-1,this.pa=-1,this.Tt=-1,this.sP=NaN,this.nP=null,this.qa=!0,this.ii=!1,this.mu=NaN,this._n=NaN,this._k=0,this.$k=null,this.Zk=null}static AF(t,e){return t.index-e.index}getProperSourceEdges(){if(!this.Tw){const t=[];for(const e of this.So){const i=e;i.valid&&t.push(i)}this.Tw=t}return this.Tw}getProperDestinationEdges(){if(!this.Dw){const t=[];for(const e of this.or){const i=e;i.valid&&t.push(i)}this.Dw=t}return this.Dw}getDestinationEdge(t){const e=this.getProperDestinationEdges();for(const i of e)if(i.toVertex===t)return i;U.o("Unable to find destination edge to given vertex")}getProperSourceVertexes(){if(!this.Lw){const t=[];for(const e of this.So){const i=e;!i.valid||i.fromVertex.layer<=i.toVertex.layer||t.push(i.fromVertex)}t.sort(LayeredDigraphVertex.AF),this.Lw=t}return this.Lw}getProperDestinationVertexes(){if(!this.Aw){const t=[];for(const e of this.or){const i=e;!i.valid||i.fromVertex.layer<=i.toVertex.layer||t.push(i.toVertex)}t.sort(LayeredDigraphVertex.AF),this.Aw=t}return this.Aw}addSourceEdge(t){super.addSourceEdge(t),this.Lw=null,this.Tw=null}deleteSourceEdge(t){super.deleteSourceEdge(t),this.Lw=null,this.Tw=null}addDestinationEdge(t){super.addDestinationEdge(t),this.Aw=null,this.Dw=null}deleteDestinationEdge(t){super.deleteDestinationEdge(t),this.Aw=null,this.Dw=null}commit(){if(this.centered)super.commit();else{const t=this.node;if(t!==null){const e=this.network.layout;if(!e)return;e.direction===180||e.direction===270?t.moveTo(this.bounds.right-t.actualBounds.width,this.bounds.bottom-t.actualBounds.height):t.moveTo(this.bounds.x,this.bounds.y)}}}get layer(){return this.gl}set layer(t){this.gl=t}get column(){return this.pa}set column(t){this.pa=t}get index(){return this.Tt}set index(t){this.Tt=t}get component(){return this.sP}set component(t){this.sP!==t&&(U.s(t,"number",LayeredDigraphVertex,"component"),this.sP=t)}get near(){return this.nP}set near(t){this.nP!==t&&(this.nP=t)}get centered(){return this.qa}set centered(t){this.qa=t}}class LayeredDigraphEdge extends LayoutEdge{ii;oP;rP;lP;aP;hP;cP;constructor(t){super(t),this.ii=!1,this.oP=!1,this.rP=!1,this.lP=NaN,this.aP=NaN,this.hP=0,this.cP=0}get fromVertex(){return this.is}set fromVertex(t){this.is!==t&&(this.is=t)}get toVertex(){return this.ss}set toVertex(t){this.ss!==t&&(this.ss=t)}get valid(){return this.ii}set valid(t){this.ii!==t&&(U.s(t,"boolean",LayeredDigraphEdge,"valid"),this.ii=t)}get rev(){return this.oP}set rev(t){this.oP!==t&&(U.s(t,"boolean",LayeredDigraphEdge,"rev"),this.oP=t)}get forest(){return this.rP}set forest(t){this.rP!==t&&(U.s(t,"boolean",LayeredDigraphEdge,"forest"),this.rP=t)}get portFromPos(){return this.lP}set portFromPos(t){this.lP!==t&&(U.s(t,"number",LayeredDigraphEdge,"portFromPos"),this.lP=t)}get portToPos(){return this.aP}set portToPos(t){this.aP!==t&&(U.s(t,"number",LayeredDigraphEdge,"portToPos"),this.aP=t)}get portFromColOffset(){return this.hP}set portFromColOffset(t){this.hP!==t&&(U.s(t,"number",LayeredDigraphEdge,"portFromColOffset"),this.hP=t)}get portToColOffset(){return this.cP}set portToColOffset(t){this.cP!==t&&(U.s(t,"number",LayeredDigraphEdge,"portToColOffset"),this.cP=t)}}var TreePath=(w=>(w[w.Default=0]="Default",w[w.Destination=1]="Destination",w[w.Source=2]="Source",w))(TreePath||{}),TreeSorting=(w=>(w[w.Forwards=10]="Forwards",w[w.Reverse=11]="Reverse",w[w.Ascending=12]="Ascending",w[w.Descending=13]="Descending",w))(TreeSorting||{}),TreeAlignment=(w=>(w[w.CenterSubtrees=20]="CenterSubtrees",w[w.CenterChildren=21]="CenterChildren",w[w.Start=22]="Start",w[w.End=23]="End",w[w.Bus=24]="Bus",w[w.BusBranching=25]="BusBranching",w[w.TopLeftBus=26]="TopLeftBus",w[w.BottomRightBus=27]="BottomRightBus",w[w.Custom=28]="Custom",w))(TreeAlignment||{}),TreeCompaction=(w=>(w[w.None=30]="None",w[w.Block=31]="Block",w))(TreeCompaction||{}),TreeStyle=(w=>(w[w.Layered=40]="Layered",w[w.LastParents=41]="LastParents",w[w.Alternating=42]="Alternating",w[w.RootOnly=43]="RootOnly",w))(TreeStyle||{}),TreeArrangement=(w=>(w[w.Vertical=50]="Vertical",w[w.Horizontal=51]="Horizontal",w[w.FixedRoots=52]="FixedRoots",w))(TreeArrangement||{}),TreeLayerStyle=(w=>(w[w.Individual=60]="Individual",w[w.Siblings=61]="Siblings",w[w.Uniform=62]="Uniform",w))(TreeLayerStyle||{});class TreeLayout extends Layout{Ie;Fe;yu;$g;xL;zi;He;Es;V;B;fP;ws;constructor(t){super(),this.Ie=new GSet,this.Fe=0,this.ws=1,this.yu=40,this.$g=60,this.xL=[],this.zi=!0,this.He=50,this.Es=new Size(10,10).k();const e=new TreeNetwork(this);this.V=new TreeVertex(e),this.B=new TreeVertex(e),this.fP=[],t&&Object.assign(this,t)}cloneProtected(t){super.cloneProtected(t),t.Fe=this.Fe,t.yu=this.yu,t.$g=this.$g,t.zi=this.zi,t.He=this.He,t.Es.h(this.Es),t.V.copyInheritedPropertiesFrom(this.V),t.B.copyInheritedPropertiesFrom(this.B)}fe(t){t in TreeAlignment?this.alignment=t:t in TreeArrangement?this.arrangement=t:t in TreeCompaction?this.compaction=t:t in TreePath?this.path=t:t in TreeSorting?this.sorting=t:t in TreeStyle?this.treeStyle=t:super.fe(t)}createNetwork(){return new TreeNetwork(this)}makeNetwork(t){const e=this.createNetwork(),i=s=>{if(s instanceof Node)return!s.isLinkLabel&&s.category!=="Comment";if(s instanceof Link){const n=s.fromNode;if(n===null||n.isLinkLabel||n.category==="Comment")return!1;const o=s.toNode;return!(o===null||o.isLinkLabel||o.category==="Comment")}return!1};return t instanceof Diagram?(e.addParts(t.nodes,!0,i),e.addParts(t.links,!0,i)):t instanceof Group?e.addParts(t.memberParts,!1,i):e.addParts(t.iterator,!1,i),e}doLayout(t){this.network===null&&(this.network=this.makeNetwork(t)),this.arrangement!==52&&(this.arrangementOrigin=this.initialOrigin(this.arrangementOrigin));let e=this.diagram;e===null&&t instanceof Diagram&&(e=t),this.path===0&&e!==null?this.ws=e.isTreePathToChildren?1:2:this.ws=this.path===0?1:this.path,this.network.vertexes.count>0&&(this.oU(),this.rU(),this.lU(),this.aU(),this.dL(),this.hU(),this.arrangeTrees(),this.updateParts()),this.network=null,this.Ie=new GSet,this.isValidLayout=!0}oU(){if(this.network===null)return;this.network.deleteSelfEdges();const t=this.network.vertexes.iterator;for(;t.next();){const n=t.value;n.initialized=!1,n.level=0,n.parent=null,n.children=[]}if(this.Ie.count>0){const n=new GSet,o=this.Ie.iterator;for(;o.next();){const r=o.value;if(r instanceof Node){const l=this.network.findVertex(r);l!==null&&n.add(l)}else r instanceof TreeVertex&&n.add(r)}this.Ie=n}this.Ie.count===0&&this.findRoots();const e=this.Ie.copy().iterator;for(;e.next();){const n=e.value;n.initialized||(n.initialized=!0,this.bL(n))}let i=this.network.vertexes,s=null;for(;s=this.cU(i),s.count>0;){const n=this.TF(s);n!==null&&(this.Ie.add(n),n.initialized=!0,this.bL(n)),i=s}}cU(t){const e=new GSet,i=t.iterator;for(;i.next();){const s=i.value;s.initialized||e.add(s)}return e}findRoots(){if(this.network===null)return;const t=this.network.vertexes,e=t.iterator;for(;e.next();){const i=e.value;switch(this.ws){case 1:i.sourceEdges.count===0&&this.Ie.add(i);break;case 2:i.destinationEdges.count===0&&this.Ie.add(i);break;default:U.o("Unhandled path value "+this.ws.toString())}}if(this.Ie.count===0){const i=this.TF(t);i!==null&&this.Ie.add(i)}}TF(t){let e=999999,i=null;const s=t.iterator;for(;s.next();){const n=s.value;switch(this.ws){case 1:n.sourceEdges.count<e&&(e=n.sourceEdges.count,i=n);break;case 2:n.destinationEdges.count<e&&(e=n.destinationEdges.count,i=n);break;default:U.o("Unhandled path value "+this.ws.toString())}}return i}bL(t){if(t===null)return;switch(this.ws){case 1:if(t.destinationEdges.count>0){const s=new List,n=t.destinationVertexes;for(;n.next();){const o=n.value;this.DF(t,o)&&s.add(o)}s.count>0&&(t.children=s.toArray())}break;case 2:if(t.sourceEdges.count>0){const s=new List,n=t.sourceVertexes;for(;n.next();){const o=n.value;this.DF(t,o)&&s.add(o)}s.count>0&&(t.children=s.toArray())}break;default:U.o("Unhandled path value"+this.ws.toString())}const e=t.children,i=e.length;for(let s=0;s<i;s++){const n=e[s];n.initialized=!0,n.level=t.level+1,n.parent=t,this.Ie.delete(n)}for(let s=0;s<i;s++){const n=e[s];this.bL(n)}}DF(t,e){return e.initialized?this.fU(e,t)||e.level>t.level?!1:(this.uU(e.parent,e),!0):!0}fU(t,e){if(e===null)return!1;let i=e.parent;for(;i!==null&&i!==t;)i=i.parent;return i===t}uU(t,e){if(t===null||e===null)return;const i=t.children;let s=0;for(let n=0;n<i.length;n++)i[n]===e&&s++;if(s>0){const n=new Array(i.length-s);let o=0;for(let r=0;r<i.length;r++)i[r]!==e&&(n[o++]=i[r]);t.children=n}}rU(){const t=this.Ie.iterator;for(;t.next();){const e=t.value;e instanceof TreeVertex&&this.vF(e)}}vF(t){if(t===null)return;this.initializeTreeVertexValues(t),t.alignment===25&&this.sortTreeVertexChildren(t);let e=0,i=t.childrenCount,s=0;const n=t.children,o=n.length;for(let r=0;r<o;r++){const l=n[r];this.vF(l),e+=l.descendantCount+1,i=Math.max(i,l.maxChildrenCount),s=Math.max(s,l.maxGenerationCount)}t.descendantCount=e,t.maxChildrenCount=i,t.maxGenerationCount=i>0?s+1:0}dU(t){switch(this.yu){default:case 40:return t.parent!==null?t.parent:this.V;case 43:return t.parent===null?this.V:t.parent.parent===null?this.B:t.parent;case 42:return t.parent!==null?t.parent.parent!==null?t.parent.parent:this.B:this.V;case 41:{let e=!0;if(t.childrenCount===0)e=!1;else{const i=t.children,s=i.length;for(let n=0;n<s;n++)if(i[n].childrenCount>0){e=!1;break}}return e&&t.parent!==null?this.B:t.parent!==null?t.parent:this.V}}}initializeTreeVertexValues(t){const e=this.dU(t);if(t.copyInheritedPropertiesFrom(e),t.parent!==null&&t.parent.alignment===25){let i=t.angle;const s=t.parent.children;let n=0;for(;n<s.length&&t!==s[n];)n++;n%2===0?n!==s.length-1&&(i===90?i=180:i===180?i=270:i===270?i=180:i=270):i===90?i=0:i===180?i=90:i===270?i=0:i=90,t.angle=i}t.initialized=!0}lU(){const t=this.Ie.iterator;for(;t.next();){const e=t.value;e instanceof TreeVertex&&this.FF(e)}}FF(t){if(t===null)return;this.assignTreeVertexValues(t);const e=t.children,i=e.length;for(let s=0;s<i;s++){const n=e[s];this.FF(n)}}assignTreeVertexValues(t){}aU(){const t=this.Ie.iterator;for(;t.next();){const e=t.value;e instanceof TreeVertex&&this.RF(e)}}RF(t){if(t===null)return;t.alignment!==25&&this.sortTreeVertexChildren(t);const e=t.children,i=e.length;for(let s=0;s<i;s++){const n=e[s];this.RF(n)}}sortTreeVertexChildren(t){switch(t.sorting){default:case 10:break;case 11:t.children.reverse();break;case 12:t.children.sort(t.comparer);break;case 13:t.children.sort(t.comparer),t.children.reverse();break}}dL(){if(!this.comments||this.network===null)return;const t=this.network.vertexes.iterator;for(;t.next();){const e=t.value;this.addComments(e)}}addComments(t){const e=t.angle,i=t.parent;let s=0,n=21,o=!1;i!==null&&(s=i.angle,n=i.alignment,o=this.isBusAlignment(n));const r=e===90||e===270,l=s===90||s===270,a=t.childrenCount===0;let h=0,c=0,f=0;const u=t.commentSpacing;if(t.node!==null){const d=t.node.findNodesConnected();for(;d.next();){const m=d.value;if(m.category!=="Comment"||!m.canLayout())continue;t.comments===null&&(t.comments=[]),t.comments.push(m),m.ensureBounds();const g=m.measuredBounds;r&&!a||!o&&!l&&a||o&&l&&a?(h=Math.max(h,g.width),c+=g.height+Math.abs(f)):(h+=g.width+Math.abs(f),c=Math.max(c,g.height)),f=u}}if(t.comments!==null){r&&!a||!o&&!l&&a||o&&l&&a?(h+=Math.abs(t.commentMargin),c=Math.max(0,c-t.height)):(c+=Math.abs(t.commentMargin),h=Math.max(0,h-t.width));const d=Rect.z(0,0,t.bounds.width+h,t.bounds.height+c);t.bounds=d,Rect.i(d)}}isBusAlignment(t){return t===24||t===25||t===26||t===27}vw(t){return t===24||t===25}kL(t){const e=t.parent;if(e!==null){const i=e.alignment;if(this.isBusAlignment(i))if(this.vw(i)){const s=e.children;let n=0;for(;n<s.length&&t!==s[n];)n++;return n%2===0}else return i===26}return!1}layoutComments(t){if(t.comments!==null){const i=t.node.measuredBounds,s=t.parent,n=t.angle;let o=0,r=21,l=!1;s!==null&&(o=s.angle,r=s.alignment,l=this.isBusAlignment(r));const a=n===90||n===270,h=o===90||o===270,c=t.childrenCount===0,f=this.kL(t);let u=0;const d=t.comments,m=d.length,g=Point.l();for(let y=0;y<m;y++){const x=d[y],b=x.measuredBounds;if(a&&!c||!l&&!h&&c||l&&h&&c){if(o>135&&!l||h&&f)if(t.commentMargin>=0){g.e(t.bounds.x-t.commentMargin-b.width,t.bounds.y+u),x.move(g);const k=x.findLinksInto();for(;k.next();){const P=k.value;P.fromSpot=Spot.MiddleLeft,P.toSpot=Spot.MiddleRight}}else{g.e(t.bounds.x+t.focus.x*2-t.commentMargin,t.bounds.y+u),x.move(g);const k=x.findLinksInto();for(;k.next();){const P=k.value;P.fromSpot=Spot.MiddleRight,P.toSpot=Spot.MiddleLeft}}else if(t.commentMargin>=0){g.e(t.bounds.x+t.focus.x*2+t.commentMargin,t.bounds.y+u),x.move(g);const k=x.findLinksInto();for(;k.next();){const P=k.value;P.fromSpot=Spot.MiddleRight,P.toSpot=Spot.MiddleLeft}}else{g.e(t.bounds.x+t.commentMargin-b.width,t.bounds.y+u),x.move(g);const k=x.findLinksInto();for(;k.next();){const P=k.value;P.fromSpot=Spot.MiddleLeft,P.toSpot=Spot.MiddleRight}}t.commentSpacing>=0?u+=b.height+t.commentSpacing:u+=t.commentSpacing-b.height}else{if(o>135&&!l||!h&&f)if(t.commentMargin>=0){g.e(t.bounds.x+u,t.bounds.y-t.commentMargin-b.height),x.move(g);const k=x.findLinksInto();for(;k.next();){const P=k.value;P.fromSpot=Spot.MiddleTop,P.toSpot=Spot.MiddleBottom}}else{g.e(t.bounds.x+u,t.bounds.y+t.focus.y*2-t.commentMargin),x.move(g);const k=x.findLinksInto();for(;k.next();){const P=k.value;P.fromSpot=Spot.MiddleBottom,P.toSpot=Spot.MiddleTop}}else if(t.commentMargin>=0){g.e(t.bounds.x+u,t.bounds.y+t.focus.y*2+t.commentMargin),x.move(g);const k=x.findLinksInto();for(;k.next();){const P=k.value;P.fromSpot=Spot.MiddleBottom,P.toSpot=Spot.MiddleTop}}else{g.e(t.bounds.x+u,t.bounds.y+t.commentMargin-b.height),x.move(g);const k=x.findLinksInto();for(;k.next();){const P=k.value;P.fromSpot=Spot.MiddleTop,P.toSpot=Spot.MiddleBottom}}t.commentSpacing>=0?u+=b.width+t.commentSpacing:u+=t.commentSpacing-b.width}}Point.i(g);const p=u-t.commentSpacing-(a?i.height:i.width);if(this.ws===1){const y=t.destinationEdges;for(;y.next();){const b=y.value.link;b!==null&&!b.isAvoiding&&(b.fromEndSegmentLength=p>0?p:NaN)}}else{const y=t.sourceEdges;for(;y.next();){const b=y.value.link;b!==null&&!b.isAvoiding&&(b.toEndSegmentLength=p>0?p:NaN)}}}}hU(){if(this.network===null)return;if(this.layerStyle===62){const e=[];let i=this.network.vertexes.iterator;for(;i.next();){const s=i.value;let n=s.parent;n===null&&(n=s);const o=n.angle===0||n.angle===180;let r=e[s.level];r===void 0&&(r=0),e[s.level]=Math.max(r,o?s.width:s.height)}for(let s=0;s<e.length;s++)e[s]===void 0&&(e[s]=0);for(this.xL=e,i=this.network.vertexes.iterator;i.next();){const s=i.value;let n=s.parent;n===null&&(n=s),n.angle===0||n.angle===180?(n.angle===180&&(s.focusX+=e[s.level]-s.width),s.width=e[s.level]):(n.angle===270&&(s.focusY+=e[s.level]-s.height),s.height=e[s.level])}}else if(this.layerStyle===61){const e=this.network.vertexes.iterator;for(;e.next();){const i=e.value,s=i.angle===0||i.angle===180;let n=-1;for(let o=0;o<i.children.length;o++){const r=i.children[o];n=Math.max(n,s?r.width:r.height)}if(n>=0)for(let o=0;o<i.children.length;o++){const r=i.children[o];s?(i.angle===180&&(r.focusX+=n-r.width),r.width=n):(i.angle===270&&(r.focusY+=n-r.height),r.height=n)}}}const t=this.Ie.iterator;for(;t.next();){const e=t.value;e instanceof TreeVertex&&this.layoutTree(e)}}layoutTree(t){if(t===null)return;const e=t.children,i=e.length;for(let s=0;s<i;s++){const n=e[s];this.layoutTree(n)}switch(t.compaction){case 30:this.OF(t);break;default:case 31:t.alignment===25?this.OF(t):this.gU(t);break}}OF(t){if(t.childrenCount===0){let R=!1,F=0,O=21;t.parent!==null&&(F=t.parent.angle,O=t.parent.alignment,R=this.isBusAlignment(O));const z=this.kL(t);t.U.e(0,0),t.dt.e(t.width,t.height),t.parent!==null&&t.comments!==null&&((F===180||F===270)&&!R||z)?F===180&&!R||(F===90||F===270)&&z?t.at.e(t.width-t.focus.x*2,0):t.at.e(0,t.height-t.focus.y*2):t.at.e(0,0);return}const e=this.orthoAngle(t),i=e===90||e===270;let s=0;const n=t.children,o=n.length;for(let R=0;R<o;R++){const F=n[R];s=Math.max(s,i?F.dt.width:F.dt.height)}const r=t.alignment,l=r===22,a=r===23,h=this.isBusAlignment(r),c=Math.max(0,t.breadthLimit),f=this.computeLayerSpacing(t),u=t.nodeSpacing,d=this.computeNodeIndent(t),m=l||a?0:d/2,g=t.rowSpacing;let p=0;(l||a)&&(p=Math.max(0,t.rowIndent));const y=t.width,x=t.height;let b=0,k=0,P=0,S=0,L=0,C=0,M=0,N=0,A=0,T=0;if(h&&!this.vw(r)&&e>135&&n.reverse(),this.vw(r))if(o>1)for(let R=0;R<o;R++){const F=n[R],O=F.dt;R%2===0&&R!==o-1?A=Math.max(A,(i?O.width:O.height)+this.computeBusNodeSpacing(F)-u):R%2!==0&&(T=Math.max(T,(i?O.width:O.height)+this.computeBusNodeSpacing(F)-u))}else o===1&&(A=i?n[0].dt.width:n[0].dt.height);if(h)switch(r){case 24:case 25:const R=Rect.l();e<135?this.IF(t,n,A,T,b,k,R):this.EF(t,n,A,T,b,k,R),A=R.x,b=R.width,k=R.height,Rect.i(R);break;case 26:for(let F=0;F<o;F++){const O=n[F],z=O.dt,Y=M===0?0:g;i?(O.U.e(s-z.width,L+Y),b=Math.max(b,z.width),k=Math.max(k,L+Y+z.height),L+=Y+z.height):(O.U.e(S+Y,s-z.height),b=Math.max(b,S+Y+z.width),k=Math.max(k,z.height),S+=Y+z.width),M++}break;case 27:for(let F=0;F<o;F++){const O=n[F],z=O.dt,Y=M===0?0:g;i?(O.U.e(u/2+t.focus.x,L+Y),b=Math.max(b,z.width),k=Math.max(k,L+Y+z.height),L+=Y+z.height):(O.U.e(S+Y,u/2+t.focus.y),b=Math.max(b,S+Y+z.width),k=Math.max(k,z.height),S+=Y+z.width),M++}break}else for(let R=0;R<o;R++){const F=n[R],O=F.dt;if(i){c>0&&M>0&&S+u+O.width>c&&(S<s&&this.pc(t,r,s-S,0,N,R-1),C++,M=0,N=R,P=k,S=0,L=e>135?-k-g:k+g);const z=M===0?m:u;this.uP(F,0,L),F.U.e(S+z,L),b=Math.max(b,S+z+O.width),k=Math.max(k,P+(C===0?0:g)+O.height),S+=z+O.width}else{c>0&&M>0&&L+u+O.height>c&&(L<s&&this.pc(t,r,0,s-L,N,R-1),C++,M=0,N=R,P=b,L=0,S=e>135?-b-g:b+g);const z=M===0?m:u;this.uP(F,S,0),F.U.e(S,L+z),k=Math.max(k,L+z+O.height),b=Math.max(b,P+(C===0?0:g)+O.width),L+=z+O.height}M++}C>0&&(i?(k+=Math.max(0,f),S<b&&this.pc(t,r,b-S,0,N,o-1),p>0&&(a||this.wu(t,p,0,0,o-1),b+=p)):(b+=Math.max(0,f),L<k&&this.pc(t,r,0,k-L,N,o-1),p>0&&(a||this.wu(t,0,p,0,o-1),k+=p)));let D=0,v=0;switch(r){case 20:i?D+=b/2-t.focus.x-d/2:v+=k/2-t.focus.y-d/2;break;default:case 21:if(C>0)i?D+=b/2-t.focus.x-d/2:v+=k/2-t.focus.y-d/2;else{const F=o;if(i){const O=n[0].U.x+n[0].at.x,z=n[F-1].U.x+n[F-1].at.x+n[F-1].focus.x*2;D+=O+(z-O)/2-t.focus.x-d/2}else{const O=n[0].U.y+n[0].at.y,z=n[F-1].U.y+n[F-1].at.y+n[F-1].focus.y*2;v+=O+(z-O)/2-t.focus.y-d/2}}break;case 22:i?(D-=d,b+=d):(v-=d,k+=d);break;case 23:i?(D+=b-t.width+d,b+=d):(v+=k-t.height+d,k+=d);break;case 24:case 25:i?o>1?D+=A+u/2-t.focus.x:D+=n[0].focus.x-t.focus.x+n[0].at.x:o>1?v+=A+u/2-t.focus.y:v+=n[0].focus.y-t.focus.y+n[0].at.y;break;case 26:i?D+=b+u/2-t.focus.x:v+=k+u/2-t.focus.y;break;case 27:break;case 28:const R=this.customAlignment(t,D,v,b,k);D=R[0],v=R[1],b=R[2],k=R[3];break}for(let R=0;R<o;R++){const F=n[R];i?F.U.e(F.U.x+F.at.x-D,F.U.y+(e>135?(h?-k:-F.dt.height)+F.at.y-f:x+f+F.at.y)):F.U.e(F.U.x+(e>135?(h?-b:-F.dt.width)+F.at.x-f:y+f+F.at.x),F.U.y+F.at.y-v)}i?(b=this.PL(t,b,D),D<0&&(D=0),e>135&&(v+=k+f),k=Math.max(Math.max(k,x),k+x+f)):(e>135&&(D+=b+f),b=Math.max(Math.max(b,y),b+y+f),k=this.SL(t,k,v),v<0&&(v=0)),t.at.e(D,v),t.dt.e(b,k)}customAlignment(t,e,i,s,n){return[e,i,s,n]}IF(t,e,i,s,n,o,r){const l=e.length;if(l===0)return r.e(i,0,n,o),r;if(l===1){const y=e[0];return n=y.dt.width,o=y.dt.height,r.e(i,0,n,o),r}const a=t.nodeSpacing,h=t.rowSpacing,f=this.orthoAngle(t)===90;let u=0,d=0,m=0;for(let y=0;y<l;y++){if(y%2!==0||l>1&&y===l-1)continue;const x=e[y],b=x.dt,k=u===0?0:h;if(f){const P=this.computeBusNodeSpacing(x)-a;x.U.e(i-(b.width+P),m+k),n=Math.max(n,b.width+P),o=Math.max(o,m+k+b.height),m+=k+b.height}else{const P=this.computeBusNodeSpacing(x)-a;x.U.e(d+k,i-(b.height+P)),o=Math.max(o,b.height+P),n=Math.max(n,d+k+b.width),d+=k+b.width}u++}u=0;const g=d,p=m;f?(d=i+a,m=0):(d=0,m=i+a);for(let y=0;y<l;y++){if(y%2===0)continue;const x=e[y],b=x.dt,k=u===0?0:h;if(f){const P=this.computeBusNodeSpacing(x)-a;x.U.e(d+P,m+k),n=Math.max(n,d+b.width+P),o=Math.max(o,m+k+b.height),m+=k+b.height}else{const P=this.computeBusNodeSpacing(x)-a;x.U.e(d+k,m+P),n=Math.max(n,d+k+b.width),o=Math.max(o,m+b.height+P),d+=k+b.width}u++}if(l>1&&l%2===1){const y=e[l-1],x=y.dt,b=this.computeBusLastRowSpacing(y,f?Math.max(Math.abs(p),Math.abs(m)):Math.max(Math.abs(g),Math.abs(d)));if(f){y.U.e(i+a/2-y.focus.x-y.at.x,o+b);const k=i+a/2-y.focus.x-y.at.x;n=Math.max(n,k+x.width),k<0&&(n-=k),o=Math.max(o,Math.max(p,m)+b+x.height),y.U.x<0&&(i=this.dP(t,y.U.x,!1,i,a))}else{y.U.e(n+b,i+a/2-y.focus.y-y.at.y),n=Math.max(n,Math.max(g,d)+b+x.width);const k=i+a/2-y.focus.y-y.at.y;o=Math.max(o,k+x.height),k<0&&(o-=k),y.U.y<0&&(i=this.dP(t,y.U.y,!0,i,a))}}return r.e(i,0,n,o),r}EF(t,e,i,s,n,o,r){const l=e.length;if(l===0)return r.e(i,0,n,o),r;if(l===1){const y=e[0];return n=y.dt.width,o=y.dt.height,r.e(i,0,n,o),r}const a=t.nodeSpacing,h=t.rowSpacing,f=this.orthoAngle(t)===270;let u=0,d=0,m=0;for(let y=0;y<l;y++){if(y%2!==0||l>1&&y===l-1)continue;const x=e[y],b=x.dt,k=u===0?0:h;if(f){const P=this.computeBusNodeSpacing(x)-a;m-=k+b.height,x.U.e(i-(b.width+P),m),n=Math.max(n,b.width+P),o=Math.max(o,Math.abs(m))}else{const P=this.computeBusNodeSpacing(x)-a;d-=k+b.width,x.U.e(d,i-(b.height+P)),o=Math.max(o,b.height+P),n=Math.max(n,Math.abs(d))}u++}u=0;const g=d,p=m;f?(d=i+a,m=0):(d=0,m=i+a);for(let y=0;y<l;y++){if(y%2===0)continue;const x=e[y],b=x.dt,k=u===0?0:h;if(f){const P=this.computeBusNodeSpacing(x)-a;m-=k+b.height,x.U.e(d+P,m),n=Math.max(n,d+b.width+P),o=Math.max(o,Math.abs(m))}else{const P=this.computeBusNodeSpacing(x)-a;d-=k+b.width,x.U.e(d,m+P),o=Math.max(o,m+b.height+P),n=Math.max(n,Math.abs(d))}u++}if(l>1&&l%2===1){const y=e[l-1],x=y.dt,b=this.computeBusLastRowSpacing(y,f?Math.max(Math.abs(p),Math.abs(m)):Math.max(Math.abs(g),Math.abs(d)));if(f){y.U.e(i+a/2-y.focus.x-y.at.x,-o-x.height-b);const k=i+a/2-y.focus.x-y.at.x;n=Math.max(n,k+x.width),k<0&&(n-=k),o=Math.max(o,Math.abs(Math.min(p,m))+b+x.height),y.U.x<0&&(i=this.dP(t,y.U.x,!1,i,a))}else{y.U.e(-n-x.width-b,i+a/2-y.focus.y-y.at.y),n=Math.max(n,Math.abs(Math.min(g,d))+b+x.width);const k=i+a/2-y.focus.y-y.at.y;o=Math.max(o,k+x.height),k<0&&(o-=k),y.U.y<0&&(i=this.dP(t,y.U.y,!0,i,a))}}for(let y=0;y<l;y++){const x=e[y];f?x.U.e(x.U.x,x.U.y+o):x.U.e(x.U.x+n,x.U.y)}return r.e(i,0,n,o),r}computeBusNodeSpacing(t){return t.parent===null?0:t.parent.nodeSpacing}computeBusLastRowSpacing(t,e){return t.parent===null?0:t.parent.rowSpacing}dP(t,e,i,s,n){const o=t.children,r=o.length;for(let a=0;a<r;a++)i?o[a].U.e(o[a].U.x,o[a].U.y-e):o[a].U.e(o[a].U.x-e,o[a].U.y);const l=o[r-1];return Math.max(s,i?l.at.y+l.focus.y-n/2:l.at.x+l.focus.x-n/2)}PL(t,e,i){switch(t.alignment){case 21:case 20:let s=e;return i+t.width>s&&(s=i+t.width),i<0&&(s-=i),s;case 22:return t.width>e?t.width:e;case 23:return t.focus.x*2>e?t.width:e+t.width-t.focus.x*2;case 24:case 25:const n=Math.min(0,i),o=Math.max(e,i+t.width);return Math.max(t.width,o-n);case 26:return t.width-t.focus.x+t.nodeSpacing/2+e;case 27:return Math.max(t.width,t.focus.x+t.nodeSpacing/2+e);default:return e}}SL(t,e,i){switch(t.alignment){case 21:case 20:let s=e;return i+t.height>s&&(s=i+t.height),i<0&&(s-=i),s;case 22:return t.height>e?t.height:e;case 23:return t.focus.y*2>e?t.height:e+t.height-t.focus.y*2;case 24:case 25:const n=Math.min(0,i),o=Math.max(e,i+t.height);return Math.max(t.height,o-n);case 26:return t.height-t.focus.y+t.nodeSpacing/2+e;case 27:return Math.max(t.height,t.focus.y+t.nodeSpacing/2+e);default:return e}}ML(t,e,i){switch(t){case 20:e/=2,i/=2;break;case 21:e/=2,i/=2;break;case 22:e=0,i=0;break;case 23:break;default:U.o("Unhandled alignment value "+t.toString())}return new Point(e,i)}pc(t,e,i,s,n,o){const r=this.ML(e,i,s);this.wu(t,r.x,r.y,n,o)}wu(t,e,i,s,n){if(e===0&&i===0)return;const o=t.children;for(let r=s;r<=n;r++){const a=o[r].U;a.x+=e,a.y+=i}}uP(t,e,i){const s=t.parent;switch(this.ws){case 1:{const n=t.sourceEdges;for(;n.next();){const o=n.value;o.fromVertex===s&&o.relativePoint.e(e,i)}break}case 2:{const n=t.destinationEdges;for(;n.next();){const o=n.value;o.toVertex===s&&o.relativePoint.e(e,i)}break}default:U.o("Unhandled path value "+this.ws.toString())}}gU(t){if(t.childrenCount===0){const B=t.parent;let H=!1,q=0,W=21;B!==null&&(q=B.angle,W=B.alignment,H=this.isBusAlignment(W));const Z=this.kL(t);t.U.e(0,0),t.dt.e(t.width,t.height),t.parent!==null&&t.comments!==null&&((q===180||q===270)&&!H||Z)?q===180&&!H||(q===90||q===270)&&Z?t.at.e(t.width-t.focus.x*2,0):t.at.e(0,t.height-t.focus.y*2):t.at.e(0,0),t.Zg=null,t.Qg=null;return}const e=this.orthoAngle(t),i=e===90||e===270;let s=0;const n=t.children,o=n.length;for(let B=0;B<o;B++){const H=n[B];s=Math.max(s,i?H.dt.width:H.dt.height)}const r=t.alignment,l=r===22,a=r===23,h=this.isBusAlignment(r),c=Math.max(0,t.breadthLimit),f=this.computeLayerSpacing(t),u=t.nodeSpacing,d=this.computeNodeIndent(t),m=t.rowSpacing;let g=0;(l||a)&&(g=Math.max(0,t.rowIndent));const p=t.width,y=t.height;let x=0,b=0,k=0,P=null,S=null,L=0,C=0,M=0,N=0,A=0,T=0,D=0,v=0,R=0;if(h&&!this.vw(r)&&e>135&&n.reverse(),this.vw(r))if(o>1)for(let B=0;B<o;B++)B%2===0&&B!==o-1?v=Math.max(v,i?n[B].dt.width:n[B].dt.height):B%2!==0&&(R=Math.max(R,i?n[B].dt.width:n[B].dt.height));else o===1&&(v=i?n[0].dt.width:n[0].dt.height);if(h){switch(r){case 24:const B=Rect.l();e<135?this.IF(t,n,v,R,x,b,B):this.EF(t,n,v,R,x,b,B),v=B.x,x=B.width,b=B.height,Rect.i(B);break;case 26:for(let H=0;H<o;H++){const q=n[H],W=q.dt,Z=T===0?0:m;i?(q.U.e(s-W.width,N+Z),x=Math.max(x,W.width),b=Math.max(b,N+Z+W.height),N+=Z+W.height):(q.U.e(M+Z,s-W.height),x=Math.max(x,M+Z+W.width),b=Math.max(b,W.height),M+=Z+W.width),T++}break;case 27:for(let H=0;H<o;H++){const q=n[H],W=q.dt,Z=T===0?0:m;i?(q.U.e(u/2+t.focus.x,N+Z),x=Math.max(x,W.width),b=Math.max(b,N+Z+W.height),N+=Z+W.height):(q.U.e(M+Z,u/2+t.focus.y),x=Math.max(x,M+Z+W.width),b=Math.max(b,W.height),M+=Z+W.width),T++}break}P=this.pi(2),S=this.pi(2),i?(P[0].e(0,0),P[1].e(0,b),S[0].e(x,0),S[1].e(x,b)):(P[0].e(0,0),P[1].e(x,0),S[0].e(0,b),S[1].e(x,b))}else for(let B=0;B<o;B++){const H=n[B],q=H.dt;if(i){c>0&&T>0&&M+u+q.width>c&&(M<s&&this.pc(t,r,s-M,0,D,B-1),A++,T=0,D=B,k=b,M=0,N=e>135?-b-m:b+m),this.uP(H,0,N);let W=0;if(T===0)P=H.Zg,S=H.Qg,L=q.width,C=q.height,(P===null||S===null||e!==this.orthoAngle(H))&&(P=this.pi(2),S=this.pi(2),P[0].e(0,0),P[1].e(0,C),S[0].e(L,0),S[1].e(L,C));else{const Z=U.nt(),V=Rect.l();this.UF(t,H,P,S,L,C,Z,V),W=V.x,P=Z[0],S=Z[1],L=V.width,C=V.height,U.Z(Z),M<q.width&&W<0&&(this.wu(t,-W,0,D,B-1),this.gP(P,-W,0),this.gP(S,-W,0),W=0),Rect.i(V)}H.U.e(W,N),x=Math.max(x,L),b=Math.max(b,k+(A===0?0:m)+q.height),M=L}else{c>0&&T>0&&N+u+q.height>c&&(N<s&&this.pc(t,r,0,s-N,D,B-1),A++,T=0,D=B,k=x,N=0,M=e>135?-x-m:x+m),this.uP(H,M,0);let W=0;if(T===0)P=H.Zg,S=H.Qg,L=q.width,C=q.height,(P===null||S===null||e!==this.orthoAngle(H))&&(P=this.pi(2),S=this.pi(2),P[0].e(0,0),P[1].e(L,0),S[0].e(0,C),S[1].e(L,C));else{const Z=U.nt(),V=Rect.l();this.UF(t,H,P,S,L,C,Z,V),W=V.x,P=Z[0],S=Z[1],L=V.width,C=V.height,U.Z(Z),N<q.height&&W<0&&(this.wu(t,0,-W,D,B-1),this.gP(P,0,-W),this.gP(S,0,-W),W=0),Rect.i(V)}H.U.e(M,W),b=Math.max(b,C),x=Math.max(x,k+(A===0?0:m)+q.width),N=C}T++}A>0&&(i?(b+=Math.max(0,f),M<x&&this.pc(t,r,x-M,0,D,o-1),g>0&&(a||this.wu(t,g,0,0,o-1),x+=g)):(x+=Math.max(0,f),N<b&&this.pc(t,r,0,b-N,D,o-1),g>0&&(a||this.wu(t,0,g,0,o-1),b+=g)));let F=0,O=0;switch(r){case 20:i?F+=x/2-t.focus.x-d/2:O+=b/2-t.focus.y-d/2;break;default:case 21:if(A>0)i?F+=x/2-t.focus.x-d/2:O+=b/2-t.focus.y-d/2;else{const H=o;if(i){const q=n[0].U.x+n[0].at.x,W=n[H-1].U.x+n[H-1].at.x+n[H-1].focus.x*2;F+=q+(W-q)/2-t.focus.x-d/2}else{const q=n[0].U.y+n[0].at.y,W=n[H-1].U.y+n[H-1].at.y+n[H-1].focus.y*2;O+=q+(W-q)/2-t.focus.y-d/2}}break;case 22:i?(F-=d,x+=d):(O-=d,b+=d);break;case 23:i?(F+=x-t.width+d,x+=d):(O+=b-t.height+d,b+=d);break;case 24:i?o>1?F+=v+u/2-t.focus.x:F+=n[0].focus.x-t.focus.x+n[0].at.x:o>1?O+=v+u/2-t.focus.y:O+=n[0].focus.y-t.focus.y+n[0].at.y;break;case 26:i?F+=x+u/2-t.focus.x:O+=b+u/2-t.focus.y;break;case 27:break;case 28:const B=this.customAlignment(t,F,O,x,b);F=B[0],O=B[1],x=B[2],b=B[3];break}for(let B=0;B<o;B++){const H=n[B];i?H.U.e(H.U.x+H.at.x-F,H.U.y+(e>135?(h?-b:-H.dt.height)+H.at.y-f:y+f+H.at.y)):H.U.e(H.U.x+(e>135?(h?-x:-H.dt.width)+H.at.x-f:p+f+H.at.x),H.U.y+H.at.y-O)}let z=0,Y=0;if(h)i?(x=this.PL(t,x,F),F<0&&(F=0),e>135&&(O+=b+f),b+=y+f,r===27&&(z+=u/2+t.focus.x),Y+=y+f):(e>135&&(F+=x+f),x+=p+f,b=this.SL(t,b,O),O<0&&(O=0),r===27&&(Y+=u/2+t.focus.y),z+=p+f);else if(i){if(t.comments===null){if(p>x){const B=this.ML(r,p-x,0);z=B.x,Y=B.y,x=p,F=0}}else x=this.PL(t,x,F);F<0&&(z-=F,F=0),e>135&&(O+=b+f),b=Math.max(Math.max(b,y),b+y+f),Y+=y+f}else{if(e>135&&(F+=x+f),x=Math.max(Math.max(x,p),x+p+f),t.comments===null){if(y>b){const B=this.ML(r,0,y-b);z=B.x,Y=B.y,b=y,O=0}}else b=this.SL(t,b,O);O<0&&(Y-=O,O=0),z+=p+f}let E,X;if(A>0)E=this.pi(4),X=this.pi(4),i?(E[2].e(0,y+f),E[3].e(E[2].x,b),X[2].e(x,E[2].y),X[3].e(X[2].x,E[3].y)):(E[2].e(p+f,0),E[3].e(x,E[2].y),X[2].e(E[2].x,b),X[3].e(E[3].x,X[2].y));else{E=this.pi(P.length+2),X=this.pi(S.length+2);for(let B=0;B<P.length;B++){const H=P[B];E[B+2].e(H.x+z,H.y+Y)}for(let B=0;B<S.length;B++){const H=S[B];X[B+2].e(H.x+z,H.y+Y)}}i?(E[0].e(F,0),E[1].e(E[0].x,y),E[2].y<E[1].y&&(E[2].x>E[0].x?E[2].h(E[1]):E[1].h(E[2])),E[3].y<E[2].y&&(E[3].x>E[0].x?E[3].h(E[2]):E[2].h(E[3])),X[0].e(F+p,0),X[1].e(X[0].x,y),X[2].y<X[1].y&&(X[2].x<X[0].x?X[2].h(X[1]):X[1].h(X[2])),X[3].y<X[2].y&&(X[3].x<X[0].x?X[3].h(X[2]):X[2].h(X[3])),E[2].y-=f/2,X[2].y-=f/2):(E[0].e(0,O),E[1].e(p,E[0].y),E[2].x<E[1].x&&(E[2].y>E[0].y?E[2].h(E[1]):E[1].h(E[2])),E[3].x<E[2].x&&(E[3].y>E[0].y?E[3].h(E[2]):E[2].h(E[3])),X[0].e(0,O+y),X[1].e(p,X[0].y),X[2].x<X[1].x&&(X[2].y<X[0].y?X[2].h(X[1]):X[1].h(X[2])),X[3].x<X[2].x&&(X[3].y<X[0].y?X[3].h(X[2]):X[2].h(X[3])),E[2].x-=f/2,X[2].x-=f/2),this.fn(P),this.fn(S),t.Zg=E,t.Qg=X,t.at.e(F,O),t.dt.e(x,b)}gP(t,e,i){for(let s=0;s<t.length;s++){const n=t[s];n.x+=e,n.y+=i}}UF(t,e,i,s,n,o,r,l){const a=this.orthoAngle(t),h=a===90||a===270,c=t.nodeSpacing,f=i,u=s,d=n,m=o;let g=e.Zg,p=e.Qg;const y=e.dt,x=h?Math.max(m,y.height):Math.max(d,y.width);if((g===null||a!==this.orthoAngle(e))&&(g=this.pi(2),p=this.pi(2),h?(g[0].e(0,0),g[1].e(0,y.height),p[0].e(y.width,0),p[1].e(p[0].x,g[1].y)):(g[0].e(0,0),g[1].e(y.width,0),p[0].e(0,y.height),p[1].e(g[1].x,p[0].y))),h){const b=d;let k=b-this.mU(u,g,b);return k+=c,i=this.pU(f,g,k),s=this.yU(u,p,k),n=Math.max(0,k)+y.width,o=x,this.fn(f),this.fn(g),this.fn(u),this.fn(p),r[0]=i,r[1]=s,l.e(k,0,n,o),l}else{const b=m;let k=b-this.wU(u,g,b);return k+=c,i=this.xU(f,g,k),s=this.bU(u,p,k),n=x,o=Math.max(0,k)+y.height,this.fn(f),this.fn(g),this.fn(u),this.fn(p),r[0]=i,r[1]=s,l.e(k,0,n,o),l}}xU(t,e,i){if(t===null||t.length<2||e===null||e.length<2)return null;const s=this.pi(t.length+e.length);let n=0,o=0,r=0;for(;o<e.length&&e[o].x<t[0].x;){const h=e[o++];s[r++].e(h.x,h.y+i)}for(;n<t.length;){const h=t[n++];s[r++].e(h.x,h.y)}const l=t[t.length-1].x;for(;o<e.length&&e[o].x<=l;)o++;for(;o<e.length&&e[o].x>l;){const h=e[o++];s[r++].e(h.x,h.y+i)}const a=this.pi(r);for(n=0;n<r;n++)a[n].h(s[n]);return this.fn(s),a}pU(t,e,i){if(t===null||t.length<2||e===null||e.length<2)return null;const s=this.pi(t.length+e.length);let n=0,o=0,r=0;for(;o<e.length&&e[o].y<t[0].y;){const h=e[o++];s[r++].e(h.x+i,h.y)}for(;n<t.length;){const h=t[n++];s[r++].e(h.x,h.y)}const l=t[t.length-1].y;for(;o<e.length&&e[o].y<=l;)o++;for(;o<e.length&&e[o].y>l;){const h=e[o++];s[r++].e(h.x+i,h.y)}const a=this.pi(r);for(n=0;n<r;n++)a[n].h(s[n]);return this.fn(s),a}bU(t,e,i){if(t===null||t.length<2||e===null||e.length<2)return null;const s=this.pi(t.length+e.length);let n=0,o=0,r=0;for(;n<t.length&&t[n].x<e[0].x;){const h=t[n++];s[r++].e(h.x,h.y)}for(;o<e.length;){const h=e[o++];s[r++].e(h.x,h.y+i)}const l=e[e.length-1].x;for(;n<t.length&&t[n].x<=l;)n++;for(;n<t.length&&t[n].x>l;){const h=t[n++];s[r++].e(h.x,h.y)}const a=this.pi(r);for(n=0;n<r;n++)a[n].h(s[n]);return this.fn(s),a}yU(t,e,i){if(t===null||t.length<2||e===null||e.length<2)return null;const s=this.pi(t.length+e.length);let n=0,o=0,r=0;for(;n<t.length&&t[n].y<e[0].y;){const h=t[n++];s[r++].e(h.x,h.y)}for(;o<e.length;){const h=e[o++];s[r++].e(h.x+i,h.y)}const l=e[e.length-1].y;for(;n<t.length&&t[n].y<=l;)n++;for(;n<t.length&&t[n].y>l;){const h=t[n++];s[r++].e(h.x,h.y)}const a=this.pi(r);for(n=0;n<r;n++)a[n].h(s[n]);return this.fn(s),a}wU(t,e,i){let s=9999999;if(t===null||t.length<2||e===null||e.length<2)return s;let n=0,o=0;for(;n<t.length&&o<e.length;){const r=t[n],l=e[o],a=l.x;let h=l.y;h+=i;let c=r;n+1<t.length&&(c=t[n+1]);let f=l,u=f.x,d=f.y;o+1<e.length&&(f=e[o+1],u=f.x,d=f.y,d+=i);let m=s;r.x===a?m=h-r.y:r.x>a&&r.x<u?m=h+(r.x-a)/(u-a)*(d-h)-r.y:a>r.x&&a<c.x&&(m=h-(r.y+(a-r.x)/(c.x-r.x)*(c.y-r.y))),m<s&&(s=m),c.x<=r.x?n++:u<=a?o++:(c.x<=u&&n++,u<=c.x&&o++)}return s}mU(t,e,i){let s=9999999;if(t===null||t.length<2||e===null||e.length<2)return s;let n=0,o=0;for(;n<t.length&&o<e.length;){const r=t[n],l=e[o];let a=l.x;const h=l.y;a+=i;let c=r;n+1<t.length&&(c=t[n+1]);let f=l,u=f.x,d=f.y;o+1<e.length&&(f=e[o+1],u=f.x,d=f.y,u+=i);let m=s;r.y===h?m=a-r.x:r.y>h&&r.y<d?m=a+(r.y-h)/(d-h)*(u-a)-r.x:h>r.y&&h<c.y&&(m=a-(r.x+(h-r.y)/(c.y-r.y)*(c.x-r.x))),m<s&&(s=m),c.y<=r.y?n++:d<=h?o++:(c.y<=d&&n++,d<=c.y&&o++)}return s}pi(t){const e=this.fP[t];if(e!==void 0){const s=e.pop();if(s!==void 0)return s}const i=[];for(let s=0;s<t;s++)i[s]=new Point;return i}fn(t){if(!t)return;const e=t.length;let i=this.fP[e];i===void 0&&(i=[],this.fP[e]=i),i.push(t)}arrangeTrees(){if(this.He===52){const t=this.Ie.iterator;for(;t.next();){const e=t.value;if(!(e instanceof TreeVertex))continue;const i=e.node;if(i===null)continue;const s=i.position;let n=s.x,o=s.y;isFinite(n)||(n=0),isFinite(o)||(o=0),this.NL(e,n,o)}}else{const t=[],e=this.Ie.iterator;for(;e.next();){const o=e.value;o instanceof TreeVertex&&t.push(o)}switch(this.sorting){default:case 10:break;case 11:t.reverse();break;case 12:t.sort(this.comparer);break;case 13:t.sort(this.comparer),t.reverse();break}const i=this.arrangementOrigin;let s=i.x,n=i.y;for(let o=0;o<t.length;o++){const r=t[o];switch(this.NL(r,s+r.at.x,n+r.at.y),this.He){case 50:n+=r.dt.height+this.Es.height;break;default:case 51:s+=r.dt.width+this.Es.width;break}}}}NL(t,e,i){if(t===null)return;t.x=e,t.y=i;const s=t.children,n=s.length;for(let o=0;o<n;o++){const r=s[o];this.NL(r,e+r.U.x,i+r.U.y)}}commitLayout(){this.Pw(),this.commitNodes(),this.wL(),this.isRouting&&this.commitLinks()}commitNodes(){if(this.network===null)return;const t=this.network.vertexes.iterator;for(;t.next();)t.value.commit();for(t.reset();t.next();){const e=t.value;this.layoutComments(e)}}wL(){if(this.network===null||this.layerStyle!==62)return;const t=this.xL,e=[];let i;const s=this.network.vertexes.iterator;for(;s.next();){const a=s.value;i===void 0?i=a.bounds.copy():i.unionRect(a.bounds);let h=e[a.level];h===void 0?h=this.computeLayerSpacing(a):h=Math.max(h,this.computeLayerSpacing(a)),e[a.level]=h}if(!i)return;for(let a=0;a<e.length;a++)e[a]===void 0&&(e[a]=0);let n;this.angle===90||this.angle===270?(i.inflate(this.nodeSpacing/2,this.layerSpacing),n=new Point(-this.nodeSpacing/2,-this.layerSpacing/2)):(i.inflate(this.layerSpacing,this.nodeSpacing/2),n=new Point(-this.layerSpacing/2,-this.nodeSpacing/2));const o=[],r=this.angle===90||this.angle===270?i.width:i.height;let l=0;if(this.angle===180||this.angle===270)for(let a=0;a<t.length;a++)l+=t[a]+e[a];for(let a=0;a<t.length;a++){const h=t[a]+e[a];this.angle===270?(l-=h,o.push(new Rect(0,l,r,h))):this.angle===90?(o.push(new Rect(0,l,r,h)),l+=h):this.angle===180?(l-=h,o.push(new Rect(l,0,h,r))):(o.push(new Rect(l,0,h,r)),l+=h)}this.commitLayers(o,n)}commitLayers(t,e){}commitLinks(){if(this.network===null)return;const t=this.network.edges.iterator;for(;t.next();)t.value.commit()}Pw(){const t=this.Ie.iterator;for(;t.next();){const e=t.value;e instanceof TreeVertex&&this.VF(e)}}VF(t){if(t===null)return;this.setPortSpots(t);const e=t.children,i=e.length;for(let s=0;s<i;s++){const n=e[s];this.VF(n)}}setPortSpots(t){const e=t.alignment;if(this.isBusAlignment(e))this.kU(t,e);else{const i=this.orthoAngle(t);if(this.ws===1){const s=t.destinationEdges;for(;s.next();){const o=s.value.link;if(o!==null){if(t.setsPortSpot)if(t.portSpot.isDefault())switch(i){case 0:o.fromSpot=Spot.MiddleRight;break;case 90:o.fromSpot=Spot.MiddleBottom;break;case 180:o.fromSpot=Spot.MiddleLeft;break;default:o.fromSpot=Spot.MiddleTop;break}else o.fromSpot=t.portSpot;if(t.setsChildPortSpot)if(t.childPortSpot.isDefault())switch(i){case 0:o.toSpot=Spot.MiddleLeft;break;case 90:o.toSpot=Spot.MiddleTop;break;case 180:o.toSpot=Spot.MiddleRight;break;default:o.toSpot=Spot.MiddleBottom;break}else o.toSpot=t.childPortSpot}}}else{const s=t.sourceEdges;for(;s.next();){const o=s.value.link;if(o!==null){if(t.setsPortSpot)if(t.portSpot.isDefault())switch(i){case 0:o.toSpot=Spot.MiddleRight;break;case 90:o.toSpot=Spot.MiddleBottom;break;case 180:o.toSpot=Spot.MiddleLeft;break;default:o.toSpot=Spot.MiddleTop;break}else o.toSpot=t.portSpot;if(t.setsChildPortSpot)if(t.childPortSpot.isDefault())switch(i){case 0:o.fromSpot=Spot.MiddleLeft;break;case 90:o.fromSpot=Spot.MiddleTop;break;case 180:o.fromSpot=Spot.MiddleRight;break;default:o.fromSpot=Spot.MiddleBottom;break}else o.fromSpot=t.childPortSpot}}}}}kU(t,e){const i=this.ws===1,s=this.orthoAngle(t);let n;switch(s){case 0:n=Spot.MiddleRight;break;case 90:n=Spot.MiddleBottom;break;case 180:n=Spot.MiddleLeft;break;default:n=Spot.MiddleTop;break}const o=t.children,r=o.length;switch(e){case 24:case 25:{for(let l=0;l<r;l++){const a=o[l],h=(i?a.sourceEdges:a.destinationEdges).first();if(h===null)continue;const c=h.link;if(c!==null){let f=s===90||s===270?Spot.MiddleLeft:Spot.MiddleTop;if(r===1||l===r-1&&r%2===1)switch(s){case 0:f=Spot.MiddleLeft;break;case 90:f=Spot.MiddleTop;break;case 180:f=Spot.MiddleRight;break;default:f=Spot.MiddleBottom;break}else l%2===0&&(f=s===90||s===270?Spot.MiddleRight:Spot.MiddleBottom);i?(t.setsPortSpot&&(c.fromSpot=n),t.setsChildPortSpot&&(c.toSpot=f)):(t.setsPortSpot&&(c.fromSpot=f),t.setsChildPortSpot&&(c.toSpot=n))}}break}case 26:{const l=s===90||s===270?Spot.MiddleRight:Spot.MiddleBottom,a=i?t.destinationEdges:t.sourceEdges;for(;a.next();){const c=a.value.link;c!==null&&(i?(t.setsPortSpot&&(c.fromSpot=n),t.setsChildPortSpot&&(c.toSpot=l)):(t.setsPortSpot&&(c.fromSpot=l),t.setsChildPortSpot&&(c.toSpot=n)))}break}case 27:{const l=s===90||s===270?Spot.MiddleLeft:Spot.MiddleTop,a=i?t.destinationEdges:t.sourceEdges;for(;a.next();){const c=a.value.link;c!==null&&(i?(t.setsPortSpot&&(c.fromSpot=n),t.setsChildPortSpot&&(c.toSpot=l)):(t.setsPortSpot&&(c.fromSpot=l),t.setsChildPortSpot&&(c.toSpot=n)))}break}}}orthoAngle(t){const e=t.angle;return e<=45?0:e<=135?90:e<=225?180:e<=315?270:0}computeLayerSpacing(t){const e=this.orthoAngle(t),i=e===90||e===270;let s=t.layerSpacing;if(t.layerSpacingParentOverlap>0){const n=Math.min(1,t.layerSpacingParentOverlap);s-=i?t.height*n:t.width*n}return s<(i?-t.height:-t.width)&&(s=i?-t.height:-t.width),s}computeNodeIndent(t){const e=this.orthoAngle(t),i=e===90||e===270;let s=t.nodeIndent;if(t.nodeIndentPastParent>0){const n=Math.min(1,t.nodeIndentPastParent);s+=i?t.width*n:t.height*n}return s=Math.max(0,s),s}get roots(){return this.Ie}set roots(t){this.Ie!==t&&(this.Ie=t,this.p())}get path(){return this.Fe}set path(t){this.Fe!==t&&(this.Fe=t,this.p())}get treeStyle(){return this.yu}set treeStyle(t){this.yu!==t&&(t===40||t===42||t===41||t===43)&&(this.yu=t,this.p())}get layerStyle(){return this.$g}set layerStyle(t){this.$g!==t&&(t===60||t===61||t===62)&&(this.$g=t,this.p())}get comments(){return this.zi}set comments(t){this.zi!==t&&(U.s(t,"boolean",TreeLayout,"comments"),this.zi=t,this.p())}get arrangement(){return this.He}set arrangement(t){this.He!==t&&(t===50||t===51||t===52)&&(this.He=t,this.p())}get arrangementSpacing(){return this.Es}set arrangementSpacing(t){this.Es.equals(t)||(this.Es.h(t),this.p())}get rootDefaults(){return this.V}set rootDefaults(t){this.V!==t&&(this.V=t,this.p())}get alternateDefaults(){return this.B}set alternateDefaults(t){this.B!==t&&(this.B=t,this.p())}get sorting(){return this.V.sorting}set sorting(t){this.V.sorting!==t&&(this.V.sorting=t,this.p())}get comparer(){return this.V.comparer}set comparer(t){this.V.comparer!==t&&(U.S(t,TreeLayout,"comparer"),this.V.comparer=t,this.p())}get angle(){return this.V.angle}set angle(t){this.V.angle!==t&&(U.s(t,"number",TreeLayout,"angle"),t===0||t===90||t===180||t===270?(this.V.angle=t,this.p()):U.o("TreeLayout.angle must be 0, 90, 180, or 270"))}get alignment(){return this.V.alignment}set alignment(t){this.V.alignment!==t&&(this.V.alignment=t,this.p())}get nodeIndent(){return this.V.nodeIndent}set nodeIndent(t){this.V.nodeIndent!==t&&(U.s(t,"number",TreeLayout,"nodeIndent"),t>=0&&(this.V.nodeIndent=t,this.p()))}get nodeIndentPastParent(){return this.V.nodeIndentPastParent}set nodeIndentPastParent(t){this.V.nodeIndentPastParent!==t&&(U.s(t,"number",TreeLayout,"nodeIndentPastParent"),t>=0&&t<=1&&(this.V.nodeIndentPastParent=t,this.p()))}get nodeSpacing(){return this.V.nodeSpacing}set nodeSpacing(t){this.V.nodeSpacing!==t&&(U.s(t,"number",TreeLayout,"nodeSpacing"),this.V.nodeSpacing=t,this.p())}get layerSpacing(){return this.V.layerSpacing}set layerSpacing(t){this.V.layerSpacing!==t&&(U.s(t,"number",TreeLayout,"layerSpacing"),this.V.layerSpacing=t,this.p())}get layerSpacingParentOverlap(){return this.V.layerSpacingParentOverlap}set layerSpacingParentOverlap(t){this.V.layerSpacingParentOverlap!==t&&(U.s(t,"number",TreeLayout,"layerSpacingParentOverlap"),t>=0&&t<=1&&(this.V.layerSpacingParentOverlap=t,this.p()))}get compaction(){return this.V.compaction}set compaction(t){this.V.compaction!==t&&(t===30||t===31)&&(this.V.compaction=t,this.p())}get breadthLimit(){return this.V.breadthLimit}set breadthLimit(t){this.V.breadthLimit!==t&&(U.s(t,"number",TreeLayout,"breadthLimit"),t>=0&&(this.V.breadthLimit=t,this.p()))}get rowSpacing(){return this.V.rowSpacing}set rowSpacing(t){this.V.rowSpacing!==t&&(U.s(t,"number",TreeLayout,"rowSpacing"),this.V.rowSpacing=t,this.p())}get rowIndent(){return this.V.rowIndent}set rowIndent(t){this.V.rowIndent!==t&&(U.s(t,"number",TreeLayout,"rowIndent"),t>=0&&(this.V.rowIndent=t,this.p()))}get commentSpacing(){return this.V.commentSpacing}set commentSpacing(t){this.V.commentSpacing!==t&&(U.s(t,"number",TreeLayout,"commentSpacing"),this.V.commentSpacing=t,this.p())}get commentMargin(){return this.V.commentMargin}set commentMargin(t){this.V.commentMargin!==t&&(U.s(t,"number",TreeLayout,"commentMargin"),this.V.commentMargin=t,this.p())}get setsPortSpot(){return this.V.setsPortSpot}set setsPortSpot(t){this.V.setsPortSpot!==t&&(U.s(t,"boolean",TreeLayout,"setsPortSpot"),this.V.setsPortSpot=t,this.p())}get portSpot(){return this.V.portSpot}set portSpot(t){this.V.portSpot.equals(t)||(this.V.portSpot=t,this.p())}get setsChildPortSpot(){return this.V.setsChildPortSpot}set setsChildPortSpot(t){this.V.setsChildPortSpot!==t&&(U.s(t,"boolean",TreeLayout,"setsChildPortSpot"),this.V.setsChildPortSpot=t,this.p())}get childPortSpot(){return this.V.childPortSpot}set childPortSpot(t){this.V.childPortSpot.equals(t)||(this.V.childPortSpot=t,this.p())}get alternateSorting(){return this.B.sorting}set alternateSorting(t){this.B.sorting!==t&&(this.B.sorting=t,this.p())}get alternateComparer(){return this.B.comparer}set alternateComparer(t){this.B.comparer!==t&&(U.S(t,TreeLayout,"alternateComparer"),this.B.comparer=t,this.p())}get alternateAngle(){return this.B.angle}set alternateAngle(t){this.B.angle!==t&&(U.s(t,"number",TreeLayout,"alternateAngle"),(t===0||t===90||t===180||t===270)&&(this.B.angle=t,this.p()))}get alternateAlignment(){return this.B.alignment}set alternateAlignment(t){this.B.alignment!==t&&(this.B.alignment=t,this.p())}get alternateNodeIndent(){return this.B.nodeIndent}set alternateNodeIndent(t){this.B.nodeIndent!==t&&(U.s(t,"number",TreeLayout,"alternateNodeIndent"),t>=0&&(this.B.nodeIndent=t,this.p()))}get alternateNodeIndentPastParent(){return this.B.nodeIndentPastParent}set alternateNodeIndentPastParent(t){this.B.nodeIndentPastParent!==t&&(U.s(t,"number",TreeLayout,"alternateNodeIndentPastParent"),t>=0&&t<=1&&(this.B.nodeIndentPastParent=t,this.p()))}get alternateNodeSpacing(){return this.B.nodeSpacing}set alternateNodeSpacing(t){this.B.nodeSpacing!==t&&(U.s(t,"number",TreeLayout,"alternateNodeSpacing"),this.B.nodeSpacing=t,this.p())}get alternateLayerSpacing(){return this.B.layerSpacing}set alternateLayerSpacing(t){this.B.layerSpacing!==t&&(U.s(t,"number",TreeLayout,"alternateLayerSpacing"),this.B.layerSpacing=t,this.p())}get alternateLayerSpacingParentOverlap(){return this.B.layerSpacingParentOverlap}set alternateLayerSpacingParentOverlap(t){this.B.layerSpacingParentOverlap!==t&&(U.s(t,"number",TreeLayout,"alternateLayerSpacingParentOverlap"),t>=0&&t<=1&&(this.B.layerSpacingParentOverlap=t,this.p()))}get alternateCompaction(){return this.B.compaction}set alternateCompaction(t){this.B.compaction!==t&&(t===30||t===31)&&(this.B.compaction=t,this.p())}get alternateBreadthLimit(){return this.B.breadthLimit}set alternateBreadthLimit(t){this.B.breadthLimit!==t&&(U.s(t,"number",TreeLayout,"alternateBreadthLimit"),t>=0&&(this.B.breadthLimit=t,this.p()))}get alternateRowSpacing(){return this.B.rowSpacing}set alternateRowSpacing(t){this.B.rowSpacing!==t&&(U.s(t,"number",TreeLayout,"alternateRowSpacing"),this.B.rowSpacing=t,this.p())}get alternateRowIndent(){return this.B.rowIndent}set alternateRowIndent(t){this.B.rowIndent!==t&&(U.s(t,"number",TreeLayout,"alternateRowIndent"),t>=0&&(this.B.rowIndent=t,this.p()))}get alternateCommentSpacing(){return this.B.commentSpacing}set alternateCommentSpacing(t){this.B.commentSpacing!==t&&(U.s(t,"number",TreeLayout,"alternateCommentSpacing"),this.B.commentSpacing=t,this.p())}get alternateCommentMargin(){return this.B.commentMargin}set alternateCommentMargin(t){this.B.commentMargin!==t&&(U.s(t,"number",TreeLayout,"alternateCommentMargin"),this.B.commentMargin=t,this.p())}get alternateSetsPortSpot(){return this.B.setsPortSpot}set alternateSetsPortSpot(t){this.B.setsPortSpot!==t&&(U.s(t,"boolean",TreeLayout,"alternateSetsPortSpot"),this.B.setsPortSpot=t,this.p())}get alternatePortSpot(){return this.B.portSpot}set alternatePortSpot(t){this.B.portSpot.equals(t)||(this.B.portSpot=t,this.p())}get alternateSetsChildPortSpot(){return this.B.setsChildPortSpot}set alternateSetsChildPortSpot(t){this.B.setsChildPortSpot!==t&&(U.s(t,"boolean",TreeLayout,"alternateSetsChildPortSpot"),this.B.setsChildPortSpot=t,this.p())}get alternateChildPortSpot(){return this.B.childPortSpot}set alternateChildPortSpot(t){this.B.childPortSpot.equals(t)||(this.B.childPortSpot=t,this.p())}static PathDefault=0;static PathDestination=1;static PathSource=2;static SortingForwards=10;static SortingReverse=11;static SortingAscending=12;static SortingDescending=13;static AlignmentCenterSubtrees=20;static AlignmentCenterChildren=21;static AlignmentStart=22;static AlignmentEnd=23;static AlignmentBus=24;static AlignmentBusBranching=25;static AlignmentTopLeftBus=26;static AlignmentBottomRightBus=27;static CompactionNone=30;static CompactionBlock=31;static StyleLayered=40;static StyleLastParents=41;static StyleAlternating=42;static StyleRootOnly=43;static ArrangementVertical=50;static ArrangementHorizontal=51;static ArrangementFixedRoots=52;static LayerIndividual=60;static LayerSiblings=61;static LayerUniform=62}class TreeNetwork extends LayoutNetwork{constructor(t){super(t)}createVertex(){return new TreeVertex(this)}createEdge(){return new TreeEdge(this)}}class TreeVertex extends LayoutVertex{U;dt;at;mP;pP;yP;wP;xP;bP;kP;zi;Zg;Qg;Si;Mi;Xt;de;Fw;Rw;Ow;Us;Iw;Ew;Uw;Vw;Bw;zw;Xw;Gw;Yw;Kw;Hw;constructor(t){super(t),this.mP=!1,this.pP=null,this.yP=[],this.wP=0,this.xP=0,this.bP=0,this.kP=0,this.zi=null,this.U=new Point(0,0),this.dt=new Size(0,0),this.at=new Point(0,0),this.Zg=null,this.Qg=null,this.Si=10,this.Mi=LayoutVertex.standardComparer,this.Xt=0,this.de=21,this.Fw=0,this.Rw=0,this.Ow=20,this.Us=50,this.Iw=0,this.Ew=31,this.Uw=0,this.Vw=25,this.Bw=10,this.zw=10,this.Xw=20,this.Gw=!0,this.Yw=Spot.Default,this.Kw=!0,this.Hw=Spot.Default}copyInheritedPropertiesFrom(t){t!==null&&(this.Si=t.sorting,this.Mi=t.comparer,this.Xt=t.angle,this.de=t.alignment,this.Fw=t.nodeIndent,this.Rw=t.nodeIndentPastParent,this.Ow=t.nodeSpacing,this.Us=t.layerSpacing,this.Iw=t.layerSpacingParentOverlap,this.Ew=t.compaction,this.Uw=t.breadthLimit,this.Vw=t.rowSpacing,this.Bw=t.rowIndent,this.zw=t.commentSpacing,this.Xw=t.commentMargin,this.Gw=t.setsPortSpot,this.Yw=t.portSpot,this.Kw=t.setsChildPortSpot,this.Hw=t.childPortSpot)}get initialized(){return this.mP}set initialized(t){this.mP!==t&&(U.s(t,"boolean",TreeVertex,"initialized"),this.mP=t)}get parent(){return this.pP}set parent(t){this.pP!==t&&(this.pP=t)}get children(){return this.yP}set children(t){if(this.yP!==t){if(t!==null&&!Array.isArray(t)&&U.si(t,"Array",TreeVertex,"children:value"),t!==null){const e=t.length;for(let i=0;i<e;i++){const s=t[i]}}this.yP=t}}get level(){return this.wP}set level(t){this.wP!==t&&(U.s(t,"number",TreeVertex,"level"),this.wP=t)}get descendantCount(){return this.xP}set descendantCount(t){this.xP!==t&&(U.s(t,"number",TreeVertex,"descendantCount"),this.xP=t)}get maxChildrenCount(){return this.bP}set maxChildrenCount(t){this.bP!==t&&(U.s(t,"number",TreeVertex,"maxChildrenCount"),this.bP=t)}get maxGenerationCount(){return this.kP}set maxGenerationCount(t){this.kP!==t&&(U.s(t,"number",TreeVertex,"maxGenerationCount"),this.kP=t)}get comments(){return this.zi}set comments(t){if(this.zi!==t){if(t!==null&&!Array.isArray(t)&&U.si(t,"Array",TreeVertex,"comments:value"),t!==null){const e=t.length;for(let i=0;i<e;i++){const s=t[i]}}this.zi=t}}get sorting(){return this.Si}set sorting(t){this.Si!==t&&(this.Si=t)}get comparer(){return this.Mi}set comparer(t){this.Mi!==t&&(U.S(t,TreeVertex,"comparer"),this.Mi=t)}get angle(){return this.Xt}set angle(t){this.Xt!==t&&(U.s(t,"number",TreeVertex,"angle"),this.Xt=t)}get alignment(){return this.de}set alignment(t){this.de!==t&&(this.de=t)}get nodeIndent(){return this.Fw}set nodeIndent(t){this.Fw!==t&&(U.s(t,"number",TreeVertex,"nodeIndent"),this.Fw=t)}get nodeIndentPastParent(){return this.Rw}set nodeIndentPastParent(t){this.Rw!==t&&(U.s(t,"number",TreeVertex,"nodeIndentPastParent"),this.Rw=t)}get nodeSpacing(){return this.Ow}set nodeSpacing(t){this.Ow!==t&&(U.s(t,"number",TreeVertex,"nodeSpacing"),this.Ow=t)}get layerSpacing(){return this.Us}set layerSpacing(t){this.Us!==t&&(U.s(t,"number",TreeVertex,"layerSpacing"),this.Us=t)}get layerSpacingParentOverlap(){return this.Iw}set layerSpacingParentOverlap(t){this.Iw!==t&&(U.s(t,"number",TreeVertex,"layerSpacingParentOverlap"),this.Iw=t)}get compaction(){return this.Ew}set compaction(t){this.Ew!==t&&(this.Ew=t)}get breadthLimit(){return this.Uw}set breadthLimit(t){this.Uw!==t&&(U.s(t,"number",TreeVertex,"breadthLimit"),this.Uw=t)}get rowSpacing(){return this.Vw}set rowSpacing(t){this.Vw!==t&&(U.s(t,"number",TreeVertex,"rowSpacing"),this.Vw=t)}get rowIndent(){return this.Bw}set rowIndent(t){this.Bw!==t&&(U.s(t,"number",TreeVertex,"rowIndent"),this.Bw=t)}get commentSpacing(){return this.zw}set commentSpacing(t){this.zw!==t&&(U.s(t,"number",TreeVertex,"commentSpacing"),this.zw=t)}get commentMargin(){return this.Xw}set commentMargin(t){this.Xw!==t&&(U.s(t,"number",TreeVertex,"commentMargin"),this.Xw=t)}get setsPortSpot(){return this.Gw}set setsPortSpot(t){this.Gw!==t&&(U.s(t,"boolean",TreeVertex,"setsPortSpot"),this.Gw=t)}get portSpot(){return this.Yw}set portSpot(t){this.Yw.equals(t)||(this.Yw=t)}get setsChildPortSpot(){return this.Kw}set setsChildPortSpot(t){this.Kw!==t&&(U.s(t,"boolean",TreeVertex,"setsChildPortSpot"),this.Kw=t)}get childPortSpot(){return this.Hw}set childPortSpot(t){this.Hw.equals(t)||(this.Hw=t)}get childrenCount(){return this.children.length}get relativePosition(){return this.U}set relativePosition(t){this.U.set(t)}get subtreeSize(){return this.dt}set subtreeSize(t){this.dt.set(t)}get subtreeOffset(){return this.at}set subtreeOffset(t){this.at.set(t)}}class TreeEdge extends LayoutEdge{PP;constructor(t){super(t),this.PP=new Point(0,0)}commit(){const t=this.link;if(t===null||t.isAvoiding)return;const e=this.network.layout;let i=null,s=null;switch(e.ws){case 1:i=this.fromVertex,s=this.toVertex;break;case 2:i=this.toVertex,s=this.fromVertex;break;default:U.o("Unhandled path value "+e.ws.toString())}if(i===null||s===null)return;const n=this.PP;if(n.x===0&&n.y===0){this.PU(i,s);return}const o=i.bounds,r=e.orthoAngle(i),l=e.computeLayerSpacing(i),a=i.rowSpacing;t.updateRoute();const h=t.curve===9,c=t.isOrthogonal;let f=0,u,d;if(t.startRoute(),c||h){for(f=2;t.pointsCount>4;)t.removePoint(2);u=t.getPoint(1),d=t.getPoint(2)}else{for(f=1;t.pointsCount>3;)t.removePoint(1);u=t.getPoint(0),d=t.getPoint(t.pointsCount-1)}const m=t.getPoint(t.pointsCount-1);let g=0;r===0?(i.alignment===23?(g=o.bottom+n.y,n.y===0&&u.y>m.y+i.rowIndent&&(g=Math.min(g,Math.max(u.y,g-e.computeNodeIndent(i))))):i.alignment===22?(g=o.top+n.y,n.y===0&&u.y<m.y-i.rowIndent&&(g=Math.max(g,Math.min(u.y,g+e.computeNodeIndent(i))))):g=o.y+o.height/2+n.y,h?(t.insertPointAt(f,u.x,g),f++,t.insertPointAt(f,o.right+l,g),f++,t.insertPointAt(f,o.right+l+(n.x-a)/3,g),f++,t.insertPointAt(f,o.right+l+(n.x-a)*2/3,g),f++,t.insertPointAt(f,o.right+l+(n.x-a),g),f++,t.insertPointAt(f,d.x,g),f++):(c&&(t.insertPointAt(f,o.right+l/2,u.y),f++),t.insertPointAt(f,o.right+l/2,g),f++,t.insertPointAt(f,o.right+l+n.x-(c?a/2:a),g),f++,c&&(t.insertPointAt(f,t.getPoint(f-1).x,d.y),f++))):r===90?(i.alignment===23?(g=o.right+n.x,n.x===0&&u.x>m.x+i.rowIndent&&(g=Math.min(g,Math.max(u.x,g-e.computeNodeIndent(i))))):i.alignment===22?(g=o.left+n.x,n.x===0&&u.x<m.x-i.rowIndent&&(g=Math.max(g,Math.min(u.x,g+e.computeNodeIndent(i))))):g=o.x+o.width/2+n.x,h?(t.insertPointAt(f,g,u.y),f++,t.insertPointAt(f,g,o.bottom+l),f++,t.insertPointAt(f,g,o.bottom+l+(n.y-a)/3),f++,t.insertPointAt(f,g,o.bottom+l+(n.y-a)*2/3),f++,t.insertPointAt(f,g,o.bottom+l+(n.y-a)),f++,t.insertPointAt(f,g,d.y),f++):(c&&(t.insertPointAt(f,u.x,o.bottom+l/2),f++),t.insertPointAt(f,g,o.bottom+l/2),f++,t.insertPointAt(f,g,o.bottom+l+n.y-(c?a/2:a)),f++,c&&(t.insertPointAt(f,d.x,t.getPoint(f-1).y),f++))):r===180?(i.alignment===23?(g=o.bottom+n.y,n.y===0&&u.y>m.y+i.rowIndent&&(g=Math.min(g,Math.max(u.y,g-e.computeNodeIndent(i))))):i.alignment===22?(g=o.top+n.y,n.y===0&&u.y<m.y-i.rowIndent&&(g=Math.max(g,Math.min(u.y,g+e.computeNodeIndent(i))))):g=o.y+o.height/2+n.y,h?(t.insertPointAt(f,u.x,g),f++,t.insertPointAt(f,o.left-l,g),f++,t.insertPointAt(f,o.left-l+(n.x+a)/3,g),f++,t.insertPointAt(f,o.left-l+(n.x+a)*2/3,g),f++,t.insertPointAt(f,o.left-l+(n.x+a),g),f++,t.insertPointAt(f,d.x,g),f++):(c&&(t.insertPointAt(f,o.left-l/2,u.y),f++),t.insertPointAt(f,o.left-l/2,g),f++,t.insertPointAt(f,o.left-l+n.x+(c?a/2:a),g),f++,c&&(t.insertPointAt(f,t.getPoint(f-1).x,d.y),f++))):r===270?(i.alignment===23?(g=o.right+n.x,n.x===0&&u.x>m.x+i.rowIndent&&(g=Math.min(g,Math.max(u.x,g-e.computeNodeIndent(i))))):i.alignment===22?(g=o.left+n.x,n.x===0&&u.x<m.x-i.rowIndent&&(g=Math.max(g,Math.min(u.x,g+e.computeNodeIndent(i))))):g=o.x+o.width/2+n.x,h?(t.insertPointAt(f,g,u.y),f++,t.insertPointAt(f,g,o.top-l),f++,t.insertPointAt(f,g,o.top-l+(n.y+a)/3),f++,t.insertPointAt(f,g,o.top-l+(n.y+a)*2/3),f++,t.insertPointAt(f,g,o.top-l+(n.y+a)),f++,t.insertPointAt(f,g,d.y),f++):(c&&(t.insertPointAt(f,u.x,o.top-l/2),f++),t.insertPointAt(f,g,o.top-l/2),f++,t.insertPointAt(f,g,o.top-l+n.y+(c?a/2:a)),f++,c&&(t.insertPointAt(f,d.x,t.getPoint(f-1).y),f++))):U.o("Invalid angle "+r),t.commitRoute()}PU(t,e){const i=this.link;if(i===null)return;const s=this.network.layout,n=s.orthoAngle(t),o=s.orthoAngle(e);if(n===o)return;const r=s.computeLayerSpacing(t),l=t.bounds,a=e.bounds;if(n===0&&a.left-l.right<r+1||n===90&&a.top-l.bottom<r+1||n===180&&l.left-a.right<r+1||n===270&&l.top-a.bottom<r+1)return;i.updateRoute();const h=i.curve===9,c=i.isOrthogonal,f=this.fromVertex,u=s.isBusAlignment(f.alignment);if(i.startRoute(),n===0){const d=l.right+r/2;if(h){if(i.pointsCount===4){const m=i.getPoint(3).y;i.setPointAt(1,d-20,i.getPoint(1).y),i.insertPointAt(2,d-20,m),i.insertPointAt(3,d,m),i.insertPointAt(4,d+20,m),i.setPointAt(5,i.getPoint(5).x,m)}}else c?u?i.setPointAt(3,i.getPoint(2).x,i.getPoint(4).y):i.pointsCount===6&&(i.setPointAt(2,d,i.getPoint(2).y),i.setPointAt(3,d,i.getPoint(3).y)):i.pointsCount===4?i.insertPointAt(2,d,i.getPoint(2).y):i.pointsCount===3?i.setPointAt(1,d,i.getPoint(2).y):i.pointsCount===2&&i.insertPointAt(1,d,i.getPoint(1).y)}else if(n===90){const d=l.bottom+r/2;if(h){if(i.pointsCount===4){const m=i.getPoint(3).x;i.setPointAt(1,i.getPoint(1).x,d-20),i.insertPointAt(2,m,d-20),i.insertPointAt(3,m,d),i.insertPointAt(4,m,d+20),i.setPointAt(5,m,i.getPoint(5).y)}}else c?u?i.setPointAt(3,i.getPoint(2).x,i.getPoint(4).y):i.pointsCount===6&&(i.setPointAt(2,i.getPoint(2).x,d),i.setPointAt(3,i.getPoint(3).x,d)):i.pointsCount===4?i.insertPointAt(2,i.getPoint(2).x,d):i.pointsCount===3?i.setPointAt(1,i.getPoint(2).x,d):i.pointsCount===2&&i.insertPointAt(1,i.getPoint(1).x,d)}else if(n===180){const d=l.left-r/2;if(h){if(i.pointsCount===4){const m=i.getPoint(3).y;i.setPointAt(1,d+20,i.getPoint(1).y),i.insertPointAt(2,d+20,m),i.insertPointAt(3,d,m),i.insertPointAt(4,d-20,m),i.setPointAt(5,i.getPoint(5).x,m)}}else c?u?i.setPointAt(3,i.getPoint(2).x,i.getPoint(4).y):i.pointsCount===6&&(i.setPointAt(2,d,i.getPoint(2).y),i.setPointAt(3,d,i.getPoint(3).y)):i.pointsCount===4?i.insertPointAt(2,d,i.getPoint(2).y):i.pointsCount===3?i.setPointAt(1,d,i.getPoint(2).y):i.pointsCount===2&&i.insertPointAt(1,d,i.getPoint(1).y)}else if(n===270){const d=l.top-r/2;if(h){if(i.pointsCount===4){const m=i.getPoint(3).x;i.setPointAt(1,i.getPoint(1).x,d+20),i.insertPointAt(2,m,d+20),i.insertPointAt(3,m,d),i.insertPointAt(4,m,d-20),i.setPointAt(5,m,i.getPoint(5).y)}}else c?u?i.setPointAt(3,i.getPoint(2).x,i.getPoint(4).y):i.pointsCount===6&&(i.setPointAt(2,i.getPoint(2).x,d),i.setPointAt(3,i.getPoint(3).x,d)):i.pointsCount===4?i.insertPointAt(2,i.getPoint(2).x,d):i.pointsCount===3?i.setPointAt(1,i.getPoint(2).x,d):i.pointsCount===2&&i.insertPointAt(1,i.getPoint(1).x,d)}i.commitRoute()}get fromVertex(){return this.is}set fromVertex(t){this.is!==t&&(this.is=t)}get toVertex(){return this.ss}set toVertex(t){this.ss!==t&&(this.ss=t)}get relativePoint(){return this.PP}set relativePoint(t){this.PP.set(t)}}class Themes{constructor(){}static Light={colors:{text:"#0a0a0a",comment:"#ca8a04",link:"#0a0a0a",group:"#a3a3a344",outline:"#a3a3a3",selection:"#0ea5e9",div:"#fff",gridMinor:"#e5e5e5",gridMajor:"#a3a3a3",overviewBox:"#c026d3",tempLink:"#2563eb",tempPort:"#c026d3",adornmentFill:"#0ea5e9",adornmentStroke:"#1e40af",dragSelect:"#c026d3"},fonts:{normal:"10pt sans-serif",bold:"bold 12pt sans-serif"},numbers:{group:1,selection:3},margins:{group:new Margin(5)},arrowheads:{toArrow:"Standard"}};static Dark={colors:{text:"#f5f5f5",comment:"#facc15",link:"#f5f5f5",group:"#a3a3a388",outline:"#a3a3a3",selection:"#38bdf8",div:"#171717",gridMinor:"#262626",gridMajor:"#404040",overviewBox:"#e879f9",tempLink:"#60a5fa",tempPort:"#e879f9",adornmentFill:"#38bdf8",adornmentStroke:"#2563eb",dragSelect:"#e879f9"},fonts:{normal:"10pt sans-serif",bold:"bold 12pt sans-serif"},numbers:{group:1,selection:3},margins:{group:new Margin(5)},arrowheads:{toArrow:"Standard"}}}class ThemeManager{hs=new Set;xu=new GMap;SP="light";MP="light";NP=!1;CL=!0;_g="light";BF=t=>{const e=t.matches?"dark":"light";e!==this._g&&(this._g=e,this.MP==="system"&&this.updateDiagrams())};constructor(t){t&&Object.assign(this,t),t?.themeMap||(this.xu.set("light",{colors:{...Themes.Light.colors},fonts:{...Themes.Light.fonts},numbers:{...Themes.Light.numbers},margins:{...Themes.Light.margins},arrowheads:{...Themes.Light.arrowheads}}),this.xu.set("dark",{colors:{...Themes.Dark.colors},fonts:{...Themes.Dark.fonts},numbers:{...Themes.Dark.numbers},margins:{...Themes.Dark.margins},arrowheads:{...Themes.Dark.arrowheads}})),root.matchMedia&&(this._g=root.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")}get themeMap(){return this.xu}set themeMap(t){this.xu!==t&&(this.xu=t,this.updateDiagrams())}get defaultTheme(){return this.SP}set defaultTheme(t){this.SP!==t&&(U.s(t,"string",ThemeManager,"defaultTheme"),this.SP=t,this.updateDiagrams())}get currentTheme(){return this.MP}set currentTheme(t){this.MP!==t&&(U.s(t,"string",ThemeManager,"currentTheme"),this.MP=t,this.updateDiagrams())}get changesDivBackground(){return this.NP}set changesDivBackground(t){if(this.NP!==t&&(this.NP=t,t))for(const i of this.hs)i.setDivBackground(this.findValue("div","","fill")),i.T("ThemeChanged",this)}get readsCssVariables(){return this.CL}set readsCssVariables(t){this.CL!==t&&(this.CL=t,this.updateDiagrams())}get preferredColorScheme(){return this._g}addDiagram(t){return this.hs.add(t),this.LL(t),this}removeDiagram(t){return this.hs.delete(t),this.LL(t),this}eO(){this.hs.size===0&&root.matchMedia&&root.matchMedia("(prefers-color-scheme: dark)")?.addEventListener("change",this.BF)}iO(){this.hs.size===0&&root.matchMedia&&root.matchMedia("(prefers-color-scheme: dark)")?.removeEventListener("change",this.BF)}set(t,e){t===""&&(t=this.SP),t==="system"&&(t=this._g);let i=this.xu.get(t);return i?i=this.zF(i,e):i=e,this.xu.set(t,i),this.updateDiagrams(),this}findValue(t,e,i){return this.getValue(this.findTheme(this.currentTheme),t,e,i)||this.getValue(this.findTheme(this.defaultTheme),t,e,i)}getValue(t,e,i,s){if(!t)return;i==null&&(i="");let n=t;const o=l=>{if(n===void 0||l==="")return;if(typeof l=="number"||!(Array.isArray(l)||l.includes(".")))return n[l];const a=Array.isArray(l)?l:l.split(".");for(let h=0;h<a.length;h++){const c=a[h];if(c!==""&&(n=n[c],n===void 0))return}return n},r=()=>{if(!(i!==""&&(n=o(i),n===void 0)))return Array.isArray(n)&&typeof e=="number"?n=n[e%n.length]:n=o(e),n};if(n=r(),n===void 0&&typeof s=="string"&&s.length>0){let l=t.targetPropertyMap?.get(s);if(l?n=t[l]:(l=ThemeManager.SU.get(s),n=l?t[l]:t.colors),n=r(),n!==void 0)return n}return n}findTheme(t){return this.themeMap.get(t==="system"?this._g:t)}updateDiagrams(){for(const t of this.hs)this.LL(t)}LL(t){const e=t.skipsUndoManager;t.skipsUndoManager=!0,t.updateAllThemeBindings(),this.NP&&t.setDivBackground(this.findValue("div","","fill")),t.skipsUndoManager=e,t.T("ThemeChanged",this)}zF(t,e){for(const i in e)if(U.qw(e,i))try{e[i]?.constructor===Object?t[i]=this.zF(t[i]??{},e[i]):t[i]=e[i]}catch{delete t[i]}return t}static SU=new Map([["background","colors"],["defaultColumnSeparatorStroke","colors"],["defaultRowSeparatorStroke","colors"],["shadowColor","colors"],["fill","colors"],["stroke","colors"],["font","fonts"],["angle","numbers"],["fromEndSegmentLength","numbers"],["fromShortLength","numbers"],["height","numbers"],["opacity","numbers"],["scale","numbers"],["toEndSegmentLength","numbers"],["toShortLength","numbers"],["width","numbers"],["defaultColumnSeparatorStrokeWidth","numbers"],["defaultRowSeparatorStrokeWidth","numbers"],["shadowBlur","numbers"],["corner","numbers"],["curviness","numbers"],["smoothness","numbers"],["parameter1","numbers"],["parameter2","numbers"],["strokeWidth","numbers"],["strokeDashOffset","numbers"],["maxLines","numbers"],["spacingAbove","numbers"],["spacingBelow","numbers"],["position","points"],["shadowOffset","points"],["desiredSize","sizes"],["maxSize","sizes"],["minSize","sizes"],["margin","margins"],["defaultSeparatorPadding","margins"],["padding","margins"],["alignment","spots"],["alignmentFocus","spots"],["fromSpot","spots"],["toSpot","spots"],["defaultAlignment","spots"],["spot1","spots"],["spot2","spots"],["verticalAlignment","spots"],["imageAlignment","spots"],["fromArrow","arrowheads"],["toArrow","arrowheads"]])}class Router{Pt;a;Be;Pl;constructor(){this.a=Diagram.Om(),this.Pt="",this.Be=!0,this.Pl=!0}get name(){return this.Pt}set name(t){this.Pt=t}get isEnabled(){return this.Be}set isEnabled(t){this.Be=t}get isRealtime(){return this.Pl}set isRealtime(t){this.Pl=t}get diagram(){return this.a}set diagram(t){this.a!==t&&(this.a=t,t.Fl=!0,t.requestUpdate())}invalidateRouter(){this.a!==null&&(this.a.Fl=!0,this.a.requestUpdate())}canRoute(t){if(!this.isEnabled)return!1;const e=this.diagram;return!(e&&(!this.isRealtime&&e.Ou||e.animationManager.isTicking))}isRoutable(t,e){return!0}routeLinks(t,e){}toString(){return this.name!==""?this.name+" Router":U.Kn(this.constructor)}}class AvoidsNodesRouter extends Router{constructor(t){super(),this.name="AvoidsNodes",t&&Object.assign(this,t)}canRoute(t){return(t instanceof Diagram?t.lp:t.diagram?.lp)?super.canRoute(t):!1}isRoutable(t,e){return!(!t.isAvoiding||t.containingGroup!==(e instanceof Group?e:null)||t.toNode===null||t.fromNode===null||t.pointsCount<4)}routeLinks(t,e){const i=e instanceof Diagram?null:e,s=t.iterator,n=this.diagram.getPositions(!0,i,null);for(;s.next();){const o=s.value;if(!this.isRoutable(o,e))continue;o.startRoute();const r=o.pointsCount,l=o.getPoint(1),a=o.getPoint(r-2),h=o.fromNode.actualBounds.copy();h.inflate(Link.Fa,Link.Fa),h.unionPoint(o.getPoint(0));const c=o.toNode.actualBounds.copy();c.inflate(Link.Fa,Link.Fa),c.unionPoint(o.getPoint(r-1)),this.MU(o,h,c,n)&&this.NU(o,l,o.SC,a,o.MC,h,c,n),o.commitRoute()}}MU(t,e,i,s){const n=t.diagram,o=t.pointsCount;if(n===null||!t.fromNode||!t.toNode||t.fromNode===t.toNode||!t.layer||t.layer.isTemporary||e.containsPoint(t.getPoint(o-1))&&!t.toNode.isMemberOf(t.fromNode)||i.containsPoint(t.getPoint(0))&&!t.fromNode.isMemberOf(t.toNode)||!t.isOrthogonal)return!1;if(t.segmentIndex===17)return!0;const r=t.getPoint(1),l=t.getPoint(o-2),a=t.getPoint(2);if(!s.isUnoccupied(Math.min(r.x,a.x),Math.min(r.y,a.y),Math.abs(r.x-a.x),Math.abs(r.y-a.y)))return!0;for(let c=2;c<o-3;c++){const f=t.getPoint(c),u=t.getPoint(c+1);if(!s.isUnoccupied(Math.min(f.x,u.x),Math.min(f.y,u.y),Math.abs(f.x-u.x),Math.abs(f.y-u.y)))return!0}const h=t.getPoint(o-3);return!s.isUnoccupied(Math.min(h.x,l.x),Math.min(h.y,l.y),Math.abs(h.x-l.x),Math.abs(h.y-l.y))}NU(t,e,i,s,n,o,r,l){const a=t.diagram;if(a===null)return;const h=e,c=s;let f=Point.gn,u=Point.gn;if(a.isVirtualized){const g=l.bounds.copy(),p=t.getPoint(2),y=t.getPoint(t.pointsCount-3);g.inflate(-l.cellWidth,-l.cellHeight);const x=Point.l();l.ng(e.x,e.y)||(G.Cl(g.x,g.y,g.x+g.width,g.y+g.height,e.x,e.y,p.x,p.y,x)?(f=e=x.copy(),i=x.directionPoint(p)):G.Cl(g.x,g.y,g.x+g.width,g.y+g.height,p.x,p.y,y.x,y.y,x)?(f=e=x.copy(),i=x.directionPoint(y)):G.Cl(g.x,g.y,g.x+g.width,g.y+g.height,y.x,y.y,s.x,s.y,x)&&(f=e=x.copy(),i=x.directionPoint(s))),l.ng(s.x,s.y)||(G.Cl(g.x,g.y,g.x+g.width,g.y+g.height,s.x,s.y,y.x,y.y,x)?(u=s=x.copy(),n=y.directionPoint(x)):G.Cl(g.x,g.y,g.x+g.width,g.y+g.height,y.x,y.y,p.x,p.y,x)?(u=s=x.copy(),n=p.directionPoint(x)):G.Cl(g.x,g.y,g.x+g.width,g.y+g.height,p.x,p.y,e.x,e.y,x)&&(u=s=x.copy(),n=e.directionPoint(x))),Point.i(x)}const d=o.copy().unionRect(r);d.inflate(l.cellWidth*l.af,l.cellHeight*l.af),l.wv(e,i,s,n,d,!0);let m=l.xo(s.x,s.y);if(!l.tw&&m>=PositionArray.sg&&(l.vT(),d.inflate(l.cellWidth*l.U2,l.cellHeight*l.V2),l.wv(e,i,s,n,d,!1),m=l.xo(s.x,s.y)),!l.tw&&m<PositionArray.sg&&!l.GE(s.x,s.y)){t.points.removeRange(2,t.pointsCount-3),this.AL(t,l,s.x,s.y,n,!0);const g=0,p=90,y=180,x=270,b=t.getPoint(2);if(t.pointsCount<4)i===g||i===y?(b.x=e.x,b.y=s.y):(b.x=s.x,b.y=e.y),t.setPointAt(2,b.x,b.y),t.insertPointAt(3,b.x,b.y);else{const k=t.getPoint(3);if(i===g||i===y)if(G.c(b.x,k.x)){const P=i===g?Math.max(b.x,e.x):Math.min(b.x,e.x);t.setPointAt(2,P,e.y),t.setPointAt(3,P,k.y)}else G.c(b.y,k.y)?(Math.abs(e.y-b.y)<=l.cellHeight/2&&(t.setPointAt(2,b.x,e.y),t.setPointAt(3,k.x,e.y)),t.insertPointAt(2,b.x,e.y)):t.setPointAt(2,e.x,b.y);else if(i===p||i===x)if(G.c(b.y,k.y)){const P=i===p?Math.max(b.y,e.y):Math.min(b.y,e.y);t.setPointAt(2,e.x,P),t.setPointAt(3,k.x,P)}else G.c(b.x,k.x)?(Math.abs(e.x-b.x)<=l.cellWidth/2&&(t.setPointAt(2,e.x,b.y),t.setPointAt(3,e.x,k.y)),t.insertPointAt(2,e.x,b.y)):t.setPointAt(2,b.x,e.y)}if(f.isReal()){const k=t.getPoint(1),P=t.getPoint(2);k.x!==P.x&&k.y!==P.y?i===g||i===y?t.insertPointAt(2,k.x,P.y):t.insertPointAt(2,P.x,k.y):i===g||i===y?t.insertPointAt(2,h.x,f.y):t.insertPointAt(2,f.x,h.y)}u.isReal()&&(n===g||n===y?t.insertPointAt(t.pointsCount-2,c.x,u.y):t.insertPointAt(t.pointsCount-2,u.x,c.y))}}AL(t,e,i,s,n,o){const c=e.cellWidth,f=e.cellHeight;let u=e.xo(i,s),d=i,m=s,g=d,p=m;for(n===0?g+=c:n===90?p+=f:n===180?g-=c:p-=f,t.vC&&u>PositionArray.sc&&e.xo(g,p)!==u-1&&(e.xo(d-c,m)===u-1?(n=180,g=d-c,p=m):e.xo(d+c,m)===u-1?(n=0,g=d+c,p=m):e.xo(d,m-f)===u-1?(n=270,g=d,p=m-f):e.xo(d,m+f)===u-1&&(n=90,g=d,p=m+f));u>PositionArray.sc&&e.xo(g,p)===u-1;)d=g,m=p,n===0?g+=c:n===90?p+=f:n===180?g-=c:p-=f,u-=1;if(o?u>PositionArray.sc&&(n===180||n===0?d=Math.floor(d/c)*c+c/2:(n===90||n===270)&&(m=Math.floor(m/f)*f+f/2)):(d=Math.floor(d/c)*c+c/2,m=Math.floor(m/f)*f+f/2),u>PositionArray.sc){let y=n,x=d,b=m;if(n===0?(y=90,b+=f):n===90?(y=180,x-=c):n===180?(y=270,b-=f):n===270&&(y=0,x+=c),e.xo(x,b)===u-1)this.AL(t,e,x,b,y,!1);else{let P=d,S=m;n===0?(y=270,S-=f):n===90?(y=0,P+=c):n===180?(y=90,S+=f):n===270&&(y=180,P-=c),e.xo(P,S)===u-1&&this.AL(t,e,P,S,y,!1)}}t.insertPointAt(t.pointsCount-2,d,m)}}ToolManager.prototype.initializeStandardTools=function(){return this.Jt("Action",new ActionTool,this.mouseDownTools),this.Jt("Relinking",new RelinkingTool,this.mouseDownTools),this.Jt("LinkReshaping",new LinkReshapingTool,this.mouseDownTools),this.Jt("Rotating",new RotatingTool,this.mouseDownTools),this.Jt("Resizing",new ResizingTool,this.mouseDownTools),this.Jt("Linking",new LinkingTool,this.mouseMoveTools),this.Jt("Dragging",new DraggingTool,this.mouseMoveTools),this.Jt("DragSelecting",new DragSelectingTool,this.mouseMoveTools),this.Jt("Panning",new PanningTool,this.mouseMoveTools),this.Jt("ContextMenu",new ContextMenuTool,this.mouseUpTools),this.Jt("TextEditing",new TextEditingTool,this.mouseUpTools),this.Jt("ClickCreating",new ClickCreatingTool,this.mouseUpTools),this.Jt("ClickSelecting",new ClickSelectingTool,this.mouseUpTools),this};Diagram.m2("GraphLinksModel",GraphLinksPartManager);Diagram.m2("TreeModel",TreePartManager);const oldGo=root.go,go={get version(){return Diagram.version},Group,List,Set:GSet,Map:GMap,Point,Size,Rect,Margin,Spot,Geometry,PathFigure,PathSegment,InputEvent,DiagramEvent,ChangedEvent,Model,GraphLinksModel,TreeModel,Binding,ThemeBinding,Transaction,UndoManager,CommandHandler,Tool,DraggingTool,DraggingInfo,DraggingOptions,LinkingBaseTool,LinkingTool,RelinkingTool,LinkReshapingTool,ResizingTool,RotatingTool,ClickSelectingTool,ActionTool,ClickCreatingTool,HTMLInfo,ContextMenuTool,DragSelectingTool,PanningTool,TextEditingTool,ToolManager,Animation,AnimationManager,AnimationTrigger,Layer,Diagram,Palette,Overview,Brush,GraphObject,Panel,RowColumnDefinition,Shape,TextBlock,Picture,Part,Adornment,Node,Link,Placeholder,Layout,LayoutNetwork,LayoutVertex,LayoutEdge,GridLayout,PanelLayout,CircularLayout,CircularNetwork,CircularVertex,CircularEdge,ForceDirectedLayout,ForceDirectedNetwork,ForceDirectedVertex,ForceDirectedEdge,LayeredDigraphLayout,LayeredDigraphNetwork,LayeredDigraphVertex,LayeredDigraphEdge,TreeLayout,TreeNetwork,TreeVertex,TreeEdge,Themes,ThemeManager,Router,AnimationStyle,AutoScale,CycleMode,Flip,TextFormat,ImageStretch,LayoutConditions,LinkAdjusting,Curve,Routing,Orientation,TextOverflow,PortSpreading,ScrollMode,CollapsePolicy,Sizing,TriggerStart,Stretch,ViewboxStretch,Wrap,BrushType,ColorSpace,GeometryStretch,GeometryType,SegmentType,BindingMode,ChangeType,CircularArrangement,CircularDirection,CircularNodeDiameterFormula,CircularSorting,GridAlignment,GridArrangement,GridSorting,LayeredDigraphAggressive,LayeredDigraphAlign,LayeredDigraphCycleRemove,LayeredDigraphInit,LayeredDigraphLayering,LayeredDigraphPack,TreeAlignment,TreeArrangement,TreeCompaction,TreeLayerStyle,TreePath,TreeSorting,TreeStyle,GestureMode,LinkingDirection,ReshapingBehavior,TextEditingAccept,TextEditingStarting,TextEditingState,WheelMode};for(const w in go){const t=go[w];U.st(t)&&t!==TextFormat&&(t.className=w)}U.$(oldGo)&&oldGo.version&&U.ne("WARNING: a `go` object on the root object is already defined.  "+("Debug"in oldGo?"debug ":"")+"version: "+oldGo.version+", replaced with version: "+go.version);Diagram.prototype.go=go;root.go=go;
})();
  "function"===typeof define&&define.amd&&define("undefined"!==typeof global?global.go:self.go);
  'undefined'!==typeof module&&'object'===typeof module.exports&&(module.exports='undefined'!==typeof global?global.go:self.go);
  